<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>Service Mesh</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2024/02/29/service-mesh/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!--<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />-->

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?ousiax" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Service Mesh</h1>
    
    
    <p class="post-meta"><time datetime="2024-02-29T14:15:22+08:00" itemprop="datePublished">Feb 29, 2024</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://istio.io/">Istio</a> addresses the challenges developers and operators face with a distributed or microservices architecture. <a href="#istio-service-mesh">[1]</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://istio.io/latest/img/service-mesh.svg" alt="Service mesh" width="45%" height="45%">
</div>
<div class="title">Figure 1. By adding a proxy "sidecar" along with every application deployed, Istio lets you program application-aware traffic management, incredible observability, and robust security capabilities into your network.</div>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#what-is-a-service-mesh">1. What is a Service Mesh</a></li>
<li><a href="#whats-istio">2. What&#8217;s Istio?</a>
<ul class="sectlevel2">
<li><a href="#architecture">2.1. Architecture</a></li>
<li><a href="#install-istio">2.2. Install Istio</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="what-is-a-service-mesh">1. What is a Service Mesh</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Modern applications are typically architected as distributed collections of microservices, with each collection of microservices performing some discrete business function. <a href="#istio-service-mesh">[1]</a></p>
</div>
<div class="paragraph">
<p>A <em>service mesh</em> is a dedicated infrastructure layer that you can add to your applications. It allows you to transparently add capabilities like <em>observability</em>, <em>traffic management</em>, and <em>security</em>, without adding them to your own code.</p>
</div>
<div class="paragraph">
<p>The term “service mesh” describes both the type of software you use to implement this pattern, and the security or network domain that is created when you use that software.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="whats-istio">2. What&#8217;s Istio?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Istio is an open source service mesh that layers transparently onto existing distributed applications.</p>
</div>
<div class="paragraph">
<p>Istio’s powerful features provide a uniform and more efficient way to secure, connect, and monitor services. Istio is the path to load balancing, service-to-service authentication, and monitoring – with few or no service code changes. Its powerful control plane brings vital features, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Secure service-to-service communication in a cluster with TLS encryption, strong identity-based authentication and authorization</p>
</li>
<li>
<p>Automatic load balancing for HTTP, gRPC, WebSocket, and TCP traffic</p>
</li>
<li>
<p>Fine-grained control of traffic behavior with rich routing rules, retries, failovers, and fault injection</p>
</li>
<li>
<p>A pluggable policy layer and configuration API supporting access controls, rate limits and quotas</p>
</li>
<li>
<p>Automatic metrics, logs, and traces for all traffic within a cluster, including cluster ingress and egress</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Istio’s control plane runs on Kubernetes, and you can add applications deployed in that cluster to your mesh, extend the mesh to other clusters, or even connect VMs or other endpoints running outside of Kubernetes.</p>
</div>
<div class="sect2">
<h3 id="architecture">2.1. Architecture</h3>
<div class="paragraph">
<p>An Istio service mesh is logically split into a data plane and a control plane. <a href="#istio-architecture">[2]</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>data plane</em> is composed of a set of intelligent proxies (<a href="https://www.envoyproxy.io/">Envoy</a>) deployed as sidecars. These proxies mediate and control all network communication between microservices. They also collect and report telemetry on all mesh traffic.</p>
</li>
<li>
<p>The <em>control plane</em> manages and configures the proxies to route traffic.</p>
<div class="imageblock">
<div class="content">
<img src="https://istio.io/latest/docs/ops/deployment/architecture/arch.svg" alt="The overall architecture of an Istio-based application." width="55%" height="55%">
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Envoy</strong></p>
</div>
<div class="paragraph">
<p>Istio uses an extended version of the <a href="https://www.envoyproxy.io/">Envoy</a> proxy. Envoy is a high-performance proxy developed in C++ to mediate all inbound and outbound traffic for all services in the service mesh. Envoy proxies are the only Istio components that interact with data plane traffic.</p>
</div>
<div class="paragraph">
<p><strong>Istiod</strong></p>
</div>
<div class="paragraph">
<p>Istiod provides service discovery, configuration and certificate management.</p>
</div>
</div>
<div class="sect2">
<h3 id="install-istio">2.2. Install Istio</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go the the <a href="https://github.com/istio/istio/releases">Istio release</a> page to download the installation file for your OS, or download and extract the latest release automatically (Linux or macOS): <a href="#istio-getting-started">[3]</a></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">curl <span class="nt">-L</span> https://istio.io/downloadIstio | sh -</code></pre>
</div>
</div>
</li>
<li>
<p>Move to the Istio package directory. For example, if the package is <code>istio-1.20.3</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nb">cd </span>istio-1.20.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The installation directory contains:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Sample applications in <code>samples/</code></p>
</li>
<li>
<p>The <code>istioctl</code> client binary in the <code>bin/</code> directory.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Add the <code>istioctl</code> client to your path (Linux or macOS):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PWD</span>/bin:<span class="nv">$PATH</span></code></pre>
</div>
</div>
</li>
<li>
<p>For this installation, we use the <code>demo</code> <a href="https://istio.io/latest/docs/setup/additional-setup/config-profiles/">configuration profile</a>. It’s selected to have a good set of defaults for testing, but there are other profiles for production or performance testing.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>istioctl <span class="nb">install</span> <span class="nt">--set</span> <span class="nv">profile</span><span class="o">=</span>demo <span class="nt">-y</span>
<span class="go">✔ Istio core installed
✔ Istiod installed
✔ Egress gateways installed
✔ Ingress gateways installed
✔ Installation complete
Made this installation the default for injection and validation.</span></code></pre>
</div>
</div>
</li>
<li>
<p>Add a namespace label to instruct Istio to automatically inject Envoy sidecar proxies when you deploy your application later:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl label namespace default istio-injection<span class="o">=</span>enabled
<span class="go">namespace/default labeled</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Uninstall</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Istio uninstall deletes the RBAC permissions and all resources hierarchically under the <code>istio-system</code> namespace. It is safe to ignore errors for non-existent resources because they may have been deleted hierarchically.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">istioctl uninstall <span class="nt">-y</span> <span class="nt">--purge</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>istio-system</code> namespace is not removed by default. If no longer needed, use the following command to remove it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">kubectl delete namespace istio-system</code></pre>
</div>
</div>
<div class="paragraph">
<p>The label to instruct Istio to automatically inject Envoy sidecar proxies is not removed by default. If no longer needed, use the following command to remove it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">kubectl label namespace default istio-injection-</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="istio-service-mesh"></a>[1] <a href="https://istio.io/latest/about/service-mesh/" class="bare">https://istio.io/latest/about/service-mesh/</a></p>
</li>
<li>
<p><a id="istio-architecture"></a>[2] <a href="https://istio.io/latest/docs/ops/deployment/architecture/" class="bare">https://istio.io/latest/docs/ops/deployment/architecture/</a></p>
</li>
<li>
<p><a id="istio-getting-started"></a>[3] <a href="https://istio.io/latest/docs/setup/getting-started/" class="bare">https://istio.io/latest/docs/setup/getting-started/</a></p>
</li>
</ul>
</div>
</div>
</div>
    
<style>
  .utterances {
      max-width: 100%;
  }
</style>
<script src="https://utteranc.es/client.js"
        repo="ousiax/utterances"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2024/02/29/kubernetes-volumes/">&laquo; Kubernetes Volumes</a>
      
    </li>
    <li>
      
      <a href="/2024/03/09/what-is-helm/">What is Helm &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
