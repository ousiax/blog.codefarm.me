<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>Python for Data Analysis</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2024/05/27/python-for-data-analysis/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!--<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />-->

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?ousiax" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Python for Data Analysis</h1>
    
    
    <p class="post-meta"><time datetime="2024-05-27T08:51:12+08:00" itemprop="datePublished">May 7, 2025</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="preamble">
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">conda <span class="nb">install</span> <span class="nt">-y</span> pandas jupyter matplotlib  <span class="c"># /ˈnʌmpli/ /ˈpeɪ.dəns/ /ˈmæt.plɒt.lɪb/</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># import conventions
</span><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="n">statsmodels</span> <span class="k">as</span> <span class="n">sm</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">np</span><span class="p">.</span><span class="n">__version__</span> <span class="c1"># '2.2.4'
</span><span class="n">pd</span><span class="p">.</span><span class="n">__version__</span> <span class="c1"># '2.2.3'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># pd.options.display.max_columns = 20
# pd.options.display.max_colwidth = 80
# pd.options.display.max_rows = 20
# pd.options.display.max_colwidth = 80
# np.set_printoptions(precision=4, suppress=True)
# pd.reset_option('all')
# pd.reset_option('display.max_rows')</span></code></pre>
</div>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#numpy">1. NumPy</a>
<ul class="sectlevel2">
<li><a href="#arrays">1.1. arrays</a></li>
<li><a href="#arithmetic-operators-and-universal-functions">1.2. arithmetic operators, and universal functions</a></li>
<li><a href="#indexing-slicing-and-iterating">1.3. indexing, slicing and iterating</a></li>
<li><a href="#copies-and-views">1.4. copies and views</a></li>
<li><a href="#probability-distributions">1.5. probability distributions</a></li>
<li><a href="#array-oriented-programming">1.6. array-oriented programming</a></li>
<li><a href="#sorting">1.7. sorting</a></li>
<li><a href="#concatenating-and-splitting">1.8. concatenating and splitting</a></li>
<li><a href="#repeating-and-tiling">1.9. repeating and tiling</a></li>
<li><a href="#taking-and-putting">1.10. taking and putting</a></li>
<li><a href="#broadcasting">1.11. broadcasting</a></li>
<li><a href="#saving-and-loading">1.12. saving and loading</a></li>
</ul>
</li>
<li><a href="#pandas">2. Pandas</a>
<ul class="sectlevel2">
<li><a href="#series-dataframe-and-index">2.1. Series, DataFrame, and Index</a></li>
<li><a href="#essential-functionality">2.2. Essential Functionality</a>
<ul class="sectlevel3">
<li><a href="#reindexing">2.2.1. Reindexing</a></li>
<li><a href="#dropping-entries-from-an-axis">2.2.2. Dropping Entries from an Axis</a></li>
<li><a href="#indexing-selection-and-filtering">2.2.3. Indexing, Selection, and Filtering</a></li>
<li><a href="#arithmetic-and-data-alignment">2.2.4. Arithmetic and Data Alignment</a></li>
<li><a href="#function-application-and-mapping">2.2.5. Function Application and Mapping</a></li>
<li><a href="#sorting-and-ranking">2.2.6. Sorting and Ranking</a></li>
<li><a href="#axis-indexes-with-duplicate-labels">2.2.7. Axis Indexes with Duplicate Labels</a></li>
<li><a href="#unique-values-value-counts-and-membership">2.2.8. Unique Values, Value Counts, and Membership</a></li>
<li><a href="#numpy-arrays">2.2.9. NumPy Arrays</a></li>
</ul>
</li>
<li><a href="#reading-and-writing">2.3. Reading and Writing</a>
<ul class="sectlevel3">
<li><a href="#reading-and-writing-csv-text-files">2.3.1. Reading and Writing CSV Text Files</a></li>
<li><a href="#reading-and-writing-microsoft-excel-files">2.3.2. Reading and Writing Microsoft Excel Files</a></li>
<li><a href="#reading-and-writing-json-files">2.3.3. Reading and Writing JSON Files</a></li>
<li><a href="#reading-sql-based-databases">2.3.4. Reading SQL-based Databases</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#data-cleaning-and-preparation">3. Data Cleaning and Preparation</a>
<ul class="sectlevel2">
<li><a href="#handling-missing-data">3.1. Handling Missing Data</a></li>
<li><a href="#removing-duplicates">3.2. Removing Duplicates</a></li>
<li><a href="#transforming-data-using-a-function-or-mapping">3.3. Transforming Data Using a Function or Mapping</a></li>
<li><a href="#replacing-values">3.4. Replacing Values</a></li>
<li><a href="#renaming-axis-indexes">3.5. Renaming Axis Indexes</a></li>
<li><a href="#discretization-and-binning">3.6. Discretization and Binning</a></li>
<li><a href="#detecting-and-filtering-outliers">3.7. Detecting and Filtering Outliers</a></li>
<li><a href="#permutation-and-random-sampling">3.8. Permutation and Random Sampling</a></li>
<li><a href="#computing-indicatordummy-variables-one-hot-encoding">3.9. Computing Indicator/Dummy Variables: One-Hot Encoding</a></li>
<li><a href="#string-functions-in-pandas">3.10. String Functions in pandas</a></li>
<li><a href="#categorical-encoding">3.11. Categorical Encoding</a></li>
</ul>
</li>
<li><a href="#data-wrangling-join-combine-and-reshape">4. Data Wrangling: Join, Combine, and Reshape</a>
<ul class="sectlevel2">
<li><a href="#hierarchical-indexing">4.1. Hierarchical Indexing</a>
<ul class="sectlevel3">
<li><a href="#pivoting-stacking-and-unstacking">4.1.1. Pivoting, Stacking, and Unstacking</a></li>
<li><a href="#reordering-and-sorting-levels">4.1.2. Reordering and Sorting Levels</a></li>
<li><a href="#summary-statistics-by-level">4.1.3. Summary Statistics by Level</a></li>
<li><a href="#indexing-with-a-dataframes-columns">4.1.4. Indexing with a DataFrame’s columns</a></li>
</ul>
</li>
<li><a href="#combining-and-merging-datasets">4.2. Combining and Merging Datasets</a>
<ul class="sectlevel3">
<li><a href="#database-style-dataframe-joins">4.2.1. Database-Style DataFrame Joins</a></li>
<li><a href="#merging-on-index">4.2.2. Merging on Index</a></li>
<li><a href="#concatenating-along-an-axis">4.2.3. Concatenating Along an Axis</a></li>
<li><a href="#combining-data-with-overlap">4.2.4. Combining Data with Overlap</a></li>
</ul>
</li>
<li><a href="#reshaping-and-pivoting">4.3. Reshaping and Pivoting</a>
<ul class="sectlevel3">
<li><a href="#reshaping-with-hierarchical-indexing">4.3.1. Reshaping with Hierarchical Indexing</a></li>
<li><a href="#pivoting-long-to-wide-format">4.3.2. Pivoting Long to Wide Format</a></li>
<li><a href="#pivoting-wide-to-long-format">4.3.3. Pivoting Wide to Long Format</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#plotting-and-visualization">5. Plotting and Visualization</a>
<ul class="sectlevel2">
<li><a href="#figures-and-subplots">5.1. Figures and Subplots</a></li>
<li><a href="#colors-markers-and-line-styles">5.2. Colors, Markers, and Line Styles</a></li>
<li><a href="#ticks-labels-and-legends">5.3. Ticks, Labels, and Legends</a></li>
<li><a href="#annotations-and-drawing-on-a-subplot">5.4. Annotations and Drawing on a Subplot</a></li>
<li><a href="#plotting-with-pandas-and-seaborn">5.5. Plotting with pandas and seaborn</a>
<ul class="sectlevel3">
<li><a href="#line-and-bar-plots">5.5.1. Line and Bar Plots</a></li>
<li><a href="#histograms-and-density-plots">5.5.2. Histograms and Density Plots</a></li>
<li><a href="#scatter-or-point-plots">5.5.3. Scatter or Point Plots</a></li>
<li><a href="#facet-grids-and-categorical-data">5.5.4. Facet Grids and Categorical Data</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#data-aggregation-and-group-operations">6. Data Aggregation and Group Operations</a>
<ul class="sectlevel2">
<li><a href="#group-operations">6.1. Group Operations</a>
<ul class="sectlevel4">
<li><a href="#group-by-column-names">6.1.1. group by column names</a></li>
<li><a href="#iterate-over-groups">6.1.2. iterate over groups</a></li>
<li><a href="#select-a-column-or-subset-of-columns">6.1.3. select a column or subset of columns</a></li>
<li><a href="#group-with-arrays-dictionaries-series-and-functions">6.1.4. group with arrays, dictionaries, series, and functions</a></li>
<li><a href="#group-by-index-levels">6.1.5. group by index levels</a></li>
</ul>
</li>
<li><a href="#data-aggregation">6.2. Data Aggregation</a>
<ul class="sectlevel3">
<li><a href="#apply-a-list-of-functions-or-function-names">6.2.1. apply a list of functions or function names</a></li>
<li><a href="#apply-a-list-of-name-function-tuples-as-the-column-names">6.2.2. apply a list of (name, function) tuples as the column names</a></li>
<li><a href="#apply-a-list-of-functions-to-all-of-the-columns-or-different-functions-per-column">6.2.3. apply a list of functions to all of the columns or different functions per column</a></li>
<li><a href="#apply-a-sql-style-aggregation-without-row-indexes">6.2.4. apply a sql-style aggregation without row indexes</a></li>
</ul>
</li>
<li><a href="#apply-general-split-apply-combine">6.3. Apply: General split-apply-combine</a></li>
<li><a href="#group-transforms-and-unwrapped-groupbys">6.4. Group Transforms and Unwrapped GroupBys</a></li>
<li><a href="#pivot-tables-and-cross-tabulation">6.5. Pivot Tables and Cross-Tabulation</a></li>
<li><a href="#window-operations">6.6. Window Operations</a>
<ul class="sectlevel3">
<li><a href="#rolling-window">6.6.1. Rolling Window</a></li>
<li><a href="#expanding-window">6.6.2. Expanding Window</a></li>
<li><a href="#weighted-window">6.6.3. Weighted Window</a></li>
<li><a href="#binary-window-functions">6.6.4. Binary Window Functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#time-series">7. Time Series</a>
<ul class="sectlevel2">
<li><a href="#date-and-time-types">7.1. Date and Time Types</a></li>
<li><a href="#indexing-selection-subsetting">7.2. Indexing, Selection, Subsetting</a></li>
<li><a href="#date-ranges-frequencies-and-shifting">7.3. Date Ranges, Frequencies, and Shifting</a></li>
<li><a href="#periods-and-period-arithmetic">7.4. Periods and Period Arithmetic</a></li>
<li><a href="#resampling-and-frequency-conversion">7.5. Resampling and Frequency Conversion</a></li>
<li><a href="#moving-window-functions">7.6. Moving Window Functions</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="numpy">1. NumPy</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://numpy.org/">NumPy</a> (<strong>Num</strong>erical <strong>Py</strong>thon, /ˈnʌmpli/) is a library for the Python programming language that’s widely used in science and engineering, which contains multidimensional array data structures, such as the homogeneous, N-dimensional array (<code>ndarray</code>, /ˈændəriː/), and a large library of functions that operate efficiently on these data structures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="n">a</span><span class="p">.</span><span class="n">shape</span>  <span class="c1"># (2, 3)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># Integer types (signed and unsigned)
</span><span class="n">int8</span><span class="p">,</span> <span class="n">uint8</span>     <span class="c1"># i1, u1: 8-bit (1 byte) integers
</span><span class="n">int16</span><span class="p">,</span> <span class="n">uint16</span>   <span class="c1"># i2, u2: 16-bit integers
</span><span class="n">int32</span><span class="p">,</span> <span class="n">uint32</span>   <span class="c1"># i4, u4: 32-bit integers
</span><span class="n">int64</span><span class="p">,</span> <span class="n">uint64</span>   <span class="c1"># i8, u8: 64-bit integers
</span>
<span class="c1"># Floating-point types
</span><span class="n">float16</span>         <span class="c1"># f2: Half-precision (16-bit) floating point
</span><span class="n">float32</span>         <span class="c1"># f4 or f: Single-precision (32-bit) floating point; compatible with C float
</span><span class="n">float64</span>         <span class="c1"># f8 or d: Double-precision (64-bit) floating point; compatible with C double and Python float
</span><span class="n">float128</span>        <span class="c1"># f16 or g: Extended-precision (128-bit) floating point
</span>
<span class="c1"># Complex number types
</span><span class="n">complex64</span>       <span class="c1"># c8: Complex number with two 32-bit floats (real and imaginary parts)
</span><span class="n">complex128</span>      <span class="c1"># c16: Complex number with two 64-bit floats
</span><span class="n">complex256</span>      <span class="c1"># c32: Complex number with two 128-bit floats
</span>
<span class="c1"># Boolean type
</span><span class="nb">bool</span>            <span class="c1"># ?: Boolean values (True or False)
</span>
<span class="c1"># Object type
</span><span class="nb">object</span>          <span class="c1"># O: Python object type; can store any Python object
</span>
<span class="c1"># String and byte types
</span><span class="n">bytes_</span>          <span class="c1"># S: Fixed-length raw byte arrays (e.g., ASCII strings, 1 byte per character).
</span>                <span class="c1"># Use 'S10' for a byte string of length 10.
</span>                <span class="c1"># Each string is padded or truncated to fit the specified length.
</span><span class="n">str_</span>            <span class="c1"># U: Fixed-length Unicode strings using UTF-32 encoding (4 bytes per character).
</span>                <span class="c1"># Use 'U10' for a Unicode string of length 10.
</span>                <span class="c1"># Each string is padded or truncated to fit the specified length.
</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="arrays">1.1. arrays</h3>
<div class="paragraph">
<p>NumPy&#8217;s main object is the homogeneous multidimensional array (dimensions are called <em>axes</em>), known as <code>ndarray</code>, which is a table of same-type elements (usually numbers) indexed by a tuple of non-negative integers.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t think of NumPy&#8217;s N-d arrays solely as spatial points or coordinates; instead, picture them as structured data containers, like boxes within boxes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0D: a single box holding a single value without no axes.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">scalar</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
<span class="c1"># 5
</span><span class="nf">print</span><span class="p">(</span><span class="n">scalar</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># ()</span></code></pre>
</div>
</div>
</li>
<li>
<p>1D: A single row of boxes with one axis (axis 0).</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span> <span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
<span class="c1"># [10 20 30]
</span><span class="nf">print</span><span class="p">(</span><span class="n">vector</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># (3,)
</span><span class="n">vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># 20</span></code></pre>
</div>
</div>
</li>
<li>
<p>2D: A grid of boxes (rows and columns) with two axes: axis 0 (rows) and axis 1 (columns).</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="nf">print</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
<span class="c1"># [[1 2 3]
#  [4 5 6]]
</span><span class="nf">print</span><span class="p">(</span><span class="n">matrix</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># (2, 3)
</span><span class="nf">print</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="c1"># 4</span></code></pre>
</div>
</div>
</li>
<li>
<p>3D: A stack of grids (like layers of boxes) with three axes: axis 0 (depth), axis 1 (rows), and axis 2 (columns).</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tensor</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
                   <span class="p">[[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]]])</span>
<span class="nf">print</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
<span class="c1"># [[[1 2]
#   [3 4]]
#
#  [[5 6]
#   [7 8]]]
</span><span class="nf">print</span><span class="p">(</span><span class="n">tensor</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># (2, 2, 2)
</span><span class="nf">print</span><span class="p">(</span><span class="n">tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="c1"># 3</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>An <code>ndarray</code> is a data structure that consists of a pointer to a block of data in RAM or a memory-mapped file, a data type (<code>dtype</code>) describing fixed-size value cells, a tuple indicating the array&#8217;s <code>shape</code>, and a tuple of <code>strides</code> that specify the number of bytes to step to advance one element along a dimension.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># create a matrix with 2 rows and 3 columns
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2],
#        [3, 4, 5]])
</span>
<span class="c1"># the number of axes (dimensions) of the array
</span><span class="n">a</span><span class="p">.</span><span class="n">ndim</span>  <span class="c1"># 2
</span>
<span class="c1"># the dimensions of the array, a tuple of integers indicating the size of the array in each dimension
</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span>                 <span class="c1"># (2, 3)
</span><span class="n">a</span><span class="p">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="nf">len</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># True
</span>
<span class="c1"># the total number of elements of the array
</span><span class="n">a</span><span class="p">.</span><span class="n">size</span>  <span class="c1"># 6 = 2 x 3
</span>
<span class="kn">import</span> <span class="n">math</span>
<span class="n">a</span><span class="p">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">math</span><span class="p">.</span><span class="nf">prod</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># True
</span>
<span class="c1"># the size in bytes of each element of the array.
</span><span class="n">a</span><span class="p">.</span><span class="n">itemsize</span>  <span class="c1"># 8
</span>
<span class="c1"># the type of the elements in the array
</span><span class="n">a</span><span class="p">.</span><span class="n">dtype</span>       <span class="c1"># dtype('int64')
</span><span class="n">a</span><span class="p">.</span><span class="n">dtype</span><span class="p">.</span><span class="nb">type</span>  <span class="c1"># numpy.int64
</span><span class="n">a</span><span class="p">.</span><span class="n">dtype</span><span class="p">.</span><span class="n">name</span>  <span class="c1"># 'int64'
</span><span class="n">np</span><span class="p">.</span><span class="nf">issubdtype</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">integer</span><span class="p">)</span> <span class="c1"># True
</span>
<span class="c1"># show all of the parent classes of a specific data type
</span><span class="n">np</span><span class="p">.</span><span class="n">int64</span><span class="p">.</span><span class="nf">mro</span><span class="p">()</span>
<span class="c1"># [numpy.int64,
#  numpy.signedinteger,
#  numpy.integer,
#  numpy.number,
#  numpy.generic,
#  object]
</span>
<span class="c1"># the buffer containing the actual elements of the array.
</span><span class="n">a</span><span class="p">.</span><span class="n">data</span>  <span class="c1"># &lt;memory at 0x10424e190&gt;
</span>
<span class="c1"># the step-size required to move from one element to the next along a dimension in memory
</span><span class="n">a</span><span class="p">.</span><span class="n">strides</span>                 <span class="c1"># (24, 8)
</span><span class="n">a</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">"</span><span class="s">int32</span><span class="sh">"</span><span class="p">).</span><span class="n">strides</span> <span class="c1"># (12, 4)
</span><span class="n">a</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">"</span><span class="s">int16</span><span class="sh">"</span><span class="p">).</span><span class="n">strides</span> <span class="c1"># (6, 2)
</span><span class="n">a</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">"</span><span class="s">int8</span><span class="sh">"</span><span class="p">).</span><span class="n">strides</span>  <span class="c1"># (3, 1)</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># reshape, ravel, flatten
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="c1"># array([0, 1, 2, 3, 4, 5, 6, 7])
</span><span class="n">a</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2, 3],
#        [4, 5, 6, 7]])
</span><span class="n">a</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># a negtive number
# array([[0, 1, 2, 3],
#        [4, 5, 6, 7]])
</span><span class="n">a</span><span class="p">.</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># a tuple
# array([[0, 1, 2, 3],
#        [4, 5, 6, 7]])
</span>
<span class="c1"># return a flattened array collapsed into one dimension
</span><span class="n">a</span><span class="p">.</span><span class="nf">ravel</span><span class="p">()</span>
<span class="c1"># array([0, 1, 2, 3, 4, 5, 6, 7])
</span>
<span class="c1"># return a copy of the array collapsed into one dimension
</span><span class="n">a</span><span class="p">.</span><span class="nf">flatten</span><span class="p">()</span>
<span class="c1"># array([0, 1, 2, 3, 4, 5, 6, 7])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># 1-dimensional array
#   axis 0 runs horizontally (or vertically)
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</span><span class="n">a</span><span class="p">.</span><span class="n">ndim</span>   <span class="c1"># 1
</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span>  <span class="c1"># (10,)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># 2-dimensional array
#   axis 0 runs vertically downwards across the rows.
#   axis 1 runs horizontally across the columns.
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2],
#        [3, 4, 5]])
</span><span class="n">a</span><span class="p">.</span><span class="n">ndim</span>   <span class="c1"># 2
</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span>  <span class="c1"># (2, 3)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># 3-dimensional array
#   axis 0 runs along the depth (the first index).
#   axis 1 runs along the rows (the second index).
#   axis 2 runs along the columns (the third index).
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># array([[[0, 1],
#         [2, 3]],
#
#        [[4, 5],
#         [6, 7]]])
</span><span class="n">a</span><span class="p">.</span><span class="n">ndim</span>   <span class="c1"># 3
</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span>  <span class="c1"># (2, 2, 2)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># creating arrays
</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="c1"># array([1, 2, 3, 4, 5, 6])
</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]])</span>
<span class="c1"># array([[ 1,  2,  3,  4],
#        [ 5,  6,  7,  8],
#        [ 9, 10, 11, 12]])
</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="c1"># array([[1.+0.j, 2.+0.j],
#        [3.+0.j, 4.+0.j]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([[0., 0., 0., 0.],
#        [0., 0., 0., 0.],
#        [0., 0., 0., 0.]])
</span><span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([[0, 0, 0, 0],
#        [0, 0, 0, 0],
#        [0, 0, 0, 0]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
<span class="c1"># array([[1, 1, 1, 1],
#        [1, 1, 1, 1],
#        [1, 1, 1, 1]], dtype=int16)
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1"># returns uninitialized memory!
# array([[0.0e+000, 4.9e-324, 9.9e-324, 1.5e-323, 2.0e-323],
#        [2.5e-323, 3.0e-323, 3.5e-323, 4.0e-323, 4.4e-323],
#        [4.9e-323, 5.4e-323, 5.9e-323, 6.4e-323, 6.9e-323]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="c1"># array([10, 15, 20, 25])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="c1"># array([0. , 0.3, 0.6, 0.9, 1.2, 1.5, 1.8])
</span>
<span class="kn">from</span> <span class="n">numpy</span> <span class="kn">import</span> <span class="n">pi</span>

<span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>  <span class="c1"># 9 numbers from 0 to 2
# array([0.  , 0.25, 0.5 , 0.75, 1.  , 1.25, 1.5 , 1.75, 2.  ])
</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># array([ 0.00000000e+00,  6.34239197e-02,  1.26592454e-01,  1.89251244e-01,
#         2.51147987e-01,  3.12033446e-01,  3.71662456e-01,  4.29794912e-01,
#         .     .       .
</span>
<span class="c1"># structured arrays
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span>
    <span class="p">[(</span><span class="sh">'</span><span class="s">Rex</span><span class="sh">'</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mf">81.0</span><span class="p">),</span> <span class="p">(</span><span class="sh">'</span><span class="s">Fido</span><span class="sh">'</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">)],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">U10</span><span class="sh">'</span><span class="p">),</span> <span class="p">(</span><span class="sh">'</span><span class="s">age</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">i4</span><span class="sh">'</span><span class="p">),</span> <span class="p">(</span><span class="sh">'</span><span class="s">weight</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">f4</span><span class="sh">'</span><span class="p">)],</span>
<span class="p">)</span>
<span class="c1"># array([('Rex', 9, 81.), ('Fido', 3, 27.)],
#       dtype=[('name', '&lt;U10'), ('age', '&lt;i4'), ('weight', '&lt;f4')])</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="arithmetic-operators-and-universal-functions">1.2. arithmetic operators, and universal functions</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># arithmetic operators, and universal functions
</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>

<span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># array([ 0.91294525, -0.98803162,  0.74511316, -0.26237485])
</span>
<span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># array([ 9.12945251, -9.88031624,  7.4511316 , -2.62374854])
</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># array([0, 1, 2, 3])
</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<span class="c1"># array([20, 29, 38, 47])
</span>
<span class="c1"># a + b
</span><span class="nf">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">53</span><span class="p">])</span>

<span class="c1"># b**2
</span><span class="nf">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>

<span class="n">a</span> <span class="o">&lt;</span> <span class="mi">35</span>
<span class="c1"># array([ True,  True, False, False])
</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>

<span class="n">A</span> <span class="o">*</span> <span class="n">B</span>  <span class="c1"># element-wise product
# array([[2, 0],
#        [0, 4]])
</span><span class="n">A</span> <span class="o">@</span> <span class="n">B</span>  <span class="c1"># matrix product: A.dot(B)
# array([[5, 4],
#        [3, 4]])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># universal functions (ufunc): operate element-wise on an array, producing an array as output
</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="c1"># array([1.        , 2.71828183, 7.3890561 ])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="c1"># array([0.        , 1.        , 1.41421356])
</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])</span>
<span class="n">np</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="c1"># array([2., 0., 6.])
</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="c1"># array([-0.99796507,  1.82697075,  0.60924821,  0.27004016, -1.62010011,
#        -0.43957991, -2.27936726, -1.87890946])
</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="c1"># array([-0.16034636,  1.60381624, -0.44003017, -1.50187946, -0.66940637,
#        -1.2649151 , -0.12716502, -0.15756179])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="c1"># array([-0.16034636,  1.82697075,  0.60924821,  0.27004016, -0.66940637,
#        -0.43957991, -0.12716502, -0.15756179])
</span>
<span class="c1"># assign the results into an existing array rather than create a new one
</span><span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
<span class="c1"># array([ 2.03493046e-03,  2.82697075e+00,  1.60924821e+00,  1.27004016e+00,
#        -6.20100112e-01,  5.60420090e-01, -1.27936726e+00, -8.78909462e-01])
</span><span class="n">out</span>
<span class="c1"># array([ 2.03493046e-03,  2.82697075e+00,  1.60924821e+00,  1.27004016e+00,
#        -6.20100112e-01,  5.60420090e-01, -1.27936726e+00, -8.78909462e-01])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># mathematical and statistical methods
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11]])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>  <span class="c1"># np.mean(a)
# np.float64(5.5)
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># compute mean across the columns
# array([1.5, 5.5, 9.5])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1"># np.int64(66)
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># compute sum down the rows
# array([12, 15, 18, 21])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">cumsum</span><span class="p">()</span>  <span class="c1"># computes the cumulative sum of the elements along a flattened version of the array
# array([ 0,  1,  3,  6, 10, 15, 21, 28, 36, 45, 55, 66])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># computes the cumulative sum along the rows
# array([[ 0,  1,  2,  3],
#        [ 4,  6,  8, 10],
#        [12, 15, 18, 21]])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># computes the sums along the columns
# array([[ 0,  1,  3,  6],
#        [ 4,  9, 15, 22],
#        [ 8, 17, 27, 38]])
</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">permutation</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="nf">ravel</span><span class="p">()).</span><span class="nf">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># array([[ 6,  8, 11,  3],
#        [ 7, 10,  4,  1],
#        [ 9,  2,  0,  5]])
</span>
<span class="n">b</span><span class="p">.</span><span class="nf">argmax</span><span class="p">()</span>  <span class="c1"># return indices of the maximum values along the given axis
# np.int64(2)
</span>
<span class="n">b</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># array([2, 1, 0, 2])
</span>
<span class="n">b</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># array([2, 1, 0])
</span>
<span class="n">b</span><span class="p">.</span><span class="nf">argmin</span><span class="p">()</span>  <span class="c1"># return indices of the minimum values along the given axis
# np.int64(10)
</span>
<span class="n">b</span><span class="p">.</span><span class="nf">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># array([0, 2, 2, 1])
</span>
<span class="n">b</span><span class="p">.</span><span class="nf">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># array([3, 3, 2])</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="indexing-slicing-and-iterating">1.3. indexing, slicing and iterating</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># indexing, slicing and iterating
</span>
<span class="c1"># one-dimensional arrays can be indexed, sliced and iterated over, much
# like lists and other Python sequences.
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</span>
<span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># np.int64(2)
</span>
<span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="c1"># array([2, 3, 4])
</span>
<span class="c1"># from start to position 6, exclusive, set every 2nd element to 1000
</span><span class="n">a</span><span class="p">[:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># array([0, 2, 4])
</span>
<span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># reversed
# array([9, 8, 7, 6, 5, 4, 3, 2, 1, 0])
</span>
<span class="c1"># multidimensional arrays can have one index per axis, given in a tuple separated by commas (,)
</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">fromfunction</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">x</span><span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [10, 11, 12, 13],
#        [20, 21, 22, 23],
#        [30, 31, 32, 33],
#        [40, 41, 42, 43]])
</span>
<span class="c1"># a comma-separated list of indices to select individual elements
</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># b[2][3]
# np.int64(23)
</span>
<span class="c1"># every element from column index 1 (`1:`) to the end of the first two rows (`:2`) of the array
</span><span class="n">b</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="c1"># array([[ 1,  2,  3],
#        [11, 12, 13]])
</span>
<span class="c1"># each row in the second column of `b`
</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="c1"># array([ 1, 11, 21, 31, 41])
</span>
<span class="c1"># a colon (`:`) by itself to take the entire axis
</span><span class="n">b</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="c1"># array([ 1, 11, 21, 31, 41])
</span><span class="n">b</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># array([[ 0],
#        [10],
#        [20],
#        [30],
#        [40]])
</span>
<span class="c1"># each column in the second and third row of `b`
</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1"># array([[10, 11, 12, 13],
#       [20, 21, 22, 23]])
</span>
<span class="c1"># missing indices are considered complete slices `:`
</span><span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># b[-1, :]
# array([40, 41, 42, 43])
</span>
<span class="c1"># the dots (`...`) represent as many colons as needed to produce a complete indexing tuple
</span><span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">...]</span>  <span class="c1"># b[-1, :]
# array([40, 41, 42, 43])
</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2],
#        [3, 4, 5]])
</span>
<span class="c1"># fancy indexing: indexing with arrays of indices
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="c1"># array([[0., 0., 0., 0.],
#        [1., 1., 1., 1.],
#        [2., 2., 2., 2.],
#        [3., 3., 3., 3.],
#        [4., 4., 4., 4.],
#        [5., 5., 5., 5.],
#        [6., 6., 6., 6.],
#        [7., 7., 7., 7.]])
</span>
<span class="n">i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="c1"># array([[4., 4., 4., 4.],
#        [3., 3., 3., 3.],
#        [0., 0., 0., 0.],
#        [6., 6., 6., 6.]])
</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">32</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11],
#        [12, 13, 14, 15],
#        [16, 17, 18, 19],
#        [20, 21, 22, 23],
#        [24, 25, 26, 27],
#        [28, 29, 30, 31]])
</span><span class="n">i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="c1"># array([ 4, 23, 29, 10])
</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>       <span class="c1"># black
</span>        <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>     <span class="c1"># red
</span>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>     <span class="c1"># green
</span>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>     <span class="c1"># blue
</span>        <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="c1"># white
</span>    <span class="p">]</span>
<span class="p">)</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># each value corresponds to a color in the palette
</span>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">palette</span><span class="p">[</span><span class="n">image</span><span class="p">]</span>  <span class="c1"># the (2, 4, 3) color image
</span>
<span class="c1"># array([[[  0,   0,   0],
#         [255,   0,   0],
#         [  0, 255,   0],
#         [  0,   0,   0]],
#
#        [[  0,   0,   0],
#         [  0,   0, 255],
#         [255, 255, 255],
#         [  0,   0,   0]]])
</span>
<span class="c1"># boolean indexing
</span><span class="n">names</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Joe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Will</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Will</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Joe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Joe</span><span class="sh">"</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>

<span class="n">names</span> <span class="o">==</span> <span class="sh">'</span><span class="s">Bob</span><span class="sh">'</span>
<span class="c1"># array([ True, False, False,  True, False, False, False])
</span>
<span class="n">data</span><span class="p">[</span><span class="n">names</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># array([[4, 7],
#        [0, 0]])
</span>
<span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">names</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">)]</span>  <span class="c1"># data[names != "Bob"]
# array([[  0,   2],
#        [ -5,   6],
#        [  1,   2],
#        [-12,  -4],
#        [  3,   4]])
</span>
<span class="c1"># The Python keywords `and` and `or` do not work with Boolean arrays.
# Use `&amp;` (and) and `|` (or) instead.
</span><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">names</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">names</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Will</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># array([ True, False,  True,  True,  True, False, False])
</span>
<span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="c1"># array([[ 4,  7],
#        [-5,  6],
#        [ 0,  0],
#        [ 1,  2]])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># iterating
</span><span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="c1"># [0 1 2]
# [3 4 5]
</span>
<span class="c1"># iterating on each element
</span><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">b</span><span class="p">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="sh">'</span><span class="se">\t</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># 0	1	2	3	4	5</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="copies-and-views">1.4. copies and views</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># copies and views: array slices are views on the original array
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]])</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11]])
</span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">b</span> <span class="ow">is</span> <span class="n">a</span>  <span class="c1"># True
</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">):</span>  <span class="c1"># pass objects as references
</span>    <span class="k">return</span> <span class="nf">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nf">id</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># (4397168176, 4397168176)
</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="nf">view</span><span class="p">()</span>  <span class="c1"># a new view of the array
</span><span class="n">c</span> <span class="ow">is</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">flags</span><span class="p">.</span><span class="n">owndata</span>  <span class="c1"># (False, True, False)
</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">c</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">shape</span>  <span class="c1"># ((2, 6), (3, 4))
</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1234</span>  <span class="c1"># a's data changes
</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># np.int64(1234)
</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># array([[ 1,  2],
#        [ 5,  6],
#        [ 9, 10]])
</span><span class="n">s</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># a view, not a copy
</span><span class="n">a</span>
<span class="c1"># array([[   0,   10,   10,    3],
#        [1234,   10,   10,    7],
#        [   8,   10,   10,   11]])
</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>  <span class="c1"># a copy of the array
</span><span class="n">d</span> <span class="ow">is</span> <span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">a</span>  <span class="c1"># (False, False)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="probability-distributions">1.5. probability distributions</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># np.random: arrays of sample values from many kinds of probability distributions
</span><span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([[ 0.56695748,  0.00955644,  0.08934151,  1.69336179],
#        [-0.41463561,  0.81013138,  0.41954566,  0.11812052],
#        [ 0.23305357,  0.26527434,  0.3752615 ,  1.82930088],
#        [ 0.36156569,  1.66151819,  0.78871978, -0.56163182]])
</span>
<span class="c1"># from random import normalvariate
# N = 1_000_000
#
# %timeit samples = [normalvariate(0, 1) for _ in range(N)]
# 320 ms ± 885 μs per loop (mean ± std. dev. of 7 runs, 1 loop each)
#
# %timeit np.random.standard_normal(N)
# 15.8 ms ± 8.28 μs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</span>
<span class="c1"># random numbers are pseudo-random with a configurable RNG initialized by the `seed` value, ensuring reproducibility.
</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="nf">type</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
<span class="c1"># numpy.random._generator.Generator
</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>

<span class="n">r1</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># array([[-1.42382504,  1.26372846, -0.87066174],
#        [-0.25917323, -0.07534331, -0.74088465]])
</span>
<span class="n">r2</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">).</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># array([[-1.42382504,  1.26372846, -0.87066174],
#        [-0.25917323, -0.07534331, -0.74088465]])</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="array-oriented-programming">1.6. array-oriented programming</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># array-oriented programming with arrays
</span><span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">yarr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
<span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>

<span class="c1"># traditional list comprehension
</span><span class="n">result</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">,</span> <span class="n">cond</span><span class="p">)]</span>
<span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># array([1.1, 2.2, 1.3, 1.4, 2.5])
</span>
<span class="c1"># numpy.where
</span><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">)</span>
<span class="c1"># array([1.1, 2.2, 1.3, 1.4, 2.5])
</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([[-0.8529, -1.6429,  1.4967, -0.6435],
#        [ 0.5086,  0.5242,  1.5083,  0.0487],
#        [-1.2721, -0.8147, -0.3598, -1.2042],
#        [ 1.1531,  1.5783, -0.9556, -0.6506]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># array([[-2, -2,  2, -2],
#        [ 2,  2,  2,  2],
#        [-2, -2, -2, -2],
#        [ 2,  2, -2, -2]])
</span>
<span class="c1"># set only positive values to 2
</span><span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="c1"># array([[-0.8529, -1.6429,  2.    , -0.6435],
#        [ 2.    ,  2.    ,  2.    ,  2.    ],
#        [-1.2721, -0.8147, -0.3598, -1.2042],
#        [ 2.    ,  2.    , -0.9556, -0.6506]])</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sorting">1.7. sorting</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># sorting
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">permutation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># array([[ 2, 10, 11,  3],
#        [ 0,  6,  9,  5],
#        [ 7,  8,  1,  4]])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">sort</span><span class="p">()</span>
<span class="c1"># array([[ 2,  3, 10, 11],
#        [ 0,  5,  6,  9],
#        [ 1,  4,  7,  8]])
</span>
<span class="n">a</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># simulate a descending order
# array([[11, 10,  3,  2],
#        [ 9,  6,  5,  0],
#        [ 8,  7,  4,  1]])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># sort across each column
# array([[ 0,  3,  6,  8],
#        [ 1,  4,  7,  9],
#        [ 2,  5, 10, 11]])
</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">permutation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># array([[ 5,  3, 11,  8],
#        [ 7,  1,  0,  4],
#        [10,  9,  2,  6]])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sort across each row
# array([[ 3,  5,  8, 11],
#        [ 0,  1,  4,  7],
#        [ 2,  6,  9, 10]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># a sorted copy of an array
# array([[ 0,  1,  4,  7],
#        [ 2,  5,  8, 10],
#        [ 3,  6,  9, 11]])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># the indices of the sorted values
</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">indexer</span> <span class="o">=</span> <span class="n">values</span><span class="p">.</span><span class="nf">argsort</span><span class="p">()</span>
<span class="c1"># array([1, 2, 4, 3, 0])
</span><span class="n">values</span><span class="p">[</span><span class="n">indexer</span><span class="p">]</span>
<span class="c1"># array([0, 1, 2, 3, 5])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># the indices of lexicographical sort on multiple key arrays
</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="sh">'</span><span class="s">Bob</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Jane</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Steve</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Bill</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Barbara</span><span class="sh">'</span><span class="p">])</span>
<span class="n">last_name</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="sh">'</span><span class="s">Jones</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Arnold</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Arnold</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Jones</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Walters</span><span class="sh">'</span><span class="p">])</span>
<span class="n">sorter</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">lexsort</span><span class="p">((</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">))</span>
<span class="c1"># array([1, 2, 3, 0, 4])
</span><span class="nf">list</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">last_name</span><span class="p">[</span><span class="n">sorter</span><span class="p">],</span> <span class="n">first_name</span><span class="p">[</span><span class="n">sorter</span><span class="p">]))</span>
<span class="c1"># [(np.str_('Arnold'), np.str_('Jane')),
#  (np.str_('Arnold'), np.str_('Steve')),
#  (np.str_('Jones'), np.str_('Bill')),
#  (np.str_('Jones'), np.str_('Bob')),
#  (np.str_('Walters'), np.str_('Barbara'))]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="concatenating-and-splitting">1.8. concatenating and splitting</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># numpy.concatenate(...)
</span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11]])
</span><span class="n">np</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11],
#        [ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11]])
</span><span class="n">np</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># array([[ 0,  1,  2,  3,  0,  1,  2,  3],
#        [ 4,  5,  6,  7,  4,  5,  6,  7],
#        [ 8,  9, 10, 11,  8,  9, 10, 11]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">((</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">))</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11],
#        [ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11]])
</span><span class="n">np</span><span class="p">.</span><span class="nf">hstack</span><span class="p">((</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">))</span>
<span class="c1"># array([[ 0,  1,  2,  3,  0,  1,  2,  3],
#        [ 4,  5,  6,  7,  4,  5,  6,  7],
#        [ 8,  9, 10, 11,  8,  9, 10, 11]])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># array([[0, 1],
#        [2, 3],
#        [4, 5],
#        [6, 7],
#        [8, 9]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># arr[:1], arr[1:3], arr[3:]
# [array([[0, 1]]),
#  array([[2, 3],
#         [4, 5]]),
#  array([[6, 7],
#         [8, 9]])]
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># [array([[0, 1]]),
#  array([[2, 3],
#         [4, 5]]),
#  array([[6, 7],
#         [8, 9]])]
</span><span class="n">np</span><span class="p">.</span><span class="nf">vsplit</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="c1"># [array([[0, 1]]),
#  array([[2, 3],
#         [4, 5]]),
#  array([[6, 7],
#         [8, 9]])]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repeating-and-tiling">1.9. repeating and tiling</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">arr</span><span class="p">.</span><span class="nf">repeat</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># array([0, 0, 0, 1, 1, 1, 2, 2, 2])
</span><span class="n">arr</span><span class="p">.</span><span class="nf">repeat</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([0, 0, 1, 1, 1, 2, 2, 2, 2])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2],
#       [3, 4, 5]])
</span>
<span class="n">arr</span><span class="p">.</span><span class="nf">repeat</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># array([0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5])
</span>
<span class="n">arr</span><span class="p">.</span><span class="nf">repeat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2],
#        [0, 1, 2],
#        [3, 4, 5],
#        [3, 4, 5]])
</span>
<span class="n">arr</span><span class="p">.</span><span class="nf">repeat</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2],
#        [0, 1, 2],
#        [3, 4, 5],
#        [3, 4, 5],
#        [3, 4, 5]])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2],
#       [3, 4, 5]])
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">tile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2, 0, 1, 2],
#        [3, 4, 5, 3, 4, 5]])
</span><span class="n">np</span><span class="p">.</span><span class="nf">tile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2, 0, 1, 2, 0, 1, 2],
#        [3, 4, 5, 3, 4, 5, 3, 4, 5]])
</span><span class="n">np</span><span class="p">.</span><span class="nf">tile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># array([[0, 1, 2],
#        [3, 4, 5],
#        [0, 1, 2],
#        [3, 4, 5]])
</span><span class="n">np</span><span class="p">.</span><span class="nf">tile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># array([[0, 1, 2, 0, 1, 2, 0, 1, 2],
#        [3, 4, 5, 3, 4, 5, 3, 4, 5],
#        [0, 1, 2, 0, 1, 2, 0, 1, 2],
#        [3, 4, 5, 3, 4, 5, 3, 4, 5]])</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="taking-and-putting">1.10. taking and putting</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">inds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

<span class="n">arr</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="c1"># fancy indexing
# array([700, 100, 200, 600])
</span>
<span class="n">arr</span><span class="p">.</span><span class="nf">take</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>
<span class="c1"># array([700, 100, 200, 600])
</span>
<span class="n">arr</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="c1"># array([  0,  42,  42, 300, 400, 500,  42,  42, 800, 900])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># array([[0, 1, 2, 3],
#        [4, 5, 6, 7]])
</span>
<span class="n">arr</span><span class="p">.</span><span class="nf">take</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># array([[2, 0, 2, 1],
#        [6, 4, 6, 5]])</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="broadcasting">1.11. broadcasting</h3>
<div class="paragraph">
<p>The broadcast rule states that two arrays can be broadcast together for vector operations if, for each trailing dimension (i.e., starting from the last dimension and moving backward), the axis lengths are either equal, one is 1, or the dimension is missing (treated as 1), enabling operations across these dimensions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># element-wise multiplication: when two arrays have the same shape, they are multiplied element-wise
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="c1"># broadcasting: when one of the arrays is a scalar, it is broadcasted to the other array
</span><span class="n">b</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">a</span> <span class="o">*</span> <span class="n">b</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">],</span>
              <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>
              <span class="p">[</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">],</span>
              <span class="p">[</span><span class="mf">30.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>

<span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="c1"># array([[ 1.,  2.,  3.],
#        [11., 12., 13.],
#        [21., 22., 23.],
#        [31., 32., 33.]])
</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])</span>
<span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="c1"># operands could not be broadcast together with shapes (4,3) (4,)
</span>
<span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">b</span><span class="p">).</span><span class="n">T</span>
<span class="c1"># array([[ 1.,  1.,  1.],
#        [12., 12., 12.],
#        [23., 23., 23.],
#        [34., 34., 34.]])</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A set of arrays is called <a href="https://numpy.org/devdocs//user/basics.broadcasting.html">“broadcastable”</a> to the same shape if the above rules produce a valid result.</p>
</div>
<div class="paragraph">
<p>For example, if <code>a.shape</code> is <code>(5,1)</code>, <code>b.shape</code> is <code>(1,6)</code>, <code>c.shape</code> is <code>(6,)</code> and <code>d.shape</code> is <code>()</code> so that <code>d</code> is a scalar, then <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> are all broadcastable to dimension <code>(5,6)</code>; and</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a</code> acts like a <code>(5,6)</code> array where <code>a[:,0]</code> is broadcast to the other columns,</p>
</li>
<li>
<p><code>b</code> acts like a <code>(5,6)</code> array where <code>b[0,:]</code> is broadcast to the other rows,</p>
</li>
<li>
<p><code>c</code> acts like a <code>(1,6)</code> array and therefore like a <code>(5,6)</code> array where <code>c[:]</code> is broadcast to every row, and finally,</p>
</li>
<li>
<p><code>d</code> acts like a <code>(5,6)</code> array where the single value is repeated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here are some more examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="nc">A      </span><span class="p">(</span><span class="mi">2</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">5</span> <span class="n">x</span> <span class="mi">4</span>
<span class="nc">B      </span><span class="p">(</span><span class="mi">1</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>      <span class="mi">1</span>
<span class="nc">Result </span><span class="p">(</span><span class="mi">2</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">5</span> <span class="n">x</span> <span class="mi">4</span>

<span class="nc">A      </span><span class="p">(</span><span class="mi">2</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">5</span> <span class="n">x</span> <span class="mi">4</span>
<span class="nc">B      </span><span class="p">(</span><span class="mi">1</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>      <span class="mi">4</span>
<span class="nc">Result </span><span class="p">(</span><span class="mi">2</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">5</span> <span class="n">x</span> <span class="mi">4</span>

<span class="nc">A      </span><span class="p">(</span><span class="mi">3</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">15</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">5</span>
<span class="nc">B      </span><span class="p">(</span><span class="mi">3</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">15</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">x</span> <span class="mi">5</span>
<span class="nc">Result </span><span class="p">(</span><span class="mi">3</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">15</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">5</span>

<span class="nc">A      </span><span class="p">(</span><span class="mi">3</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">15</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">5</span>
<span class="nc">B      </span><span class="p">(</span><span class="mi">2</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>       <span class="mi">3</span> <span class="n">x</span> <span class="mi">5</span>
<span class="nc">Result </span><span class="p">(</span><span class="mi">3</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">15</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">5</span>

<span class="nc">A      </span><span class="p">(</span><span class="mi">3</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">15</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">5</span>
<span class="nc">B      </span><span class="p">(</span><span class="mi">2</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>       <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span>
<span class="nc">Result </span><span class="p">(</span><span class="mi">3</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">15</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are examples of shapes that do not broadcast:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="nc">A      </span><span class="p">(</span><span class="mi">1</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">3</span>
<span class="nc">B      </span><span class="p">(</span><span class="mi">1</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">4</span> <span class="c1"># trailing dimensions do not match
</span>
<span class="nc">A      </span><span class="p">(</span><span class="mi">2</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>      <span class="mi">2</span> <span class="n">x</span> <span class="mi">1</span>
<span class="nc">B      </span><span class="p">(</span><span class="mi">3</span><span class="n">d</span> <span class="n">array</span><span class="p">):</span>  <span class="mi">8</span> <span class="n">x</span> <span class="mi">4</span> <span class="n">x</span> <span class="mi">3</span> <span class="c1"># second from last dimensions mismatched</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Broadcasting is a powerful tool for writing short and usually intuitive code that does its computations very efficiently in C. However, there are cases when broadcasting uses unnecessarily large amounts of memory for a particular algorithm. In these cases, it is better to write the algorithm’s outer loop in Python. This may also produce more readable code, as algorithms that use broadcasting tend to become more difficult to interpret as the number of dimensions in the broadcast increases.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="saving-and-loading">1.12. saving and loading</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># save an array to a binary file in NumPy `.npy` format
</span><span class="n">np</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># load arrays or pickled objects from ``.npy``, ``.npz`` or pickled files
</span><span class="n">np</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">a.npy</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># array([0, 1, 2])
</span>
<span class="c1"># save several arrays into a single file in uncompressed ``.npz`` format.
</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="nf">savez</span><span class="p">(</span><span class="sh">"</span><span class="s">x</span><span class="sh">"</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># np.savez_compressed("x", a=a, b=b)
</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">x.npz</span><span class="sh">"</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># array([0, 1, 2])
</span><span class="n">x</span><span class="p">[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># array([4, 5, 6])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># memory-mapped files
</span><span class="n">mmap</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">memmap</span><span class="p">(</span><span class="sh">"</span><span class="s">mymap</span><span class="sh">"</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">float64</span><span class="sh">"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">"</span><span class="s">w+</span><span class="sh">"</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">))</span>
<span class="c1"># memmap([[0., 0., 0., ..., 0., 0., 0.],
#         [0., 0., 0., ..., 0., 0., 0.],
#         [0., 0., 0., ..., 0., 0., 0.],
#         ...,
#         [0., 0., 0., ..., 0., 0., 0.],
#         [0., 0., 0., ..., 0., 0., 0.],
#         [0., 0., 0., ..., 0., 0., 0.]], shape=(10000, 10000))
</span><span class="n">section</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># slice a memmap and return a view on the data on disk
</span><span class="n">section</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">))</span>
<span class="n">mmap</span><span class="p">.</span><span class="nf">flush</span><span class="p">()</span> <span class="c1"># synchronize the buffer to disk
</span><span class="k">del</span> <span class="n">mmap</span>
<span class="n">mmap</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">memmap</span><span class="p">(</span><span class="sh">"</span><span class="s">mymap</span><span class="sh">"</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">float64</span><span class="sh">"</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">))</span>
<span class="c1"># memmap([[ 0.91382662,  1.49977917, -1.47262602, ..., -0.24502025,
#          -0.30054133, -1.02916198],
#         [-0.12684315, -0.11920898, -0.66880989, ...,  1.28690387,
#          -0.39796217, -1.24489593],
#         [-0.28898526, -0.52547418,  0.81749133, ..., -1.2065158 ,
#           0.56140227,  0.12171409],
#         ...,
#         [ 0.        ,  0.        ,  0.        , ...,  0.        ,
#           0.        ,  0.        ],
#         [ 0.        ,  0.        ,  0.        , ...,  0.        ,
#           0.        ,  0.        ],
#         [ 0.        ,  0.        ,  0.        , ...,  0.        ,
#           0.        ,  0.        ]], shape=(10000, 10000))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pandas">2. Pandas</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://pandas.pydata.org/">Pandas</a> (derived from panel data, /ˈpeɪ.dəns/) is an open-source, BSD-licensed Python library built on NumPy, offering high-performance, user-friendly tabular or heterogeneous data structures like <code>Series</code> (1D labeled arrays of any data type) and <code>DataFrames</code> (2D labeled tables) for powerful data analysis.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">BooleanDtype</span>     <span class="c1"># Nullable Boolean data, use "boolean" when passing as string
</span><span class="n">CategoricalDtype</span> <span class="c1"># Categorical data type, use "category" when passing as string
</span><span class="n">DatetimeTZDtype</span>  <span class="c1"># Datetime with time zone
</span><span class="n">Float32Dtype</span>     <span class="c1"># 32-bit nullable floating point, use "Float32" when passing as string
</span><span class="n">Float64Dtype</span>     <span class="c1"># 64-bit nullable floating point, use "Float64" when passing as string
</span><span class="n">Int8Dtype</span>   <span class="c1"># 8-bit nullable signed integer, use "Int8" when passing as string
</span><span class="n">Int16Dtype</span>  <span class="c1"># 16-bit nullable signed integer, use "Int16" when passing as string
</span><span class="n">Int32Dtype</span>  <span class="c1"># 32-bit nullable signed integer, use "Int32" when passing as string
</span><span class="n">Int64Dtype</span>  <span class="c1"># 64-bit nullable signed integer, use "Int64" when passing as string
</span><span class="n">UInt8Dtype</span>  <span class="c1"># 8-bit nullable unsigned integer, use "UInt8" when passing as string
</span><span class="n">UInt16Dtype</span> <span class="c1"># 16-bit nullable unsigned integer, use "UInt16" when passing as string
</span><span class="n">UInt32Dtype</span> <span class="c1"># 32-bit nullable unsigned integer, use "UInt32" when passing as string
</span><span class="n">UInt64Dtype</span> <span class="c1"># 64-bit nullable unsigned integer, use "UInt64" when passing as string</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nc">Float64Dtype</span><span class="p">())</span>  <span class="c1"># pd.Series([1, 2, 3, None], dtype="Float64")
# 0     1.0
# 1     2.0
# 2     3.0
# 3    &lt;NA&gt;
# dtype: Float64
</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="n">pd</span><span class="p">.</span><span class="n">NA</span>
<span class="c1"># True
</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="sh">'</span><span class="s">one</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">two</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">'</span><span class="s">three</span><span class="sh">'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nc">StringDtype</span><span class="p">())</span>  <span class="c1"># pd.Series(['one', 'two', None, 'three'], dtype="string")
# 0      one
# 1      two
# 2     &lt;NA&gt;
# 3    three
# dtype: string
</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="n">pd</span><span class="p">.</span><span class="n">NA</span>
<span class="c1"># True</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="series-dataframe-and-index">2.1. Series, DataFrame, and Index</h3>
<div class="ulist">
<ul>
<li>
<p>A <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.html">Series</a> is a one-dimensional array-like object containing a sequence of any values and an associated array of labels, called its <em>index</em>, also like a fixed-length, ordered dictionary as it is a mapping of index values to data values.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>  <span class="c1"># default integer index
# 0    4
# 1    7
# 2   -5
# 3    3
# dtype: int64
</span>
<span class="n">s</span><span class="p">.</span><span class="n">array</span>
<span class="c1"># &lt;NumpyExtensionArray&gt;
# [np.int64(4), np.int64(7), np.int64(-5), np.int64(3)]
# Length: 4, dtype: int64
</span>
<span class="n">s</span><span class="p">.</span><span class="n">index</span>
<span class="c1"># RangeIndex(start=0, stop=4, step=1)
</span>
<span class="n">s</span><span class="p">.</span><span class="n">dtype</span>
<span class="c1"># dtype('int64')
</span>
<span class="n">s</span><span class="p">.</span><span class="nf">to_numpy</span><span class="p">()</span>  <span class="c1"># NumPy array
# array([ 4,  7, -5,  3])
</span>
<span class="n">s</span><span class="p">.</span><span class="nf">to_dict</span><span class="p">()</span>  <span class="c1"># dictionary
# {0: 4, 1: 7, 2: -5, 3: 3}
</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># label index
# d    4
# b    7
# a   -5
# c    3
# dtype: int64
</span>
<span class="c1"># select a single value or a set of values
</span><span class="n">s</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># np.int64(-5)
</span><span class="n">s</span><span class="p">[[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">]]</span>
<span class="c1"># b    7
# c    3
# d    4
# dtype: int64
</span>
<span class="c1"># purely integer-location based indexing for selection by position
</span><span class="n">s</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># np.int64(4)
</span><span class="n">s</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># d    4
# b    7
# dtype: int64
</span><span class="n">s</span><span class="p">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="c1"># b    7
# a   -5
# d    4
# dtype: int64
</span>
<span class="c1"># Series is ndarray-like
</span><span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="c1"># d     True
# b     True
# a    False
# c     True
# dtype: bool
</span><span class="n">s</span><span class="p">[</span><span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># d    4
# b    7
# c    3
# dtype: int64
</span><span class="n">s</span><span class="p">[</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">s</span><span class="p">.</span><span class="nf">median</span><span class="p">()]</span>
<span class="c1"># d    4
# b    7
# dtype: int64
</span><span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># import numpy as np
# d      54.598150
# b    1096.633158
# a       0.006738
# c      20.085537
# dtype: float64
</span>
<span class="c1"># Series is dictionary-like
</span><span class="n">s</span><span class="p">[</span><span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># np.int64(4)
</span><span class="n">s</span><span class="p">[[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">]]</span>
<span class="c1"># a   -5
# b    7
# c    3
# dtype: int64
</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">s</span>
<span class="c1"># True
</span><span class="sh">"</span><span class="s">e</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">s</span>
<span class="c1"># False
</span><span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>
<span class="c1"># nan
</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">:</span> <span class="mi">35000</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">:</span> <span class="mi">71000</span><span class="p">,</span> <span class="sh">"</span><span class="s">Oregon</span><span class="sh">"</span><span class="p">:</span> <span class="mi">16000</span><span class="p">,</span> <span class="sh">"</span><span class="s">Utah</span><span class="sh">"</span><span class="p">:</span> <span class="mi">5000</span><span class="p">}</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">California</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Oregon</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">]</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">states</span><span class="p">)</span>  <span class="c1"># override indices
# California        NaN
# Ohio          35000.0
# Oregon        16000.0
# Texas         71000.0
# dtype: float64
</span>
<span class="c1"># name attribute
</span><span class="n">s</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">fooooobar</span><span class="sh">"</span>
<span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">buzzzzzz</span><span class="sh">"</span>
<span class="n">s</span>
<span class="c1"># buzzzzzz
# d    4
# b    7
# a   -5
# c    3
# Name: fooooobar, dtype: int64
</span>
<span class="c1"># alter the index in place while preserving the original index name
</span><span class="n">s</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Index</span><span class="p">([</span><span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Steve</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Jeff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ryan</span><span class="sh">"</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># Retains the current index name
# Output:
# buzzzzzz
# Bob      4
# Steve    7
# Jeff    -5
# Ryan     3
# Name: fooooobar, dtype: int64
</span>
<span class="c1"># alter the index in place without preserving the index name
</span><span class="n">s</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Steve</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Jeff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ryan</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># Removes the index name
# Output:
# Bob      4
# Steve    7
# Jeff    -5
# Ryan     3
# Name: fooooobar, dtype: int64</span></code></pre>
</div>
</div>
</li>
<li>
<p>A <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html">DataFrame</a> is a two-dimensional data structure that holds data like a two-dimension array or a table with rows and columns, or a spreadsheet, or a dict of Series objects.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2003</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">pop</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># from a dictionary of equal-length lists or NumPy arrays
#     state  year  pop
# 0    Ohio  2000  1.5
# 1    Ohio  2001  1.7
# 2    Ohio  2002  3.6
# 3  Nevada  2001  2.4
# 4  Nevada  2002  2.9
# 5  Nevada  2003  3.2
</span>
<span class="n">frame</span><span class="p">.</span><span class="n">dtypes</span>
<span class="c1"># state     object
# year       int64
# pop      float64
# dtype: object
</span>
<span class="n">frame</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>  <span class="c1"># select the first five (by default) rows
#     state  year  pop
# 0    Ohio  2000  1.5
# 1    Ohio  2001  1.7
# 2    Ohio  2002  3.6
# 3  Nevada  2001  2.4
# 4  Nevada  2002  2.9
</span><span class="n">frame</span><span class="p">.</span><span class="nf">tail</span><span class="p">()</span>  <span class="c1"># select the last five (by default) rows
#     state  year  pop
# 1    Ohio  2001  1.7
# 2    Ohio  2002  3.6
# 3  Nevada  2001  2.4
# 4  Nevada  2002  2.9
# 5  Nevada  2003  3.2
</span>
<span class="c1"># specify a sequence of columns and order
</span><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pop</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#    year   state  pop
# 0  2000    Ohio  1.5
# 1  2001    Ohio  1.7
# 2  2002    Ohio  3.6
# 3  2001  Nevada  2.4
# 4  2002  Nevada  2.9
# 5  2003  Nevada  3.2
</span><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pop</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">debt</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#    year   state  pop debt
# 0  2000    Ohio  1.5  NaN
# 1  2001    Ohio  1.7  NaN
# 2  2002    Ohio  3.6  NaN
# 3  2001  Nevada  2.4  NaN
# 4  2002  Nevada  2.9  NaN
# 5  2003  Nevada  3.2  NaN
</span>
<span class="c1"># retrieve columns as Series
</span><span class="n">frame</span><span class="p">[</span><span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># dictionary-like notation
# 0      Ohio
# 1      Ohio
# 2      Ohio
# 3    Nevada
# 4    Nevada
# 5    Nevada
# Name: state, dtype: object
</span><span class="n">frame</span><span class="p">.</span><span class="n">year</span>  <span class="c1"># dot attribute notation
# 0    2000
# 1    2001
# 2    2002
# 3    2001
# 4    2002
# 5    2003
# Name: year, dtype: int64
</span>
<span class="c1"># retrieve rows by position or name with the special `iloc` and `loc` attributes
</span><span class="n">frame</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># state    Ohio
# year     2001
# pop       1.7
# Name: 1, dtype: object
</span><span class="n">frame</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># state    Ohio
# year     2002
# pop       3.6
# Name: 2, dtype: object
</span>
<span class="c1"># columns can be modified by assignment
</span><span class="n">frame2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pop</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">debt</span><span class="sh">"</span><span class="p">])</span>
<span class="n">frame2</span><span class="p">[</span><span class="sh">"</span><span class="s">debt</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="mf">16.5</span>
<span class="c1">#   year   state  pop  debt
# 0  2000    Ohio  1.5  16.5
# 1  2001    Ohio  1.7  16.5
# 2  2002    Ohio  3.6  16.5
# 3  2001  Nevada  2.4  16.5
# 4  2002  Nevada  2.9  16.5
# 5  2003  Nevada  3.2  16.5
</span><span class="n">frame2</span><span class="p">[</span><span class="sh">"</span><span class="s">debt</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mf">6.</span><span class="p">)</span>
<span class="c1">#    year   state  pop  debt
# 0  2000    Ohio  1.5   0.0
# 1  2001    Ohio  1.7   1.0
# 2  2002    Ohio  3.6   2.0
# 3  2001  Nevada  2.4   3.0
# 4  2002  Nevada  2.9   4.0
# 5  2003  Nevada  3.2   5.0
</span>
<span class="c1"># assigning a column that doesn’t exist will create a new column.
</span><span class="n">frame2</span><span class="p">[</span><span class="sh">"</span><span class="s">eastern</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame2</span><span class="p">[</span><span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span>
<span class="c1">#    year   state  pop  debt  eastern
# 0  2000    Ohio  1.5   0.0     True
# 1  2001    Ohio  1.7   1.0     True
# 2  2002    Ohio  3.6   2.0     True
# 3  2001  Nevada  2.4   3.0    False
# 4  2002  Nevada  2.9   4.0    False
# 5  2003  Nevada  3.2   5.0    False
</span>
<span class="c1"># remove a column
</span><span class="k">del</span> <span class="n">frame2</span><span class="p">[</span><span class="sh">"</span><span class="s">eastern</span><span class="sh">"</span><span class="p">]</span>
<span class="c1">#    year   state  pop  debt
# 0  2000    Ohio  1.5   0.0
# 1  2001    Ohio  1.7   1.0
# 2  2002    Ohio  3.6   2.0
# 3  2001  Nevada  2.4   3.0
# 4  2002  Nevada  2.9   4.0
# 5  2003  Nevada  3.2   5.0
</span>
<span class="c1"># return and drop an item from frame
</span><span class="n">frame2</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="sh">"</span><span class="s">debt</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 0    0.0
# 1    1.0
# 2    2.0
# 3    3.0
# 4    4.0
# 5    5.0
# Name: debt, dtype: float64
</span><span class="n">frame2</span>
<span class="c1">#    year   state  pop
# 0  2000    Ohio  1.5
# 1  2001    Ohio  1.7
# 2  2002    Ohio  3.6
# 3  2001  Nevada  2.4
# 4  2002  Nevada  2.9
# 5  2003  Nevada  3.2
</span>
<span class="c1"># from a nested dictionary of dictionaries
#   the outer dictionary keys as the columns
#   the inner keys as the row indices
</span><span class="n">populations</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="mi">2000</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2001</span><span class="p">:</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mi">2002</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">},</span>
    <span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="mi">2001</span><span class="p">:</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mi">2002</span><span class="p">:</span> <span class="mf">2.9</span><span class="p">},</span>
<span class="p">}</span>
<span class="n">frame3</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">populations</span><span class="p">)</span>
<span class="c1">#       Ohio  Nevada
# 2000   1.5     NaN
# 2001   1.7     2.4
# 2002   3.6     2.9
</span>
<span class="n">frame3</span><span class="p">.</span><span class="n">T</span>  <span class="c1"># transpose the DataFrame (swap rows and columns)
#         2000  2001  2002
# Ohio     1.5   1.7   3.6
# Nevada   NaN   2.4   2.9
</span>
<span class="n">frame2</span><span class="p">.</span><span class="nf">to_numpy</span><span class="p">()</span>  <span class="c1"># a two-dimensional ndarray
# array([[2000, 'Ohio', 1.5, 0.0],
#        [2001, 'Ohio', 1.7, 1.0],
#        [2002, 'Ohio', 3.6, 2.0],
#        [2001, 'Nevada', 2.4, 3.0],
#        [2002, 'Nevada', 2.9, 4.0],
#        [2003, 'Nevada', 3.2, 5.0]], dtype=object)</span></code></pre>
</div>
</div>
</li>
<li>
<p>A pandas’s <a href="https://pandas.pydata.org/docs/reference/indexing.html">Index</a> object is responsible for holding the axis labels (including a DataFrame’s column names) and other metadata (like the axis name or names).</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">frame3</span>
<span class="c1">#       Ohio  Nevada
# 2000   1.5     NaN
# 2001   1.7     2.4
# 2002   3.6     2.9
</span>
<span class="n">frame3</span><span class="p">.</span><span class="n">index</span>
<span class="c1"># Index([2000, 2001, 2002], dtype='int64')
</span>
<span class="n">frame3</span><span class="p">.</span><span class="n">columns</span>
<span class="c1"># Index(['Ohio', 'Nevada'], dtype='object')
</span>
<span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">frame3</span><span class="p">.</span><span class="n">columns</span>
<span class="c1"># True
</span>
<span class="mi">2003</span> <span class="ow">in</span> <span class="n">frame3</span><span class="p">.</span><span class="n">index</span>
<span class="c1"># False
</span>
<span class="c1"># duplicate labels select all occurrences of that label
</span><span class="n">s</span> <span class="o">=</span> <span class="n">frame3</span><span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># 2000    1.5
# 2001    1.7
# 2002    3.6
# Name: Ohio, dtype: float64
</span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="nc">Index</span><span class="p">([</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2002</span><span class="p">]))</span>  <span class="c1"># Index([2000, 2001, 2002, 2000, 2002], dtype='int64')
</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="c1"># 2000    1.5
# 2001    1.7
# 2002    3.6
# 2000    1.5
# 2002    3.6
# Name: Ohio, dtype: float64</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="essential-functionality">2.2. Essential Functionality</h3>
<div class="sect3">
<h4 id="reindexing">2.2.1. Reindexing</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.3</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># d    4.5
# b    7.2
# a   -5.3
# c    3.6
# dtype: float64
</span><span class="n">obj</span><span class="p">.</span><span class="nf">reindex</span><span class="p">([</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># a   -5.3
# b    7.2
# c    3.6
# d    4.5
# e    NaN
# dtype: float64
</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">California</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#    Ohio  Texas  California
# a     0      1           2
# c     3      4           5
# d     6      7           8
</span>
<span class="n">frame</span><span class="p">.</span><span class="nf">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#    Ohio  Texas  California
# a   0.0    1.0         2.0
# b   NaN    NaN         NaN
# c   3.0    4.0         5.0
# d   6.0    7.0         8.0
</span>
<span class="c1"># reindex with the `axis` keyword
</span><span class="n">frame</span><span class="p">.</span><span class="nf">reindex</span><span class="p">([</span><span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Utah</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">California</span><span class="sh">"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#    Texas  Utah  California
# a      1   NaN           2
# c      4   NaN           5
# d      7   NaN           8
</span><span class="n">frame</span><span class="p">.</span><span class="nf">reindex</span><span class="p">([</span><span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Utah</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">California</span><span class="sh">"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#    Texas  Utah  California
# a      1   NaN           2
# c      4   NaN           5
# d      7   NaN           8
</span>
<span class="c1"># reindex with the `columns` keyword
</span><span class="n">frame</span><span class="p">.</span><span class="nf">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Utah</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">California</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#    Texas  Utah  California
# a      1   NaN           2
# c      4   NaN           5
# d      7   NaN           8
</span>
<span class="c1"># reindex with the `loc` operator
</span><span class="n">frame</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">],</span> <span class="p">[</span><span class="sh">"</span><span class="s">California</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">]]</span>
<span class="c1">#    California  Texas
# a           2      1
# d           8      7
# c           5      4</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dropping-entries-from-an-axis">2.2.2. Dropping Entries from an Axis</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">obj</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mf">5.</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># a    0.0
# b    1.0
# c    2.0
# d    3.0
# e    4.0
# dtype: float64
</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># a    0.0
# b    1.0
# d    3.0
# e    4.0
# dtype: float64
</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># a    0.0
# b    1.0
# e    4.0
# dtype: float64
</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Utah</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">four</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#          one  two  three  four
# Ohio        0    1      2     3
# Colorado    4    5      6     7
# Utah        8    9     10    11
# New York   12   13     14    15
</span><span class="n">data</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#           one  two  three  four
# Utah        8    9     10    11
# New York   12   13     14    15
</span><span class="n">data</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#           one  three  four
# Ohio        0      2     3
# Colorado    4      6     7
# Utah        8     10    11
# New York   12     14    15
</span><span class="n">data</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>          <span class="c1"># drop values from the columns by passing axis=1
#           one  three  four
# Ohio        0      2     3
# Colorado    4      6     7
# Utah        8     10    11
# New York   12     14    15
</span><span class="n">data</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># drop values from the columns by passing axis="columns"
#           one  three  four
# Ohio        0      2     3
# Colorado    4      6     7
# Utah        8     10    11
# New York   12     14    15</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="indexing-selection-and-filtering">2.2.3. Indexing, Selection, and Filtering</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mf">4.</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># a    0.0
# b    1.0
# c    2.0
# d    3.0
# dtype: float64
</span>
<span class="n">s</span><span class="p">[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># np.float64(1.0)
</span>
<span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># deprecated: label-based indexing or position-based ?
# np.float64(1.0)
</span>
<span class="n">s</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># by position
# np.float64(1.0)
</span><span class="n">s</span><span class="p">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="c1"># b    1.0
# d    3.0
# dtype: float64
</span>
<span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># slicing with integers is always integer oriented
# c    2.0
# d    3.0
# dtype: float64
</span>
<span class="n">s</span><span class="p">[[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">]]</span>
<span class="c1"># b    1.0
# a    0.0
# d    3.0
# dtype: float64
</span><span class="n">s</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">]]</span>  <span class="c1"># the preferred way to select index values by label
# b    1.0
# a    0.0
# d    3.0
# dtype: float64
</span>
<span class="n">s</span><span class="p">[</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">]</span>
<span class="c1"># a    0.0
# b    1.0
# dtype: float64
</span>
<span class="n">s</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># a    0.0
# b    5.0
# c    5.0
# d    3.0
# dtype: float64
</span>
<span class="c1"># retrieve one or more columns from a DataFrame either with a single value or sequence
# df[column]          select single column or sequence of columns from the DataFrame
# df.loc[rows]        select single row or subset of rows from the DataFrame by label
# df.loc[:, cols]     select single column or subset of columns by label
# df.loc[rows, cols]  select both row(s) and column(s) by label
# df.iloc[rows]       select single row or subset of rows from the DataFrame by integer position
# df.iloc[:, cols]    select single column or subset of columns by integer position
# df.iloc[rows, cols] select both row(s) and column(s) by integer position
# df.at[row, col]     select a single scalar value by row and column label
# df.iat[row, col]    select a single scalar value by row and column position (integers)
# df.reindex(...)     select either rows or columns by labels
</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Utah</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">four</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#           one  two  three  four
# Ohio        0    1      2     3
# Colorado    4    5      6     7
# Utah        8    9     10    11
# New York   12   13     14    15
</span>
<span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># Ohio         1
# Colorado     5
# Utah         9
# New York    13
# Name: two, dtype: int64
</span>
<span class="n">data</span><span class="p">[[</span><span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">]]</span>
<span class="c1">#           three  one
# Ohio          2    0
# Colorado      6    4
# Utah         10    8
# New York     14   12
</span>
<span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># slice (slice rows)
#           one  two  three  four
# Ohio        0    1      2     3
# Colorado    4    5      6     7
</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># boolean array (filter rows)
#           one  two  three  four
# Colorado    4    5      6     7
# Utah        8    9     10    11
# New York   12   13     14    15
</span>
<span class="n">data</span> <span class="o">&lt;</span> <span class="mi">5</span>
<span class="c1">#             one    two  three   four
# Ohio       True   True   True   True
# Colorado   True  False  False  False
# Utah      False  False  False  False
# New York  False  False  False  False
</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># boolean DataFrame (set values based on some criterion)
#           one  two  three  four
# Ohio        0    0      0     0
# Colorado    0    5      6     7
# Utah        8    9     10    11
# New York   12   13     14    15
</span>
<span class="c1"># select a subset of the rows and columns using either axis labels (loc) or integers (iloc)
</span><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># select a single row by label
# one      0
# two      5
# three    6
# four     7
# Name: Colorado, dtype: int64
</span>
<span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">]]</span>  <span class="c1"># select multiple rows with a sequence of labels
#           one  two  three  four
# Colorado    0    5      6     7
# New York   12   13     14    15
</span>
<span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">]]</span>  <span class="c1"># data.loc["Colorado"][["two", "three"]]
# two      5
# three    6
# Name: Colorado, dtype: int64
</span>
<span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># select a single row by integer
# one       8
# two       9
# three    10
# four     11
# Name: Utah, dtype: int64
</span>
<span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="c1">#           one  two  three  four
# Utah        8    9     10    11
# Colorado    0    5      6     7
</span>
<span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="c1"># four    11
# one      8
# two      9
# Name: Utah, dtype: int64
</span>
<span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="c1">#           four  one  two
# Colorado     7    0    5
# Utah        11    8    9
</span>
<span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">][</span><span class="n">data</span><span class="p">.</span><span class="n">three</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>
<span class="c1">#           one  two  three
# Colorado    0    5      6
# Utah        8    9     10
# New York   12   13     14
</span>
<span class="c1"># boolean arrays can be used with `loc` but not `iloc`
</span><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">.</span><span class="n">three</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># data[data.three &gt;= 2]
#           one  two  three  four
# Colorado    0    5      6     7
# Utah        8    9     10    11
# New York   12   13     14    15</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="arithmetic-and-data-alignment">2.2.4. Arithmetic and Data Alignment</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mf">7.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># a    7.3
# c   -2.5
# d    3.4
# e    1.5
# dtype: float64
</span><span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="o">-</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">f</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">g</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># a   -2.1
# c    3.6
# e   -1.5
# f    4.0
# g    3.1
# dtype: float64
</span><span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span>  <span class="c1"># label-based data alignment yields NaN for non-overlapping entries in arithmetic
# a    5.2
# c    1.1
# d    NaN
# e    0.0
# f    NaN
# g    NaN
# dtype: float64
</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mf">9.0</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="n">columns</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="sh">"</span><span class="s">bcd</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#             b    c    d
# Ohio      0.0  1.0  2.0
# Texas     3.0  4.0  5.0
# Colorado  6.0  7.0  8.0
</span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mf">12.0</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="n">columns</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="sh">"</span><span class="s">bde</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Utah</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Oregon</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#           b     d     e
# Utah    0.0   1.0   2.0
# Ohio    3.0   4.0   5.0
# Texas   6.0   7.0   8.0
# Oregon  9.0  10.0  11.0
</span><span class="n">df1</span> <span class="o">+</span> <span class="n">df2</span>  <span class="c1"># alignment is performed on both rows and columns on DataFrame
#             b   c     d   e
# Colorado  NaN NaN   NaN NaN
# Ohio      3.0 NaN   6.0 NaN
# Oregon    NaN NaN   NaN NaN
# Texas     9.0 NaN  12.0 NaN
# Utah      NaN NaN   NaN NaN
</span>
<span class="c1"># arithmetic methods with fill values: substitute the passed value for any missing values
</span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mf">12.</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="sh">"</span><span class="s">abcd</span><span class="sh">"</span><span class="p">))</span>
<span class="c1">#      a    b     c     d
# 0  0.0  1.0   2.0   3.0
# 1  4.0  5.0   6.0   7.0
# 2  8.0  9.0  10.0  11.0
</span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mf">20.</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="sh">"</span><span class="s">abcde</span><span class="sh">"</span><span class="p">))</span>
<span class="c1">#       a     b     c     d     e
# 0   0.0   1.0   2.0   3.0   4.0
# 1   5.0   6.0   7.0   8.0   9.0
# 2  10.0  11.0  12.0  13.0  14.0
# 3  15.0  16.0  17.0  18.0  19.0
</span>
<span class="n">df2</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="c1">#       a     b     c     d     e
# 0   0.0   1.0   2.0   3.0   4.0
# 1   5.0   NaN   7.0   8.0   9.0
# 2  10.0  11.0  12.0  13.0  14.0
# 3  15.0  16.0  17.0  18.0  19.0
</span>
<span class="n">df1</span> <span class="o">+</span> <span class="n">df2</span>
<span class="c1">#       a     b     c     d   e
# 0   0.0   2.0   4.0   6.0 NaN
# 1   9.0   NaN  13.0  15.0 NaN
# 2  18.0  20.0  22.0  24.0 NaN
# 3   NaN   NaN   NaN   NaN NaN
</span>
<span class="n">df1</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="c1">#       a     b     c     d     e
# 0   0.0   2.0   4.0   6.0   4.0
# 1   9.0   5.0  13.0  15.0   9.0
# 2  18.0  20.0  22.0  24.0  14.0
# 3  15.0  16.0  17.0  18.0  19.0
</span>
<span class="c1"># broadcasting: operations between DataFrame and Series
</span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([[ 0,  1,  2,  3],
#        [ 4,  5,  6,  7],
#        [ 8,  9, 10, 11]])
</span>
<span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># array([0, 1, 2, 3])
</span>
<span class="n">arr</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># the subtraction is performed once for each row
# array([[0, 0, 0, 0],
#        [4, 4, 4, 4],
#        [8, 8, 8, 8]])</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="function-application-and-mapping">2.2.5. Function Application and Mapping</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="n">columns</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="sh">"</span><span class="s">bde</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Utah</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Oregon</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#                b         d         e
# Utah   -0.079026  1.151062 -0.393464
# Ohio   -0.731363  0.601451 -0.462457
# Texas  -1.400861  0.892020 -0.010010
# Oregon  0.899501 -0.418370 -0.791160
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># NumPy ufuncs (element-wise array methods)
#                b         d         e
# Utah    0.079026  1.151062  0.393464
# Ohio    0.731363  0.601451  0.462457
# Texas   1.400861  0.892020  0.010010
# Oregon  0.899501  0.418370  0.791160
</span>
<span class="c1"># apply a function along an axis of the DataFrame.
</span><span class="n">data</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nf">min</span><span class="p">())</span>
<span class="c1"># b    2.300362
# d    1.569433
# e    0.781149
# dtype: float64
</span><span class="n">data</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nf">min</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Utah      1.544527
# Ohio      1.332813
# Texas     2.292882
# Oregon    1.690661
# dtype: float64
</span><span class="n">data</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="n">x</span><span class="p">.</span><span class="nf">max</span><span class="p">(),</span> <span class="n">x</span><span class="p">.</span><span class="nf">min</span><span class="p">()],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">]))</span>
<span class="c1">#             b         d        e
# max  0.899501  1.151062 -0.01001
# min -1.400861 -0.418370 -0.79116
</span>
<span class="c1"># apply a function to a Dataframe element-wise
</span><span class="n">data</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#             b      d      e
# Utah    -0.08   1.15  -0.39
# Ohio    -0.73   0.60  -0.46
# Texas   -1.40   0.89  -0.01
# Oregon   0.90  -0.42  -0.79</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sorting-and-ranking">2.2.6. Sorting and Ranking</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># d    4
# a    7
# b   -3
# c    2
# dtype: int64
</span>
<span class="c1"># sort lexicographically by row or column label
</span><span class="n">s</span><span class="p">.</span><span class="nf">sort_index</span><span class="p">()</span>
<span class="c1"># a    7
# b   -3
# c    2
# d    4
# dtype: int64
</span><span class="n">s</span><span class="p">.</span><span class="nf">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># descending
# d    4
# c    2
# b   -3
# a    7
# dtype: int64
</span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">()</span>
<span class="c1"># Index(['a', 'b', 'c', 'd'], dtype='object')
</span><span class="n">s</span><span class="p">.</span><span class="nf">reindex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="c1"># a    7
# b   -3
# c    2
# d    4
# dtype: int64
</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">()</span>  <span class="c1"># sort by value
# b   -3
# c    2
# d    4
# a    7
# dtype: int64
</span>
<span class="c1"># any missing values are sorted to the end of the Series by default
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]).</span><span class="nf">sort_values</span><span class="p">()</span>
<span class="c1"># 4   -3.0
# 5    2.0
# 0    4.0
# 2    7.0
# 1    NaN
# 3    NaN
# dtype: float64
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]).</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># 2    7.0
# 0    4.0
# 5    2.0
# 4   -3.0
# 1    NaN
# 3    NaN
# dtype: float64
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]).</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">na_position</span><span class="o">=</span><span class="sh">"</span><span class="s">first</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 1    NaN
# 3    NaN
# 4   -3.0
# 5    2.0
# 0    4.0
# 2    7.0
# dtype: float64
</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1">#        d  a  b  c
# three  4  7 -3  2
# one    0  1  0  1
</span><span class="n">data</span><span class="p">.</span><span class="nf">sort_index</span><span class="p">()</span>
<span class="c1">#        d  a  b  c
# one    0  1  0  1
# three  4  7 -3  2
</span><span class="n">data</span><span class="p">.</span><span class="nf">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#        a  b  c  d
# three  7 -3  2  4
# one    1  0  1  0</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># compute numerical data ranks (1 through n) along axis.
</span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="n">s</span><span class="p">.</span><span class="nf">rank</span><span class="p">()</span>  <span class="c1"># by default, average rank of the group
# 0    6.5
# 1    1.0
# 2    6.5
# 3    4.5
# 4    3.0
# 5    2.0
# 6    4.5
# dtype: float64
</span><span class="n">s</span><span class="p">.</span><span class="nf">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="sh">"</span><span class="s">first</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ranks assigned in order they appear in the array
# 0    6.0
# 1    1.0
# 2    7.0
# 3    4.0
# 4    3.0
# 5    2.0
# 6    5.0
# dtype: float64
</span><span class="n">s</span><span class="p">.</span><span class="nf">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># rank in descending order
# 0    1.5
# 1    7.0
# 2    1.5
# 3    3.5
# 4    5.0
# 5    6.0
# 6    3.5
# dtype: float64
</span>
<span class="c1"># DataFrame can compute ranks over the rows or the columns
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">]})</span>
<span class="c1">#      b  a    c
# 0  4.3  0 -2.0
# 1  7.0  1  5.0
# 2 -3.0  0  8.0
# 3  2.0  1 -2.5
</span><span class="n">data</span><span class="p">.</span><span class="nf">rank</span><span class="p">()</span>
<span class="c1">#      b    a    c
# 0  3.0  1.5  2.0
# 1  4.0  3.5  3.0
# 2  1.0  1.5  4.0
# 3  2.0  3.5  1.0
</span><span class="n">data</span><span class="p">.</span><span class="nf">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="sh">"</span><span class="s">first</span><span class="sh">"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#      b    a    c
# 0  3.0  2.0  1.0
# 1  3.0  1.0  2.0
# 2  1.0  2.0  3.0
# 3  3.0  2.0  1.0</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="axis-indexes-with-duplicate-labels">2.2.7. Axis Indexes with Duplicate Labels</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># a    0
# a    1
# b    2
# b    3
# c    4
# dtype: int64
</span><span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">is_unique</span>
<span class="c1"># False
</span><span class="n">s</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># return a Series
# a    0
# a    1
# dtype: int64
</span><span class="n">s</span><span class="p">[</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># return a scalar value
# np.int64(4)
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#           0         1         2
# a -0.366146  0.329982  0.186980
# a  1.275523  0.615156 -3.403692
# b  0.488783 -0.448384 -2.626718
# b  0.610570  2.211333  1.131847
# c -0.157337  0.212340  0.175906
</span><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># return a DataFrame
#           0         1         2
# a -0.366146  0.329982  0.186980
# a  1.275523  0.615156 -3.403692
</span><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># return a Series
# 0   -0.157337
# 1    0.212340
# 2    0.175906
# Name: c, dtype: float64</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unique-values-value-counts-and-membership">2.2.8. Unique Values, Value Counts, and Membership</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">])</span>
<span class="n">s</span><span class="p">.</span><span class="nf">unique</span><span class="p">()</span>  <span class="c1"># return unique values of Series object
# array(['c', 'a', 'd', 'b'], dtype=object)
</span><span class="n">s</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">()</span>  <span class="c1"># return a Series containing counts of unique values
# c    3
# a    3
# b    2
# d    1
# Name: count, dtype: int64
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">isin</span><span class="p">([</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># performs a vectorized set membership check
# 0     True
# 1    False
# 2    False
# 3    False
# 4    False
# 5     True
# 6     True
# 7     True
# 8     True
# dtype: bool
</span><span class="n">s</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="c1"># 0    c
# 5    b
# 6    b
# 7    c
# 8    c
# dtype: object
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Index</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">unique</span><span class="p">()))</span>
<span class="c1"># Index(['c', 'a', 'd', 'b'], dtype='object')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Index</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">unique</span><span class="p">())).</span><span class="nf">get_indexer</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="c1"># array([0, 1, 2, 1, 1, 3, 3, 0, 0])</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="numpy-arrays">2.2.9. NumPy Arrays</h4>
<div class="ulist">
<ul>
<li>
<p>Pandas is often used for data loading and cleaning in model development, with feature engineering being crucial, and the transition to modeling libraries typically involves converting data to NumPy arrays.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">x0</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">x1</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">y</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#    x0    x1    y
# 0   1  0.01 -1.5
# 1   2 -0.01  0.0
# 2   3  0.25  3.6
# 3   4 -4.10  1.3
# 4   5  0.00 -2.0
</span><span class="n">data</span><span class="p">.</span><span class="n">columns</span>
<span class="c1"># Index(['x0', 'x1', 'y'], dtype='object')
</span>
<span class="c1"># to a NumPy array from a DataFrame
</span><span class="n">data</span><span class="p">.</span><span class="nf">to_numpy</span><span class="p">()</span>
<span class="c1"># array([[ 1.  ,  0.01, -1.5 ],
#        [ 2.  , -0.01,  0.  ],
#        [ 3.  ,  0.25,  3.6 ],
#        [ 4.  , -4.1 ,  1.3 ],
#        [ 5.  ,  0.  , -2.  ]])
</span>
<span class="c1"># to a DataFrame from a NumPy array
</span><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">to_numpy</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
<span class="c1">#     x0    x1    y
# 0  1.0  0.01 -1.5
# 1  2.0 -0.01  0.0
# 2  3.0  0.25  3.6
# 3  4.0 -4.10  1.3
# 4  5.0  0.00 -2.0</span></code></pre>
</div>
</div>
</li>
<li>
<p>The <code>to_numpy</code> method is best for homogeneous data, producing a numeric ndarray, whereas heterogeneous data results in an ndarray of Python objects.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data1</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">data1</span><span class="p">[</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">]</span>
<span class="c1">#    x0    x1    y string
# 0   1  0.01 -1.5      a
# 1   2 -0.01  0.0      b
# 2   3  0.25  3.6      c
# 3   4 -4.10  1.3      d
# 4   5  0.00 -2.0      e
</span><span class="n">data1</span><span class="p">.</span><span class="nf">to_numpy</span><span class="p">()</span>
<span class="c1"># array([[1, 0.01, -1.5, 'a'],
#        [2, -0.01, 0.0, 'b'],
#        [3, 0.25, 3.6, 'c'],
#        [4, -4.1, 1.3, 'd'],
#        [5, 0.0, -2.0, 'e']], dtype=object)</span></code></pre>
</div>
</div>
</li>
<li>
<p>It&#8217;s recommended to use <code>loc</code> indexing to select a subset of columns before applying <code>to_numpy</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="sh">"</span><span class="s">x0</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">x1</span><span class="sh">"</span><span class="p">]].</span><span class="nf">to_numpy</span><span class="p">()</span>
<span class="c1"># array([[ 1.  ,  0.01],
#        [ 2.  , -0.01],
#        [ 3.  ,  0.25],
#        [ 4.  , -4.1 ],
#        [ 5.  ,  0.  ]])</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reading-and-writing">2.3. Reading and Writing</h3>
<div class="sect3">
<h4 id="reading-and-writing-csv-text-files">2.3.1. Reading and Writing CSV Text Files</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">csv_data</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
Id,Name,Birth Day,Phone Number,Age,City,Country,Timestamp
1,John,1998-05-06,1234567890,25,New York,USA,894240000
2,Jane,1993-07-15,0987654321,30,London,UK,741484800
3,Doe,2001-12-20,1122334455,,Sydney,Australia,1008806400
4,NULL,1990-01-01,NULL,40,NULL,Canada,631152000
</span><span class="sh">"""</span>
<span class="c1"># load the CSV data into a DataFrame
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span>
    <span class="n">io</span><span class="p">.</span><span class="nc">StringIO</span><span class="p">(</span><span class="n">csv_data</span><span class="p">),</span>        <span class="c1"># use io.StringIO to simulate a file-like object
</span>    <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Birth Day</span><span class="sh">"</span><span class="p">],</span>    <span class="c1"># parse the 'Birth Day' column as datetime
</span>    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">Phone Number</span><span class="sh">"</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span>  <span class="c1"># treat 'Phone Number' as a string
</span>    <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">NULL</span><span class="sh">"</span><span class="p">],</span>       <span class="c1"># handle missing values
</span><span class="p">)</span>
<span class="c1">#    Id  Name  Birth Day Phone Number   Age      City    Country   Timestamp
# 0   1  John 1998-05-06   1234567890  25.0  New York        USA   894240000
# 1   2  Jane 1993-07-15   0987654321  30.0    London         UK   741484800
# 2   3   Doe 2001-12-20   1122334455   NaN    Sydney  Australia  1008806400
# 3   4   NaN 1990-01-01          NaN  40.0       NaN     Canada   631152000
# convert the 'Timestamp' column from Unix epoch time to datetime
</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">Timestamp</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">Timestamp</span><span class="sh">"</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="sh">"</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#    Id  Name  Birth Day Phone Number   Age      City    Country   Timestamp  timestamp
# 0   1  John 1998-05-06   1234567890  25.0  New York        USA   894240000 1998-05-04
# 1   2  Jane 1993-07-15   0987654321  30.0    London         UK   741484800 1993-07-01
# 2   3   Doe 2001-12-20   1122334455   NaN    Sydney  Australia  1008806400 2001-12-20
# 3   4   NaN 1990-01-01          NaN  40.0       NaN     Canada   631152000 1990-01-01
</span><span class="n">data</span><span class="p">.</span><span class="n">dtypes</span>
<span class="c1"># Id                       int64
# Name                    object
# Birth Day       datetime64[ns]
# Phone Number            object
# Age                    float64
# City                    object
# Country                 object
# Timestamp       datetime64[ns]
# dtype: object
</span>
<span class="c1"># write the data out to a comma-separated file
</span><span class="n">data</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">)</span>  <span class="c1"># import sys
# ,Id,Name,Birth Day,Phone Number,Age,City,Country,Timestamp
# 0,1,John,1998-05-06,1234567890,25.0,New York,USA,1998-05-04
# 1,2,Jane,1993-07-15,0987654321,30.0,London,UK,1993-07-01
# 2,3,Doe,2001-12-20,1122334455,,Sydney,Australia,2001-12-20
# 3,4,,1990-01-01,,40.0,,Canada,1990-01-01
</span><span class="n">data</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># Id,Name,Birth Day,Phone Number,Age,City,Country,Timestamp
# 1,John,1998-05-06,1234567890,25.0,New York,USA,1998-05-04
# 2,Jane,1993-07-15,0987654321,30.0,London,UK,1993-07-01
# 3,Doe,2001-12-20,1122334455,,Sydney,Australia,2001-12-20
# 4,,1990-01-01,,40.0,,Canada,1990-01-01
</span><span class="n">data</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">na_rep</span><span class="o">=</span><span class="sh">'</span><span class="s">NIL</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># Id,Name,Birth Day,Phone Number,Age,City,Country,Timestamp
# 1,John,1998-05-06,1234567890,25.0,New York,USA,1998-05-04
# 2,Jane,1993-07-15,0987654321,30.0,London,UK,1993-07-01
# 3,Doe,2001-12-20,1122334455,NIL,Sydney,Australia,2001-12-20
# 4,NIL,1990-01-01,NIL,40.0,NIL,Canada,1990-01-01
</span><span class="n">data</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">na_rep</span><span class="o">=</span><span class="sh">'</span><span class="s">NIL</span><span class="sh">'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># 1,John,1998-05-06,1234567890,25.0,New York,USA,1998-05-04
# 2,Jane,1993-07-15,0987654321,30.0,London,UK,1993-07-01
# 3,Doe,2001-12-20,1122334455,NIL,Sydney,Australia,2001-12-20
# 4,NIL,1990-01-01,NIL,40.0,NIL,Canada,1990-01-01</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reading-and-writing-microsoft-excel-files">2.3.2. Reading and Writing Microsoft Excel Files</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># add-on packages xlrd and openpyxl to read old-style XLS and newer XLSX files</span>
conda <span class="nb">install </span>openpyxl xlrd</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pandas.ExcelFile</code>: read sheets and parse as DataFrame</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">xlsx</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">ExcelFile</span><span class="p">(</span><span class="sh">"</span><span class="s">book1.xlsx</span><span class="sh">"</span><span class="p">)</span>
<span class="n">xlsx</span><span class="p">.</span><span class="n">sheet_names</span>
<span class="c1"># ['Sheet1']
</span><span class="n">xlsx</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">Sheet1</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#    0  a   b   c   d message
# 0  0  1   2   3   4   hello
# 1  1  5   6   7   8   world
# 2  2  9  10  11  12     foo
</span><span class="n">df</span> <span class="o">=</span> <span class="n">xlsx</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">Sheet1</span><span class="sh">"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#    a   b   c   d message
# 0
# 0  1   2   3   4   hello
# 1  5   6   7   8   world
# 2  9  10  11  12     foo
</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span>  <span class="c1"># Index(['a', 'b', 'c', 'd', 'message'], dtype='object')
</span><span class="n">df</span><span class="p">.</span><span class="n">index</span>    <span class="c1"># Index([0, 1, 2], dtype='int64', name=0)
</span><span class="n">xlsx</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">Sheet1</span><span class="sh">"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#          0  a   b   c   d
# message
# hello    0  1   2   3   4
# world    1  5   6   7   8
# foo      2  9  10  11  12</span></code></pre>
</div>
</div>
</li>
<li>
<p><code>pandas.read_excel</code>: read a sheet as pandas data directly</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">pd</span><span class="p">.</span><span class="nf">read_excel</span><span class="p">(</span><span class="sh">"</span><span class="s">book1.xlsx</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># pd.read_excel("book1.xlsx", sheet_name=0)
#    0  a   b   c   d message
# 0  0  1   2   3   4   hello
# 1  1  5   6   7   8   world
# 2  2  9  10  11  12     foo
</span><span class="n">pd</span><span class="p">.</span><span class="nf">read_excel</span><span class="p">(</span><span class="sh">"</span><span class="s">book1.xlsx</span><span class="sh">"</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">Sheet1</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#    0  a   b   c   d message
# 0  0  1   2   3   4   hello
# 1  1  5   6   7   8   world
# 2  2  9  10  11  12     foo</span></code></pre>
</div>
</div>
</li>
<li>
<p><code>pandas.to_excel</code>: write pandas data to Excel files</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">ExcelWriter</span><span class="p">(</span><span class="sh">"</span><span class="s">sample1.xlsx</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">foo</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># write to sheet 'foo'
</span><span class="n">df</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># write to sheet 'bar'
</span><span class="n">df</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">"</span><span class="s">buz</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># write to sheet 'buz'
</span><span class="n">pd</span><span class="p">.</span><span class="nc">ExcelFile</span><span class="p">(</span><span class="sh">"</span><span class="s">sample1.xlsx</span><span class="sh">"</span><span class="p">).</span><span class="n">sheet_names</span>
<span class="c1"># ['foo', 'bar', 'buz']</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="reading-and-writing-json-files">2.3.3. Reading and Writing JSON Files</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">import</span> <span class="n">json</span>

<span class="n">obj</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">Wes</span><span class="sh">"</span><span class="s">,
</span><span class="sh">"</span><span class="s">cities_lived</span><span class="sh">"</span><span class="s">: [</span><span class="sh">"</span><span class="s">Akron</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Nashville</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">San Francisco</span><span class="sh">"</span><span class="s">],
</span><span class="sh">"</span><span class="s">pet</span><span class="sh">"</span><span class="s">: null,
</span><span class="sh">"</span><span class="s">siblings</span><span class="sh">"</span><span class="s">: [{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">Scott</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="s">: 34, </span><span class="sh">"</span><span class="s">hobbies</span><span class="sh">"</span><span class="s">: [</span><span class="sh">"</span><span class="s">guitars</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">soccer</span><span class="sh">"</span><span class="s">]},
{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">Katie</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="s">: 42, </span><span class="sh">"</span><span class="s">hobbies</span><span class="sh">"</span><span class="s">: [</span><span class="sh">"</span><span class="s">diving</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">art</span><span class="sh">"</span><span class="s">]}]
}
</span><span class="sh">"""</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="c1"># deserialization
# {'name': 'Wes',
#  'cities_lived': ['Akron', 'Nashville', 'New York', 'San Francisco'],
#  'pet': None,
#  'siblings': [{'name': 'Scott', 'age': 34, 'hobbies': ['guitars', 'soccer']},
#   {'name': 'Katie', 'age': 42, 'hobbies': ['diving', 'art']}]}
</span>
<span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="c1"># serialization
# '{"name": "Wes", "cities_lived": ["Akron", "Nashville", "New York", "San Francisco"], "pet": null, "siblings": [{"name": "Scott", "age": 34, "hobbies": ["guitars", "soccer"]}, {"name": "Katie", "age": 42, "hobbies": ["diving", "art"]}]}'
</span>
<span class="c1"># load and select a subset of the data fields
</span><span class="n">siblings</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">siblings</span><span class="sh">"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#     name  age
# 0  Scott   34
# 1  Katie   42</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># !cat examples/example.json
# [{"a": 1, "b": 2, "c": 3},
# {"a": 4, "b": 5, "c": 6},
# {"a": 7, "b": 8, "c": 9}]
</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_json</span><span class="p">(</span><span class="sh">"</span><span class="s">examples/example.json</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#    a  b  c
# 0  1  2  3
# 1  4  5  6
# 2  7  8  9
</span>
<span class="kn">import</span> <span class="n">sys</span>

<span class="n">data</span><span class="p">.</span><span class="nf">to_json</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="c1"># {"a":{"0":1,"1":4,"2":7},"b":{"0":2,"1":5,"2":8},"c":{"0":3,"1":6,"2":9}}
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">to_json</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="sh">"</span><span class="s">records</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># [{"a":1,"b":2,"c":3},{"a":4,"b":5,"c":6},{"a":7,"b":8,"c":9}]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Pandas, <code>pd.read_json</code> is designed for flat JSON structures and creates a DataFrame with nested objects as-is, while <code>pd.json_normalize</code> is specifically designed to flatten nested JSON structures and extract nested data into separate columns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">json_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">details</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">orders</span><span class="sh">"</span><span class="p">:</span> <span class="p">[{</span><span class="sh">"</span><span class="s">item</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Laptop</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1200</span><span class="p">},</span> <span class="p">{</span><span class="sh">"</span><span class="s">item</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Mouse</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">50</span><span class="sh">"</span><span class="p">}],</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">details</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">London</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">orders</span><span class="sh">"</span><span class="p">:</span> <span class="p">[{</span><span class="sh">"</span><span class="s">item</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Keyboard</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">}],</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">df_norm</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">json_normalize</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
<span class="c1">#    id   name                                                                 orders  details.age details.city
# 0   1  Alice  [{'item': 'Laptop', 'price': 1200}, {'item': 'Mouse', 'price': '50'}]           30     New York
# 1   2    Bob                                   [{'item': 'Keyboard', 'price': 100}]           25       London
</span><span class="n">df_norm</span><span class="p">.</span><span class="n">columns</span>
<span class="c1"># Index(['id', 'name', 'orders', 'details.age', 'details.city'], dtype='object')
</span>
<span class="c1"># extract the orders array into separate rows
</span><span class="n">df_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">json_normalize</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">record_path</span><span class="o">=</span><span class="sh">"</span><span class="s">orders</span><span class="sh">"</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#        item price id   name
# 0    Laptop  1200  1  Alice
# 1     Mouse    50  1  Alice
# 2  Keyboard   100  2    Bob
</span><span class="n">df_orders</span><span class="p">.</span><span class="n">columns</span>
<span class="c1"># Index(['item', 'price', 'id', 'name'], dtype='object')</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reading-sql-based-databases">2.3.4. Reading SQL-based Databases</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">import</span> <span class="n">sqlite3</span>

<span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">CREATE TABLE test (a VARCHAR(20), b VARCHAR(20), c REAL, d INTEGER );</span><span class="sh">"</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="sh">"</span><span class="s">mydata.sqlite</span><span class="sh">"</span><span class="p">)</span>
<span class="n">con</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="c1"># &lt;sqlite3.Cursor at 0x7f56df665840&gt;
</span><span class="n">con</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">Atlanta</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Georgia</span><span class="sh">"</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">Tallahassee</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Florida</span><span class="sh">"</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">Sacramento</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">California</span><span class="sh">"</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="sh">"</span><span class="s">INSERT INTO test VALUES(?, ?, ?, ?)</span><span class="sh">"</span>
<span class="n">con</span><span class="p">.</span><span class="nf">executemany</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="c1"># &lt;sqlite3.Cursor at 0x7f56e074fac0&gt;
</span><span class="n">con</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM test</span><span class="sh">"</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
<span class="c1"># [('Atlanta', 'Georgia', 1.25, 6),
#  ('Tallahassee', 'Florida', 2.6, 3),
#  ('Sacramento', 'California', 1.7, 5)]
</span><span class="n">cursor</span><span class="p">.</span><span class="n">description</span>
<span class="c1"># (('a', None, None, None, None, None, None),
#  ('b', None, None, None, None, None, None),
#  ('c', None, None, None, None, None, None),
#  ('d', None, None, None, None, None, None))
</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">.</span><span class="n">description</span><span class="p">]</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="c1">#              a           b     c  d
# 0      Atlanta     Georgia  1.25  6
# 1  Tallahassee     Florida  2.60  3
# 2   Sacramento  California  1.70  5</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pandas.read_sql</code>: read data easily from a general SQLAlchemy connection</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">import</span> <span class="n">sqlalchemy</span> <span class="k">as</span> <span class="n">sqla</span>  <span class="c1"># conda install sqlalchemy -y
</span><span class="n">db</span> <span class="o">=</span> <span class="n">sqla</span><span class="p">.</span><span class="nf">create_engine</span><span class="p">(</span><span class="sh">"</span><span class="s">sqlite:///mydata.sqlite</span><span class="sh">"</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">read_sql</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM test</span><span class="sh">"</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
<span class="c1">#              a           b     c  d
# 0      Atlanta     Georgia  1.25  6
# 1  Tallahassee     Florida  2.60  3
# 2   Sacramento  California  1.70  5</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-cleaning-and-preparation">3. Data Cleaning and Preparation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="handling-missing-data">3.1. Handling Missing Data</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">s</span><span class="p">.</span><span class="nf">dropna</span><span class="p">()</span>  <span class="c1"># remove missing values
# 0    1.0
# 2    3.5
# 4    7.0
# dtype: float64
</span><span class="n">s</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># fill NA/NaN values (NA: not available)
# 0    1.0
# 1    0.0
# 2    3.5
# 3    0.0
# 4    7.0
# dtype: float64
</span><span class="n">s</span><span class="p">.</span><span class="nf">isna</span><span class="p">()</span>
<span class="c1"># 0    False
# 1     True
# 2    False
# 3     True
# 4    False
# dtype: bool
</span><span class="n">s</span><span class="p">.</span><span class="nf">notna</span><span class="p">()</span>
<span class="c1"># 0     True
# 1    False
# 2     True
# 3    False
# 4     True
# dtype: bool
</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="c1">#      0    1    2
# 0  1.0  6.5  3.0
# 1  1.0  NaN  NaN
# 2  NaN  NaN  NaN
# 3  NaN  6.5  3.0
</span><span class="n">data</span><span class="p">.</span><span class="nf">dropna</span><span class="p">()</span>
<span class="c1">#      0    1    2
# 0  1.0  6.5  3.0
</span><span class="n">data</span><span class="p">.</span><span class="nf">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">all</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#      0    1    2
# 0  1.0  6.5  3.0
# 1  1.0  NaN  NaN
# 3  NaN  6.5  3.0
</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="c1">#      0    1    2   4
# 0  1.0  6.5  3.0 NaN
# 1  1.0  NaN  NaN NaN
# 2  NaN  NaN  NaN NaN
# 3  NaN  6.5  3.0 NaN
</span><span class="n">data</span><span class="p">.</span><span class="nf">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">all</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#      0    1    2
# 0  1.0  6.5  3.0
# 1  1.0  NaN  NaN
# 2  NaN  NaN  NaN
# 3  NaN  6.5  3.0
</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="c1">#           0         1         2
# 0 -0.327178       NaN       NaN
# 1  1.345916       NaN       NaN
# 2 -0.502837       NaN  0.894144
# 3 -0.372355       NaN -1.719540
# 4 -0.210112  0.484139  0.904050
# 5  0.100575 -1.676686 -0.691126
# 6  0.581531 -0.615403 -1.176631
</span><span class="n">data</span><span class="p">.</span><span class="nf">dropna</span><span class="p">()</span>
<span class="c1">#           0         1         2
# 4 -0.210112  0.484139  0.904050
# 5  0.100575 -1.676686 -0.691126
# 6  0.581531 -0.615403 -1.176631
</span><span class="n">data</span><span class="p">.</span><span class="nf">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#           0         1         2
# 2 -0.502837       NaN  0.894144
# 3 -0.372355       NaN -1.719540
# 4 -0.210112  0.484139  0.904050
# 5  0.100575 -1.676686 -0.691126
# 6  0.581531 -0.615403 -1.176631
</span><span class="n">data</span><span class="p">.</span><span class="nf">ffill</span><span class="p">()</span>  <span class="c1"># fill NA/NaN values by using the last (row) valid observation to fill the gap
#           0         1         2
# 0 -0.327178       NaN       NaN
# 1  1.345916       NaN       NaN
# 2 -0.502837       NaN  0.894144
# 3 -0.372355       NaN -1.719540
# 4 -0.210112  0.484139  0.904050
# 5  0.100575 -1.676686 -0.691126
# 6  0.581531 -0.615403 -1.176631
</span><span class="n">data</span><span class="p">.</span><span class="nf">ffill</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#           0         1         2
# 0 -0.327178 -0.327178 -0.327178
# 1  1.345916  1.345916  1.345916
# 2 -0.502837 -0.502837  0.894144
# 3 -0.372355 -0.372355 -1.719540
# 4 -0.210112  0.484139  0.904050
# 5  0.100575 -1.676686 -0.691126
# 6  0.581531 -0.615403 -1.176631
</span><span class="n">data</span><span class="p">.</span><span class="nf">bfill</span><span class="p">()</span>  <span class="c1"># fill NA/NaN values by using the next (row) valid observation to fill the gap
#           0         1         2
# 0 -0.327178  0.484139  0.894144
# 1  1.345916  0.484139  0.894144
# 2 -0.502837  0.484139  0.894144
# 3 -0.372355  0.484139 -1.719540
# 4 -0.210112  0.484139  0.904050
# 5  0.100575 -1.676686 -0.691126
# 6  0.581531 -0.615403 -1.176631
</span><span class="n">data</span><span class="p">.</span><span class="nf">bfill</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#           0         1         2
# 0 -0.327178       NaN       NaN
# 1  1.345916       NaN       NaN
# 2 -0.502837  0.894144  0.894144
# 3 -0.372355 -1.719540 -1.719540
# 4 -0.210112  0.484139  0.904050
# 5  0.100575 -1.676686 -0.691126
# 6  0.581531 -0.615403 -1.176631</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="removing-duplicates">3.2. Removing Duplicates</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">k1</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">],</span> <span class="sh">"</span><span class="s">k2</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>
<span class="c1">#     k1  k2
# 0  one   1
# 1  two   1
# 2  one   2
# 3  two   3
# 4  one   3
# 5  two   4
# 6  two   4
</span><span class="n">data</span><span class="p">.</span><span class="nf">duplicated</span><span class="p">()</span>
<span class="c1"># 0    False
# 1    False
# 2    False
# 3    False
# 4    False
# 5    False
# 6     True
# dtype: bool
</span><span class="n">data</span><span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">()</span>
    <span class="n">k1</span>  <span class="n">k2</span>
<span class="mi">0</span>  <span class="n">one</span>   <span class="mi">1</span>
<span class="mi">1</span>  <span class="n">two</span>   <span class="mi">1</span>
<span class="mi">2</span>  <span class="n">one</span>   <span class="mi">2</span>
<span class="mi">3</span>  <span class="n">two</span>   <span class="mi">3</span>
<span class="mi">4</span>  <span class="n">one</span>   <span class="mi">3</span>
<span class="mi">5</span>  <span class="n">two</span>   <span class="mi">4</span>

<span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">v1</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="c1">#     k1  k2  v1
# 0  one   1   0
# 1  two   1   1
# 2  one   2   2
# 3  two   3   3
# 4  one   3   4
# 5  two   4   5
# 6  two   4   6
</span><span class="n">data</span><span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">k1</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#     k1  k2  v1
# 0  one   1   0
# 1  two   1   1
</span><span class="n">data</span><span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">k1</span><span class="sh">"</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="sh">"</span><span class="s">last</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#     k1  k2  v1
# 4  one   3   4
# 6  two   4   6</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transforming-data-using-a-function-or-mapping">3.3. Transforming Data Using a Function or Mapping</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">food</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="sh">"</span><span class="s">bacon</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">pulled pork</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">bacon</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">pastrami</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">corned beef</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">bacon</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">pastrami</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">honey ham</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">nova lox</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="sh">"</span><span class="s">ounces</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#           food  ounces
# 0        bacon     4.0
# 1  pulled pork     3.0
# 2        bacon    12.0
# 3     pastrami     6.0
# 4  corned beef     7.5
# 5        bacon     8.0
# 6     pastrami     3.0
# 7    honey ham     5.0
# 8     nova lox     6.0
</span><span class="n">meat_to_animal</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">bacon</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">pig</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">pulled pork</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">pig</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">pastrami</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">cow</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">corned beef</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">cow</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">honey ham</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">pig</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">nova lox</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">salmon</span><span class="sh">"</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">animal</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">food</span><span class="sh">"</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="n">meat_to_animal</span><span class="p">)</span>  <span class="c1"># data["food"].map(lambda x: meat_to_animal.get(x, None))
#           food  ounces  animal
# 0        bacon     4.0     pig
# 1  pulled pork     3.0     pig
# 2        bacon    12.0     pig
# 3     pastrami     6.0     cow
# 4  corned beef     7.5     cow
# 5        bacon     8.0     pig
# 6     pastrami     3.0     cow
# 7    honey ham     5.0     pig
# 8     nova lox     6.0  salmon</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replacing-values">3.4. Replacing Values</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">999.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">999.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">])</span>
<span class="c1"># 0       1.0
# 1    -999.0
# 2       2.0
# 3    -999.0
# 4   -1000.0
# 5       3.0
# dtype: float64
</span><span class="n">data</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>
<span class="c1"># 0       1.0
# 1       NaN
# 2       2.0
# 3       NaN
# 4   -1000.0
# 5       3.0
# dtype: float64
</span><span class="n">data</span><span class="p">.</span><span class="nf">replace</span><span class="p">([</span><span class="o">-</span><span class="mi">999</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">],</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>  <span class="c1"># replace multiple values at once
# 0    1.0
# 1    NaN
# 2    2.0
# 3    NaN
# 4    NaN
# 5    3.0
# dtype: float64</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="renaming-axis-indexes">3.5. Renaming Axis Indexes</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">four</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:</span><span class="mi">4</span><span class="p">].</span><span class="nf">upper</span><span class="p">())</span>
<span class="c1"># Index(['OHIO', 'COLO', 'NEW '], dtype='object')
</span>
<span class="n">data</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:</span><span class="mi">4</span><span class="p">].</span><span class="nf">upper</span><span class="p">())</span>
<span class="c1">#       one  two  three  four
# OHIO    0    1      2     3
# COLO    4    5      6     7
# NEW     8    9     10    11
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">.</span><span class="n">title</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">str</span><span class="p">.</span><span class="n">upper</span><span class="p">)</span>
<span class="c1">#       ONE  TWO  THREE  FOUR
# Ohio    0    1      2     3
# Colo    4    5      6     7
# New     8    9     10    11</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="discretization-and-binning">3.6. Discretization and Binning</h3>
<div class="ulist">
<ul>
<li>
<p><code>pandas.cut()</code>: discretizes data points into bins based on values</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># continuous data points (i.e. observations) is often discretized or otherwise separated into “bins” for analysis
</span><span class="n">ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>

<span class="n">age_categories</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">cut</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>  <span class="c1"># pandas.core.arrays.categorical.Categorical
# [(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]
# Length: 12
# Categories (4, interval[int64, right]): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]
</span>
<span class="n">age_categories</span><span class="p">.</span><span class="n">codes</span>
<span class="c1"># array([0, 0, 0, 1, 0, 0, 2, 1, 3, 2, 2, 1], dtype=int8)
</span><span class="n">age_categories</span><span class="p">.</span><span class="n">categories</span>
<span class="c1"># IntervalIndex([(18, 25], (25, 35], (35, 60], (60, 100]], dtype='interval[int64, right]')
</span><span class="n">age_categories</span><span class="p">.</span><span class="n">categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Interval(18, 25, closed='right')
</span>
<span class="n">age_categories</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">()</span>
<span class="c1"># (18, 25]     5
# (25, 35]     3
# (35, 60]     3
# (60, 100]    1
# Name: count, dtype: int64
</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">cut</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">categories</span>
<span class="c1"># IntervalIndex([[18, 25), [25, 35), [35, 60), [60, 100)], dtype='interval[int64, left]')
</span>
<span class="n">group_names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">Youth</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">YoungAdult</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">MiddleAged</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Senior</span><span class="sh">"</span><span class="p">]</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">cut</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">group_names</span><span class="p">).</span><span class="n">categories</span>
<span class="c1"># Index(['Youth', 'YoungAdult', 'MiddleAged', 'Senior'], dtype='object')</span></code></pre>
</div>
</div>
</li>
<li>
<p><code>pandas.qcut()</code>: discretizes data points into bins based on sample quantiles</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># array([0.34500722, 0.51390559, 0.45442101, 0.24779283, 0.11860691,
#        0.64541406, 0.95682711, 0.69983468, 0.661519  , 0.09869171,
#        0.12846634, 0.10438803, 0.6110211 , 0.28152758, 0.40054146,
#        0.36215715, 0.29260695, 0.0516599 , 0.7291701 , 0.84767151])
</span><span class="n">pd</span><span class="p">.</span><span class="nf">cut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">).</span><span class="n">categories</span>  <span class="c1"># equal-length bins based on the minimum and maximum values
# IntervalIndex([(0.051, 0.28], (0.28, 0.5], (0.5, 0.73], (0.73, 0.96]], dtype='interval[float64, right]')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">).</span><span class="nf">value_counts</span><span class="p">()</span>
<span class="c1"># (0.041999999999999996, 0.22]    5
# (0.22, 0.38]                    5
# (0.38, 0.65]                    5
# (0.65, 0.96]                    5
# Name: count, dtype: int64
</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]).</span><span class="nf">value_counts</span><span class="p">()</span>
<span class="c1"># (0.0507, 0.104]    2
# (0.104, 0.381]     8
# (0.381, 0.741]     8
# (0.741, 0.957]     2
# Name: count, dtype: int64</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="detecting-and-filtering-outliers">3.7. Detecting and Filtering Outliers</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
<span class="n">data</span><span class="p">.</span><span class="nf">describe</span><span class="p">()</span>
<span class="c1">#                  0            1            2            3
# count  1000.000000  1000.000000  1000.000000  1000.000000
# mean     -0.002266    -0.036654    -0.017418    -0.029068
# std       1.018625     0.950048     0.994702     1.041082
# min      -3.421405    -3.833754    -3.642241    -3.125454
# 25%      -0.663947    -0.694460    -0.659706    -0.762197
# 50%      -0.024047    -0.005600    -0.025911    -0.024954
# 75%       0.700707     0.603613     0.663005     0.701335
# max       3.134904     2.526298     2.994854     3.704972
</span>
<span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">.</span><span class="nf">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">).</span><span class="nf">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)]</span>  <span class="c1"># select all rows having a value exceeding 3 or –3
#             0         1         2         3
# 64   0.769583 -3.833754 -0.284691  0.283270
# 176 -3.198594  0.745868 -0.430357 -0.374628
# 207  0.823846 -0.171761  1.137797  3.704972
# 416 -3.024055  0.560612  1.320891 -0.691014
# 790 -3.421405  0.516339  0.049209  1.016584
# 915 -0.543984  0.844945 -3.010801 -0.165290
# 916  3.134904  0.091651  0.908098  1.685942
# 945  3.073425 -0.943425 -1.711061  0.573415
# 955 -1.375006 -0.344609 -3.642241 -0.823830
# 981  0.507220  0.136884  0.880373 -3.125454
</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">.</span><span class="nf">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>  <span class="c1"># cap values outside the interval [–3, 3]
</span><span class="n">data</span><span class="p">.</span><span class="nf">describe</span><span class="p">()</span>
<span class="c1">#                  0            1            2            3
# count  1000.000000  1000.000000  1000.000000  1000.000000
# mean     -0.001830    -0.035821    -0.016765    -0.029648
# std       1.015991     0.947074     0.992531     1.038420
# min      -3.000000    -3.000000    -3.000000    -3.000000
# 25%      -0.663947    -0.694460    -0.659706    -0.762197
# 50%      -0.024047    -0.005600    -0.025911    -0.024954
# 75%       0.700707     0.603613     0.663005     0.701335
# max       3.000000     2.526298     2.994854     3.000000
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="nf">head</span><span class="p">()</span>  <span class="c1"># produces 1 and –1 values based on positive or negative
#      0    1    2    3
# 0 -1.0  1.0 -1.0  1.0
# 1 -1.0 -1.0 -1.0 -1.0
# 2  1.0 -1.0 -1.0  1.0
# 3 -1.0 -1.0  1.0 -1.0
# 4  1.0  1.0  1.0 -1.0</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="permutation-and-random-sampling">3.8. Permutation and Random Sampling</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">7</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)))</span>
<span class="c1">#     0   1   2   3   4   5   6
# 0   0   1   2   3   4   5   6
# 1   7   8   9  10  11  12  13
# 2  14  15  16  17  18  19  20
# 3  21  22  23  24  25  26  27
# 4  28  29  30  31  32  33  34
</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">permutation</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># array([2, 4, 3, 0, 1])
</span><span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sampler</span><span class="p">]</span>  <span class="c1"># equivalent: data.take(sampler)
</span>    <span class="mi">0</span>   <span class="mi">1</span>   <span class="mi">2</span>   <span class="mi">3</span>   <span class="mi">4</span>   <span class="mi">5</span>   <span class="mi">6</span>
<span class="mi">2</span>  <span class="mi">14</span>  <span class="mi">15</span>  <span class="mi">16</span>  <span class="mi">17</span>  <span class="mi">18</span>  <span class="mi">19</span>  <span class="mi">20</span>
<span class="mi">4</span>  <span class="mi">28</span>  <span class="mi">29</span>  <span class="mi">30</span>  <span class="mi">31</span>  <span class="mi">32</span>  <span class="mi">33</span>  <span class="mi">34</span>
<span class="mi">3</span>  <span class="mi">21</span>  <span class="mi">22</span>  <span class="mi">23</span>  <span class="mi">24</span>  <span class="mi">25</span>  <span class="mi">26</span>  <span class="mi">27</span>
<span class="mi">0</span>   <span class="mi">0</span>   <span class="mi">1</span>   <span class="mi">2</span>   <span class="mi">3</span>   <span class="mi">4</span>   <span class="mi">5</span>   <span class="mi">6</span>
<span class="mi">1</span>   <span class="mi">7</span>   <span class="mi">8</span>   <span class="mi">9</span>  <span class="mi">10</span>  <span class="mi">11</span>  <span class="mi">12</span>  <span class="mi">13</span>
<span class="n">column_sampler</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">permutation</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># array([3, 5, 2, 4, 6, 0, 1])
</span><span class="n">data</span><span class="p">.</span><span class="nf">take</span><span class="p">(</span><span class="n">column_sampler</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#     3   5   2   4   6   0   1
# 0   3   5   2   4   6   0   1
# 1  10  12   9  11  13   7   8
# 2  17  19  16  18  20  14  15
# 3  24  26  23  25  27  21  22
# 4  31  33  30  32  34  28  29
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># select a random subset without replacement
#      0   1   2   3   4   5   6
#  0   0   1   2   3   4   5   6
#  2  14  15  16  17  18  19  20
#  4  28  29  30  31  32  33  34
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># select a random subset with replacement (to allow repeat choices)
#     0   1   2   3   4   5   6
# 3  21  22  23  24  25  26  27
# 0   0   1   2   3   4   5   6
# 1   7   8   9  10  11  12  13
# 0   0   1   2   3   4   5   6
# 4  28  29  30  31  32  33  34
# 4  28  29  30  31  32  33  34
# 3  21  22  23  24  25  26  27</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="computing-indicatordummy-variables-one-hot-encoding">3.9. Computing Indicator/Dummy Variables: One-Hot Encoding</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">],</span> <span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">:</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)})</span>
<span class="c1">#   key  data1
# 0   b      0
# 1   b      1
# 2   a      2
# 3   c      3
# 4   a      4
# 5   b      5
</span><span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="c1">#    a  b  c
# 0  0  1  0
# 1  0  1  0
# 2  1  0  0
# 3  0  0  1
# 4  1  0  0
# 5  0  1  0
</span><span class="n">data</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
<span class="c1">#   key  data1  a  b  c
# 0   b      0  0  1  0
# 1   b      1  0  1  0
# 2   a      2  1  0  0
# 3   c      3  0  0  1
# 4   a      4  1  0  0
# 5   b      5  0  1  0
</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_table</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/datasets/movielens/movies.dat</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="sh">"</span><span class="s">::</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">movie_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">genres</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">engine</span><span class="o">=</span><span class="sh">"</span><span class="s">python</span><span class="sh">"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    movie_id                               title                        genres
# 0         1                    Toy Story (1995)   Animation|Children's|Comedy
# 1         2                      Jumanji (1995)  Adventure|Children's|Fantasy
# 2         3             Grumpier Old Men (1995)                Comedy|Romance
# 3         4            Waiting to Exhale (1995)                  Comedy|Drama
# 4         5  Father of the Bride Part II (1995)                        Comedy
</span><span class="n">dummies</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="sh">"</span><span class="s">genres</span><span class="sh">"</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="sh">"</span><span class="s">|</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># string functions in pandas
</span><span class="n">dummies</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,:</span><span class="mi">6</span><span class="p">]</span>
<span class="c1">#    Action  Adventure  Animation  Children's  Comedy  Crime
# 0       0          0          1           1       1      0
# 1       0          1          0           1       0      0
# 2       0          0          0           0       1      0
# 3       0          0          0           0       1      0
# 4       0          0          0           0       1      0
</span><span class="n">movies_windic</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">dummies</span><span class="p">.</span><span class="nf">add_prefix</span><span class="p">(</span><span class="sh">"</span><span class="s">Genre_</span><span class="sh">"</span><span class="p">))</span>
<span class="n">movies_windic</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
<span class="c1"># movie_id                                       1
# title                           Toy Story (1995)
# genres               Animation|Children's|Comedy
# Genre_Action                                   0
# Genre_Adventure                                0
# Genre_Animation                                1
# Genre_Children's                               1
# Genre_Comedy                                   1
# Genre_Crime                                    0
# Genre_Documentary                              0
# Name: 0, dtype: object
</span>
<span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span> <span class="c1"># to make the example repeatable
</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># array([0.92961609, 0.31637555, 0.18391881, 0.20456028, 0.56772503,
#        0.5955447 , 0.96451452, 0.6531771 , 0.74890664, 0.65356987])
</span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="nf">cut</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="c1">#    (0.0, 0.2]  (0.2, 0.4]  (0.4, 0.6]  (0.6, 0.8]  (0.8, 1.0]
# 0           0           0           0           0           1
# 1           0           1           0           0           0
# 2           1           0           0           0           0
# 3           0           1           0           0           0
# 4           0           0           1           0           0
# 5           0           0           1           0           0
# 6           0           0           0           0           1
# 7           0           0           0           1           0
# 8           0           0           0           1           0
# 9           0           0           0           1           0</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="string-functions-in-pandas">3.10. String Functions in pandas</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">Dave</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">dave@google.com</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Steve</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">steve@gmail.com</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Rob</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">rob@gmail.com</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Wes</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># Dave     dave@google.com
# Steve    steve@gmail.com
# Rob        rob@gmail.com
# Wes                  NaN
# dtype: object
</span><span class="n">data</span><span class="p">.</span><span class="nf">isna</span><span class="p">()</span>
<span class="c1"># Dave     False
# Steve    False
# Rob      False
# Wes       True
# dtype: bool
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># extension types
# Dave     dave@google.com
# Steve    steve@gmail.com
# Rob        rob@gmail.com
# Wes                 &lt;NA&gt;
# dtype: string
</span>
<span class="n">data</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="sh">"</span><span class="s">gmail</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># .str attribute
# Dave     False
# Steve     True
# Rob       True
# Wes        NaN
# dtype: object
</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">"</span><span class="s">([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]{2,4})</span><span class="sh">"</span>
<span class="n">data</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>  <span class="c1"># regular expressions
# Dave     [(dave, google, com)]
# Steve    [(steve, gmail, com)]
# Rob        [(rob, gmail, com)]
# Wes                        NaN
# dtype: object
</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">).</span><span class="nb">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># vectorized element retrieval
# Dave     (dave, google, com)
# Steve    (steve, gmail, com)
# Rob        (rob, gmail, com)
# Wes                      NaN
# dtype: object
</span><span class="n">matches</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Dave     google
# Steve     gmail
# Rob       gmail
# Wes         NaN
# dtype: object
</span>
<span class="n">data</span><span class="p">.</span><span class="nb">str</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># slice strings
# Dave     dave@
# Steve    steve
# Rob      rob@g
# Wes        NaN
# dtype: object
</span>
<span class="n">data</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>  <span class="c1"># extract capture groups
#            0       1    2
# Dave    dave  google  com
# Steve  steve   gmail  com
# Rob      rob   gmail  com
# Wes      NaN     NaN  NaN</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="categorical-encoding">3.11. Categorical Encoding</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">categories</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="sh">"</span><span class="s">apple</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">orange</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># categories, dictionary, or levels
# 0     apple
# 1    orange
# dtype: object
</span><span class="n">codes</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># category codes or codes
# 0    0
# 1    1
# 2    0
# 3    0
# 4    0
# 5    1
# 6    0
# 7    0
# dtype: int64
</span><span class="n">values</span> <span class="o">=</span> <span class="n">categories</span><span class="p">.</span><span class="nf">take</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span>
<span class="c1"># 0     apple
# 1    orange
# 0     apple
# 0     apple
# 0     apple
# 1    orange
# 0     apple
# 0     apple
# dtype: object</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># pandas has a Categorical extension type for the integer-based categorical or dictionary-encoded encoding
</span><span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">apple</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">orange</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">apple</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">apple</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">N</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">fruits</span><span class="p">)</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">fruit</span><span class="sh">"</span><span class="p">:</span> <span class="n">fruits</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">basket_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">:</span> <span class="n">rng</span><span class="p">.</span><span class="nf">integers</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">weight</span><span class="sh">"</span><span class="p">:</span> <span class="n">rng</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">basket_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">fruit</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">weight</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#    basket_id   fruit  count    weight
# 0          0   apple      8  0.366659
# 1          1  orange      6  2.394272
# 2          2   apple      9  3.418968
# 3          3   apple     12  2.406485
# 4          4   apple      8  3.727953
# 5          5  orange      5  2.899125
# 6          6   apple      3  3.442205
# 7          7   apple      4  3.717351
</span>
<span class="n">fruit_cat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">fruit</span><span class="sh">"</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 0     apple
# 1    orange
# 2     apple
# 3     apple
# 4     apple
# 5    orange
# 6     apple
# 7     apple
# Name: fruit, dtype: category
# Categories (2, object): ['apple', 'orange']
</span><span class="n">c</span> <span class="o">=</span> <span class="n">fruit_cat</span><span class="p">.</span><span class="n">array</span>
<span class="nf">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>       <span class="c1"># pandas.core.arrays.categorical.Categorical
</span><span class="n">c</span><span class="p">.</span><span class="n">categories</span>  <span class="c1"># Index(['apple', 'orange'], dtype='object')
</span><span class="n">c</span><span class="p">.</span><span class="n">codes</span>       <span class="c1"># array([0, 1, 0, 0, 0, 1, 0, 0], dtype=int8)
</span>
<span class="nf">dict</span><span class="p">(</span><span class="nf">enumerate</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">categories</span><span class="p">))</span>  <span class="c1"># get a mapping between codes and categories
# {0: 'apple', 1: 'orange'}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">pd</span><span class="p">.</span><span class="nc">Categorical</span><span class="p">([</span><span class="sh">'</span><span class="s">foo</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">baz</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">foo</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">])</span>
<span class="c1"># ['foo', 'bar', 'baz', 'foo', 'bar']
# Categories (3, object): ['bar', 'baz', 'foo']
</span><span class="n">pd</span><span class="p">.</span><span class="n">Categorical</span><span class="p">.</span><span class="nf">from_codes</span><span class="p">(</span><span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">foo</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">baz</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># ['foo', 'bar', 'baz', 'foo', 'foo', 'bar']
# Categories (3, object): ['foo', 'bar', 'baz']
</span><span class="n">pd</span><span class="p">.</span><span class="n">Categorical</span><span class="p">.</span><span class="nf">from_codes</span><span class="p">(</span><span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">foo</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">baz</span><span class="sh">"</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># ['foo', 'bar', 'baz', 'foo', 'foo', 'bar']
# Categories (3, object): ['foo' &lt; 'bar' &lt; 'baz']</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># `.cat` accessor attribute
</span><span class="n">cat_s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">c</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span>
<span class="n">cat_s</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">categories</span>
<span class="c1"># Index(['a', 'b', 'c', 'd'], dtype='object')
</span><span class="n">cat_s</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">codes</span>
<span class="c1"># 0    0
# 1    1
# 2    2
# 3    3
# 4    0
# 5    1
# 6    2
# 7    3
# dtype: int8
</span><span class="n">cat_s</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">()</span>
<span class="c1"># a    2
# b    2
# c    2
# d    2
# Name: count, dtype: int64
</span><span class="n">cat_s2</span> <span class="o">=</span> <span class="n">cat_s</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="nf">set_categories</span><span class="p">([</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">])</span>
<span class="n">cat_s2</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">()</span>
<span class="c1"># a    2
# b    2
# c    2
# d    2
# e    0
# Name: count, dtype: int64
</span><span class="n">cat_s3</span> <span class="o">=</span> <span class="n">cat_s</span><span class="p">[</span><span class="n">cat_s</span><span class="p">.</span><span class="nf">isin</span><span class="p">([</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">])]</span>
<span class="c1"># 0    a
# 1    b
# 4    a
# 5    b
# dtype: category
# Categories (4, object): ['a', 'b', 'c', 'd']
</span><span class="n">cat_s_3</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="nf">remove_unused_categories</span><span class="p">()</span>
<span class="c1"># 0    a
# 1    b
# 4    a
# 5    b
# dtype: category
# Categories (2, object): ['a', 'b']</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">draws</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">).</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">1_000</span><span class="p">)</span>
<span class="c1"># array([-1.42382504,  1.26372846, -0.87066174, -0.25917323, -0.07534331,
</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">draws</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># compute a quartile binning
# [(-3.121, -0.675], (0.687, 3.211], (-3.121, -0.675], (-0.675, 0.0134], (-0.675, 0.0134], ..., (0.0134, 0.687], (0.0134, 0.687], (-0.675, 0.0134], (0.0134, 0.687], (-0.675, 0.0134]]
# Length: 1000
# Categories (4, interval[float64, right]): [(-3.121, -0.675] &lt; (-0.675, 0.0134] &lt; (0.0134, 0.687] &lt; (0.687, 3.211]]
</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">draws</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Q1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Q2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Q3</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Q4</span><span class="sh">'</span><span class="p">])</span>  <span class="c1"># quartile names
# ['Q1', 'Q4', 'Q1', 'Q2', 'Q2', ..., 'Q3', 'Q3', 'Q2', 'Q3', 'Q2']
# Length: 1000
# Categories (4, object): ['Q1' &lt; 'Q2' &lt; 'Q3' &lt; 'Q4']
</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">quartile</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># 0      Q1
# 1      Q4
# 2      Q1
#        ..
# 998    Q3
# 999    Q2
# Name: quartile, Length: 1000, dtype: category
# Categories (4, object): ['Q1' &lt; 'Q2' &lt; 'Q3' &lt; 'Q4']
</span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">draws</span><span class="p">).</span><span class="nf">groupby</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">agg</span><span class="p">([</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">]).</span><span class="nf">reset_index</span><span class="p">()</span>  <span class="c1"># statistics
#   quartile  count       min       max
# 0       Q1    250 -3.119609 -0.678494
# 1       Q2    250 -0.673305  0.008009
# 2       Q3    250  0.018753  0.686183
# 3       Q4    250  0.688282  3.211418</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># dummy variables or one-hot encoding
</span><span class="n">cat_s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">c</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">cat_s</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="c1">#    a  b  c  d
# 0  1  0  0  0
# 1  0  1  0  0
# 2  0  0  1  0
# 3  0  0  0  1
# 4  1  0  0  0
# 5  0  1  0  0
# 6  0  0  1  0
# 7  0  0  0  1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-wrangling-join-combine-and-reshape">4. Data Wrangling: Join, Combine, and Reshape</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="hierarchical-indexing">4.1. Hierarchical Indexing</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">[</span>  <span class="mi">2</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span>   <span class="mi">1</span><span class="p">]</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">data</span>  <span class="c1"># a prettified view
# a  2    0.911650
#    3    0.316521
# b  1    0.049235
#    3    0.995199
#    1    0.602722
# dtype: float64
</span><span class="n">data</span><span class="p">.</span><span class="n">index</span>
<span class="c1"># MultiIndex([('a', 2),
#             ('a', 3),
#             ('b', 1),
#             ('b', 3),
#             ('b', 1)],
#            )
</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">]</span>       <span class="c1"># partial indexing
# 1    0.049235
# 3    0.995199
# 1    0.602722
# dtype: float64
</span><span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># level indexing
# a    0.316521
# b    0.995199
# dtype: float64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">[</span>  <span class="mi">1</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">2</span><span class="p">]</span>
    <span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">[</span><span class="sh">"</span><span class="s">Green</span><span class="sh">"</span><span class="p">,</span>  <span class="sh">"</span><span class="s">Red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Green</span><span class="sh">"</span><span class="p">]</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="c1">#      Ohio     Colorado
#     Green Red    Green
# a 1     0   1        2
#   2     3   4        5
# b 1     6   7        8
#   2     9  10       11
</span><span class="n">data</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">]</span>
<span class="n">data</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
#      2        3   4        5
# b    1        6   7        8
#      2        9  10       11
</span><span class="n">data</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">nlevels</span>
<span class="c1"># 2
</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># color     Green  Red
# key key2
# a   1         0    1
#     2         3    4
# b   1         6    7
#     2         9   10</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">pd</span><span class="p">.</span><span class="n">MultiIndex</span><span class="p">.</span><span class="nf">from_tuples</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">2023-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">North</span><span class="sh">"</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">2023-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">South</span><span class="sh">"</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">2023-01-02</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">North</span><span class="sh">"</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">2023-01-02</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">South</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Region</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># MultiIndex([('2023-01-01', 'North'),
#             ('2023-01-01', 'South'),
#             ('2023-01-02', 'North'),
#             ('2023-01-02', 'South')],
#            names=['Date', 'Region'])
</span><span class="n">pd</span><span class="p">.</span><span class="n">MultiIndex</span><span class="p">.</span><span class="nf">from_arrays</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">[</span><span class="sh">"</span><span class="s">Green</span><span class="sh">"</span><span class="p">,</span>  <span class="sh">"</span><span class="s">Red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Green</span><span class="sh">"</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># MultiIndex([(    'Ohio', 'Green'),
#             (    'Ohio',   'Red'),
#             ('Colorado', 'Green')],
#            names=['state', 'color'])</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="pivoting-stacking-and-unstacking">4.1.1. Pivoting, Stacking, and Unstacking</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">2023-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2023-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2023-01-02</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2023-01-02</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">City</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Los Angeles</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Los Angeles</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">Temperature</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">77</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">Humidity</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1">#          Date         City  Temperature  Humidity
# 0  2023-01-01     New York           30        65
# 1  2023-01-01  Los Angeles           75        30
# 2  2023-01-02     New York           28        70
# 3  2023-01-02  Los Angeles           77        35</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># pandas.pivot(...)
# - reshapes data by turning unique values from one column into columns
# - creates a table where rows and columns represent specific categories, and the values are aggregated
</span><span class="n">pivoted</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">City</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Temperature</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Humidity</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#            Temperature             Humidity
# City       Los Angeles New York Los Angeles New York
# Date
# 2023-01-01          75       30          30       65
# 2023-01-02          77       28          35       70
</span><span class="n">pivoted</span><span class="p">.</span><span class="n">columns</span>
<span class="c1"># MultiIndex([('Temperature', 'Los Angeles'),
#             ('Temperature',    'New York'),
#             (   'Humidity', 'Los Angeles'),
#             (   'Humidity',    'New York')],
#            names=[None, 'City'])
</span><span class="n">pivoted_t</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">City</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">"</span><span class="s">Temperature</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># City        Los Angeles  New York
# Date
# 2023-01-01           75        30
# 2023-01-02           77        28</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># pandas.stack(...)
# - converts columns into rows, creating a hierarchical index
# - compacts a DataFrame by stacking columns into a single column
</span><span class="n">stacked</span> <span class="o">=</span> <span class="n">pivoted_t</span><span class="p">.</span><span class="nf">stack</span><span class="p">()</span>
<span class="c1"># Date        City
# 2023-01-01  Los Angeles    75
#             New York       30
# 2023-01-02  Los Angeles    77
#             New York       28
# dtype: int64
</span><span class="n">stacked</span><span class="p">.</span><span class="n">index</span>
<span class="c1"># MultiIndex([('2023-01-01', 'Los Angeles'),
#             ('2023-01-01',    'New York'),
#             ('2023-01-02', 'Los Angeles'),
#             ('2023-01-02',    'New York')],
#            names=['Date', 'City'])</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># pandas.unstack(...)
# - converts rows into columns, the reverse of stack
# - expands a DataFrame by unstacking a hierarchical index into columns
</span><span class="n">stacked</span><span class="p">.</span><span class="nf">unstack</span><span class="p">()</span>
<span class="c1"># City        Los Angeles  New York
# Date
# 2023-01-01           75        30
# 2023-01-02           77        28</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reordering-and-sorting-levels">4.1.2. Reordering and Sorting Levels</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span><span class="p">.</span><span class="nf">swaplevel</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># state      Ohio     Colorado
# color     Green Red    Green
# key2 key1
# 1    a        0   1        2
# 2    a        3   4        5
# 1    b        6   7        8
# 2    b        9  10       11
</span><span class="n">df</span><span class="p">.</span><span class="nf">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
# b    1        6   7        8
# a    2        3   4        5
# b    2        9  10       11
</span>
<span class="n">df</span><span class="p">.</span><span class="nf">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># state      Ohio     Colorado
# color     Green Red    Green
# key2 key1
# 1    a        0   1        2
# 2    a        3   4        5
# 1    b        6   7        8
# 2    b        9  10       11
</span><span class="n">df</span><span class="p">.</span><span class="nf">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># state      Ohio     Colorado
# color     Green Red    Green
# key2 key1
# 1    a        0   1        2
#      b        6   7        8
# 2    a        3   4        5
#      b        9  10       11</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="summary-statistics-by-level">4.1.3. Summary Statistics by Level</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1"># state  Ohio     Colorado
# color Green Red    Green
# key2
# 1         6   8       10
# 2        12  14       16
</span><span class="n">df</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">).</span><span class="nf">sum</span><span class="p">().</span><span class="n">T</span>
<span class="c1"># color      Green  Red
# key1 key2
# a    1         2    1
#      2         8    4
# b    1        14    7
#      2        20   10</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="indexing-with-a-dataframes-columns">4.1.4. Indexing with a DataFrame’s columns</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="nf">range</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">:</span> <span class="nf">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#    a  b    c  d
# 0  0  7  one  0
# 1  1  6  one  1
# 2  2  5  one  2
# 3  3  4  two  0
# 4  4  3  two  1
# 5  5  2  two  2
# 6  6  1  two  3
</span><span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">set_index</span><span class="p">([</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># set a DataFrame index using existing columns
#        a  b
# c   d
# one 0  0  7
#     1  1  6
#     2  2  5
# two 0  3  4
#     1  4  3
#     2  5  2
#     3  6  1
</span><span class="n">data2</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">()</span>  <span class="c1"># reset the hierarchical index levels into the columns
</span>     <span class="n">c</span>  <span class="n">d</span>  <span class="n">a</span>  <span class="n">b</span>
<span class="mi">0</span>  <span class="n">one</span>  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>
<span class="mi">1</span>  <span class="n">one</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>
<span class="mi">2</span>  <span class="n">one</span>  <span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>
<span class="mi">3</span>  <span class="n">two</span>  <span class="mi">0</span>  <span class="mi">3</span>  <span class="mi">4</span>
<span class="mi">4</span>  <span class="n">two</span>  <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">3</span>
<span class="mi">5</span>  <span class="n">two</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">2</span>
<span class="mi">6</span>  <span class="n">two</span>  <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="combining-and-merging-datasets">4.2. Combining and Merging Datasets</h3>
<div class="sect3">
<h4 id="database-style-dataframe-joins">4.2.1. Database-Style DataFrame Joins</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">foo</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">foo</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">lval</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#   key1 key2  lval
# 0  foo  one     1
# 1  foo  two     2
# 2  bar  one     3
</span><span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">foo</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">foo</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">rval</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#   key1 key2  rval
# 0  foo  one     4
# 1  foo  one     5
# 2  bar  one     6
# 3  bar  two     7
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>  <span class="c1"># same as pd.merge(left, right, on=["key1", "key2"]) by specifying the overlap columns explicitly
#   key1 key2  lval  rval
# 0  foo  one     1     4
# 1  foo  one     1     5
# 2  bar  one     3     6
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">],</span> <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># specify the left and right keys separately
</span>  <span class="n">key1</span> <span class="n">key2</span>  <span class="n">lval</span>  <span class="n">rval</span>
<span class="mi">0</span>  <span class="n">foo</span>  <span class="n">one</span>     <span class="mi">1</span>     <span class="mi">4</span>
<span class="mi">1</span>  <span class="n">foo</span>  <span class="n">one</span>     <span class="mi">1</span>     <span class="mi">5</span>
<span class="mi">2</span>  <span class="n">bar</span>  <span class="n">one</span>     <span class="mi">3</span>     <span class="mi">6</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">inner</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># inner join (by default)
#   key1 key2  lval  rval
# 0  foo  one     1     4
# 1  foo  one     1     5
# 2  bar  one     3     6
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">left</span><span class="sh">"</span><span class="p">)</span>   <span class="c1"># left join
#   key1 key2  lval  rval
# 0  foo  one     1     4
# 1  foo  one     1     5
# 2  foo  two     2  &lt;NA&gt;
# 3  bar  one     3     6
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">right</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># right join
#   key1 key2  lval  rval
# 0  foo  one     1     4
# 1  foo  one     1     5
# 2  bar  one     3     6
# 3  bar  two  &lt;NA&gt;     7
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">outer</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># outer join
#   key1 key2  lval  rval
# 0  bar  one     3     6
# 1  bar  two  &lt;NA&gt;     7
# 2  foo  one     1     4
# 3  foo  one     1     5
# 4  foo  two     2  &lt;NA&gt;
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">outer</span><span class="sh">"</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># source indicator
#   key1 key2  lval  rval      _merge
# 0  bar  one     3     6        both
# 1  bar  two  &lt;NA&gt;     7  right_only
# 2  foo  one     1     4        both
# 3  foo  one     1     5        both
# 4  foo  two     2  &lt;NA&gt;   left_only
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># specify a single join key
#   key1 key2_x  lval key2_y  rval
# 0  foo    one     1    one     4
# 1  foo    one     1    one     5
# 2  foo    two     2    one     4
# 3  foo    two     2    one     5
# 4  bar    one     3    one     6
# 5  bar    one     3    two     7
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="sh">"</span><span class="s">_left</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">_right</span><span class="sh">"</span><span class="p">))</span>  <span class="c1"># sepcify the suffixes for the overlap columns
#   key1 key2_left  lval key2_right  rval
# 0  foo       one     1        one     4
# 1  foo       one     1        one     5
# 2  foo       two     2        one     4
# 3  foo       two     2        one     5
# 4  bar       one     3        one     6
# 5  bar       one     3        two     7</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="merging-on-index">4.2.2. Merging on Index</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">left1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">],</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">)}</span>
<span class="p">)</span>
<span class="c1">#   key  value
# 0   a      0
# 1   b      1
# 2   a      2
# 3   a      3
# 4   b      4
# 5   c      5
</span><span class="n">right1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">group_val</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#    group_val
# a        3.5
# b        7.0
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left1</span><span class="p">,</span> <span class="n">right1</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># merge on index
#   key  value  group_val
# 0   a      0        3.5
# 1   b      1        7.0
# 2   a      2        3.5
# 3   a      3        3.5
# 4   b      4        7.0
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">right1</span><span class="p">,</span> <span class="n">left1</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">outer</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#    group_val key  value
# 0        3.5   a      0
# 2        3.5   a      2
# 3        3.5   a      3
# 1        7.0   b      1
# 4        7.0   b      4
# 5        NaN   c      5
</span>

<span class="n">left2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]],</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">],</span>
<span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">)</span>
<span class="n">right2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">[[</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]],</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Missouri</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Alabama</span><span class="sh">"</span><span class="p">],</span>
<span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">left2</span><span class="p">,</span> <span class="n">right2</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">outer</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># use both sides indexes
#    Ohio  Nevada  Missouri  Alabama
# a     1       2      &lt;NA&gt;     &lt;NA&gt;
# b  &lt;NA&gt;    &lt;NA&gt;         7        8
# c     3       4         9       10
# d  &lt;NA&gt;    &lt;NA&gt;        11       12
# e     5       6        13       14
</span><span class="n">left2</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">right2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">outer</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># join: merge by index shortly
#    Ohio  Nevada  Missouri  Alabama
# a     1       2      &lt;NA&gt;     &lt;NA&gt;
# b  &lt;NA&gt;    &lt;NA&gt;         7        8
# c     3       4         9       10
# d  &lt;NA&gt;    &lt;NA&gt;        11       12
# e     5       6        13       14
</span>
<span class="n">another</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">[[</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">16.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">]],</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">f</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Oregon</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#    New York  Oregon
# a       7.0     8.0
# c       9.0    10.0
# e      11.0    12.0
# f      16.0    17.0
</span><span class="n">left2</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="n">right2</span><span class="p">,</span> <span class="n">another</span><span class="p">])</span>
<span class="c1">#    Ohio  Nevada  Missouri  Alabama  New York  Oregon
# a     1       2      &lt;NA&gt;     &lt;NA&gt;       7.0     8.0
# c     3       4         9       10       9.0    10.0
# e     5       6        13       14      11.0    12.0
</span>

<span class="n">lefth</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#      key1  key2  data
# 0    Ohio  2000     0
# 1    Ohio  2001     1
# 2    Ohio  2002     2
# 3  Nevada  2001     3
# 4  Nevada  2002     4
</span><span class="n">righth_index</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">MultiIndex</span><span class="p">.</span><span class="nf">from_arrays</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Nevada</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">righth</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">event1</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">righth_index</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">event2</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">righth_index</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#              event1  event2
# Nevada 2001       0       1
#        2000       2       3
# Ohio   2000       4       5
#        2000       6       7
#        2001       8       9
#        2002      10      11
</span><span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">lefth</span><span class="p">,</span> <span class="n">righth</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">],</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># multiple-key merge
</span>     <span class="n">key1</span>  <span class="n">key2</span>  <span class="n">data</span>  <span class="n">event1</span>  <span class="n">event2</span>
<span class="mi">0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>     <span class="mi">0</span>       <span class="mi">4</span>       <span class="mi">5</span>
<span class="mi">0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>     <span class="mi">0</span>       <span class="mi">6</span>       <span class="mi">7</span>
<span class="mi">1</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>     <span class="mi">1</span>       <span class="mi">8</span>       <span class="mi">9</span>
<span class="mi">2</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>     <span class="mi">2</span>      <span class="mi">10</span>      <span class="mi">11</span>
<span class="mi">3</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>     <span class="mi">3</span>       <span class="mi">0</span>       <span class="mi">1</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="concatenating-along-an-axis">4.2.3. Concatenating Along an Axis</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># pandas.concat(...)
</span><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># a    0
# b    1
# dtype: Int64
</span><span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># c    2
# d    3
# e    4
# dtype: Int64
</span><span class="n">s3</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">f</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">g</span><span class="sh">"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># f    5
# g    6
# dtype: Int64
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">])</span>  <span class="c1"># stacking (union all) on columns
# a    0
# b    1
# c    2
# d    3
# e    4
# f    5
# g    6
# dtype: Int64
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># union (outer join) of the indexes
#       0     1     2
# a     0  &lt;NA&gt;  &lt;NA&gt;
# b     1  &lt;NA&gt;  &lt;NA&gt;
# c  &lt;NA&gt;     2  &lt;NA&gt;
# d  &lt;NA&gt;     3  &lt;NA&gt;
# e  &lt;NA&gt;     4  &lt;NA&gt;
# f  &lt;NA&gt;  &lt;NA&gt;     5
# g  &lt;NA&gt;  &lt;NA&gt;     6
</span><span class="n">s4</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s3</span><span class="p">])</span>
<span class="c1"># a    0
# b    1
# f    5
# g    6
# dtype: Int64
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#       0  1
# a     0  0
# b     1  1
# f  &lt;NA&gt;  5
# g  &lt;NA&gt;  6
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="sh">"</span><span class="s">inner</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#    0  1
# a  0  0
# b  1  1</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># use the keys to indicate the concatenated pieces
</span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># one    a    0
#        b    1
# two    a    0
#        b    1
# three  f    5
#        g    6
# dtype: Int64
</span><span class="n">result</span><span class="p">.</span><span class="nf">unstack</span><span class="p">()</span>
<span class="c1">#           a     b     f     g
# one       0     1  &lt;NA&gt;  &lt;NA&gt;
# two       0     1  &lt;NA&gt;  &lt;NA&gt;
# three  &lt;NA&gt;  &lt;NA&gt;     5     6
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#     one   two  three
# a     0  &lt;NA&gt;   &lt;NA&gt;
# b     1  &lt;NA&gt;   &lt;NA&gt;
# c  &lt;NA&gt;     2   &lt;NA&gt;
# d  &lt;NA&gt;     3   &lt;NA&gt;
# e  &lt;NA&gt;     4   &lt;NA&gt;
# f  &lt;NA&gt;  &lt;NA&gt;      5
# g  &lt;NA&gt;  &lt;NA&gt;      6</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1">#    one  two
# a    0    1
# b    2    3
# c    4    5
</span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="mi">5</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">four</span><span class="sh">"</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1">#    three  four
# a      5     6
# c      7     8
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>
<span class="c1">#    one  two  three  four
# a  0.0  1.0    NaN   NaN
# b  2.0  3.0    NaN   NaN
# c  4.0  5.0    NaN   NaN
# a  NaN  NaN    5.0   6.0
# c  NaN  NaN    7.0   8.0
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#    one  two  three  four
# a    0    1    5.0   6.0
# b    2    3    NaN   NaN
# c    4    5    7.0   8.0
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">level1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">level2</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#   level1     level2
#      one two  three four
# a      0   1    5.0  6.0
# b      2   3    NaN  NaN
# c      4   5    7.0  8.0
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">({</span><span class="sh">"</span><span class="s">level1</span><span class="sh">"</span><span class="p">:</span> <span class="n">df1</span><span class="p">,</span> <span class="sh">"</span><span class="s">level2</span><span class="sh">"</span><span class="p">:</span> <span class="n">df2</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#   level1     level2
#      one two  three four
# a      0   1    5.0  6.0
# b      2   3    NaN  NaN
# c      4   5    7.0  8.0
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">level1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">level2</span><span class="sh">"</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">upper</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lower</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># upper level1     level2
# lower    one two  three four
# a          0   1    5.0  6.0
# b          2   3    NaN  NaN
# c          4   5    7.0  8.0</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># not preserve indexes along concatenation axis, instead produce a new range(total_length) index
</span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#           a         b         c         d
# 0  2.410815 -0.872558  1.215403  1.321002
# 1 -0.046726  0.088367  0.255645 -1.442833
# 2  0.001280  0.561726 -0.992764 -0.830453
</span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#           b         d         a
# 0 -1.281585 -1.052020  0.925319
# 1 -0.711210 -0.424939 -0.619031
</span><span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#           a         b         c         d
# 0  2.410815 -0.872558  1.215403  1.321002
# 1 -0.046726  0.088367  0.255645 -1.442833
# 2  0.001280  0.561726 -0.992764 -0.830453
# 3  0.925319 -1.281585       NaN -1.052020
# 4 -0.619031 -0.711210       NaN -0.424939</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="combining-data-with-overlap">4.2.4. Combining Data with Overlap</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span>
    <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">f</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># f    NaN
# e    2.5
# d    0.0
# c    3.5
# b    4.5
# a    NaN
# dtype: float64
</span><span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">f</span><span class="sh">"</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># a    0.0
# b    NaN
# c    2.0
# d    NaN
# e    NaN
# f    5.0
# dtype: float64
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="nf">isna</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>  <span class="c1"># not check the index labels
# array([0. , 2.5, 0. , 3.5, 4.5, 5. ])
</span>
<span class="n">a</span><span class="p">.</span><span class="nf">combine_first</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># line up values by index
# a    0.0
# b    4.5
# c    3.5
# d    0.0
# e    2.5
# f    5.0
# dtype: float64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">:</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#      a    b   c
# 0  1.0  NaN   2
# 1  NaN  2.0   6
# 2  5.0  NaN  10
# 3  NaN  6.0  14
</span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#      a    b
# 0  5.0  NaN
# 1  4.0  3.0
# 2  NaN  4.0
# 3  3.0  6.0
# 4  7.0  8.0
</span>
<span class="n">df1</span><span class="p">.</span><span class="nf">combine_first</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>  <span class="c1"># union of all the column names
#      a    b     c
# 0  1.0  NaN   2.0
# 1  4.0  2.0   6.0
# 2  5.0  4.0  10.0
# 3  3.0  6.0  14.0
# 4  7.0  8.0   NaN</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reshaping-and-pivoting">4.3. Reshaping and Pivoting</h3>
<div class="sect3">
<h4 id="reshaping-with-hierarchical-indexing">4.3.1. Reshaping with Hierarchical Indexing</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="nf">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nc">Index</span><span class="p">([</span><span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nc">Index</span><span class="p">([</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">number</span><span class="sh">"</span><span class="p">),</span>
<span class="p">)</span>
<span class="c1"># number    one  two  three
# state
# Ohio        0    1      2
# Colorado    3    4      5
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">stack</span><span class="p">()</span>  <span class="c1"># pivot the columns into the rows (a new Series)
# state     number
# Ohio      one       0
#           two       1
#           three     2
# Colorado  one       3
#           two       4
#           three     5
# dtype: int64
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">unstack</span><span class="p">()</span>  <span class="c1"># pivot the rows into the columns (a new Series)
# number  state
# one     Ohio        0
#         Colorado    3
# two     Ohio        1
#         Colorado    4
# three   Ohio        2
#         Colorado    5
# dtype: int64
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">stack</span><span class="p">().</span><span class="nf">unstack</span><span class="p">()</span>  <span class="c1"># rearrange forth and back
# number    one  two  three
# state
# Ohio        0    1      2
# Colorado    3    4      5</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pivoting-long-to-wide-format">4.3.2. Pivoting Long to Wide Format</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A common way to store multiple time series in databases and CSV files is what is sometimes called long or stacked format, that each row represents a single observation or value, with columns for identifiers (e.g., time, category) and the corresponding value.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">raw_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/examples/macrodata.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">raw_data</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    year  quarter   realgdp  realcons  realinv  ...  tbilrate  unemp      pop  infl  realint
# 0  1959        1  2710.349    1707.4  286.898  ...      2.82    5.8  177.146  0.00     0.00
# 1  1959        2  2778.801    1733.7  310.859  ...      3.08    5.1  177.830  2.34     0.74
# 2  1959        3  2775.488    1751.8  289.226  ...      3.82    5.3  178.657  2.74     1.09
# 3  1959        4  2785.204    1753.7  299.356  ...      4.33    5.6  179.386  0.27     4.06
# 4  1960        1  2847.699    1770.5  331.722  ...      3.50    5.2  180.007  2.31     1.19
#
# [5 rows x 14 columns]
</span><span class="n">data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">quarter</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">realgdp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">infl</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">unemp</span><span class="sh">"</span><span class="p">]]</span>
<span class="n">data</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    year  quarter   realgdp  infl  unemp
# 0  1959        1  2710.349  0.00    5.8
# 1  1959        2  2778.801  2.34    5.1
# 2  1959        3  2775.488  2.74    5.3
# 3  1959        4  2785.204  0.27    5.6
# 4  1960        1  2847.699  2.31    5.2
</span><span class="n">periods</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">PeriodIndex</span><span class="p">.</span><span class="nf">from_fields</span><span class="p">(</span>
    <span class="n">year</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">quarter</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="sh">"</span><span class="s">quarter</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">periods</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">date</span><span class="sh">"</span>
<span class="c1"># PeriodIndex(['1959Q1', '1959Q2', '1959Q3', '1959Q4', '1960Q1', '1960Q2',
#              '1960Q3', '1960Q4', '1961Q1', '1961Q2',
#              ...
#              '2007Q2', '2007Q3', '2007Q4', '2008Q1', '2008Q2', '2008Q3',
#              '2008Q4', '2009Q1', '2009Q2', '2009Q3'],
#             dtype='period[Q-DEC]', name='date', length=203)
</span><span class="n">data</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">periods</span><span class="p">.</span><span class="nf">to_timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#              realgdp  infl  unemp
# date
# 1959-01-01  2710.349  0.00    5.8
# 1959-04-01  2778.801  2.34    5.1
# 1959-07-01  2775.488  2.74    5.3
# 1959-10-01  2785.204  0.27    5.6
# 1960-01-01  2847.699  2.31    5.2
</span><span class="n">data</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">item</span><span class="sh">"</span>
<span class="n">data</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1"># item         realgdp  infl  unemp
# date
# 1959-01-01  2710.349  0.00    5.8
# 1959-04-01  2778.801  2.34    5.1
# 1959-07-01  2775.488  2.74    5.3
# 1959-10-01  2785.204  0.27    5.6
# 1960-01-01  2847.699  2.31    5.2
</span>
<span class="n">ldata</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">stack</span><span class="p">().</span><span class="nf">reset_index</span><span class="p">().</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">})</span>  <span class="c1"># long format
</span><span class="n">ldata</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#         date     item     value
# 0 1959-01-01  realgdp  2710.349
# 1 1959-01-01     infl     0.000
# 2 1959-01-01    unemp     5.800
# 3 1959-04-01  realgdp  2778.801
# 4 1959-04-01     infl     2.340
</span>
<span class="n">pivoted</span> <span class="o">=</span> <span class="n">ldata</span><span class="p">.</span><span class="nf">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">item</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">)</span>
<span class="n">pivoted</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1"># item        infl   realgdp  unemp
# date
# 1959-01-01  0.00  2710.349    5.8
# 1959-04-01  2.34  2778.801    5.1
# 1959-07-01  2.74  2775.488    5.3
# 1959-10-01  0.27  2785.204    5.6
# 1960-01-01  2.31  2847.699    5.2
</span>
<span class="n">ldata</span><span class="p">[</span><span class="sh">"</span><span class="s">value2</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ldata</span><span class="p">))</span>
<span class="n">pivoted</span> <span class="o">=</span> <span class="n">ldata</span><span class="p">.</span><span class="nf">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">item</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># mutiple values, hierarchical columns
</span><span class="n">pivoted</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#            value                    value2
# item        infl   realgdp unemp      infl   realgdp     unemp
# date
# 1959-01-01  0.00  2710.349   5.8 -0.971766 -0.561886  0.007484
# 1959-04-01  2.34  2778.801   5.1  0.649848  0.664631  0.635405
# 1959-07-01  2.74  2775.488   5.3 -0.828290  0.528560 -1.424809
# 1959-10-01  0.27  2785.204   5.6 -1.433866 -0.062887  0.395601
# 1960-01-01  2.31  2847.699   5.2  0.074323 -0.682785 -0.587253
</span><span class="n">pivoted</span><span class="p">[</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">].</span><span class="nf">head</span><span class="p">()</span>
<span class="c1"># item        infl   realgdp  unemp
# date
# 1959-01-01  0.00  2710.349    5.8
# 1959-04-01  2.34  2778.801    5.1
# 1959-07-01  2.74  2775.488    5.3
# 1959-10-01  0.27  2785.204    5.6
# 1960-01-01  2.31  2847.699    5.2
</span>
<span class="n">unstacked</span> <span class="o">=</span> <span class="n">ldata</span><span class="p">.</span><span class="nf">set_index</span><span class="p">([</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">item</span><span class="sh">"</span><span class="p">]).</span><span class="nf">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="sh">"</span><span class="s">item</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># equivalent: set_index and unstack
</span><span class="n">unstacked</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#            value                    value2
# item        infl   realgdp unemp      infl   realgdp     unemp
# date
# 1959-01-01  0.00  2710.349   5.8 -0.971766 -0.561886  0.007484
# 1959-04-01  2.34  2778.801   5.1  0.649848  0.664631  0.635405
# 1959-07-01  2.74  2775.488   5.3 -0.828290  0.528560 -1.424809
# 1959-10-01  0.27  2785.204   5.6 -1.433866 -0.062887  0.395601
# 1960-01-01  2.31  2847.699   5.2  0.074323 -0.682785 -0.587253</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pivoting-wide-to-long-format">4.3.3. Pivoting Wide to Long Format</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">foo</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">baz</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">C</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#    key  A  B  C
# 0  foo  1  4  7
# 1  bar  2  5  8
# 2  baz  3  6  9
</span><span class="n">melted</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># use "key" as the group indicator
#    key variable  value
# 0  foo        A      1
# 1  bar        A      2
# 2  baz        A      3
# 3  foo        B      4
# 4  bar        B      5
# 5  baz        B      6
# 6  foo        C      7
# 7  bar        C      8
# 8  baz        C      9
</span><span class="n">melted</span><span class="p">.</span><span class="nf">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">variable</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">reset_index</span><span class="p">()</span>  <span class="c1"># reshape back
# variable  key  A  B  C
# 0         bar  2  5  8
# 1         baz  3  6  9
# 2         foo  1  4  7</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plotting-and-visualization">5. Plotting and Visualization</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">conda <span class="nb">install</span> <span class="nt">-c</span> conda-forge <span class="nt">-y</span> jupyterlab <span class="o">&amp;&amp;</span> jupyter lab</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</span><span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/simple-line-plot.svg" alt="Simple Line Plot" width="25%" height="25%">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
===
<code>matplotlib.pyplot</code> maintains the concept of an active figure and axes.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>plt.figure()</code> creates a new figure, and it becomes the active figure, and a default axes is also created and becomes active.</p>
</li>
<li>
<p><code>plt.gcf()</code> returns the current active figure or creates one if no figure exists.</p>
</li>
<li>
<p><code>plt.gca()</code> returns the current active axes or creates one if no axes exists in the current figure.</p>
</li>
<li>
<p><code>plt.plot()</code>, <code>plt.scatter()</code>, etc., operate on the current active axes.</p>
</li>
<li>
<p><code>plt.axes(ax)</code> can be used to set the current axes, where <code>ax</code> is an axes object.</p>
</li>
<li>
<p><code>plt.sca(ax)</code> is a more suitable way to set the current axes, as <code>plt.axes</code> is deprecated for this purpose.</p>
</li>
<li>
<p><code>plt.subplot()</code> creates a new subplot and makes it the active axes.</p>
</li>
<li>
<p>In interactive mode, <code>plt.show()</code> is not necessary to display plots.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>plt.ion()</code> enables interactive mode, and <code>plt.ioff()</code> disables it.</p>
</li>
<li>
<p><code>plt.isinteractive()</code> returns <code>True</code> if interactive mode is enabled, and <code>False</code> otherwise.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">plt</span><span class="p">.</span><span class="nf">get_fignums</span><span class="p">()</span>  <span class="c1"># []
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="p">.</span><span class="n">number</span>         <span class="c1"># 1
</span><span class="n">plt</span><span class="p">.</span><span class="nf">get_fignums</span><span class="p">()</span>  <span class="c1"># [1]
</span><span class="n">fig</span> <span class="o">==</span> <span class="n">plt</span><span class="p">.</span><span class="nf">gcf</span><span class="p">()</span>   <span class="c1"># True
</span><span class="n">ax</span> <span class="ow">is</span> <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">()</span>    <span class="c1"># True
</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">()</span>
<span class="n">fig2</span><span class="p">.</span><span class="n">number</span>        <span class="c1"># 2
</span><span class="n">plt</span><span class="p">.</span><span class="nf">get_fignums</span><span class="p">()</span>  <span class="c1"># [1, 2]
</span><span class="n">plt</span><span class="p">.</span><span class="nf">gcf</span><span class="p">().</span><span class="n">number</span>   <span class="c1"># 2
</span><span class="n">fig2</span><span class="p">.</span><span class="n">axes</span>          <span class="c1"># []
</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">()</span>
<span class="n">ax2</span> <span class="o">==</span> <span class="n">ax</span>          <span class="c1"># False
</span><span class="n">fig2</span><span class="p">.</span><span class="n">axes</span>          <span class="c1"># [&lt;Axes: &gt;]
</span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig3</span><span class="p">.</span><span class="n">number</span>        <span class="c1"># 1
</span><span class="n">fig3</span> <span class="o">==</span> <span class="n">fig</span>        <span class="c1"># True
</span><span class="n">fig3</span> <span class="o">==</span> <span class="n">plt</span><span class="p">.</span><span class="nf">gcf</span><span class="p">()</span>  <span class="c1"># True</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>===</p>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="figures-and-subplots">5.1. Figures and Subplots</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># plots in matplotlib reside within a figure object
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">()</span>   <span class="c1"># create a new figure
</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">get_fignums</span><span class="p">()</span>     <span class="c1"># [1]
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">fig</span>  <span class="c1"># True
</span>
<span class="c1"># get the current figure or create a new figure
</span><span class="n">cf</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">gcf</span><span class="p">()</span>
<span class="n">cf</span><span class="p">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cf</span> <span class="o">==</span> <span class="n">fig</span>  <span class="c1"># (1, True)
</span>
<span class="c1"># saving plots to file
</span><span class="n">fig</span><span class="p">.</span><span class="nf">savefig</span><span class="p">(</span><span class="sh">"</span><span class="s">figpath.svg</span><span class="sh">"</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="nf">savefig</span><span class="p">(</span><span class="sh">"</span><span class="s">figpath.png</span><span class="sh">"</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

<span class="c1"># show a specific figure
</span><span class="n">fig</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
<span class="n">fig</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>  <span class="c1"># fine
</span>
<span class="c1"># show and erase the current figure
</span><span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>  <span class="c1"># not work
</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">get_fignums</span><span class="p">()</span>  <span class="c1"># []
</span><span class="n">plt</span><span class="p">.</span><span class="nf">gcf</span><span class="p">()</span>  <span class="c1"># &lt;Figure size 640x480 with 0 Axes&gt;</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/an-empty-figure-with-three-subplots.svg" alt="An empty matplotlib figure with three subplots" width="25%" height="25%">
</div>
<div class="title">Figure 1. An empty matplotlib figure with three subplots</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">ax3</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">50</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">"</span><span class="s">dashed</span><span class="sh">"</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/data-visualization-with-a-single-plot.svg" alt="Data visualization after a single plot" width="25%" height="25%">
</div>
<div class="title">Figure 2. Data visualization after a single plot</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">ax1</span><span class="p">.</span><span class="nf">hist</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>
<span class="n">ax3</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">50</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">"</span><span class="s">dashed</span><span class="sh">"</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/data-visualization-with-3-subplots.svg" alt="Data visualization after additional plots" width="25%" height="25%">
</div>
<div class="title">Figure 3. Data visualization after additional plots</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># plt.subplots(...): create a grid of subplots more convenient
</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">axes</span>
<span class="c1"># array([[&lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;],
#        [&lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;]], dtype=object)
</span><span class="n">fig</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/plt-subplots.svg" alt="plt subplots" width="25%" height="25%">
</div>
<div class="title">Figure 4. An empty matplotlib figure with six (2 x 3) subplots</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># adjusting the spacing around subplots
</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="nf">hist</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="nf">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/data-visualization-with-no-inter-subplot-spacing.svg" alt="Data visualization with no inter-subplot spacing" width="25%" height="25%">
</div>
<div class="title">Figure 5. Data visualization with no inter-subplot spacing</div>
</div>
</div>
<div class="sect2">
<h3 id="colors-markers-and-line-styles">5.2. Colors, Markers, and Line Styles</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">30</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">"</span><span class="s">--</span><span class="sh">"</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="sh">"</span><span class="s">o</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># markers highlights the data points
</span><span class="n">fig</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/line-plot-with-markers.svg" alt="Line plot with markers" width="25%" height="25%">
</div>
<div class="title">Figure 6. Line plot with markers</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">30</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">#FF69B4</span><span class="sh">"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">"</span><span class="s">dashed</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">Default</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># pink
</span><span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">#33CCFF</span><span class="sh">"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">"</span><span class="s">dotted</span><span class="sh">"</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="sh">"</span><span class="s">steps-post</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">steps-post</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># sky blue
</span><span class="n">ax</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/line-plot-with-different-drawstyle-options.svg" alt="Line plot with different drawstyle options" width="25%" height="25%">
</div>
<div class="title">Figure 7. Line plot with different drawstyle options</div>
</div>
</div>
<div class="sect2">
<h3 id="ticks-labels-and-legends">5.3. Ticks, Labels, and Legends</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">).</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">1_000</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">());</span>
<span class="n">fig</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/simple-plot-for-illustrating-xticks-with-default-labels.svg" alt="Simple plot for illustrating xticks (with default labels)" width="25%" height="25%">
</div>
<div class="title">Figure 8. Simple plot for illustrating xticks (with default labels)</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">).</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">1_000</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">());</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="nf">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="nf">set_xticklabels</span><span class="p">([</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">four</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">five</span><span class="sh">"</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Stages</span><span class="sh">"</span><span class="p">);</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">My first matplotlib plot</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># ax.set(title="My first matplotlib plot", xlabel="Stages")</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/simple-plot-for-illustrating-custom-xticks.svg" alt="Simple plot for illustrating custom xticks" width="25%" height="25%">
</div>
<div class="title">Figure 9. Simple plot for illustrating custom xticks</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">"</span><span class="s">dashed</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">"</span><span class="s">dotted</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/simple-plot-with-three-lines-and-legend.svg" alt="Simple plot with three lines and legend" width="25%" height="25%">
</div>
<div class="title">Figure 10. Simple plot with three lines and legend</div>
</div>
</div>
<div class="sect2">
<h3 id="annotations-and-drawing-on-a-subplot">5.4. Annotations and Drawing on a Subplot</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/examples/spx.csv</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">spx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">SPX</span><span class="sh">"</span><span class="p">]</span>

<span class="n">spx</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">)</span>

<span class="n">crisis_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">2007</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="sh">"</span><span class="s">Peak of bull market</span><span class="sh">"</span><span class="p">),</span>  <span class="c1"># from datatime import datetime
</span>    <span class="p">(</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="sh">"</span><span class="s">Bear Stearns Fails</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="sh">"</span><span class="s">Lehman Bankruptcy</span><span class="sh">"</span><span class="p">),</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">crisis_data</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">annotate</span><span class="p">(</span>
        <span class="n">label</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">spx</span><span class="p">.</span><span class="nf">asof</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="mi">75</span><span class="p">),</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">spx</span><span class="p">.</span><span class="nf">asof</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="mi">225</span><span class="p">),</span>
        <span class="n">arrowprops</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="sh">"</span><span class="s">left</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="sh">"</span><span class="s">top</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># Zoom in on 2007-2010
</span><span class="n">ax</span><span class="p">.</span><span class="nf">set_xlim</span><span class="p">([</span><span class="sh">"</span><span class="s">1/1/2007</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">1/1/2011</span><span class="sh">"</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">([</span><span class="mi">600</span><span class="p">,</span> <span class="mi">1800</span><span class="p">])</span>

<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Important dates in the 2008-2009 financial crisis</span><span class="sh">"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/important-dates-in-the-2008-2009-financial-crisis.svg" alt="Important dates in the 2008–2009 financial crisis" width="25%" height="25%">
</div>
<div class="title">Figure 11. Important dates in the 2008–2009 financial crisis</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>
<span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nc">Rectangle</span><span class="p">((</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">circ</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nc">Circle</span><span class="p">((</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">blue</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">pgon</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nc">Polygon</span><span class="p">([[</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">green</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">add_patch</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">add_patch</span><span class="p">(</span><span class="n">pgon</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/data-visualization-composed-from-three-different-patches.svg" alt="Data visualization composed from three different patches" width="25%" height="25%">
</div>
<div class="title">Figure 12. Data visualization composed from three different patches</div>
</div>
</div>
<div class="sect2">
<h3 id="plotting-with-pandas-and-seaborn">5.5. Plotting with pandas and seaborn</h3>
<div class="paragraph">
<p>Series and DataFrame have a <code>plot</code> attribute for making some basic plot types.</p>
</div>
<div class="sect3">
<h4 id="line-and-bar-plots">5.5.1. Line and Bar Plots</h4>
<div class="ulist">
<ul>
<li>
<p>Simple Series plot</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">cumsum</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span> <span class="c1"># `s.plot()` is equivalent to `s.plot.line()` and `s.plot(kind="line")`</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/simple-series-plot.svg" alt="Simple Series plot" width="25%" height="25%">
</div>
<div class="title">Figure 13. Simple Series plot</div>
</div>
</li>
<li>
<p>Simple DataFrame plot</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)).</span><span class="nf">cumsum</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">C</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">"</span><span class="s">grayscale</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/simple-dataframe-plot.svg" alt="Simple DataFrame plot" width="25%" height="25%">
</div>
<div class="title">Figure 14. Simple DataFrame plot</div>
</div>
</li>
<li>
<p>Horizonal and vertical bar plot</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">).</span><span class="nf">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="sh">"</span><span class="s">abcdefghijklmnop</span><span class="sh">"</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="nf">barh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/horizonal-and-vertical-bar-plot.svg" alt="Horizonal and vertical bar plot" width="25%" height="25%">
</div>
<div class="title">Figure 15. Horizonal and vertical bar plot</div>
</div>
</li>
<li>
<p>DataFrame bar plot</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">).</span><span class="nf">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">one</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">two</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">three</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">four</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">five</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">six</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nc">Index</span><span class="p">([</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">C</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">Genus</span><span class="sh">"</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="nf">bar</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/dataframe-bar-plot.svg" alt="DataFrame bar plot" width="25%" height="25%">
</div>
<div class="title">Figure 16. DataFrame bar plot</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="nf">barh</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># create stacked bar plots</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/dataframe-stacked-bar-plot.svg" alt="DataFrame stacked bar plot" width="25%" height="25%">
</div>
<div class="title">Figure 17. DataFrame stacked bar plot</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tips</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/examples/tips.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">tips</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    total_bill   tip smoker  day    time  size
# 0       16.99  1.01     No  Sun  Dinner     2
# 1       10.34  1.66     No  Sun  Dinner     3
# 2       21.01  3.50     No  Sun  Dinner     3
# 3       23.68  3.31     No  Sun  Dinner     2
# 4       24.59  3.61     No  Sun  Dinner     4
</span><span class="n">party_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">crosstab</span><span class="p">(</span><span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">],</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># frequency table
# size  1   2   3   4  5  6
# day
# Fri   1  16   1   1  0  0
# Sat   2  53  18  13  1  0
# Sun   0  39  15  18  3  1
# Thur  1  48   4   5  1  3
</span><span class="n">party_counts</span> <span class="o">=</span> <span class="n">party_counts</span><span class="p">.</span><span class="nf">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Thur</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Fri</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Sat</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Sun</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># size  1   2   3   4  5  6
# day
# Thur  1  48   4   5  1  3
# Fri   1  16   1   1  0  0
# Sat   2  53  18  13  1  0
# Sun   0  39  15  18  3  1
</span><span class="n">party_counts</span> <span class="o">=</span> <span class="n">party_counts</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># remove one- and six-person parties
# size   2   3   4  5
# day
# Thur  48   4   5  1
# Fri   16   1   1  0
# Sat   53  18  13  1
# Sun   39  15  18  3
</span><span class="n">party_pcts</span> <span class="o">=</span> <span class="n">party_counts</span><span class="p">.</span><span class="nf">div</span><span class="p">(</span><span class="n">party_counts</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">columns</span><span class="sh">"</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="sh">"</span><span class="s">index</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># normalize to sum to 1
# size         2         3         4         5
# day
# Thur  0.827586  0.068966  0.086207  0.017241
# Fri   0.888889  0.055556  0.055556  0.000000
# Sat   0.623529  0.211765  0.152941  0.011765
# Sun   0.520000  0.200000  0.240000  0.040000
</span><span class="n">party_pcts</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/fraction-of-parties-by-size-within-each-day.svg" alt="Fraction of parties by size within each day" width="25%" height="25%">
</div>
<div class="title">Figure 18. Fraction of parties by size within each day</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>       <span class="c1"># conda install seaborn
</span><span class="n">sns</span><span class="p">.</span><span class="nf">set_style</span><span class="p">(</span><span class="sh">"</span><span class="s">whitegrid</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_palette</span><span class="p">(</span><span class="sh">"</span><span class="s">Greys_r</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># set a greyscale color palette for black-and-white print medium</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">total_bill</span><span class="sh">"</span><span class="p">]</span> <span class="o">-</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">])</span>
<span class="n">tips</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    total_bill   tip smoker  day    time  size   tip_pct
# 0       16.99  1.01     No  Sun  Dinner     2  0.063204
# 1       10.34  1.66     No  Sun  Dinner     3  0.191244
# 2       21.01  3.50     No  Sun  Dinner     3  0.199886
# 3       23.68  3.31     No  Sun  Dinner     2  0.162494
# 4       24.59  3.61     No  Sun  Dinner     4  0.172069</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tips</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="sh">"</span><span class="s">h</span><span class="sh">"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/tipping-percentage-by-day-with-error-bars.svg" alt="Tipping percentage by day with error bars" width="25%" height="25%">
</div>
<div class="title">Figure 19. Tipping (average) percentage by day with error bars</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="histograms-and-density-plots">5.5.2. Histograms and Density Plots</h4>
<div class="ulist">
<ul>
<li>
<p>A histogram is a kind of bar plot that gives a discretized display of value frequency, that is, the data points are split into discrete, evenly spaced bins, and the number of data points in each bin is plotted.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/histogram-of-tip-percentages.svg" alt="Histogram of tip percentages" width="25%" height="25%">
</div>
<div class="title">Figure 20. Histogram of tip percentages</div>
</div>
</li>
<li>
<p>A density plot is formed by approximating a continuous probability distribution that generated observed data as a mixture of simpler distributions, often referred to as kernel density estimates (KDE).</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">density</span><span class="p">()</span>  <span class="c1"># SciPy: conda install scipy</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/density-plot-of-tip-percentages.svg" alt="Density plot of tip percentages" width="25%" height="25%">
</div>
<div class="title">Figure 21. Density plot of tip percentages</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="scatter-or-point-plots">5.5.3. Scatter or Point Plots</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">macro</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/examples/macrodata.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">macro</span><span class="p">[[</span><span class="sh">"</span><span class="s">cpi</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">m1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">tbilrate</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">unemp</span><span class="sh">"</span><span class="p">]]</span>
<span class="n">trans_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="nf">diff</span><span class="p">().</span><span class="nf">dropna</span><span class="p">()</span>
<span class="n">trans_data</span><span class="p">.</span><span class="nf">tail</span><span class="p">()</span>
<span class="c1">#           cpi        m1  tbilrate     unemp
# 198 -0.007904  0.045361 -0.396881  0.105361
# 199 -0.021979  0.066753 -2.277267  0.139762
# 200  0.002340  0.010286  0.606136  0.160343
# 201  0.008419  0.037461 -0.200671  0.127339
# 202  0.008894  0.012202 -0.405465  0.042560</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Make a scatter plot and fits a linear regression line</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">m1</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">unemp</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">trans_data</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Changes in log(m1) versus log(unemp)</span><span class="sh">"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/a-seaborn-regression-scatter-plot.svg" alt="A seaborn regression/scatter plot" width="25%" height="25%">
</div>
<div class="title">Figure 22. A seaborn regression/scatter plot</div>
</div>
</li>
<li>
<p>Make a pairs plot or scatter plot matrix</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">sns</span><span class="p">.</span><span class="nf">pairplot</span><span class="p">(</span><span class="n">trans_data</span><span class="p">,</span> <span class="n">diag_kind</span><span class="o">=</span><span class="sh">"</span><span class="s">kde</span><span class="sh">"</span><span class="p">,</span> <span class="n">plot_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">alpha</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">})</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/pair-plot-matrix-of-statsmodels-macro-data.svg" alt="Pair plot matrix of statsmodels macro data" width="25%" height="25%">
</div>
<div class="title">Figure 23. Pair plot matrix of statsmodels macro data</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="facet-grids-and-categorical-data">5.5.4. Facet Grids and Categorical Data</h4>
<div class="ulist">
<ul>
<li>
<p>Tipping percentage by day/time/smoker</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">sns</span><span class="p">.</span><span class="nf">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tips</span><span class="p">[</span><span class="n">tips</span><span class="p">.</span><span class="n">tip_pct</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">])</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/tipping-percentage-by-day-time-smoker.svg" alt="Tipping percentage by day/time/smoker" width="25%" height="25%">
</div>
<div class="title">Figure 24. Tipping percentage by day/time/smoker</div>
</div>
</li>
<li>
<p>Tipping percentage by day split by time/smoker</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">sns</span><span class="p">.</span><span class="nf">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">bar</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tips</span><span class="p">[</span><span class="n">tips</span><span class="p">.</span><span class="n">tip_pct</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">])</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/tipping-percentage-by-day-split-by-time-smoker.svg" alt="Tipping percentage by day split by time/smoker" width="25%" height="25%">
</div>
</div>
</li>
<li>
<p>Box plot of tipping percentage by day</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">sns</span><span class="p">.</span><span class="nf">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">box</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tips</span><span class="p">[</span><span class="n">tips</span><span class="p">.</span><span class="n">tip_pct</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">])</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/plotting/box-plot-of-tipping-percentage-by-day.svg" alt="Box plot of tipping percentage by day" width="25%" height="25%">
</div>
<div class="title">Figure 25. Box plot of tipping percentage by day</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-aggregation-and-group-operations">6. Data Aggregation and Group Operations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="group-operations">6.1. Group Operations</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">"</span><span class="s">Int64</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">data2</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#    key1  key2     data1     data2
# 0     a     1 -0.570747  0.965378
# 1     a     2 -0.442446  0.433062
# 2  &lt;NA&gt;     1  0.156601  0.045637
# 3     b     2  1.307246 -2.110711
# 4     b     1 -0.914420 -0.069982
# 5     a  &lt;NA&gt; -1.878161 -0.512519
# 6  &lt;NA&gt;     1 -0.637074 -1.144718</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># 1. split into groups based on one or more keys
# 2. apply a function to each group, producing a new value
# 3. combine the results of all those function applications into a result object
</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">].</span><span class="nf">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># &lt;pandas.core.groupby.generic.SeriesGroupBy object at 0x7f5e0a36ef90&gt;
</span><span class="n">grouped</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">mean</span><span class="p">())</span>
<span class="c1"># key1
# a   -0.963785
# b    0.196413
# Name: data1, dtype: float64
</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">])</span>
<span class="c1"># &lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7f5dd552a210&gt;
</span><span class="n">grouped</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1">#          data1
# key1
# a    -0.963785
# b     0.196413</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">]</span>
<span class="n">grouped</span><span class="p">.</span><span class="n">keys</span>   <span class="c1"># 'key1'
</span><span class="n">grouped</span><span class="p">.</span><span class="n">groups</span> <span class="c1"># {'a': [0, 1, 5], 'b': [3, 4]}
</span><span class="n">grouped</span><span class="p">.</span><span class="nf">get_group</span><span class="p">(</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 0   -0.570747
# 1   -0.442446
# 5   -1.878161
# Name: data1, dtype: float64
</span><span class="n">grouped</span><span class="p">.</span><span class="nf">get_group</span><span class="p">(</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>  <span class="c1"># np.float64(-0.9637846666666666)</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>any missing values in a group key are excluded from the result by default</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">).</span><span class="nf">size</span><span class="p">()</span>
<span class="c1"># key1
# a    3
# b    2
# dtype: int64
</span><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">size</span><span class="p">()</span>
<span class="c1"># key1
# a       3
# b       2
# &lt;NA&gt;    2
# dtype: int64</span></code></pre>
</div>
</div>
</li>
<li>
<p>compute the number of non-null values in each group</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">).</span><span class="nf">count</span><span class="p">()</span>
<span class="c1">#       key2  data1  data2
# key1
# a        2      3      3
# b        2      2      2</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="group-by-column-names">6.1.1. group by column names</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>  <span class="c1"># the numeric columns key1, data1, and data2 are all aggregated
#       key2     data1     data2
# key1
# a      1.5 -0.963784  0.295307
# b      1.5  0.196413 -1.090347
</span><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># key1 is a nuisance column
#         data1     data2
# key2
# 1    -0.49141 -0.050921
# 2     0.43240 -0.838825
</span><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">]).</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1">#               data1     data2
# key1 key2
# a    1    -0.570747  0.965378
#      2    -0.442446  0.433062
# b    1    -0.914420 -0.069982
#      2     1.307246 -2.110711</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="iterate-over-groups">6.1.2. iterate over groups</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">].</span><span class="nf">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">]):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="c1"># a
# 0   -0.570747
# 1   -0.442446
# 5   -1.878161
# Name: data1, dtype: float64
# b
# 3    1.307246
# 4   -0.914420
# Name: data1, dtype: float64
</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">]):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="c1"># ('a', np.int64(1))
#   key1  key2     data1     data2
# 0    a     1 -0.570747  0.965378
# ('a', np.int64(2))
#   key1  key2     data1     data2
# 1    a     2 -0.442446  0.433062
# ('b', np.int64(1))
#   key1  key2    data1     data2
# 4    b     1 -0.91442 -0.069982
# ('b', np.int64(2))
#   key1  key2     data1     data2
# 3    b     2  1.307246 -2.110711</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="select-a-column-or-subset-of-columns">6.1.3. select a column or subset of columns</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">]</span>    <span class="c1"># df["data1"].groupby(df["key1"])
# &lt;pandas.core.groupby.generic.SeriesGroupBy object at 0x7f5dd9540cd0&gt;
</span><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">)[[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">]]</span>  <span class="c1"># df[["data1"]].groupby(df["key1"])
# &lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7f5dd979a690&gt;
</span>
<span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">])[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1"># key1  key2
# a     1      -0.570747
#       2      -0.442446
# b     1      -0.914420
#       2       1.307246
# Name: data1, dtype: float64
</span><span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key2</span><span class="sh">"</span><span class="p">)[[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">data2</span><span class="sh">"</span><span class="p">]].</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1">#         data1     data2
# key2
# 1    -0.49141 -0.050921
# 2     0.43240 -0.838825</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="group-with-arrays-dictionaries-series-and-functions">6.1.4. group with arrays, dictionaries, series, and functions</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">people</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Joe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Steve</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Wanda</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Jill</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Trey</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">people</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>  <span class="c1"># add a few NA values
#               a         b         c         d         e
# Joe   -0.722383  0.074867 -2.167530  0.779033  0.401936
# Steve  1.154339 -0.256692  0.382976  0.138536  0.057351
# Wanda -2.275050       NaN       NaN -1.089663 -0.355903
# Jill  -0.188314  0.327582  1.138911 -0.509901  0.388599
# Trey   0.736051 -1.300729 -1.214873  0.171754 -0.053030</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">blue</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">blue</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">]</span>
<span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="sh">"</span><span class="s">OH</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">CA</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">CA</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">OH</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">OH</span><span class="sh">"</span><span class="p">])</span>
<span class="n">people</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">colors</span><span class="p">).</span><span class="nf">max</span><span class="p">().</span><span class="n">T</span>
<span class="c1">#            blue       red
# Joe    0.779033  0.401936
# Steve  0.382976  1.154339
# Wanda -1.089663 -0.355903
# Jill   1.138911  0.388599
# Trey   0.171754  0.736051
</span><span class="n">people</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="n">colors</span><span class="p">,</span> <span class="n">states</span><span class="p">]).</span><span class="nf">sum</span><span class="p">().</span><span class="n">T</span>
<span class="c1">#            blue                 red
#              CA        OH        CA        OH
# Joe   -2.167530  0.779033  0.074867 -0.320447
# Steve  0.382976  0.138536 -0.256692  1.211690
# Wanda  0.000000 -1.089663  0.000000 -2.630953
# Jill   1.138911 -0.509901  0.327582  0.200285
# Trey  -1.214873  0.171754 -1.300729  0.683021</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">blue</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">blue</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">e</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">f</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">orange</span><span class="sh">"</span><span class="p">}</span>  <span class="c1"># unused keys (f) are OK
</span><span class="n">people</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">dictionary</span><span class="p">).</span><span class="nf">sum</span><span class="p">().</span><span class="n">T</span>
<span class="c1">#            blue       red
# Joe   -1.388497 -0.245580
# Steve  0.521512  0.954998
# Wanda -1.089663 -2.630953
# Jill   0.629010  0.527867
# Trey  -1.043119 -0.617708</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
<span class="n">people</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">series</span><span class="p">).</span><span class="nf">count</span><span class="p">().</span><span class="n">T</span>
<span class="c1">#        blue  red
# Joe       2    3
# Steve     2    3
# Wanda     1    2
# Jill      2    3
# Trey      2    3</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">people</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1">#           a         b         c         d         e
# J -0.910697  0.402449 -1.028619  0.269132  0.790535
# S  1.154339 -0.256692  0.382976  0.138536  0.057351
# T  0.736051 -1.300729 -1.214873  0.171754 -0.053030
# W -2.275050  0.000000  0.000000 -1.089663 -0.355903
</span><span class="n">people</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">people</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">array</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1">#           a         b         c         d         e
# J -0.910697  0.402449 -1.028619  0.269132  0.790535
# S  1.154339 -0.256692  0.382976  0.138536  0.057351
# T  0.736051 -1.300729 -1.214873  0.171754 -0.053030
# W -2.275050  0.000000  0.000000 -1.089663 -0.355903
</span>
<span class="n">people</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="nb">len</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1">#           a         b         c         d         e
# 3 -0.722383  0.074867 -2.167530  0.779033  0.401936
# 4  0.547737 -0.973147 -0.075962 -0.338147  0.335569
# 5 -1.120712 -0.256692  0.382976 -0.951127 -0.298552
</span><span class="n">people</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">people</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">array</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nb">len</span><span class="p">)).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1">#           a         b         c         d         e
# 3 -0.722383  0.074867 -2.167530  0.779033  0.401936
# 4  0.547737 -0.973147 -0.075962 -0.338147  0.335569
# 5 -1.120712 -0.256692  0.382976 -0.951127 -0.298552</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">people</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">states</span><span class="p">]).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1">#              a         b         c         d         e
# 3 OH -0.722383  0.074867 -2.167530  0.779033  0.401936
# 4 OH  0.547737 -0.973147 -0.075962 -0.338147  0.335569
# 5 CA -1.120712 -0.256692  0.382976 -0.951127 -0.298552</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="group-by-index-levels">6.1.5. group by index levels</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">MultiIndex</span><span class="p">.</span><span class="nf">from_arrays</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="sh">"</span><span class="s">US</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">US</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">US</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">JP</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">JP</span><span class="sh">"</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">cty</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">tenor</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="c1"># cty          US                            JP
# tenor         1         3         5         1         3
# 0     -1.604618  0.129037  0.322549 -1.217651 -0.818239
# 1      1.198944 -2.472948 -0.637405 -0.116704 -1.252229
# 2      1.839182  0.339592 -0.580455  1.108270  0.694266
# 3     -2.000956  1.706998 -2.092790  0.139301  0.074481
</span><span class="n">df</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="sh">"</span><span class="s">cty</span><span class="sh">"</span><span class="p">).</span><span class="nf">count</span><span class="p">().</span><span class="n">T</span>
<span class="c1"># cty  JP  US
# 0     2   3
# 1     2   3
# 2     2   3
# 3     2   3</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="data-aggregation">6.2. Data Aggregation</h3>
<div class="paragraph">
<p>Aggregations refer to any data transformation that produces scalar values from arrays.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># common optimized aggregations on GroupBy objects
</span><span class="nb">any</span><span class="p">,</span> <span class="nb">all</span>       <span class="c1"># return True if any (one or more values) or all non-NA values are “truthy”
</span><span class="n">count</span>          <span class="c1"># number of non-NA values
</span><span class="n">cummin</span><span class="p">,</span> <span class="n">cummax</span> <span class="c1"># cumulative minimum and maximum of non-NA values
</span><span class="n">cumsum</span>         <span class="c1"># cumulative sum of non-NA values
</span><span class="n">cumprod</span>        <span class="c1"># cumulative product of non-NA values
</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span>    <span class="c1"># first and last non-NA values
</span><span class="n">mean</span>           <span class="c1"># mean of non-NA values
</span><span class="n">median</span>         <span class="c1"># arithmetic median of non-NA values
</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span>       <span class="c1"># minimum and maximum of non-NA values
</span><span class="n">nth</span>            <span class="c1"># retrieve value that would appear at position n with the data in sorted order
</span><span class="n">ohlc</span>           <span class="c1"># compute four “open-high-low-close” statistics for time series-like data
</span><span class="n">prod</span>           <span class="c1"># product of non-NA values
</span><span class="n">quantile</span>       <span class="c1"># compute sample quantile
</span><span class="n">rank</span>           <span class="c1"># ordinal ranks of non-NA values, like calling Series.rank
</span><span class="n">size</span>           <span class="c1"># compute group sizes, returning result as a Series
</span><span class="nb">sum</span>            <span class="c1"># sum of non-NA values
</span><span class="n">std</span><span class="p">,</span> <span class="n">var</span>       <span class="c1"># sample standard deviation and variance</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1">#    key1  key2     data1     data2
# 0     a     1 -0.570747  0.965378
# 1     a     2 -0.442446  0.433062
# 2  &lt;NA&gt;     1  0.156601  0.045637
# 3     b     2  1.307246 -2.110711
# 4     b     1 -0.914420 -0.069982
# 5     a  &lt;NA&gt; -1.878161 -0.512519
# 6  &lt;NA&gt;     1 -0.637074 -1.144718
</span><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key1</span><span class="sh">"</span><span class="p">)</span>

<span class="n">grouped</span><span class="p">[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">].</span><span class="nf">nsmallest</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># key1
# a     5   -1.878161
#       0   -0.570747
# b     4   -0.914420
#       3    1.307246
# Name: data1, dtype: float64
</span>
<span class="n">grouped</span><span class="p">.</span><span class="nf">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nf">min</span><span class="p">())</span> <span class="c1"># aggregate or alias agg: custom non-optimized aggregation
#       key2     data1     data2
# key1
# a        1  1.435715  1.477897
# b        1  2.221666  2.040729
</span>
<span class="n">grouped</span><span class="p">[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">].</span><span class="nf">describe</span><span class="p">()</span>  <span class="c1"># work, but not aggregations
#       count      mean       std       min       25%       50%       75%       max
# key1
# a       3.0 -0.963785  0.794467 -1.878161 -1.224454 -0.570747 -0.506597 -0.442446
# b       2.0  0.196413  1.570955 -0.914420 -0.359004  0.196413  0.751829  1.307246</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tips</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/examples/tips.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">tips</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    total_bill   tip smoker  day    time  size
# 0       16.99  1.01     No  Sun  Dinner     2
# 1       10.34  1.66     No  Sun  Dinner     3
# 2       21.01  3.50     No  Sun  Dinner     3
# 3       23.68  3.31     No  Sun  Dinner     2
# 4       24.59  3.61     No  Sun  Dinner     4
</span><span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">total_bill</span><span class="sh">"</span><span class="p">]</span>
<span class="n">tips</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    total_bill   tip smoker  day    time  size   tip_pct
# 0       16.99  1.01     No  Sun  Dinner     2  0.059447
# 1       10.34  1.66     No  Sun  Dinner     3  0.160542
# 2       21.01  3.50     No  Sun  Dinner     3  0.166587
# 3       23.68  3.31     No  Sun  Dinner     2  0.139780
# 4       24.59  3.61     No  Sun  Dinner     4  0.146808</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="apply-a-list-of-functions-or-function-names">6.2.1. apply a list of functions or function names</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">grouped</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">].</span><span class="nf">agg</span><span class="p">(</span><span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># day   smoker
# Fri   No        0.151650
#       Yes       0.174783
# Sat   No        0.158048
#       Yes       0.147906
# Sun   No        0.160113
#       Yes       0.187250
# Thur  No        0.160298
#       Yes       0.163863
# Name: tip_pct, dtype: float64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">grouped</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">].</span><span class="nf">agg</span><span class="p">([</span><span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">std</span><span class="sh">"</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nf">min</span><span class="p">()])</span>
<span class="c1">#                  mean       std  &lt;lambda_0&gt;
# day  smoker
# Fri  No      0.151650  0.028123    0.067349
#      Yes     0.174783  0.051293    0.159925
# Sat  No      0.158048  0.039767    0.235193
#      Yes     0.147906  0.061375    0.290095
# Sun  No      0.160113  0.042347    0.193226
#      Yes     0.187250  0.154134    0.644685
# Thur No      0.160298  0.038774    0.193350
#      Yes     0.163863  0.039389    0.151240</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="apply-a-list-of-name-function-tuples-as-the-column-names">6.2.2. apply a list of (name, function) tuples as the column names</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">grouped</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">].</span><span class="nf">agg</span><span class="p">([(</span><span class="sh">"</span><span class="s">average</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">stdev</span><span class="sh">"</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">std</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">peak</span><span class="sh">"</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nf">min</span><span class="p">())])</span>
<span class="c1">#               average     stdev      peak
# day  smoker
# Fri  No      0.151650  0.028123  0.067349
#      Yes     0.174783  0.051293  0.159925
# Sat  No      0.158048  0.039767  0.235193
#      Yes     0.147906  0.061375  0.290095
# Sun  No      0.160113  0.042347  0.193226
#      Yes     0.187250  0.154134  0.644685
# Thur No      0.160298  0.038774  0.193350
#      Yes     0.163863  0.039389  0.151240</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="apply-a-list-of-functions-to-all-of-the-columns-or-different-functions-per-column">6.2.3. apply a list of functions to all of the columns or different functions per column</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">grouped</span><span class="p">[[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">total_bill</span><span class="sh">"</span><span class="p">]].</span><span class="nf">agg</span><span class="p">([</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#             tip_pct                     total_bill
#               count       min       max      count    min    max
# day  smoker
# Fri  No           4  0.120385  0.187735          4  12.46  22.75
#      Yes         15  0.103555  0.263480         15   5.75  40.17
# Sat  No          45  0.056797  0.291990         45   7.25  48.33
#      Yes         42  0.035638  0.325733         42   3.07  50.81
# Sun  No          57  0.059447  0.252672         57   8.77  48.17
#      Yes         19  0.065660  0.710345         19   7.25  45.35
# Thur No          45  0.072961  0.266312         45   7.51  41.19
#      Yes         17  0.090014  0.241255         17  10.34  43.11
</span><span class="n">grouped</span><span class="p">.</span><span class="nf">agg</span><span class="p">({</span><span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">max</span><span class="p">(),</span> <span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">sum</span><span class="sh">"</span><span class="p">})</span>
<span class="c1">#                tip  size
# day  smoker
# Fri  No       3.50     9
#      Yes      4.73    31
# Sat  No       9.00   115
#      Yes     10.00   104
# Sun  No       6.00   167
#      Yes      6.50    49
# Thur No       6.70   112
#      Yes      5.00    40</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="apply-a-sql-style-aggregation-without-row-indexes">6.2.4. apply a sql-style aggregation without row indexes</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tips</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># SQL style: as_index=False
#     day smoker  total_bill       tip      size   tip_pct
# 0   Fri     No   18.420000  2.812500  2.250000  0.151650
# 1   Fri    Yes   16.813333  2.714000  2.066667  0.174783
# 2   Sat     No   19.661778  3.102889  2.555556  0.158048
# 3   Sat    Yes   21.276667  2.875476  2.476190  0.147906
# 4   Sun     No   20.506667  3.167895  2.929825  0.160113
# 5   Sun    Yes   24.120000  3.516842  2.578947  0.187250
# 6  Thur     No   17.113111  2.673778  2.488889  0.160298
# 7  Thur    Yes   19.190588  3.030000  2.352941  0.163863</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apply-general-split-apply-combine">6.3. Apply: General split-apply-combine</h3>
<div class="ulist">
<ul>
<li>
<p><code>apply</code> splits the object being manipulated into pieces, invokes the passed function on each piece, and then attempts to concatenate the pieces</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">top</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">:</span> <span class="n">df</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[:</span><span class="n">n</span><span class="p">]</span>
<span class="nf">top</span><span class="p">(</span><span class="n">tips</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="c1">#      total_bill   tip smoker  day    time  size   tip_pct
# 172        7.25  5.15    Yes  Sun  Dinner     2  2.452381
# 178        9.60  4.00    Yes  Sun  Dinner     2  0.714286
# 67         3.07  1.00    Yes  Sat  Dinner     1  0.483092
# 232       11.61  3.39     No  Sat  Dinner     2  0.412409
# 183       23.17  6.50    Yes  Sun  Dinner     4  0.389922
# 109       14.31  4.00    Yes  Sat  Dinner     2  0.387973</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># apply the `top` function on each group
# combine the results of each function call together using `pandas.concat`
# label the pieces with the group names with a hierarchical index
</span><span class="n">tips</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">include_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1">#             total_bill   tip   day    time  size   tip_pct
# smoker
# No     232       11.61  3.39   Sat  Dinner     2  0.412409
#        149        7.51  2.00  Thur   Lunch     2  0.362976
#        51        10.29  2.60   Sun  Dinner     2  0.338101
#        185       20.69  5.00   Sun  Dinner     5  0.318674
#        88        24.71  5.85  Thur   Lunch     2  0.310180
# Yes    172        7.25  5.15   Sun  Dinner     2  2.452381
#        178        9.60  4.00   Sun  Dinner     2  0.714286
#        67         3.07  1.00   Sat  Dinner     1  0.483092
#        183       23.17  6.50   Sun  Dinner     4  0.389922
#        109       14.31  4.00   Sat  Dinner     2  0.387973
</span>
<span class="c1"># apply a function that takes other arguments or keywords
</span><span class="n">tips</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">,</span> <span class="n">include_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1">#             total_bill    tip  day    time  size   tip_pct
# smoker
# No     212       48.33   9.00  Sat  Dinner     4  0.228833
#        23        39.42   7.58  Sat  Dinner     4  0.238065
#        59        48.27   6.73  Sat  Dinner     4  0.162013
# Yes    170       50.81  10.00  Sat  Dinner     3  0.245038
#        183       23.17   6.50  Sun  Dinner     4  0.389922
#        214       28.17   6.50  Sat  Dinner     3  0.299954
</span>
<span class="c1"># apply a function like `describe`
</span><span class="n">tips</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">]).</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">describe</span><span class="p">(),</span> <span class="n">include_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1">#                    total_bill       tip  size   tip_pct
# smoker day
# No     Fri  count    4.000000  4.000000  4.00  4.000000
#             mean    18.420000  2.812500  2.25  0.179740
#             std      5.059282  0.898494  0.50  0.039458
#             min     12.460000  1.500000  2.00  0.136861
#             25%     15.100000  2.625000  2.00  0.159215
# ...                       ...       ...   ...       ...
# Yes    Thur min     10.340000  2.000000  2.00  0.098918
#             25%     13.510000  2.000000  2.00  0.173762
#             50%     16.470000  2.560000  2.00  0.181818
#             75%     19.810000  4.000000  2.00  0.241984
#             max     43.110000  5.000000  4.00  0.317965
#
# [64 rows x 4 columns]</span></code></pre>
</div>
</div>
</li>
<li>
<p>remove the group keys for the results</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tips</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">include_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>                    <span class="c1"># group_keys=True
#             total_bill   tip   day    time  size   tip_pct
# smoker
# No     232       11.61  3.39   Sat  Dinner     2  0.291990
#        149        7.51  2.00  Thur   Lunch     2  0.266312
#        51        10.29  2.60   Sun  Dinner     2  0.252672
#        185       20.69  5.00   Sun  Dinner     5  0.241663
#        88        24.71  5.85  Thur   Lunch     2  0.236746
# Yes    172        7.25  5.15   Sun  Dinner     2  0.710345
#        178        9.60  4.00   Sun  Dinner     2  0.416667
#        67         3.07  1.00   Sat  Dinner     1  0.325733
#        183       23.17  6.50   Sun  Dinner     4  0.280535
#        109       14.31  4.00   Sat  Dinner     2  0.279525
</span>
<span class="n">tips</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">include_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># group_keys=False
#      total_bill   tip   day    time  size   tip_pct
# 232       11.61  3.39   Sat  Dinner     2  0.412409
# 149        7.51  2.00  Thur   Lunch     2  0.362976
# 51        10.29  2.60   Sun  Dinner     2  0.338101
# 185       20.69  5.00   Sun  Dinner     5  0.318674
# 88        24.71  5.85  Thur   Lunch     2  0.310180
# 172        7.25  5.15   Sun  Dinner     2  2.452381
# 178        9.60  4.00   Sun  Dinner     2  0.714286
# 67         3.07  1.00   Sat  Dinner     1  0.483092
# 183       23.17  6.50   Sun  Dinner     4  0.389922
# 109       14.31  4.00   Sat  Dinner     2  0.387973</span></code></pre>
</div>
</div>
</li>
<li>
<p>quantile and bucket analysis</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="sh">"</span><span class="s">data2</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">1000</span><span class="p">)}</span>
<span class="p">)</span>
<span class="n">stats</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">min</span><span class="p">(),</span> <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">max</span><span class="p">(),</span> <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">count</span><span class="p">(),</span> <span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">mean</span><span class="p">()})</span>

<span class="n">quartiles</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">cut</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">quartiles</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
<span class="c1">#                              min       max  count      mean
# data1
# (-3.178, -1.488] data1 -3.171336 -1.496146     58 -1.875128
#                  data2 -2.040919  3.687331     58  0.225945
# (-1.488, 0.195]  data1 -1.488242  0.193295    516 -0.524040
#                  data2 -2.887477  2.946888    516 -0.045822
# (0.195, 1.878]   data1  0.208000  1.875157    393  0.811104
#                  data2 -3.066116  2.567213    393  0.119729
# (1.878, 3.561]   data1  1.888199  3.560975     33  2.283037
#                  data2 -2.094342  1.893865     33  0.009781
</span>
<span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">quartiles</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">agg</span><span class="p">([</span><span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># equivalent
#                      data1                               data2
#                        min       max count      mean       min       max count      mean
# data1
# (-3.178, -1.488] -3.171336 -1.496146    58 -1.875128 -2.040919  3.687331    58  0.225945
# (-1.488, 0.195]  -1.488242  0.193295   516 -0.524040 -2.887477  2.946888   516 -0.045822
# (0.195, 1.878]    0.208000  1.875157   393  0.811104 -3.066116  2.567213   393  0.119729
# (1.878, 3.561]    1.888199  3.560975    33  2.283037 -2.094342  1.893865    33  0.009781
</span>
<span class="n">quartiles_samp</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">quartiles_samp</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
<span class="c1">#               min       max  count      mean
# 0 data1 -3.171336 -0.664742    250 -1.223014
#   data2 -2.887477  3.687331    250  0.016059
# 1 data1 -0.655842 -0.005734    250 -0.324734
#   data2 -2.667193  2.946888    250 -0.042407
# 2 data1  0.001768  0.683123    250  0.329009
#   data2 -2.674011  2.618537    250  0.083003
# 3 data1  0.683490  3.560975    250  1.278506
#   data2 -3.066116  2.279426    250  0.090694
</span>
<span class="n">quartiles_samp</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="sh">"</span><span class="s">data1</span><span class="sh">"</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">quartiles_samp</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
<span class="c1">#                   min       max  count      mean
# data1
# 0     data1 -3.171336 -0.664742    250 -1.223014
#       data2 -2.887477  3.687331    250  0.016059
# 1     data1 -0.655842 -0.005734    250 -0.324734
#       data2 -2.667193  2.946888    250 -0.042407
# 2     data1  0.001768  0.683123    250  0.329009
#       data2 -2.674011  2.618537    250  0.083003
# 3     data1  0.683490  3.560975    250  1.278506
#       data2 -3.066116  2.279426    250  0.090694</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="group-transforms-and-unwrapped-groupbys">6.4. Group Transforms and Unwrapped GroupBys</h3>
<div class="ulist">
<ul>
<li>
<p><code>transform</code> is another built-in method that produces either a scalar value (broadcast to the group&#8217;s shape) or an object matching the input group&#8217;s shape.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mf">12.0</span><span class="p">)})</span>
<span class="c1">#    key  value
# 0    a    0.0
# 1    b    1.0
# 2    c    2.0
# 3    a    3.0
# 4    b    4.0
# 5    c    5.0
# 6    a    6.0
# 7    b    7.0
# 8    c    8.0
# 9    a    9.0
# 10   b   10.0
# 11   c   11.0
</span><span class="n">g</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">g</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1">#      value
# key
# a      4.5
# b      5.5
# c      6.5
</span><span class="n">g</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># produce a scalar value to broadcast to the group shape
#     value
# 0     4.5
# 1     5.5
# 2     6.5
# 3     4.5
# 4     5.5
# 5     6.5
# 6     4.5
# 7     5.5
# 8     6.5
# 9     4.5
# 10    5.5
# 11    6.5
</span><span class="n">g</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>  <span class="c1"># produce an object matching the input group shape
#     value
# 0     4.0
# 1     4.0
# 2     4.0
# 3     3.0
# 4     3.0
# 5     3.0
# 6     2.0
# 7     2.0
# 8     2.0
# 9     1.0
# 10    1.0
# 11    1.0
</span>
<span class="n">normalize</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nf">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">x</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span>
<span class="n">g</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">normalize</span><span class="p">)</span>
<span class="c1">#        value
# 0  -1.161895
# 1  -1.161895
# 2  -1.161895
# 3  -0.387298
# 4  -0.387298
# 5  -0.387298
# 6   0.387298
# 7   0.387298
# 8   0.387298
# 9   1.161895
# 10  1.161895
# 11  1.161895
</span><span class="n">g</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">normalize</span><span class="p">)</span>
<span class="c1">#        value
# 0  -1.161895
# 1  -1.161895
# 2  -1.161895
# 3  -0.387298
# 4  -0.387298
# 5  -0.387298
# 6   0.387298
# 7   0.387298
# 8   0.387298
# 9   1.161895
# 10  1.161895
# 11  1.161895
</span>
<span class="c1"># unwrapped vectorized group operation: high efficiency, reduced readability
</span><span class="n">normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">]</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span> <span class="o">/</span> <span class="n">g</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="sh">"</span><span class="s">std</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># 0    -1.161895
# 1    -1.161895
# 2    -1.161895
# 3    -0.387298
# 4    -0.387298
# 5    -0.387298
# 6     0.387298
# 7     0.387298
# 8     0.387298
# 9     1.161895
# 10    1.161895
# 11    1.161895
# Name: value, dtype: float64</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="pivot-tables-and-cross-tabulation">6.5. Pivot Tables and Cross-Tabulation</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tips</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/examples/tips.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">total_bill</span><span class="sh">"</span><span class="p">]</span> <span class="o">-</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">])</span>
<span class="n">tips</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    total_bill   tip smoker  day    time  size   tip_pct
# 0       16.99  1.01     No  Sun  Dinner     2  0.063204
# 1       10.34  1.66     No  Sun  Dinner     3  0.191244
# 2       21.01  3.50     No  Sun  Dinner     3  0.199886
# 3       23.68  3.31     No  Sun  Dinner     2  0.162494
# 4       24.59  3.61     No  Sun  Dinner     4  0.172069</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>pivot table</em> is a data summarization tool, common in spreadsheet and analysis software, that aggregates data by keys into a rectangular grid with keys as rows and columns.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># compute a table of group means (by default) arranged by `day` and `smoker` on the rows
</span><span class="n">tips</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">total_bill</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#                  size       tip   tip_pct  total_bill
# day  smoker
# Fri  No      2.250000  2.812500  0.179740   18.420000
#      Yes     2.066667  2.714000  0.216293   16.813333
# Sat  No      2.555556  3.102889  0.190412   19.661778
#      Yes     2.476190  2.875476  0.179833   21.276667
# Sun  No      2.929825  3.167895  0.193617   20.506667
#      Yes     2.578947  3.516842  0.322021   24.120000
# Thur No      2.488889  2.673778  0.193424   17.113111
#      Yes     2.352941  3.030000  0.198508   19.190588
</span><span class="n">tips</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">])[[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">tip</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">total_bill</span><span class="sh">"</span><span class="p">]].</span><span class="nf">mean</span><span class="p">()</span> <span class="c1"># groupby
#                  size       tip   tip_pct  total_bill
# day  smoker
# Fri  No      2.250000  2.812500  0.179740   18.420000
#      Yes     2.066667  2.714000  0.216293   16.813333
# Sat  No      2.555556  3.102889  0.190412   19.661778
#      Yes     2.476190  2.875476  0.179833   21.276667
# Sun  No      2.929825  3.167895  0.193617   20.506667
#      Yes     2.578947  3.516842  0.322021   24.120000
# Thur No      2.488889  2.673778  0.193424   17.113111
#      Yes     2.352941  3.030000  0.198508   19.190588
</span>
<span class="c1"># take the average of only `tip_pct` and `size`, additionally group by `time`, and
# put `smoker` in the table columns and `time` and `day` in the rows
</span><span class="n">tips</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#                  size             tip_pct
# smoker             No       Yes        No       Yes
# time   day
# Dinner Fri   2.000000  2.222222  0.162612  0.202545
#        Sat   2.555556  2.476190  0.190412  0.179833
#        Sun   2.929825  2.578947  0.193617  0.322021
#        Thur  2.000000       NaN  0.190114       NaN
# Lunch  Fri   3.000000  1.833333  0.231125  0.236915
#        Thur  2.500000  2.352941  0.193499  0.198508
</span>
<span class="c1"># include partial totals by passing `margins=True` to add `All` row and column labels, with
# corresponding values being the group statistics for all the data within a single tier
</span><span class="n">tips</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">],</span> <span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#                  size                       tip_pct
# smoker             No       Yes       All        No       Yes       All
# time   day
# Dinner Fri   2.000000  2.222222  2.166667  0.162612  0.202545  0.192562
#        Sat   2.555556  2.476190  2.517241  0.190412  0.179833  0.185305
#        Sun   2.929825  2.578947  2.842105  0.193617  0.322021  0.225718
#        Thur  2.000000       NaN  2.000000  0.190114       NaN  0.190114
# Lunch  Fri   3.000000  1.833333  2.000000  0.231125  0.236915  0.236088
#        Thur  2.500000  2.352941  2.459016  0.193499  0.198508  0.194895
# All          2.668874  2.408602  2.569672  0.192237  0.218176  0.202123
</span>
<span class="c1"># specify an aggregation function other than `mean` with the `aggfunc` keyword argument
</span><span class="n">tips</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1">#               size            tip_pct
# smoker          No   Yes  All      No   Yes  All
# time   day
# Dinner Fri     3.0   9.0   12     3.0   9.0   12
#        Sat    45.0  42.0   87    45.0  42.0   87
#        Sun    57.0  19.0   76    57.0  19.0   76
#        Thur    1.0   NaN    1     1.0   NaN    1
# Lunch  Fri     1.0   6.0    7     1.0   6.0    7
#        Thur   44.0  17.0   61    44.0  17.0   61
# All          151.0  93.0  244   151.0  93.0  244
</span>
<span class="c1"># fill NA/NaN combinations by `fill_value`
</span><span class="n">tips</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># day                      Fri       Sat       Sun      Thur
# time   size smoker
# Dinner 1    No           NaN  0.160000       NaN       NaN
#             Yes          NaN  0.483092       NaN       NaN
#        2    No      0.162612  0.198319  0.206535  0.190114
#             Yes     0.211180  0.178877  0.400522       NaN
# ...                      ...       ...       ...       ...
# Lunch  4    No           NaN       NaN       NaN  0.161573
#             Yes          NaN       NaN       NaN  0.186592
#        5    No           NaN       NaN       NaN  0.138160
#        6    No           NaN       NaN       NaN  0.211191
#
# [21 rows x 4 columns]
</span><span class="n">tips</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">"</span><span class="s">tip_pct</span><span class="sh">"</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># day                      Fri       Sat       Sun      Thur
# time   size smoker
# Dinner 1    No      0.000000  0.160000  0.000000  0.000000
#             Yes     0.000000  0.483092  0.000000  0.000000
#        2    No      0.162612  0.198319  0.206535  0.190114
#             Yes     0.211180  0.178877  0.400522  0.000000
# ...                      ...       ...       ...       ...
# Lunch  4    No      0.000000  0.000000  0.000000  0.161573
#             Yes     0.000000  0.000000  0.000000  0.186592
#        5    No      0.000000  0.000000  0.000000  0.138160
#        6    No      0.000000  0.000000  0.000000  0.211191
#
# [21 rows x 4 columns]</span></code></pre>
</div>
</div>
</li>
<li>
<p>A <em>cross-tabulation</em>, or <em>crosstab</em>, is a specific type of pivot table that calculates the frequency of data points within different groups.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">pd</span><span class="p">.</span><span class="nf">crosstab</span><span class="p">([</span><span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">],</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">day</span><span class="sh">"</span><span class="p">]],</span> <span class="n">tips</span><span class="p">[</span><span class="sh">"</span><span class="s">smoker</span><span class="sh">"</span><span class="p">],</span> <span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># smoker        No  Yes  All
# time   day
# Dinner Fri     3    9   12
#        Sat    45   42   87
#        Sun    57   19   76
#        Thur    1    0    1
# Lunch  Fri     1    6    7
#        Thur   44   17   61
# All          151   93  244</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="window-operations">6.6. Window Operations</h3>
<div class="paragraph">
<p>A window operation in pandas is a data analysis tool that performs statistical calculations over a sliding or adaptive window by looking back from each observation point in an ordered sequence, enabling data smoothing and trend analysis.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pandas supports four types of windowing operations: <em>rolling windows</em> for sliding calculations, <em>weighted windows</em> for non-rectangular calculations, <em>expanding windows</em> for accumulating calculations, and <em>exponentially weighted windows</em> for weighted accumulating calculations.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># 0    0
# 1    1
# 2    2
# 3    3
# 4    4
# dtype: int64
</span>
<span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1"># 0    NaN
# 1    1.0
# 2    3.0
# 3    5.0
# 4    7.0
# dtype: float64
</span>
<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="c1"># 0    0
# dtype: int64
# 0    0
# 1    1
# dtype: int64
# 1    1
# 2    2
# dtype: int64
# 2    2
# 3    3
# dtype: int64
# 3    3
# 4    4
# dtype: int64
</span>
<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="c1"># 0    0
# dtype: int64
# 1    1
# 2    2
# dtype: int64
# 3    3
# 4    4
# dtype: int64</span></code></pre>
</div>
</div>
</li>
<li>
<p>All windowing operations require a minimum number of non-null values (specified by <code>min_periods</code>) to produce a result, defaulting to 1 for time-based windows and the window size for fixed windows, otherwise returning null (i.e. <code>na.nan</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1"># 0    0.0
# 1    1.0
# 2    3.0
# 3    5.0
# 4    7.0
# dtype: float64</span></code></pre>
</div>
</div>
</li>
<li>
<p>All windowing operations support the <code>aggregate</code> (alias <code>agg</code>) method to return multiple aggregation results.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">).</span><span class="nf">agg</span><span class="p">([</span><span class="sh">"</span><span class="s">sum</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">std</span><span class="sh">"</span><span class="p">])</span>
<span class="c1">#    sum  mean       std
# 0  NaN   NaN       NaN
# 1  1.0   0.5  0.707107
# 2  3.0   1.5  0.707107
# 3  5.0   2.5  0.707107
# 4  7.0   3.5  0.707107</span></code></pre>
</div>
</div>
</li>
<li>
<p>All windowing operations support the <code>apply</code> method to return custom aggregation results using user-defined functions.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">4</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">fabs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nf">mean</span><span class="p">()).</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># 0    NaN
# 1    NaN
# 2    NaN
# 3    1.0
# 4    1.0
# dtype: float64</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="rolling-window">6.6.1. Rolling Window</h4>
<div class="ulist">
<ul>
<li>
<p>A rolling window is a fixed or variable-sized window that can be specified by either a number of observations or a time-based offset, requiring a monotonic time index when using time-based offsets.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">2020-01-01</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">2020-01-03</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">2020-01-04</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">2020-01-05</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">2020-01-29</span><span class="sh">'</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nc">DatetimeIndex</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
<span class="c1"># 2020-01-01    0
# 2020-01-03    1
# 2020-01-04    2
# 2020-01-05    3
# 2020-01-29    4
# dtype: int64
</span>
<span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span>    <span class="c1"># window with 2 observations
# 2020-01-01    NaN
# 2020-01-03    1.0
# 2020-01-04    3.0
# 2020-01-05    5.0
# 2020-01-29    7.0
# dtype: float64
</span>
<span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="sh">"</span><span class="s">2D</span><span class="sh">"</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span> <span class="c1"># window with 2 days worth of observations
# 2020-01-01    0.0
# 2020-01-03    1.0
# 2020-01-04    3.0
# 2020-01-05    5.0
# 2020-01-29    4.0
# dtype: float64
</span>
<span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="sh">"</span><span class="s">2D</span><span class="sh">"</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">2</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1"># 2020-01-01    NaN
# 2020-01-03    NaN
# 2020-01-04    3.0
# 2020-01-05    5.0
# 2020-01-29    NaN
# dtype: float64</span></code></pre>
</div>
</div>
</li>
<li>
<p>By default the labels (index or column labels) are set to the right edge of the window, but a <code>center</code> keyword is available so the labels can be set at the center.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># 0    0
# 1    1
# 2    2
# 3    3
# 4    4
# dtype: int64
</span>
<span class="c1"># the window ends at the current observation, and for each position, it looks back 3 positions.
</span><span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
<span class="c1"># [0]
# [0, 1]
# [0, 1, 2]
# [1, 2, 3]
# [2, 3, 4]
</span>
<span class="c1"># the window is centered on the current observation, and for each position, it looks 1 position back and 1 position forward.
</span><span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
<span class="c1"># [0, 1]    (can't look back, so only forward)
# [0, 1, 2]
# [1, 2, 3]
# [2, 3, 4]
# [3, 4]    (can't look forward, so only back)</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="expanding-window">6.6.2. Expanding Window</h4>
<div class="ulist">
<ul>
<li>
<p>An expanding window is a special case of rolling window where the window size equals the length of available data, yielding the value of an aggregation statistic with all the data up to that point in time.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="c1">#    0
# 0  0
# 1  1
# 2  2
# 3  3
# 4  4
</span><span class="n">data</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1">#      0
# 0  0.0
# 1  0.5
# 2  1.0
# 3  1.5
# 4  2.0
</span><span class="n">data</span><span class="p">.</span><span class="nf">expanding</span><span class="p">(</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1">#      0
# 0  0.0
# 1  0.5
# 2  1.0
# 3  1.5
# 4  2.0</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="weighted-window">6.6.3. Weighted Window</h4>
<div class="ulist">
<ul>
<li>
<p>A weighted window is a rolling window that assigns different weights to observations within the window, where the weights are determined by a specific mathematical function (like Gaussian, Hann, or Hamming) to emphasize or de-emphasize certain data points in the calculation.</p>
</li>
<li>
<p>In pandas, weighted windows can be created in multiple ways: by specifying a <code>win_type</code> argument in <code>.rolling</code> that corresponds to a <code>scipy.signal</code> window function (commonly used in filtering and spectral estimation), or by using custom weights, exponential weights, or other mathematical functions.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># gaussian window
</span><span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="sh">"</span><span class="s">gaussian</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">(</span><span class="n">std</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># conda install scipy
# 0    NaN
# 1    NaN
# 2    1.0
# 3    2.0
# 4    3.0
# dtype: float64
</span>
<span class="c1"># custom weights
</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">weights</span><span class="p">))</span>
<span class="c1"># 0    NaN
# 1    NaN
# 2    1.5
# 3    2.5
# 4    3.5
# dtype: float64
</span>
<span class="c1"># linear weights (e.g., [0.1, 0.2, 0.3, 0.4])
</span><span class="n">s</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">4</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>

<span class="c1"># ewm (exponential weighted moving)
</span><span class="n">s</span><span class="p">.</span><span class="nf">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">3</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="n">s</span><span class="p">.</span><span class="nf">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="binary-window-functions">6.6.4. Binary Window Functions</h4>
<div class="paragraph">
<p>A binary window function is a specialized method within the <code>rolling()</code>, <code>expanding()</code>, or <code>ewm()</code> frameworks to compute relationship-based statistics—such as covariance (<code>cov</code>) and correlation (<code>corr</code>)—over a defined or adaptive window.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Covariance measures the direction of the linear relationship between two variables—positive for co-movement, negative for opposing movement—but its non-standardized value depends on the data&#8217;s scale.</p>
</li>
<li>
<p>Correlation quantifies both the strength and direction of a linear relationship between two variables with values from <code>-1</code> to <code>1</code>, providing a standardized and more easily interpretable measure than covariance.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="time-series">7. Time Series</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Time series data consists of sequentially recorded data points over time, which can be fixed or irregular in frequency, and is used to represent timestamps, fixed periods, intervals, or elapsed time across various fields.</p>
</div>
<div class="sect2">
<h3 id="date-and-time-types">7.1. Date and Time Types</h3>
<div class="ulist">
<ul>
<li>
<p>The Python standard library, such as <code>datetime</code>, <code>time</code>, and <code>calendar</code> modules, includes data types for date and time data, as well as calendar-related functionality.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">timezone</span>

<span class="kn">import</span> <span class="n">pytz</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
<span class="c1"># datetime.datetime(2022, 8, 12, 14, 9, 11, 337033)
</span><span class="n">now</span><span class="p">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now</span><span class="p">.</span><span class="n">month</span><span class="p">,</span> <span class="n">now</span><span class="p">.</span><span class="n">day</span>
<span class="c1"># (2022, 8, 12)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">delta</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="c1"># datetime.timedelta(days=926, seconds=56700)
</span><span class="n">delta</span><span class="p">.</span><span class="n">days</span><span class="p">,</span> <span class="n">delta</span><span class="p">.</span><span class="n">seconds</span>
<span class="c1"># (926, 56700)
</span>
<span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="nf">timedelta</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="c1"># datetime.datetime(2011, 1, 19, 0, 0)
</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="c1"># datetime.datetime(2011, 1, 19, 8, 45)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># tz-naive datetime
</span><span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
<span class="c1"># datetime.datetime(2024, 5, 29, 14, 38, 23, 755723)
</span><span class="n">now</span><span class="p">.</span><span class="nf">tzname</span><span class="p">(),</span> <span class="n">now</span><span class="p">.</span><span class="nf">utcoffset</span><span class="p">()</span>
<span class="c1"># (None, None)
</span>
<span class="c1"># local datetime
</span><span class="n">local_now</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="nf">astimezone</span><span class="p">()</span> <span class="c1"># datetime.now().astimezone()
# datetime.datetime(2024, 5, 29, 14, 38, 23, 755723, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), 'CST'))
</span><span class="n">local_now</span><span class="p">.</span><span class="nf">tzname</span><span class="p">(),</span> <span class="n">local_now</span><span class="p">.</span><span class="nf">utcoffset</span><span class="p">()</span>
<span class="c1"># ('CST', datetime.timedelta(seconds=28800))
</span>
<span class="c1"># a UTC datetime
</span><span class="n">utc_now</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="nf">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="p">.</span><span class="n">utc</span><span class="p">)</span> <span class="c1"># datetime.now(timezone.utc)
# datetime.datetime(2024, 5, 29, 6, 38, 23, 755723, tzinfo=datetime.timezone.utc)
</span><span class="n">utc_now</span><span class="p">.</span><span class="nf">tzname</span><span class="p">(),</span> <span class="n">utc_now</span><span class="p">.</span><span class="nf">utcoffset</span><span class="p">()</span>
<span class="c1"># ('UTC', datetime.timedelta(0))
</span>
<span class="c1"># a fixed offset from UTC
</span><span class="n">tz</span> <span class="o">=</span> <span class="nf">timezone</span><span class="p">(</span><span class="nf">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="n">now_tz</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="nf">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span> <span class="c1"># datetime.now(tz)
# datetime.datetime(2024, 5, 29, 14, 38, 23, 755723, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800)))
</span><span class="n">now_tz</span><span class="p">.</span><span class="nf">tzname</span><span class="p">(),</span> <span class="n">now_tz</span><span class="p">.</span><span class="nf">utcoffset</span><span class="p">().</span><span class="nf">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span>
<span class="c1"># ('UTC+08:00', 8.0)
</span>
<span class="c1"># a named time zone
</span><span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="p">.</span><span class="nf">timezone</span><span class="p">(</span><span class="sh">"</span><span class="s">Asia/Shanghai</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># pip install pytz
</span><span class="n">now_tz</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="nf">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span> <span class="c1"># datetime.now(tz)
# datetime.datetime(2024, 5, 29, 14, 38, 23, 755723, tzinfo=&lt;DstTzInfo 'Asia/Shanghai' CST+8:00:00 STD&gt;)
</span><span class="n">now_tz</span><span class="p">.</span><span class="nf">tzname</span><span class="p">(),</span> <span class="n">now_tz</span><span class="p">.</span><span class="nf">utcoffset</span><span class="p">()</span>
<span class="c1"># ('CST', datetime.timedelta(seconds=28800))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">stamp</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">stamp</span><span class="p">)</span>
<span class="c1"># '2011-01-03 00:00:00'
</span><span class="n">stamp</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># '2011-01-03'
</span>
<span class="n">value</span> <span class="o">=</span> <span class="sh">"</span><span class="s">2011-01-03</span><span class="sh">"</span>
<span class="n">datetime</span><span class="p">.</span><span class="nf">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="sh">"</span><span class="s">%Y-%m-%d</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># datetime.datetime(2011, 1, 3, 0, 0)
</span>
<span class="n">datestrs</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">7/6/2011</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">8/6/2011</span><span class="sh">"</span><span class="p">]</span>
<span class="p">[</span><span class="n">datetime</span><span class="p">.</span><span class="nf">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="sh">"</span><span class="s">%m/%d/%Y</span><span class="sh">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">datestrs</span><span class="p">]</span>
<span class="c1"># [datetime.datetime(2011, 7, 6, 0, 0), datetime.datetime(2011, 8, 6, 0, 0)]</span></code></pre>
</div>
</div>
</li>
<li>
<p>The pandas library offers a comprehensive suite of data types and functionalities specifically tailored for time series analysis, organized around four general concepts: date times (a specific date and time with timezone support), time deltas (an absolute time duration), time spans (a span of time defined by a point in time and its associated frequency), and date offsets (a relative time duration that respects calendar arithmetic).</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># date times: a specific date and time with timezone support.
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">2025-05-07 08:51:12 +0800</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2025-05-07 08:51:12+0800', tz='UTC+08:00')
</span><span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="sh">"</span><span class="s">2010/11/12</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2010-11-12 00:00:00')
</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
<span class="c1"># datetime.datetime(2024, 5, 20, 15, 32, 2, 656503)
</span>
<span class="n">np</span><span class="p">.</span><span class="nf">datetime64</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
<span class="c1"># np.datetime64('2024-05-20T15:11:30.645265')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
<span class="c1"># Timestamp('2024-05-20 15:11:30.645265')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="nf">astimezone</span><span class="p">())</span>
<span class="c1"># Timestamp('2024-05-20 15:32:02.656503+0800', tz='CST')</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">())</span>
<span class="c1"># Timestamp('2024-05-20 15:48:21.663001')
</span><span class="n">ts</span><span class="p">.</span><span class="nf">to_pydatetime</span><span class="p">()</span>
<span class="c1"># datetime.datetime(2024, 5, 20, 15, 48, 21, 663001)
</span><span class="n">ts</span><span class="p">.</span><span class="nf">to_datetime64</span><span class="p">()</span>
<span class="c1"># np.datetime64('2024-05-20T15:48:21.663001')
</span><span class="n">ts</span><span class="p">.</span><span class="nf">to_period</span><span class="p">(</span><span class="sh">"</span><span class="s">Y-JUN</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2024', 'Y-JUN')
</span>
<span class="n">ts_utc</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="nf">tz_localize</span><span class="p">(</span><span class="sh">"</span><span class="s">utc</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2024-05-20 15:48:21.663001+0000', tz='UTC')
</span>
<span class="n">ts_utc</span><span class="p">.</span><span class="nf">tz_convert</span><span class="p">(</span><span class="sh">"</span><span class="s">Europe/Moscow</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2024-05-20 18:48:21.663001+0300', tz='Europe/Moscow')</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">pd</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">.</span><span class="nb">min</span>
<span class="c1"># Timestamp('1677-09-21 00:12:43.145224193')
</span><span class="n">pd</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">.</span><span class="nb">max</span>
<span class="c1"># Timestamp('2262-04-11 23:47:16.854775807')</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># epoch timestamps: nanoseconds since the Unix epoch (January 1, 1970)
</span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">2024-05-20 15:32:02.656503+0800</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ns</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="n">value</span>
<span class="c1"># 1716190322656503000
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="sh">"</span><span class="s">UTC+08:00</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2024-05-20 15:32:02.656503+0800', tz='UTC+08:00')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="n">ns</span> <span class="o">//</span> <span class="mi">1_000</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="sh">"</span><span class="s">us</span><span class="sh">"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="sh">"</span><span class="s">UTC+08:00</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2024-05-20 15:32:02.656503+0800', tz='UTC+08:00')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="n">ns</span> <span class="o">//</span> <span class="mi">1_000_000</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="sh">"</span><span class="s">ms</span><span class="sh">"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="sh">"</span><span class="s">UTC+08:00</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2024-05-20 15:32:02.656000+0800', tz='UTC+08:00')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="n">ns</span> <span class="o">//</span> <span class="mi">1_000_000_000</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="sh">"</span><span class="s">s</span><span class="sh">"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="sh">"</span><span class="s">UTC+08:00</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2024-05-20 15:32:02+0800', tz='UTC+08:00')</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># time deltas: an absolute time duration.
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Timedelta</span><span class="p">(</span><span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
<span class="c1"># Timedelta('15 days 00:00:00')
</span><span class="n">td</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timedelta('1 days 00:00:00')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">2024-05-20T15:11:30.645265</span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="n">td</span>
<span class="c1"># Timestamp('2024-05-21 15:11:30.645265')</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># date offsets: a relative time duration that respects calendar arithmetic.
</span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">2016-10-30 00:00:00</span><span class="sh">"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="sh">"</span><span class="s">Europe/Helsinki</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ts</span><span class="p">.</span><span class="nf">dst</span><span class="p">()</span> <span class="c1"># datetime.timedelta(seconds=3600)
</span>
<span class="c1"># a Timedelta day adds 24 hours, while a DateOffset day adjusts for DST with the same time next day
</span><span class="n">ts</span> <span class="o">+</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># absolute time
# Timestamp('2016-10-30 23:00:00+0200', tz='Europe/Helsinki')
</span><span class="n">ts</span> <span class="o">+</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># calendar time
# Timestamp('2016-10-31 00:00:00+0200', tz='Europe/Helsinki')
</span>
<span class="n">friday</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">2018-01-05</span><span class="sh">"</span><span class="p">)</span>
<span class="n">friday</span><span class="p">.</span><span class="nf">day_name</span><span class="p">()</span>
<span class="c1"># 'Friday'
</span><span class="n">friday_2b</span> <span class="o">=</span> <span class="n">friday</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pd</span><span class="p">.</span><span class="n">offsets</span><span class="p">.</span><span class="nc">BDay</span><span class="p">()</span> <span class="c1"># plus two business days
# Timestamp('2018-01-09 00:00:00')
</span><span class="n">friday_2b</span><span class="p">.</span><span class="nf">day_name</span><span class="p">()</span>
<span class="c1"># 'Tuesday'
</span>
<span class="n">mb</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">offsets</span><span class="p">.</span><span class="nc">MonthBegin</span><span class="p">()</span>
<span class="n">mb</span><span class="p">.</span><span class="nf">rollforward</span><span class="p">(</span><span class="sh">"</span><span class="s">2025-01-15</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2025-02-01 00:00:00')
</span><span class="n">mb</span><span class="p">.</span><span class="nf">rollback</span><span class="p">(</span><span class="sh">"</span><span class="s">2025-01-15</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Timestamp('2025-01-01 00:00:00')
</span>
<span class="c1"># a number of string aliases are given to useful common time series frequencies
</span><span class="n">pd</span><span class="p">.</span><span class="n">offsets</span><span class="p">.</span><span class="nc">BusinessDay</span><span class="p">().</span><span class="n">name</span>
<span class="c1"># 'B'
</span><span class="n">pd</span><span class="p">.</span><span class="n">offsets</span><span class="p">.</span><span class="nc">BDay</span><span class="p">().</span><span class="n">name</span>
<span class="c1"># 'B'
</span><span class="n">pd</span><span class="p">.</span><span class="n">offsets</span><span class="p">.</span><span class="nc">MonthEnd</span><span class="p">().</span><span class="n">name</span>
<span class="c1"># 'ME'
</span><span class="n">pd</span><span class="p">.</span><span class="n">offsets</span><span class="p">.</span><span class="nc">Hour</span><span class="p">().</span><span class="n">name</span>
<span class="c1"># 'h'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># pandas represents null date times, time deltas, and time spans as NaT
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">NaT</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># NaT
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">NaT</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># NaT
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">())</span> <span class="o">-</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">NaT</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># NaT</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">tdi</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">([</span><span class="sh">"</span><span class="s">2025-05-07 08:51:12 +0800</span><span class="sh">"</span><span class="p">,</span> <span class="bp">None</span><span class="p">])</span>
<span class="c1"># DatetimeIndex(['2025-05-07 08:51:12+08:00', 'NaT'], dtype='datetime64[ns, UTC+08:00]', freq=None)
</span><span class="n">tdi</span><span class="p">.</span><span class="n">dtype</span> <span class="c1"># pandas stores timestamps using NumPy’s `datetime64` data type at the nanosecond resolution
# datetime64[ns, UTC+08:00]
</span><span class="n">dti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># scalar values from a DatetimeIndex are pandas Timestamp objects
# Timestamp('2024-05-20 15:32:02.656503+0800', tz='UTC+08:00')
</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2012-03-09 09:30</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2012-03-09 09:30:00', '2012-03-10 09:30:00',
#                '2012-03-11 09:30:00', '2012-03-12 09:30:00',
#                '2012-03-13 09:30:00', '2012-03-14 09:30:00'],
#               dtype='datetime64[ns]', freq='D')
</span>
<span class="c1"># localize a tz-naive date time index to a specific time zone
</span><span class="n">local_dates</span> <span class="o">=</span> <span class="n">dates</span><span class="p">.</span><span class="nf">tz_localize</span><span class="p">(</span><span class="sh">"</span><span class="s">Asia/Shanghai</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2012-03-09 09:30:00+08:00', '2012-03-10 09:30:00+08:00',
#                '2012-03-11 09:30:00+08:00', '2012-03-12 09:30:00+08:00',
#                '2012-03-13 09:30:00+08:00', '2012-03-14 09:30:00+08:00'],
#               dtype='datetime64[ns, Asia/Shanghai]', freq=None)
</span>
<span class="c1"># convert a date time index to another specific time zone
</span><span class="n">local_dates</span><span class="p">.</span><span class="nf">tz_convert</span><span class="p">(</span><span class="sh">"</span><span class="s">Europe/Berlin</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2012-03-09 02:30:00+01:00', '2012-03-10 02:30:00+01:00',
#                '2012-03-11 02:30:00+01:00', '2012-03-12 02:30:00+01:00',
#                '2012-03-13 02:30:00+01:00', '2012-03-14 02:30:00+01:00'],
#               dtype='datetime64[ns, Europe/Berlin]', freq=None)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<span class="c1"># 2012-03-09 09:30:00   -1.206441
# 2012-03-10 09:30:00    1.604368
# 2012-03-11 09:30:00   -1.453797
# 2012-03-12 09:30:00    0.507613
# 2012-03-13 09:30:00    2.178526
# 2012-03-14 09:30:00   -0.950722
# Freq: D, dtype: float64
</span><span class="nf">print</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">tz</span><span class="p">)</span>
<span class="c1"># None
</span>
<span class="c1"># localize a tz-naive time series to a specific time zone
</span><span class="n">ts_utc</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="nf">tz_localize</span><span class="p">(</span><span class="sh">"</span><span class="s">UTC</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ts_utc</span><span class="p">.</span><span class="n">index</span>
<span class="c1"># DatetimeIndex(['2012-03-09 09:30:00+00:00', '2012-03-10 09:30:00+00:00',
#                '2012-03-11 09:30:00+00:00', '2012-03-12 09:30:00+00:00',
#                '2012-03-13 09:30:00+00:00', '2012-03-14 09:30:00+00:00'],
#               dtype='datetime64[ns, UTC]', freq='D')
</span><span class="nf">print</span><span class="p">(</span><span class="n">ts_utc</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">tz</span><span class="p">)</span>
<span class="c1"># UTC
</span>
<span class="c1"># convert a time series to another specific time zone
</span><span class="n">ts_utc</span><span class="p">.</span><span class="nf">tz_convert</span><span class="p">(</span><span class="sh">"</span><span class="s">America/Los_Angeles</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 2012-03-09 01:30:00-08:00   -1.206441
# 2012-03-10 01:30:00-08:00    1.604368
# 2012-03-11 01:30:00-08:00   -1.453797
# 2012-03-12 02:30:00-07:00    0.507613
# 2012-03-13 02:30:00-07:00    2.178526
# 2012-03-14 02:30:00-07:00   -0.950722
# Freq: D, dtype: float64
</span>
<span class="c1"># two time series with different time zones are combined to be UTC
</span><span class="n">ts1</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[:</span><span class="mi">2</span><span class="p">].</span><span class="nf">tz_localize</span><span class="p">(</span><span class="sh">"</span><span class="s">Europe/London</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ts2</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="mi">2</span><span class="p">:].</span><span class="nf">tz_localize</span><span class="p">(</span><span class="sh">"</span><span class="s">Europe/Paris</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ts1</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">tz</span><span class="p">,</span> <span class="n">ts2</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">tz</span><span class="p">,</span> <span class="p">(</span><span class="n">ts1</span> <span class="o">+</span> <span class="n">ts2</span><span class="p">).</span><span class="n">index</span><span class="p">.</span><span class="n">tz</span>
<span class="c1"># (&lt;DstTzInfo 'Europe/London' LMT-1 day, 23:59:00 STD&gt;, &lt;DstTzInfo 'Europe/Paris' LMT+0:09:00 STD&gt;, datetime.timezone.utc)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># time spans: a span of time defined by a point in time and its associated frequency.
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2011-01</span><span class="sh">"</span><span class="p">)</span>           <span class="c1"># inferred from datetime string format
# Period('2011-01', 'M')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2011-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">)</span>      <span class="c1"># specified explicitly
# Period('2011-01', 'M')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2011-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># specified explicitly
# Period('2011-01-01', 'D')
</span>
<span class="c1"># a period represents a span of time (e.g., a day, a month, a quarter, etc)
</span><span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
<span class="c1"># datetime.datetime(2025, 5, 20, 8, 42, 2, 587839)
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="sh">"</span><span class="s">Y</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2025', 'Y-DEC')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="sh">"</span><span class="s">Q</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2025Q2', 'Q-DEC')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2025-05', 'M')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2025-05-20', 'D')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">).</span><span class="nf">to_timestamp</span><span class="p">()</span>
<span class="c1"># Timestamp('2025-05-20 08:42:00')
</span>
<span class="c1"># adding and subtracting integers from periods shifts the period by its own frequency
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2012</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1"># Period('2013', 'Y-DEC')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">PeriodIndex</span><span class="p">([</span><span class="sh">"</span><span class="s">2011-1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2011-2</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2011-3</span><span class="sh">"</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># PeriodIndex(['2011-01', '2011-02', '2011-03'], dtype='period[M]')
</span><span class="n">pd</span><span class="p">.</span><span class="nf">period_range</span><span class="p">(</span><span class="sh">"</span><span class="s">1/1/2011</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">1/1/2012</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># PeriodIndex(['2011-01', '2011-02', '2011-03', '2011-04', '2011-05', '2011-06',
#              '2011-07', '2011-08', '2011-09', '2011-10', '2011-11', '2011-12',
#              '2012-01'],
#             dtype='period[M]')
</span><span class="n">pd</span><span class="p">.</span><span class="nf">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="sh">"</span><span class="s">2014-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">3M</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># PeriodIndex(['2014-01', '2014-04', '2014-07', '2014-10'], dtype='period[3M]')
</span><span class="n">pd</span><span class="p">.</span><span class="nf">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="sh">"</span><span class="s">2014-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Q</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># PeriodIndex(['2014Q1', '2014Q2', '2014Q3', '2014Q4'], dtype='period[Q-DEC]')
</span>
<span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2012-01</span><span class="sh">"</span><span class="p">),</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2012-02</span><span class="sh">"</span><span class="p">),</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2012-03</span><span class="sh">"</span><span class="p">)]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">periods</span><span class="p">)</span>
<span class="c1"># 2012-01   -0.544439
# 2012-02   -0.478298
# 2012-03   -0.781469
# Freq: M, dtype: float64</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="indexing-selection-subsetting">7.2. Indexing, Selection, Subsetting</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">dates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
    <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># index using loc with a string date
</span><span class="n">ts</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="sh">"</span><span class="s">2011-01-02</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># np.float64(2.1940286611797526)
</span>
<span class="c1"># index using iloc with an integer index
</span><span class="n">ts</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># np.float64(2.1940286611797526)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># index with timestamp
</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Timestamp('2011-01-02 00:00:00')
</span><span class="n">ts</span><span class="p">[</span><span class="n">stamp</span><span class="p">]</span>
<span class="c1"># np.float64(2.1940286611797526)
</span>
<span class="c1"># slice with timestamp
</span><span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">ts</span><span class="p">[</span><span class="n">t1</span><span class="p">:</span><span class="n">t2</span><span class="p">]</span>
<span class="c1"># 2011-01-02    2.194029
# 2011-01-05    1.253080
# 2011-01-07    0.834581
# 2011-01-08    0.929077
# dtype: float64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># index with datetime object
</span><span class="n">ts</span><span class="p">[</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="c1"># np.float64(2.1940286611797526)
</span>
<span class="c1"># slice with datatime objects
</span><span class="n">ts</span><span class="p">[</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
<span class="c1"># 2011-01-07    0.834581
# 2011-01-08    0.929077
# 2011-01-10    1.993171
# dtype: float64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># index with string date
</span><span class="n">ts</span><span class="p">[</span><span class="sh">"</span><span class="s">2011-01-02</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># np.float64(2.1940286611797526)
</span>
<span class="c1"># slice with string dates
</span><span class="n">ts</span><span class="p">[</span><span class="sh">"</span><span class="s">2011-01-07</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">2011-01-10</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># 2011-01-07    0.834581
# 2011-01-08    0.929077
# 2011-01-10    1.993171
# dtype: float64
</span>
<span class="c1"># slice with string dates not contained in a time series
</span><span class="n">ts</span><span class="p">[</span><span class="sh">"</span><span class="s">2011-01-06</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">2011-01-11</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># 2011-01-07    0.834581
# 2011-01-08    0.929077
# 2011-01-10    1.993171
# dtype: float64
</span>
<span class="c1"># slice with specific year
</span><span class="n">ts</span><span class="p">[</span><span class="sh">"</span><span class="s">2011</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># 2011-01-02    2.194029
# 2011-01-05    1.253080
# 2011-01-07    0.834581
# 2011-01-08    0.929077
# 2011-01-10    1.993171
# 2011-01-12    0.847771
# dtype: float64
</span>
<span class="c1"># slice with specific month
</span><span class="n">ts</span><span class="p">[</span><span class="sh">"</span><span class="s">2011-01</span><span class="sh">"</span><span class="p">]</span>
<span class="c1"># 2011-01-02    2.194029
# 2011-01-05    1.253080
# 2011-01-07    0.834581
# 2011-01-08    0.929077
# 2011-01-10    1.993171
# 2011-01-12    0.847771
# dtype: float64</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="date-ranges-frequencies-and-shifting">7.3. Date Ranges, Frequencies, and Shifting</h3>
<div class="ulist">
<ul>
<li>
<p>By default, <code>pandas.date_range</code> generates daily timestamps.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2025-05-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2025-05-15</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2025-05-01', '2025-05-02', '2025-05-03', '2025-05-04',
#                '2025-05-05', '2025-05-06', '2025-05-07', '2025-05-08',
#                '2025-05-09', '2025-05-10', '2025-05-11', '2025-05-12',
#                '2025-05-13', '2025-05-14', '2025-05-15'],
#               dtype='datetime64[ns]', freq='D')
</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="sh">"</span><span class="s">2025-05-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2025-05-01', '2025-05-02', '2025-05-03', '2025-05-04',
#                '2025-05-05', '2025-05-06', '2025-05-07', '2025-05-08',
#                '2025-05-09', '2025-05-10', '2025-05-11', '2025-05-12',
#                '2025-05-13', '2025-05-14', '2025-05-15'],
#               dtype='datetime64[ns]', freq='D')
</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="sh">"</span><span class="s">2025-05-15</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2025-05-01', '2025-05-02', '2025-05-03', '2025-05-04',
#                '2025-05-05', '2025-05-06', '2025-05-07', '2025-05-08',
#                '2025-05-09', '2025-05-10', '2025-05-11', '2025-05-12',
#                '2025-05-13', '2025-05-14', '2025-05-15'],
#               dtype='datetime64[ns]', freq='D')</span></code></pre>
</div>
</div>
</li>
<li>
<p>By default, <code>pandas.date_range</code> preserves the time (if any) of the start or end timestamp.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2012-05-02 12:56:31</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2012-05-02 12:56:31', '2012-05-03 12:56:31',
#                '2012-05-04 12:56:31', '2012-05-05 12:56:31',
#                '2012-05-06 12:56:31'],
#               dtype='datetime64[ns]', freq='D')
</span>
<span class="c1"># normalize timestamps to midnight
</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2012-05-02 12:56:31</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2012-05-02', '2012-05-03', '2012-05-04', '2012-05-05',
#                '2012-05-06'],
#               dtype='datetime64[ns]', freq='D')</span></code></pre>
</div>
</div>
</li>
<li>
<p>Frequencies in pandas such as daily, monthly, or every 15 minutes, are composed of a base frequency that typically referred to by a string <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html#timeseries-offset-aliases">frequency alias</a>, like "D" for calendar daily, "ME" for monthly or "h" for hourly and a multiplier.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># for each base frequency, there is an object referred to as a date offset.
</span><span class="kn">from</span> <span class="n">pandas.tseries.offsets</span> <span class="kn">import</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">Minute</span>

<span class="nc">Hour</span><span class="p">()</span>      <span class="c1"># &lt;Hour&gt;
</span><span class="nc">Hour</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>     <span class="c1"># &lt;4 * Hours&gt;
</span><span class="mi">4</span> <span class="o">*</span> <span class="nc">Hour</span><span class="p">()</span>  <span class="c1"># &lt;4 * Hours&gt;
</span><span class="mi">2</span> <span class="o">*</span> <span class="nc">Hour</span><span class="p">()</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">*</span> <span class="nc">Minute</span><span class="p">()</span>  <span class="c1"># &lt;150 * Minutes&gt;
</span><span class="nc">Hour</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nc">Minute</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>        <span class="c1"># &lt;150 * Minutes&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2000-01-02 23:59</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="nc">Hour</span><span class="p">())</span>
<span class="c1"># DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 04:00:00',
#                '2000-01-01 08:00:00', '2000-01-01 12:00:00',
#                '2000-01-01 16:00:00', '2000-01-01 20:00:00',
#                '2000-01-02 00:00:00', '2000-01-02 04:00:00',
#                '2000-01-02 08:00:00', '2000-01-02 12:00:00',
#                '2000-01-02 16:00:00', '2000-01-02 20:00:00'],
#               dtype='datetime64[ns]', freq='4h')
#
</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2000-01-02 23:59</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">4h</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 04:00:00',
#                '2000-01-01 08:00:00', '2000-01-01 12:00:00',
#                '2000-01-01 16:00:00', '2000-01-01 20:00:00',
#                '2000-01-02 00:00:00', '2000-01-02 04:00:00',
#                '2000-01-02 08:00:00', '2000-01-02 12:00:00',
#                '2000-01-02 16:00:00', '2000-01-02 20:00:00'],
#               dtype='datetime64[ns]', freq='4h')
#
</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2000-01-02 23:59</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">4h30min</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 04:30:00',
#                '2000-01-01 09:00:00', '2000-01-01 13:30:00',
#                '2000-01-01 18:00:00', '2000-01-01 22:30:00',
#                '2000-01-02 03:00:00', '2000-01-02 07:30:00',
#                '2000-01-02 12:00:00', '2000-01-02 16:30:00',
#                '2000-01-02 21:00:00'],
#               dtype='datetime64[ns]', freq='270min')
</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2000-12-31</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">BME</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-28',
#                '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
#                '2000-09-29', '2000-10-31', '2000-11-30', '2000-12-29'],
#               dtype='datetime64[ns]', freq='BME')</span></code></pre>
</div>
</div>
</li>
<li>
<p>Shifting refers to moving data backward and forward through time.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">ME</span><span class="sh">"</span><span class="p">),</span>
<span class="p">)</span>
<span class="c1"># 2000-01-31    0.162140
# 2000-02-29    1.690547
# 2000-03-31   -2.413846
# 2000-04-30    0.558444
# Freq: ME, dtype: float64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># naive shifts leave the index unmodified, and discard data
</span><span class="n">ts</span><span class="p">.</span><span class="nf">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># 2000-01-31         NaN
# 2000-02-29         NaN
# 2000-03-31    0.162140
# 2000-04-30    1.690547
# Freq: ME, dtype: float64
</span><span class="n">ts</span><span class="p">.</span><span class="nf">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># 2000-01-31   -2.413846
# 2000-02-29    0.558444
# 2000-03-31         NaN
# 2000-04-30         NaN
# Freq: ME, dtype: float64
</span><span class="n">ts</span> <span class="o">/</span> <span class="n">ts</span><span class="p">.</span><span class="nf">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="c1"># 2000-01-31         NaN
# 2000-02-29    9.426449
# 2000-03-31   -2.427850
# 2000-04-30   -1.231350
# Freq: ME, dtype: float64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># shift with freq to advance the timestamps
</span><span class="n">ts</span><span class="p">.</span><span class="nf">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">ME</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 2000-03-31    0.162140
# 2000-04-30    1.690547
# 2000-05-31   -2.413846
# 2000-06-30    0.558444
# Freq: ME, dtype: float64
</span><span class="n">ts</span><span class="p">.</span><span class="nf">shift</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 2000-02-03    0.162140
# 2000-03-03    1.690547
# 2000-04-03   -2.413846
# 2000-05-03    0.558444
# dtype: float64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># shifting dates with offsets
</span><span class="kn">from</span> <span class="n">pandas.tseries.offsets</span> <span class="kn">import</span> <span class="n">Day</span><span class="p">,</span> <span class="n">MonthEnd</span>

<span class="n">now</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>

<span class="n">now</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nc">Day</span><span class="p">()</span>   <span class="c1"># Timestamp('2011-11-20 00:00:00')
</span><span class="mi">3</span> <span class="o">*</span> <span class="nc">Day</span><span class="p">()</span>         <span class="c1"># &lt;3 * Days&gt;
</span><span class="n">now</span> <span class="o">+</span> <span class="nc">MonthEnd</span><span class="p">()</span>  <span class="c1"># Timestamp('2011-11-30 00:00:00')
</span><span class="n">now</span> <span class="o">+</span> <span class="nc">MonthEnd</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Timestamp('2011-12-31 00:00:00')
</span>
<span class="n">offset</span> <span class="o">=</span> <span class="nc">MonthEnd</span><span class="p">()</span>     <span class="c1"># &lt;MonthEnd&gt;
</span><span class="n">offset</span><span class="p">.</span><span class="nf">rollforward</span><span class="p">(</span><span class="n">now</span><span class="p">)</span> <span class="c1"># Timestamp('2011-11-30 00:00:00')
</span><span class="n">offset</span><span class="p">.</span><span class="nf">rollback</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>    <span class="c1"># Timestamp('2011-10-31 00:00:00')
</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-15</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">4D</span><span class="sh">"</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">ts</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="nc">MonthEnd</span><span class="p">().</span><span class="n">rollforward</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1"># 2000-01-31   -0.729635
# 2000-02-29    0.582600
# 2000-03-31   -0.036413
# dtype: float64
</span><span class="n">ts</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">ME</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span> <span class="c1"># resample: an easier and faster way
# 2000-01-31   -0.729635
# 2000-02-29    0.582600
# 2000-03-31   -0.036413
# Freq: ME, dtype: float64</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="periods-and-period-arithmetic">7.4. Periods and Period Arithmetic</h3>
<div class="paragraph">
<p>Periods represent time spans, like days, months, quarters, or years, represented by the <code>pandas.Period</code> class data type, requiring a string or integer and a supported frequency <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html#period-aliases">period alias</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2011</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2011', 'Y-DEC')
</span>
<span class="n">p</span> <span class="o">+</span> <span class="mi">3</span>
<span class="c1"># Period('2014', 'Y-DEC')
</span><span class="n">p</span> <span class="o">-</span> <span class="mi">3</span>
<span class="c1"># Period('2008', 'Y-DEC')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2011</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2009</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># pandas._libs.tslibs.offsets.YearEnd
# &lt;2 * YearEnds: month=12&gt;
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2006</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">).</span><span class="nf">asfreq</span><span class="p">(</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2006-01', 'M')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2006</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">).</span><span class="nf">asfreq</span><span class="p">(</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2006-12', 'M')
</span>
<span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2011</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-JUN</span><span class="sh">"</span><span class="p">).</span><span class="nf">asfreq</span><span class="p">(</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2010-07', 'M')
</span><span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2011</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-JUN</span><span class="sh">"</span><span class="p">).</span><span class="nf">asfreq</span><span class="p">(</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2011-06', 'M')
</span>
<span class="n">tpi</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">period_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2006</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># PeriodIndex(['2006', '2007', '2008', '2009'], dtype='period[Y-DEC]')
</span><span class="n">tpi</span><span class="p">.</span><span class="nf">asfreq</span><span class="p">(</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># PeriodIndex(['2006-01', '2007-01', '2008-01', '2009-01'], dtype='period[M]')
</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Period</span><span class="p">(</span><span class="sh">"</span><span class="s">2012</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Y-JAN</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># a fiscal year ending in January
# Period('2012', 'Y-JAN')
</span><span class="n">p</span><span class="p">.</span><span class="nf">asfreq</span><span class="p">(</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2011-02-01', 'D')
</span><span class="n">p</span><span class="p">.</span><span class="nf">asfreq</span><span class="p">(</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Period('2012-01-31', 'D')
</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">ME</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<span class="c1"># 2000-01-31    1.635092
# 2000-02-29    0.050582
# 2000-03-31   -0.825711
# Freq: ME, dtype: float64
</span><span class="n">ts</span><span class="p">.</span><span class="nf">to_period</span><span class="p">()</span>  <span class="c1"># inferred as 'M'
# 2000-01    1.635092
# 2000-02    0.050582
# 2000-03   -0.825711
# Freq: M, dtype: float64
</span>
<span class="n">pts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="nf">to_period</span><span class="p">(</span><span class="sh">"</span><span class="s">Q-DEC</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 2000Q1    1.635092
# 2000Q1    0.050582
# 2000Q1   -0.825711
# Freq: Q-DEC, dtype: float64
</span>
<span class="n">pts</span><span class="p">.</span><span class="nf">to_timestamp</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 2000-01-31    1.635092
# 2000-01-31    0.050582
# 2000-01-31   -0.825711
# dtype: float64
</span><span class="n">pts</span><span class="p">.</span><span class="nf">to_timestamp</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 2000-03-31 23:59:59.999999999    1.635092
# 2000-03-31 23:59:59.999999999    0.050582
# 2000-03-31 23:59:59.999999999   -0.825711
# dtype: float64
</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/examples/macrodata.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">data</span><span class="p">[[</span><span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">quarter</span><span class="sh">"</span><span class="p">]].</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#    year  quarter
# 0  1959        1
# 1  1959        2
# 2  1959        3
# 3  1959        4
# 4  1960        1
</span><span class="n">pd</span><span class="p">.</span><span class="n">PeriodIndex</span><span class="p">.</span><span class="nf">from_fields</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">year</span><span class="sh">"</span><span class="p">],</span> <span class="n">quarter</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">quarter</span><span class="sh">"</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">Q-DEC</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># PeriodIndex(['1959Q1', '1959Q2', '1959Q3', '1959Q4', '1960Q1', '1960Q2',
#              '1960Q3', '1960Q4', '1961Q1', '1961Q2',
#              ...
#              '2007Q2', '2007Q3', '2007Q4', '2008Q1', '2008Q2', '2008Q3',
#              '2008Q4', '2009Q1', '2009Q2', '2009Q3'],
#             dtype='period[Q-DEC]', length=203)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resampling-and-frequency-conversion">7.5. Resampling and Frequency Conversion</h3>
<div class="ulist">
<ul>
<li>
<p>The <code>resample</code> method in pandas is the primary tool for performing resampling operations during frequency conversion, functioning as a time-based <code>groupby</code> followed by a reduction method on its groups.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<span class="c1"># 2000-01-01   -2.360643
# 2000-01-02   -0.453989
# 2000-01-03   -0.030482
# 2000-01-04    0.331564
# 2000-01-05    0.899450
#                 ...
# 2000-04-05   -0.658839
# 2000-04-06   -0.632787
# 2000-04-07   -1.112433
# 2000-04-08   -0.274477
# 2000-04-09    0.262441
# Freq: D, Length: 100, dtype: float64
</span>
<span class="n">ts</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">ME</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1"># 2000-01-31   -0.218753
# 2000-02-29    0.293163
# 2000-03-31    0.148025
# 2000-04-30   -0.040589
# Freq: ME, dtype: float64
</span>
<span class="n">ts</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">ME</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">().</span><span class="nf">to_period</span><span class="p">(</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># 2000-01   -0.218753
# 2000-02    0.293163
# 2000-03    0.148025
# 2000-04   -0.040589
# Freq: M, dtype: float64
</span>
<span class="n">ts</span><span class="p">.</span><span class="nf">to_period</span><span class="p">(</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">).</span><span class="nf">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1"># 2000-01   -0.218753
# 2000-02    0.293163
# 2000-03    0.148025
# 2000-04   -0.040589
# Freq: M, dtype: float64</span></code></pre>
</div>
</div>
</li>
<li>
<p>Downsampling aggregates data into lower frequency intervals (like daily to monthly), where each data point belongs to exactly one interval, and the process requires careful consideration of which interval boundary to include (<code>closed</code>) and whether to <code>label</code> the result with the interval&#8217;s start or end time.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<span class="c1"># 2000-01-01 00:00:00     0
# 2000-01-01 00:01:00     1
# 2000-01-01 00:02:00     2
# 2000-01-01 00:03:00     3
# 2000-01-01 00:04:00     4
# 2000-01-01 00:05:00     5
# 2000-01-01 00:06:00     6
# 2000-01-01 00:07:00     7
# 2000-01-01 00:08:00     8
# 2000-01-01 00:09:00     9
# 2000-01-01 00:10:00    10
# 2000-01-01 00:11:00    11
# Freq: min, dtype: int64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># by default, each bin includes its left edge and is labeled with its start time
</span><span class="n">rs</span><span class="p">.</span><span class="n">closed</span><span class="p">,</span> <span class="n">rs</span><span class="p">.</span><span class="n">label</span>
<span class="p">(</span><span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">)</span>
<span class="n">rs</span><span class="p">.</span><span class="n">binner</span>
<span class="c1"># DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 00:05:00',
#                '2000-01-01 00:10:00', '2000-01-01 00:15:00'],
#               dtype='datetime64[ns]', freq='5min')
</span><span class="n">rs</span><span class="p">.</span><span class="n">indices</span>
<span class="c1"># defaultdict(list,
#             {Timestamp('2000-01-01 00:00:00'): [0, 1, 2, 3, 4],
#              Timestamp('2000-01-01 00:05:00'): [5, 6, 7, 8, 9],
#              Timestamp('2000-01-01 00:10:00'): [10, 11]})
</span><span class="n">rs</span><span class="p">.</span><span class="n">groups</span>
<span class="c1"># {Timestamp('2000-01-01 00:00:00'): np.int64(5),
#  Timestamp('2000-01-01 00:05:00'): np.int64(10),
#  Timestamp('2000-01-01 00:10:00'): np.int64(12)}
</span><span class="n">rs</span><span class="p">.</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1"># 2000-01-01 00:00:00    10
# 2000-01-01 00:05:00    35
# 2000-01-01 00:10:00    21
# Freq: 5min, dtype: int64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">rs</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">5min</span><span class="sh">"</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="sh">"</span><span class="s">right</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">right</span><span class="sh">"</span><span class="p">)</span>
<span class="n">rs</span><span class="p">.</span><span class="n">closed</span><span class="p">,</span> <span class="n">rs</span><span class="p">.</span><span class="n">label</span>
<span class="c1"># ('right', 'right')
</span><span class="n">rs</span><span class="p">.</span><span class="n">binner</span>
<span class="c1"># DatetimeIndex(['1999-12-31 23:55:00', '2000-01-01 00:00:00',
#                '2000-01-01 00:05:00', '2000-01-01 00:10:00',
#                '2000-01-01 00:15:00'],
#               dtype='datetime64[ns]', freq='5min')
</span><span class="n">rs</span><span class="p">.</span><span class="n">indices</span>
<span class="c1"># defaultdict(list,
#             {Timestamp('2000-01-01 00:00:00'): [0],
#              Timestamp('2000-01-01 00:05:00'): [1, 2, 3, 4, 5],
#              Timestamp('2000-01-01 00:10:00'): [6, 7, 8, 9, 10],
#              Timestamp('2000-01-01 00:15:00'): [11]})
</span><span class="n">rs</span><span class="p">.</span><span class="n">groups</span>
<span class="c1"># {Timestamp('2000-01-01 00:00:00'): np.int64(1),
#  Timestamp('2000-01-01 00:05:00'): np.int64(6),
#  Timestamp('2000-01-01 00:10:00'): np.int64(11),
#  Timestamp('2000-01-01 00:15:00'): np.int64(12)}
</span><span class="n">rs</span><span class="p">.</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1"># 2000-01-01 00:00:00     0
# 2000-01-01 00:05:00    15
# 2000-01-01 00:10:00    40
# 2000-01-01 00:15:00    11
# Freq: 5min, dtype: int64</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># open-high-low-close (OHLC) resampling
</span><span class="n">ts</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">5min</span><span class="sh">"</span><span class="p">).</span><span class="nf">ohlc</span><span class="p">()</span>
<span class="c1">#                      open  high  low  close
# 2000-01-01 00:00:00     0     4    0      4
# 2000-01-01 00:05:00     5     9    5      9
# 2000-01-01 00:10:00    10    11   10     11</span></code></pre>
</div>
</div>
</li>
<li>
<p>Upsampling is converting from a lower frequency to a higher frequency (e.g., monthly to daily), where no aggregation is needed.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">W-WED</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1">#             Colorado     Texas  New York      Ohio
# 2000-01-05 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-12 -0.672536 -0.385764 -0.291828 -0.132960
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">).</span><span class="nf">asfreq</span><span class="p">()</span>
<span class="c1">#             Colorado     Texas  New York      Ohio
# 2000-01-05 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-06       NaN       NaN       NaN       NaN
# 2000-01-07       NaN       NaN       NaN       NaN
# 2000-01-08       NaN       NaN       NaN       NaN
# 2000-01-09       NaN       NaN       NaN       NaN
# 2000-01-10       NaN       NaN       NaN       NaN
# 2000-01-11       NaN       NaN       NaN       NaN
# 2000-01-12 -0.672536 -0.385764 -0.291828 -0.132960
</span><span class="n">data</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">).</span><span class="nf">ffill</span><span class="p">()</span>
<span class="c1">#             Colorado     Texas  New York      Ohio
# 2000-01-05 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-06 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-07 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-08 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-09 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-10 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-11 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-12 -0.672536 -0.385764 -0.291828 -0.132960
</span><span class="n">data</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">).</span><span class="nf">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#             Colorado     Texas  New York      Ohio
# 2000-01-05 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-06 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-07 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-08       NaN       NaN       NaN       NaN
# 2000-01-09       NaN       NaN       NaN       NaN
# 2000-01-10       NaN       NaN       NaN       NaN
# 2000-01-11       NaN       NaN       NaN       NaN
# 2000-01-12 -0.672536 -0.385764 -0.291828 -0.132960
</span>
<span class="n">data</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">W-THU</span><span class="sh">"</span><span class="p">).</span><span class="nf">asfreq</span><span class="p">()</span>
<span class="c1">#             Colorado  Texas  New York  Ohio
# 2000-01-06       NaN    NaN       NaN   NaN
# 2000-01-13       NaN    NaN       NaN   NaN
</span><span class="n">data</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">W-THU</span><span class="sh">"</span><span class="p">).</span><span class="nf">ffill</span><span class="p">()</span>
<span class="c1">#             Colorado     Texas  New York      Ohio
# 2000-01-06 -0.538076 -1.057339  0.181577 -0.716948
# 2000-01-13 -0.672536 -0.385764 -0.291828 -0.132960
</span><span class="n">data</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">W-THU</span><span class="sh">"</span><span class="p">).</span><span class="nf">bfill</span><span class="p">()</span>
<span class="c1">#             Colorado     Texas  New York     Ohio
# 2000-01-06 -0.672536 -0.385764 -0.291828 -0.13296
# 2000-01-13       NaN       NaN       NaN      NaN</span></code></pre>
</div>
</div>
</li>
<li>
<p>Resampling data indexed by periods.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">standard_normal</span><span class="p">((</span><span class="mi">24</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nf">period_range</span><span class="p">(</span><span class="sh">"</span><span class="s">1-2000</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">12-2001</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Colorado</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Texas</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ohio</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#          Colorado     Texas  New York      Ohio
# 2000-01 -1.318496 -1.731395  0.782337  0.310808
# 2000-02  1.384605  1.210093  0.265278 -0.936725
# 2000-03 -0.743702  1.604631  0.011729  0.039290
# 2000-04  1.461097  0.047567 -1.117273  0.268163
# 2000-05  1.572309 -0.068589 -1.911431  0.160430
</span>
<span class="c1"># 1. converts the PeriodIndex to DatetimeIndex
# 2. performs the resampling on the DatetimeIndex
# 3. calculates the mean for each year
# 4. converts back to PeriodIndex if needed
</span><span class="n">adf</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">to_timestamp</span><span class="p">().</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">YE-DEC</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">().</span><span class="nf">to_period</span><span class="p">(</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#       Colorado     Texas  New York      Ohio
# 2000  0.360182 -0.188067 -0.316574  0.151905
# 2001  0.059221 -0.199204  0.230402 -0.310169
</span>
<span class="c1"># use `asfreq()` instead of `resample()`
</span><span class="n">data</span><span class="p">.</span><span class="nf">asfreq</span><span class="p">(</span><span class="sh">"</span><span class="s">Y-DEC</span><span class="sh">"</span><span class="p">).</span><span class="nf">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="c1">#       Colorado     Texas  New York      Ohio
# 2000  0.360182 -0.188067 -0.316574  0.151905
# 2001  0.059221 -0.199204  0.230402 -0.310169
</span>
<span class="c1"># https://github.com/pandas-dev/pandas/issues/57033
# FutureWarning: Resampling with a PeriodIndex is deprecated. Cast index to DatetimeIndex before resampling instead.
</span><span class="n">adf</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">Q-DEC</span><span class="sh">"</span><span class="p">).</span><span class="nf">ffill</span><span class="p">()</span>
<span class="c1">#         Colorado     Texas  New York      Ohio
# 2000Q1  0.360182 -0.188067 -0.316574  0.151905
# 2000Q2  0.360182 -0.188067 -0.316574  0.151905
# 2000Q3  0.360182 -0.188067 -0.316574  0.151905
# 2000Q4  0.360182 -0.188067 -0.316574  0.151905
# 2001Q1  0.059221 -0.199204  0.230402 -0.310169
# 2001Q2  0.059221 -0.199204  0.230402 -0.310169
# 2001Q3  0.059221 -0.199204  0.230402 -0.310169
# 2001Q4  0.059221 -0.199204  0.230402 -0.310169
</span>
<span class="n">adf</span><span class="p">.</span><span class="nf">to_timestamp</span><span class="p">().</span><span class="nf">reindex</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2000-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2001-12</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">ME</span><span class="sh">"</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="sh">"</span><span class="s">ffill</span><span class="sh">"</span>
<span class="p">).</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">QE-DEC</span><span class="sh">"</span><span class="p">).</span><span class="nf">ffill</span><span class="p">().</span><span class="nf">to_period</span><span class="p">(</span><span class="sh">"</span><span class="s">Q</span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#         Colorado     Texas  New York      Ohio
# 2000Q1  0.360182 -0.188067 -0.316574  0.151905
# 2000Q2  0.360182 -0.188067 -0.316574  0.151905
# 2000Q3  0.360182 -0.188067 -0.316574  0.151905
# 2000Q4  0.360182 -0.188067 -0.316574  0.151905
# 2001Q1  0.059221 -0.199204  0.230402 -0.310169
# 2001Q2  0.059221 -0.199204  0.230402 -0.310169
# 2001Q3  0.059221 -0.199204  0.230402 -0.310169
# 2001Q4  0.059221 -0.199204  0.230402 -0.310169</span></code></pre>
</div>
</div>
</li>
<li>
<p>For time series data, the <code>resample</code> method is semantically a group operation based on a time intervalization.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">N</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">"</span><span class="s">2017-05-20 00:00</span><span class="sh">"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">1min</span><span class="sh">"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">:</span> <span class="n">times</span><span class="p">.</span><span class="nf">repeat</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">tile</span><span class="p">([</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">],</span> <span class="n">N</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="mf">3.0</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">).</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">5min</span><span class="sh">"</span><span class="p">).</span><span class="nf">count</span><span class="p">()</span>
<span class="c1">#                      key  value
# time
# 2017-05-20 00:00:00   15     15
# 2017-05-20 00:05:00   15     15
# 2017-05-20 00:10:00   15     15
</span>
<span class="n">time_key</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">5min</span><span class="sh">"</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">).</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="n">time_key</span><span class="p">]).</span><span class="nf">sum</span><span class="p">()</span>
<span class="c1">#                          value
# key time
# a   2017-05-20 00:00:00   30.0
#     2017-05-20 00:05:00  105.0
#     2017-05-20 00:10:00  180.0
# b   2017-05-20 00:00:00   35.0
#     2017-05-20 00:05:00  110.0
#     2017-05-20 00:10:00  185.0
# c   2017-05-20 00:00:00   40.0
#     2017-05-20 00:05:00  115.0
#     2017-05-20 00:10:00  190.0</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="moving-window-functions">7.6. Moving Window Functions</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">close_px_all</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">https://raw.githubusercontent.com/wesm/pydata-book/refs/heads/3rd-edition/examples/stock_px.csv</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">close_px</span> <span class="o">=</span> <span class="n">close_px_all</span><span class="p">[[</span><span class="sh">"</span><span class="s">AAPL</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">MSFT</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">XOM</span><span class="sh">"</span><span class="p">]].</span><span class="nf">resample</span><span class="p">(</span><span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">).</span><span class="nf">ffill</span><span class="p">()</span>
<span class="n">close_px</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
<span class="c1">#             AAPL   MSFT    XOM
# 2003-01-02  7.40  21.11  29.22
# 2003-01-03  7.45  21.14  29.24
# 2003-01-06  7.45  21.52  29.96
# 2003-01-07  7.43  21.93  28.95
# 2003-01-08  7.28  21.31  28.83</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">close_px</span><span class="p">[</span><span class="sh">"</span><span class="s">AAPL</span><span class="sh">"</span><span class="p">].</span><span class="nf">plot</span><span class="p">()</span>
<span class="n">close_px</span><span class="p">[</span><span class="sh">"</span><span class="s">AAPL</span><span class="sh">"</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="mi">250</span><span class="p">).</span><span class="nf">mean</span><span class="p">().</span><span class="nf">plot</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/time-series/apple-price-with-250-day-moving-average.svg" alt="Apple price with 250-day moving average" width="25%" height="25%">
</div>
<div class="title">Figure 26. Apple price with 250-day moving average</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">std250</span> <span class="o">=</span> <span class="n">close_px</span><span class="p">[</span><span class="sh">"</span><span class="s">AAPL</span><span class="sh">"</span><span class="p">].</span><span class="nf">pct_change</span><span class="p">().</span><span class="nf">rolling</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">10</span><span class="p">).</span><span class="nf">std</span><span class="p">()</span>
<span class="n">std250</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
<span class="c1"># 2003-01-09         NaN
# 2003-01-10         NaN
# 2003-01-13         NaN
# 2003-01-14         NaN
# 2003-01-15         NaN
# 2003-01-16    0.009628
# 2003-01-17    0.013818
# Freq: B, Name: AAPL, dtype: float64
</span><span class="n">std250</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span>
<span class="n">std250</span><span class="p">.</span><span class="nf">expanding</span><span class="p">().</span><span class="nf">mean</span><span class="p">().</span><span class="nf">plot</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/time-series/apple-250-day-daily-return-standard-deviation.svg" alt="Apple 250-day daily return standard deviation" width="25%" height="25%">
</div>
<div class="title">Figure 27. Apple 250-day daily return standard deviation</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">"</span><span class="s">grayscale</span><span class="sh">"</span><span class="p">)</span>
<span class="n">close_px</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="sh">"</span><span class="s">60D</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">().</span><span class="nf">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/time-series/stock-prices-60-day-moving-average-log-y-axis.svg" alt="Stock prices 60-day moving average (log y-axis)" width="25%" height="25%">
</div>
<div class="title">Figure 28. Stock prices 60-day moving average (log y-axis),</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">aapl_px</span> <span class="o">=</span> <span class="n">close_px</span><span class="p">[</span><span class="sh">"</span><span class="s">AAPL</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">2006</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">2007</span><span class="sh">"</span><span class="p">]</span>
<span class="n">ma30</span> <span class="o">=</span> <span class="n">aapl_px</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">20</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="n">ewma30</span> <span class="o">=</span> <span class="n">aapl_px</span><span class="p">.</span><span class="nf">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">30</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="n">aapl_px</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">k-</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">Price</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ma30</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">k--</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">Simple Moving Avg</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ewma30</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">k-</span><span class="sh">"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">EW MA</span><span class="sh">"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/time-series/simple-moving-average-versus-exponentially-weighted.svg" alt="Simple moving average versus exponentially weighted" width="25%" height="25%">
</div>
<div class="title">Figure 29. Simple moving average versus exponentially weighted</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># binary moving window functions
</span><span class="n">spx_px</span> <span class="o">=</span> <span class="n">close_px_all</span><span class="p">[</span><span class="sh">"</span><span class="s">SPX</span><span class="sh">"</span><span class="p">]</span>
<span class="n">spx_rets</span> <span class="o">=</span> <span class="n">spx_px</span><span class="p">.</span><span class="nf">pct_change</span><span class="p">()</span>
<span class="n">returns</span> <span class="o">=</span> <span class="n">close_px</span><span class="p">.</span><span class="nf">pct_change</span><span class="p">()</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">returns</span><span class="p">[</span><span class="sh">"</span><span class="s">AAPL</span><span class="sh">"</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">100</span><span class="p">).</span><span class="nf">corr</span><span class="p">(</span><span class="n">spx_rets</span><span class="p">)</span>
<span class="n">corr</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">returns</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">100</span><span class="p">).</span><span class="nf">corr</span><span class="p">(</span><span class="n">spx_rets</span><span class="p">)</span>
<span class="n">corr</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/six-month-aapl-return-correlation-to-s-p-500.svg" alt="Six-month AAPL return correlation to S&amp;P 500" width="25%" height="25%">
</div>
<div class="title">Figure 30. Six-month AAPL return correlation to S&amp;P 500</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="n">corr</span> <span class="o">=</span> <span class="n">returns</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">100</span><span class="p">).</span><span class="nf">corr</span><span class="p">(</span><span class="n">spx_rets</span><span class="p">)</span>
<span class="n">corr</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/six-month-return-correlations-to-sp-500.svg" alt="Six-month return correlations to S&amp;P 500" width="25%" height="25%">
</div>
<div class="title">Figure 31. Six-month return correlations to S&amp;P 500</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="py"><span class="c1"># user-defined moving window functions
</span><span class="n">result</span> <span class="o">=</span> <span class="n">returns</span><span class="p">[</span><span class="sh">"</span><span class="s">AAPL</span><span class="sh">"</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="mi">250</span><span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">scipy</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="nf">percentileofscore</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">))</span>
<span class="n">result</span><span class="p">.</span><span class="nf">plot</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/python-for-data-analysis/time-series/percentile-rank-of-2-pct-aapl-return-over-one-year-window.svg" alt="Percentile rank of 2% AAPL return over one-year window" width="25%" height="25%">
</div>
<div class="title">Figure 32. Percentile rank of 2% AAPL return over one-year window</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="pydata-book"></a>[1] Wes McKinney <em>Python for Data Analysis</em>. thrid edition, O’Reilly, August 2022.</p>
</li>
</ul>
</div>
</div>
</div>
    
<style>
  .utterances {
      max-width: 100%;
  }
</style>
<script src="https://utteranc.es/client.js"
        repo="ousiax/utterances"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2024/05/17/python-learning-notes/">&laquo; Python Learning Notes</a>
      
    </li>
    <li>
      
      <a href="/2024/06/03/lua-learning-notes/">Lua Learning Notes &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
