<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>TCP/IP: Security: EAP, IPsec, TLS, DNSSEC, and DKIM</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2023/02/24/tcp-ip-security-eap-ipsec-tls-dnssec-and-dkim/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!--<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />-->

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?ousiax" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">TCP/IP: Security: EAP, IPsec, TLS, DNSSEC, and DKIM</h1>
    
    
    <p class="post-meta"><time datetime="2023-02-24T08:27:23+08:00" itemprop="datePublished">Jul 24, 2023</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>There are three primary properties of information, whether in a computer network or not, that may be desirable from an information security point of view: confidentiality, integrity, and availability (the CIA triad) [L01], summarized here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Confidentiality</strong> means that information is made known only to its intended users (which could include processing systems).</p>
</li>
<li>
<p><strong>Integrity</strong> means that information has not been modified in an unauthorized way before it is delivered.</p>
</li>
<li>
<p><strong>Availability</strong> means that information is available when needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are core properties of information, yet there are other properties we may also desire, including <em>authentication</em>, <em>nonrepudiation</em>, and <em>auditability</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong> means that a particular identified party or principal is not impersonating another principal.</p>
</li>
<li>
<p><strong>Nonrepudiation</strong> means that if some action is performed by a principal (e.g., agreeing to the terms of a contract), this fact can be proven later (i.e., cannot successfully be denied).</p>
</li>
<li>
<p><strong>Auditability</strong> means that some sort of trustworthy log or accounting describing how information has been used is available.</p>
<div class="paragraph">
<p>Such logs are often important for forensic (i.e., legal and prosecuritorial) purposes.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These principles are applicable to information in physical (e.g., printed) form, for which mechanisms such as safes, secured facilities, and guards have been used for thousands of years to enforce controlled sharing, storage, and dissemination. When information is to be moved through an unsecured environment, additional techniques are required.</p>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#threats-to-network-communication">1. Threats to Network Communication</a></li>
<li><a href="#basic-cryptography-and-security-mechanisms">2. Basic Cryptography and Security Mechanisms</a>
<ul class="sectlevel2">
<li><a href="#cryptosystems">2.1. Cryptosystems</a></li>
<li><a href="#rivest-shamir-and-adleman-rsa-public-key-cryptography">2.2. Rivest, Shamir, and Adleman (RSA) Public Key Cryptography</a></li>
<li><a href="#diffie-hellman-merkle-key-agreement-aka-diffie-hellman-or-dh">2.3. Diffie-Hellman-Merkle Key Agreement (aka Diffie-Hellman or DH)</a></li>
<li><a href="#signcryption-and-elliptic-curve-cryptography-ecc">2.4. Signcryption and Elliptic Curve Cryptography (ECC)</a></li>
<li><a href="#key-derivation-and-perfect-forward-secrecy-pfs">2.5. Key Derivation and Perfect Forward Secrecy (PFS)</a></li>
<li><a href="#pseudorandom-numbers-generators-and-function-families">2.6. Pseudorandom Numbers, Generators, and Function Families</a></li>
<li><a href="#nonces-and-salt">2.7. Nonces and Salt</a></li>
<li><a href="#cryptographic-hash-functions-and-message-digests">2.8. Cryptographic Hash Functions and Message Digests</a></li>
<li><a href="#message-authentication-codes-macs-hmac-cmac-and-gmac">2.9. Message Authentication Codes (MACs, HMAC, CMAC, and GMAC)</a></li>
<li><a href="#cryptographic-suites-and-cipher-suites">2.10. Cryptographic Suites and Cipher Suites</a></li>
</ul>
</li>
<li><a href="#certificates-certificate-authorities-cas-and-pkis">3. Certificates, Certificate Authorities (CAs), and PKIs</a>
<ul class="sectlevel2">
<li><a href="#public-key-certificates-certificate-authorities-and-x-509">3.1. Public Key Certificates, Certificate Authorities, and X.509</a></li>
<li><a href="#validating-and-revoking-certificates">3.2. Validating and Revoking Certificates</a></li>
<li><a href="#attribute-certificates">3.3. Attribute Certificates</a></li>
</ul>
</li>
<li><a href="#tcpip-security-protocols-and-layering">4. TCP/IP Security Protocols and Layering</a>
<ul class="sectlevel2">
<li><a href="#network-access-control-802-1x-802-1ae-eap-and-pana">4.1. Network Access Control: 802.1X, 802.1AE, EAP, and PANA</a></li>
<li><a href="#layer-3-ip-security-ipsec">4.2. Layer 3 IP Security (IPsec)</a>
<ul class="sectlevel3">
<li><a href="#internet-key-exchange-ikev2-protocol">4.2.1. Internet Key Exchange (IKEv2) Protocol</a>
<ul class="sectlevel4">
<li><a href="#ikev2-message-formats">4.2.1.1. IKEv2 Message Formats</a></li>
<li><a href="#the-ike_sa_init-exchange">4.2.1.2. The IKE_SA_INIT Exchange</a></li>
<li><a href="#security-association-sa-payloads-and-proposals">4.2.1.3. Security Association (SA) Payloads and Proposals</a></li>
<li><a href="#key-exchange-ke-and-nonce-ni-nr-payloads">4.2.1.4. Key Exchange (KE) and Nonce (Ni, Nr) Payloads</a></li>
<li><a href="#notification-n-and-configuration-cp-payloads">4.2.1.5. Notification (N) and Configuration (CP) Payloads</a></li>
<li><a href="#algorithm-selection-and-application">4.2.1.6. Algorithm Selection and Application</a></li>
<li><a href="#the-ike_auth-exchange">4.2.1.7. The IKE_AUTH Exchange</a></li>
<li><a href="#traffic-selectors-and-ts-payloads">4.2.1.8. Traffic Selectors and TS Payloads</a></li>
<li><a href="#eap-and-ike">4.2.1.9. EAP and IKE</a></li>
<li><a href="#better-than-nothing-security-btns">4.2.1.10. Better-than-Nothing Security (BTNS)</a></li>
<li><a href="#the-create_child_sa-exchange">4.2.1.11. The CREATE_CHILD_SA Exchange</a></li>
<li><a href="#the-informational-exchange">4.2.1.12. The INFORMATIONAL Exchange</a></li>
<li><a href="#mobile-ike-mobike">4.2.1.13. Mobile IKE (MOBIKE)</a></li>
</ul>
</li>
<li><a href="#authentication-header-ah">4.2.2. Authentication Header (AH)</a></li>
<li><a href="#encapsulating-security-payload-esp">4.2.3. Encapsulating Security Payload (ESP)</a>
<ul class="sectlevel4">
<li><a href="#transport-and-tunnel-modes">4.2.3.1. Transport and Tunnel Modes</a></li>
<li><a href="#esp-null-wrapped-esp-wesp-and-traffic-visibility">4.2.3.2. ESP-NULL, Wrapped ESP (WESP), and Traffic Visibility</a></li>
</ul>
</li>
<li><a href="#multicast">4.2.4. Multicast</a></li>
<li><a href="#l2tpipsec">4.2.5. L2TP/IPsec</a></li>
<li><a href="#ipsec-nat-traversal">4.2.6. IPsec NAT Traversal</a></li>
<li><a href="#ipsec-implementations">4.2.7. IPsec implementations</a></li>
</ul>
</li>
<li><a href="#transport-layer-security-tls-and-dtls">4.3. Transport Layer Security (TLS and DTLS)</a>
<ul class="sectlevel3">
<li><a href="#tls-1-2">4.3.1. TLS 1.2</a>
<ul class="sectlevel4">
<li><a href="#tls-record-protocol">4.3.1.1. TLS Record Protocol</a></li>
<li><a href="#tls-handshaking-protocols">4.3.1.2. TLS Handshaking Protocols</a></li>
</ul>
</li>
<li><a href="#tls-extensions">4.3.2. TLS Extensions</a></li>
<li><a href="#renegotiation">4.3.3. Renegotiation</a></li>
<li><a href="#example">4.3.4. Example</a></li>
<li><a href="#tls-with-datagrams-dtls">4.3.5. TLS with Datagrams (DTLS)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#dns-security-dnssec">5. DNS Security (DNSSEC)</a></li>
<li><a href="#faqs">Appendix A: FAQs</a>
<ul class="sectlevel2">
<li><a href="#aes-aes-128-aes-192-and-aes-256">A.1. AES, AES-128, AES-192, and AES-256?</a></li>
<li><a href="#aes-and-aes-gcm">A.2. AES and AES-GCM</a></li>
<li><a href="#whats-the-salt-and-iv-in-aes">A.3. What&#8217;s the SALT and IV in AES?</a></li>
<li><a href="#openssl-cryptography-and-ssltls-toolkit">A.4. OpenSSL: Cryptography and SSL/TLS Toolkit</a></li>
<li><a href="#how-to-generate-an-encrypted-key-for-aes-using-openssl">A.5. How to generate an encrypted key for AES using OpenSSL?</a></li>
<li><a href="#how-to-encrypt-a-message-with-aes">A.6. How to encrypt a message with AES?</a></li>
<li><a href="#how-to-determine-if-aes-cannot-decrypt-a-ciphertext">A.7. How to determine if AES cannot decrypt a ciphertext?</a></li>
<li><a href="#how-to-encrypte-a-message-with-aes-using-a-specific-salt-and-an-iv">A.8. How to encrypte a message with AES using a specific salt and an IV?</a></li>
<li><a href="#ec-ecc-ecdh-and-ecdsa">A.9. EC, ECC, ECDH and ECDSA?</a></li>
<li><a href="#rsa-dh-and-ecdh">A.10. RSA, DH, and ECDH</a></li>
<li><a href="#digital-signatures-and-public-key-encryptiondecryption">A.11. Digital signatures and public key encryption/decryption</a></li>
<li><a href="#is-it-possible-to-encrypt-a-message-with-a-private-key-and-decrypt-it-with-the-corresponding-public-key-or-vice-versa">A.12. Is it possible to encrypt a message with a private key and decrypt it with the corresponding public key, or vice versa?</a></li>
<li><a href="#it-seems-that-the-text-length-of-private-key-is-larger-than-public-key-in-pem">A.13. It seems that the text length of private key is larger than public key in PEM?</a></li>
<li><a href="#how-does-openssl-determine-the-algorithm-rsa-or-ecc">A.14. How does OpenSSL determine the algorithm (RSA or ECC)?</a></li>
<li><a href="#how-to-use-openssl-to-show-the-asn-1-oid-in-a-key-file">A.15. How to use OpenSSL to show the ASN.1 OID in a key file?</a></li>
<li><a href="#how-to-derive-a-shared-key-using-key-exchange-algorithm">A.16. How to derive a shared key using key exchange algorithm?</a></li>
<li><a href="#can-i-derive-a-shared-key-using-two-different-cipher-algorithm-keys">A.17. Can I derive a shared key using two different cipher algorithm keys?</a></li>
<li><a href="#can-i-derive-a-shared-key-with-rsa">A.18. Can I derive a shared key with RSA?</a></li>
<li><a href="#how-to-compute-the-digest-and-sign-it-from-a-csr-separately">A.19. How to compute the digest and sign it from a CSR separately?</a></li>
<li><a href="#how-to-create-issue-and-verify-a-certificate">A.20. How to create, issue and verify a certificate?</a></li>
</ul>
</li>
<li><a href="#fqas-ipsec">Appendix B: FQAs: IPsec</a>
<ul class="sectlevel2">
<li><a href="#ikev2-internet-key-exchange-version-2">B.1. IKEv2 (Internet Key Exchange version 2)</a></li>
<li><a href="#transport-mode-and-tunnel-mode-in-ipsec">B.2. Transport mode and tunnel mode in IPsec</a></li>
<li><a href="#tunnel-mode-in-ipsec-as-an-overlay-network">B.3. Tunnel mode in IPsec as an overlay network</a></li>
<li><a href="#ah-authentication-header-and-esp-encapsulating-security-payload-headers">B.4. AH (Authentication Header) and ESP (Encapsulating Security Payload) headers</a></li>
<li><a href="#the-scenarios-where-using-ipsec-without-confidentiality-i-e-without-encryption">B.5. The scenarios where using IPsec without confidentiality (i.e., without encryption)</a></li>
<li><a href="#ipsec-internet-protocol-security-and-tls-transport-layer-security">B.6. IPsec (Internet Protocol Security) and TLS (Transport Layer Security)</a></li>
<li><a href="#how-to-identify-the-type-of-an-ip-datagram-that-contains-normal-ipsec-data-an-ikev2-message-or-something-else">B.7. How to identify the type of an IP datagram, that contains normal IPsec data, an IKEv2 message, or something else?</a></li>
<li><a href="#what-are-ikev2-and-openvpn">B.8. What are IKEv2 and OpenVPN?</a></li>
<li><a href="#whatre-p2s-point-to-site-and-s2s-site-to-site">B.9. What&#8217;re P2S (Point-to-Site) and S2S (Site-to-Site)?</a></li>
</ul>
</li>
<li><a href="#extended-validation-certificate">Appendix C: Extended Validation Certificate</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="threats-to-network-communication">1. Threats to Network Communication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Attacks can generally be categorized as either passive or active.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Passive attacks</strong> are mounted by monitoring or eavesdropping on the contents of network traffic, and if not handled they can lead to unauthorized release of information (loss of confidentiality).</p>
</li>
<li>
<p><strong>Active attacks</strong> can cause modification of information (with possible loss of integrity) or denial of service (loss of availability).</p>
<div class="paragraph">
<p>Logically, such attacks are carried out by an "intruder" or adversary.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/passive-active-attacks.jpg" alt="Passive and active attacks" width="50%" height="50%">
</div>
<div class="title">Figure 1. The principals, Alice and Bob, attempt to communicate securely, but Eve may eavesdrop and Mallory may modify messages in transit.</div>
</div>
<div class="paragraph">
<p>Eve is able to eavesdrop (listen in on, also called <em>capture</em> or <em>sniff</em>) and perform <strong><em>traffic analysis</em></strong> on the traffic passing between Alice and Bob.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Capturing the traffic could lead to compromise of confidentiality, as sensitive data may be available to Eve without Alice or Bob knowing.</p>
<div class="paragraph">
<p>In addition, traffic analysis can determine the features of the traffic, such as its size and when it is sent, and possibly identify the parties to a communication. This information, although it does not reveal the exact contents of the communication, could also lead to disclosure of sensitive information and could be used to mount more powerful active attacks in the future.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>While the passive attacks are essentially impossible for Alice or Bob to detect, Mallory is capable of performing more easily noticed active attacks. These include
<em>message stream modification</em> (MSM), <em>denial-of-service</em> (DoS), and <em>spurious association</em> attacks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MSM attacks (including so-called called <strong><em>man-in-the-middle</em></strong> or MITM_attacks) are a broad category and include any way traffic is modified in transit, including deletion, reordering, and content modification.</p>
</li>
<li>
<p>DoS might include deletion of traffic, or generation of such large volumes of traffic so as to overwhelm Alice, Bob, or the communication channel connecting them.</p>
</li>
<li>
<p>Spurious associations include <strong><em>masquerading</em></strong> (Mallory pretends to be Bob or Alice) and replay, whereby Alice or Bob’s earlier (authentic) communications are replayed later, from Mallory&#8217;s memory.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Attacks on communication are broadly classified as passive or active. Passive attacks are ordinarily more difficult to detect, and active attacks are ordinarily more difficult to prevent.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Passive</th>
<th class="tableblock halign-left valign-top" colspan="2">Active</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Type</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Threats</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Type</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Threats</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eavesdropping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confidentiality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message stream modification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authenticity, integrity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Traffic analysis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confidentiality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denial of service (DoS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Availability</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spurious association</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authenticity</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With effective and careful use of <strong>cryptography</strong>, passive attacks are rendered ineffective, and active attacks are made detectable (and to some degree preventable).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basic-cryptography-and-security-mechanisms">2. Basic Cryptography and Security Mechanisms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cryptography evolved from the desire to protect the confidentiality, integrity, and authenticity of information carried through unsecured communication channels.</p>
</div>
<div class="paragraph">
<p>The use of cryptography, at least in a primitive form, dates back to at least 3500 BCE. The earliest systems were usually <strong>codes</strong>.</p>
</div>
<div class="paragraph">
<p>Codes involve substitutions of groups of words, phrases, or sentences with groups of numbers or letters as given in a codebook. Codebooks needed to be kept secret in order to keep communications private, so distributing them required considerable care.</p>
</div>
<div class="paragraph">
<p>More advanced systems used <strong>ciphers</strong>, in which both substitution and rearrangement are used.</p>
</div>
<div class="sect2">
<h3 id="cryptosystems">2.1. Cryptosystems</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/symmetric-asymmetric-cryptosystem.png" alt="Symmetric and asymmetric key cryptosystem" width="50%" height="50%">
</div>
<div class="title">Figure 2. The unencrypted (cleartext) message is passed through an encryption algorithm to produce an encrypted (ciphertext) message. In a symmetric cryptosystem, the same (secret) key is used for encryption and decryption. In an asymmetric or public key cryptosystem, confidentiality is achieved by using the recipient&#8217;s public key for encryption and private (secret) key for decryption.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In each case, a <strong>cleartext</strong> message is processed by an encryption algorithm to produce <strong>ciphertext</strong> (scrambled text).</p>
</li>
<li>
<p>The <strong>key</strong> is a particular sequence of bits used to drive the <strong>encryption algorithm</strong> or cipher.</p>
</li>
<li>
<p>With different keys, the same input produces different outputs. Combining the algorithms with supporting protocols and operating methods forms a <strong>cryptosystem</strong>.</p>
</li>
<li>
<p>In a <strong>symmetric cryptosystem</strong>, the encryption and decryption keys are typically identical, as are the encryption and decryption algorithms.</p>
</li>
<li>
<p>In an <strong>asymmetric cryptosystem</strong>, each principal is generally provided with a <strong>pair</strong> of keys consisting of one public and one private key.</p>
<div class="paragraph">
<p>The public key is intended to be known to any party that might want to send a message to the key pair&#8217;s owner.</p>
</div>
<div class="paragraph">
<p>The public and private keys are mathematically related and are themselves outputs of a <strong>key generation</strong> algorithm.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>RSA is based on the mathematical properties of large prime numbers and their modular arithmetic, while ECC relies on the algebraic structure of elliptic curves over finite fields. As a result, the key pairs generated for each algorithm are incompatible with each other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Without knowing the symmetric key (in a symmetric cryptosystem) or the private key (in a public key cryptosystem), it is (believed to be) effectively impossible
for any third party that intercepts the ciphertext to produce the corresponding cleartext. This provides the basis for confidentiality.</p>
</div>
<div class="paragraph">
<p>For the symmetric key cryptosystem, it also provides a degree of authentication, because only a party holding the key is able to produce a useful ciphertext that can be decrypted to something sensible.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A receiver can decrypt the ciphertext, look for a portion of the resulting cleartext to contain a particular agreed-upon value, and conclude that the sender holds the appropriate key and is therefore authentic.</p>
</li>
<li>
<p>Furthermore, most encryption algorithms work in such a way that if messages are modified in transit, they are unable to produce useful cleartext upon decryption.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, symmetric cryptosystems provide a measure of both authentication and integrity protection for messages, but this approach alone is weak. Instead, special forms of checksums are usually coupled with symmetric cryptography to ensure integrity.</p>
</div>
<div class="paragraph">
<p>A symmetric encryption algorithm is usually classified as either a <strong>block cipher</strong> or a <strong>stream cipher</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Block ciphers perform operations on a fixed number of bits (e.g., 64 or 128) at a time,</p>
</li>
<li>
<p>and stream ciphers operate continuously on however many bits (or bytes) are provided as input.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For years, the most popular symmetric encryption algorithm was the <strong><em>Data Encryption Standard</em></strong> (DES), a block cipher that uses 64-bit blocks and 56-bit keys.</p>
</div>
<div class="paragraph">
<p>Eventually, the use of 56-bit keys was felt to be insecure, and many applications turned to <strong><em>triple-DES</em></strong> (also denoted <em>3DES</em> or <em>TDES</em>—applying DES three times with two or three different keys to each block of data).</p>
</div>
<div class="paragraph">
<p>Today, DES and 3DES have been largely phased out in favor of the <strong><em>Advanced Encryption Standard</em></strong> (AES), also known occasionally by its original name the <em>Rijndael</em> algorithm (pronounced “rain-dahl”), in deference to its Belgian cryptographer inventors Vincent Rijmen and Joan Daemen.</p>
</div>
<div class="paragraph">
<p>Different variants of AES provide key lengths of 128, 192, and 256 bits and are usually written with the corresponding extension (i.e., AES-128, AES-192, and AES-256).</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Symmetric-key algorithm: From Wikipedia, the free encyclopedia</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/6/61/Simple_symmetric_encryption.png" alt="Symmetric-key encryption: the same key is used for both encryption and decryption" width="35%" height="35%">
</div>
</div>
<div class="paragraph">
<p>Examples of popular symmetric-key algorithms include Twofish, Serpent, AES (Rijndael), Camellia, Salsa20, ChaCha20, Blowfish, CAST5, Kuznyechik, RC4, DES, 3DES, Skipjack, Safer, and IDEA.</p>
</div>
<div class="paragraph">
<p>When used with asymmetric ciphers for key transfer, <em>pseudorandom key generators</em> are nearly always used to generate the symmetric cipher session keys.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Asymmetric cryptosystems have some additional interesting properties beyond those of symmetric key cryptosystems.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Assuming we have Alice as sender and Bob as intended recipient, any third party is assumed to know Bob&#8217;s public key and can therefore send him a secret message—only Bob is able to decrypt it because only Bob knows the private key corresponding to his public key.</p>
</li>
<li>
<p>However, Bob has no real assurance that the message is authentic, because any party can create a message and send it to Bob, encrypted in Bob&#8217;s public key.</p>
</li>
<li>
<p>Fortunately, public key cryptosystems also provide another function when used in reverse: authentication of the sender.</p>
</li>
<li>
<p>In this case, Alice can encrypt a message using her private key and send it to Bob (or anyone else).</p>
</li>
<li>
<p>Using Alice&#8217;s public key (known to all), anyone can verify that the message was authored by Alice and has not been modified.</p>
</li>
<li>
<p>However, it is not confidential because everyone has access to Alice&#8217;s public key.</p>
</li>
<li>
<p>To achieve <em>authenticity</em>, <em>integrity</em>, and <em>confidentiality</em>, <strong>Alice can encrypt a message using her private key and encrypt the result using Bob&#8217;s public key.</strong></p>
</li>
<li>
<p>The result is a message that is reliably authored by Alice and is also confidential to Bob.</p>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/asymmetric-cryptosystem.png" alt="Asymmetric (Public Key) Cryptosystem" width="50%" height="50%">
</div>
<div class="title">Figure 3. The asymmetric cryptosystem can be used for confidentiality (encryption), authentication (digital signatures or signing), or both. When used for both, it produces a signed output that is confidential to the sender and the receiver. Public keys, as their name suggests, are not kept secret.</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When public key cryptography is used in "reverse" like this, it provides a <strong>digital signature</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Digital signatures are important consequences of public key cryptography and can be used to help ensure authenticity and nonrepudiation.</p>
</li>
<li>
<p>Only a party possessing Alice’s private key is able to author messages or carry out transactions as Alice.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a <strong><em>hybrid</em></strong> cryptosystem, elements of both public key and symmetric key cryptography are used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Most often, public key operations are used to exchange a randomly generated confidential (symmetric) <strong>session key</strong>, which is used to encrypt traffic for a single transaction using a symmetric algorithm.</p>
</li>
<li>
<p>The reason for doing so is performance—symmetric key operations are less computationally intensive than public key operations.</p>
</li>
<li>
<p>Most systems today are of the hybrid type: public key cryptography is used to establish keys used for symmetric encryption of individual sessions.</p>
</li>
</ul>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Public-key cryptography: From Wikipedia, the free encyclopedia</p>
</div>
<div class="paragraph">
<p>Public-key cryptography, or asymmetric cryptography, is the field of cryptographic systems that use pairs of related keys. Each key pair consists of a public key and a corresponding private key which are generated with cryptographic algorithms based on mathematical problems termed one-way functions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/3/32/Public-key-crypto-1.svg" alt="Public key crypto 1" width="25%" height="25%">
</div>
<div class="title">Figure 4. An unpredictable (typically large and random) number is used to begin generation of an acceptable pair of keys suitable for use by an asymmetric key algorithm.</div>
</div>
<div class="paragraph">
<p>In a <strong>public-key encryption</strong> system, anyone with a public key can encrypt a message, yielding a ciphertext, but only those who know the corresponding private key can decrypt the ciphertext to obtain the original message.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/f/f9/Public_key_encryption.svg" alt="Public key encryption" width="25%" height="25%">
</div>
<div class="title">Figure 5. In an asymmetric key encryption scheme, anyone can encrypt messages using a public key, but only the holder of the paired private key can decrypt such a message. The security of the system depends on the secrecy of the private key, which must not become known to any other.</div>
</div>
<div class="paragraph">
<p>In a <strong>digital signature system</strong>, a sender can use a private key together with a message to create a signature. Anyone with the corresponding public key can verify whether the signature matches the message, but a forger who does not know the private key cannot find any message/signature pair that will pass verification with the public key.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Private_key_signing.svg" alt="Private key signing" width="25%" height="25%">
</div>
<div class="title">Figure 6. In this example the message is digitally signed with Alice&#8217;s private key, but the message itself is not encrypted. 1) Alice signs a message with her private key. 2) Using Alice&#8217;s public key, Bob can verify that Alice sent the message and that the message has not been modified.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/4/4c/Public_key_shared_secret.svg" alt="Public key shared secret" width="25%" height="25%">
</div>
<div class="title">Figure 7. In the Diffie–Hellman key exchange scheme, each party generates a public/private key pair and distributes the public key of the pair. After obtaining an authentic (n.b., this is critical) copy of each other&#8217;s public keys, Alice and Bob can compute a shared secret offline. The shared secret can be used, for instance, as the key for a symmetric cipher which will be, in essentially all cases, much faster.</div>
</div>
<div class="paragraph">
<p>Examples of well-regarded asymmetric key techniques for varied purposes include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Diffie–Hellman key exchange protocol</p>
</li>
<li>
<p>DSS (Digital Signature Standard), which incorporates the Digital Signature Algorithm</p>
</li>
<li>
<p>ElGamal</p>
</li>
<li>
<p>Elliptic-curve cryptography</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Elliptic Curve Digital Signature Algorithm (ECDSA)</p>
</li>
<li>
<p>Elliptic-curve Diffie–Hellman (ECDH)</p>
</li>
<li>
<p>Ed25519 and Ed448 (EdDSA)</p>
</li>
<li>
<p>X25519 and X448 (ECDH/EdDH)</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Various password-authenticated key agreement techniques</p>
</li>
<li>
<p>Paillier cryptosystem</p>
</li>
<li>
<p>RSA encryption algorithm (PKCS#1)</p>
</li>
<li>
<p>Cramer–Shoup cryptosystem</p>
</li>
<li>
<p>YAK authenticated key agreement protocol</p>
</li>
</ul>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="rivest-shamir-and-adleman-rsa-public-key-cryptography">2.2. Rivest, Shamir, and Adleman (RSA) Public Key Cryptography</h3>
<div class="paragraph">
<p>The most common approach used for both digital signatures and confidentiality is called RSA in deference to its authors' names, Rivest, Shamir, and Adleman. The security of this system hinges on the difficulty of factoring large numbers into constituent primes.</p>
</div>
</div>
<div class="sect2">
<h3 id="diffie-hellman-merkle-key-agreement-aka-diffie-hellman-or-dh">2.3. Diffie-Hellman-Merkle Key Agreement (aka Diffie-Hellman or DH)</h3>
<div class="paragraph">
<p>The Diffie-Hellman-Merkle Key Agreement protocol (more commonly called simply Diffie-Hellman or DH) provides a method to have two parties agree on a common set of secret bits that can be used as a symmetric key, based on the use of finite field arithmetic.</p>
</div>
<div class="paragraph">
<p>DH techniques are used in many of the Internet-related security protocols <a href="#RFC2631">[RFC2631]</a> and are closely related to the RSA approach for public key cryptography.</p>
</div>
</div>
<div class="sect2">
<h3 id="signcryption-and-elliptic-curve-cryptography-ecc">2.4. Signcryption and Elliptic Curve Cryptography (ECC)</h3>
<div class="paragraph">
<p>When using RSA, additional security is provided with larger numbers. However, the basic mathematical operations required by RSA (e.g., exponentiation) can be computationally intensive and scale as the numbers grow. Reducing the effort of combining digital signatures and encryption for confidentiality, a class of <strong>sign-cryption</strong> schemes (also called <strong>authenticated encryption</strong>) provides both features at a cost less than the sum of the two if computed separately. However, even greater efficiency can sometimes be achieved by changing the mathematical basis for public key cryptography.</p>
</div>
<div class="paragraph">
<p>In a continuing search for security with greater efficiency and performance, researchers have explored other public key cryptosystems beyond RSA. An alternative based on the difficulty of finding the discrete logarithm of an <strong>elliptic curve</strong> element has emerged, known as <strong>elliptic curve cryptography</strong> (ECC, not to be confused with <em>error-correcting code</em>).</p>
</div>
<div class="paragraph">
<p>For equivalent security, ECC offers the benefit of using keys that are considerably smaller than those of RSA (e.g., by about a factor of 6 for a 1024-bit RSA modulus). This leads to simpler and faster implementations, issues of considerable practical concern.</p>
</div>
<div class="paragraph">
<p>ECC has been standardized for use in many of the applications where RSA still retains dominance, but adoption has remained somewhat sluggish because of patents on ECC technology held by the Certicom Corporation. (The RSA algorithm was also patented, but patent protection lapsed in the year 2000.)</p>
</div>
</div>
<div class="sect2">
<h3 id="key-derivation-and-perfect-forward-secrecy-pfs">2.5. Key Derivation and Perfect Forward Secrecy (PFS)</h3>
<div class="paragraph">
<p>In communication scenarios where multiple messages are to be exchanged, it is common to establish a short-term session key to perform symmetric encryption.</p>
</div>
<div class="paragraph">
<p>The session key is ordinarily a random number generated by a function called a <strong>key derivation function</strong> (KDF), based on some input such as a master key or a previous session key. If a session key is compromised, any of the data encrypted with the key is subject to compromise. However, it is common practice to change keys (<strong><em>rekey</em></strong>) multiple times during an extended communication session.</p>
</div>
<div class="paragraph">
<p>A scheme in which the compromise of one session key keeps future communications secure is said to have <strong>perfect forward secrecy</strong> (PFS). Usually, schemes that provide PFS require additional key exchanges or verifications that introduce overhead. One example is the STS protocol for DH mentioned earlier.</p>
</div>
</div>
<div class="sect2">
<h3 id="pseudorandom-numbers-generators-and-function-families">2.6. Pseudorandom Numbers, Generators, and Function Families</h3>
<div class="paragraph">
<p>In cryptography, random numbers are often used as initial input values to cryptographic functions, or for generating keys that are difficult to guess. Given that computers are not very random by nature, obtaining true random numbers is somewhat difficult. The numbers used in most computers for simulating randomness are called <strong>pseudorandom numbers</strong>. Such numbers are not usually truly random but instead exhibit a number of statistical properties that suggest that they are (e.g., when many of them are generated, they tend to be uniformly distributed across some range). Pseudorandom numbers are produced by an algorithm or device known as a <strong>pseudorandom number generator</strong> (PRNG) or <strong>pseudorandom generator</strong> (PRG), depending on the author.</p>
</div>
<div class="paragraph">
<p>Simple PRNGs are deterministic. That is, they have a small amount of internal state initialized by a <strong><em>seed</em></strong> value. Once the internal state is known, the sequence of PNs can be determined.</p>
</div>
<div class="paragraph">
<p>For example, the common <em>Linear Congruential Generator</em> (LCG) algorithm produces random-appearing values that are entirely predictable if the input parameters are known or guessed. Consequently, LCGs are perfectly fine for use in certain programs (e.g., games that simulate random events) but insufficient for cryptographic purposes.</p>
</div>
<div class="paragraph">
<p>A <strong>pseudorandom function family</strong> (PRF) is a family of functions that appear to be algorithmically indistinguishable (by polynomial time algorithms) from truly random functions. A PRF is a stronger concept than a PRG, as a PRG can be created from a PRF.</p>
</div>
<div class="paragraph">
<p>PRFs are the basis for <strong><em>cryptographically strong</em></strong> (or secure) pseudorandom number generators, called CSPRNGs. CSPRNGs are necessary in cryptographic applications for several purposes, including session key generation, for which a sufficient amount of randomness must be guaranteed <a href="#RFC4086">[RFC4086]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="nonces-and-salt">2.7. Nonces and Salt</h3>
<div class="paragraph">
<p>A <strong>cryptographic nonce</strong> is a number that is used once (or for one transaction) in a cryptographic protocol. Most commonly, a nonce is a random or pseudorandom number that is used in authentication protocols to ensure <strong><em>freshness</em></strong>. Freshness is the (desirable) property that a message or operation has taken place in the very recent past.</p>
</div>
<div class="paragraph">
<p>For example, in a <strong><em>challenge-response</em></strong> protocol, a server may provide a requesting client with a nonce, and the client may need to respond with authentication material as well as a copy of the nonce (or perhaps an encrypted copy of the nonce) within a certain period of time. This helps to avoid replay attacks, because old authentication exchanges that are replayed to the server would not contain the correct nonce value.</p>
</div>
<div class="paragraph">
<p>A <strong>salt</strong> or salt value, used in the cryptographic context, is a random or pseudorandom number used to frustrate <strong><em>brute-force</em></strong> attacks on secrets. Brute-force attacks usually involve repeatedly guessing a password, passphrase, key, or equivalent secret value and checking to see if the guess was correct. Salts work by frustrating the checking portion of a brute-force attack.</p>
</div>
<div class="paragraph">
<p>The best-known example is the way passwords used to be handled in the UNIX system. Users' passwords were encrypted and stored in a password file that all users could read. When logging in, each user would provide a password that was used to double encrypt a fixed value. The result was then compared against the user&#8217;s entry in the password file. A match indicated that a correct password was provided.</p>
</div>
<div class="paragraph">
<p>At the time, the encryption method (DES) was well known and there was concern that a hardware-based <strong><em>dictionary attack</em></strong> would be possible whereby many words from a dictionary were encrypted with DES ahead of time (forming a <strong><em>rainbow table</em></strong>) and compared against the password file. A pseudorandom 12-bit salt was added to perturb the DES algorithm in one of 4096 (nonstandard) ways for each password in an effort to thwart this attack. Ultimately, the 12-bit salt was determined to be insufficient with improved computers (that could guess more values) and was expanded.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
However, there are limitations in the protections that a salt can provide. If the attacker is hitting an online service with a credential stuffing attack, a subset of the brute force attack category, salts won&#8217;t help at all because the legitimate server is doing the salting+hashing for you. <a href="https://auth0.com/blog/adding-salt-to-hashing-a-better-way-to-store-passwords/">[auth0-salt-hasing</a>]
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cryptographic-hash-functions-and-message-digests">2.8. Cryptographic Hash Functions and Message Digests</h3>
<div class="paragraph">
<p>In most of the protocols, including Ethernet, IP, ICMP, UDP, and TCP, we have seen the use of a frame check sequence (FCS, either a checksum or a CRC) to determine whether a PDU has likely been delivered without bit errors. When considering security, ordinary FCS functions are not sufficient for this purpose.</p>
</div>
<div class="paragraph">
<p>A checksum or FCS can be used to verify message integrity if properly constructed using special functions, which are called <strong>cryptographic hash functions</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The output of a cryptographic hash function <em>H</em>, when provided a message <em>M</em>, is called the <strong>digest</strong> or <strong>fingerprint</strong> of the message, <em>H(M)</em>.</p>
</li>
<li>
<p>A message digest is a type of strong FCS that is easy to compute and has the following important properties:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Preimage resistance: Given <em>H(M)</em>, it should be difficult to determine <em>M</em> if not already known.</p>
</li>
<li>
<p>Second preimage resistance: Given <em>H(M1)</em>, it should be difficult to determine an <em>M2 ≠ M1</em> such that <em>H(M1) = H(M2)</em>.</p>
</li>
<li>
<p>Collision resistance: It should be difficult to find any pair <em>M1</em>, <em>M2</em> where <em>H(M1) = H(M2)</em> when <em>M2 ≠ M1</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>If a hash function has all of these properties, then if two messages have the same cryptographic hash value, they are, with negligible doubt, the same message.</p>
</div>
<div class="paragraph">
<p>The two most common cryptographic hash algorithms are at present the <em>Message Digest Algorithm 5</em> (<strong><em>MD5</em></strong>, <a href="#RFC1321">[RFC1321]</a>), which produces a 128-bit (16-byte) digest, and the <em>Secure Hash Algorithm 1</em> (<strong><em>SHA-1</em></strong>), which produces a 160-bit (20-byte) digest.</p>
</div>
<div class="paragraph">
<p>More recently, a family of functions based on SHA called <strong><em>SHA-2</em></strong> <a href="#RFC6234">[RFC6234]</a> produce digests with lengths of 224, 256, 384, or 512 bits (28, 32, 48, and 64 bytes, respectively). Others are under development.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cryptographic hash functions are often based on a compression function <em>f</em>, which takes an input of length <em>L</em> and produces a collision-resistant but deterministic output of size less than <em>L</em>. The Merkle-Damgård construction, which essentially breaks an arbitrarily long input into blocks of length <em>L</em>, pads them, passes them to <em>f</em>, and combines the results, produces a cryptographic hash function capable of taking a long input and producing an output with collision resistance.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="message-authentication-codes-macs-hmac-cmac-and-gmac">2.9. Message Authentication Codes (MACs, HMAC, CMAC, and GMAC)</h3>
<div class="paragraph">
<p>A <em>message authentication code</em> (unfortunately abbreviated <strong>MAC</strong> or sometimes <strong>MIC</strong> but unrelated to the link-layer MAC addresses) can be used to ensure message integrity and authentication. MACs are usually based on <strong><em>keyed cryptographic hash functions</em></strong>, which are like <em>message digest algorithms</em> but require a <em>private key</em> to produce or verify the integrity of a message and may also be used to verify (authenticate) the message&#8217;s sender.</p>
</div>
<div class="paragraph">
<p>MACs require resistance to various forms of <strong><em>forgery</em></strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For a given keyed hash function <em>H(M,K)</em> taking input message <em>M</em> and key <em>K</em>, resistance to <strong><em>selective forgery</em></strong> means that it is difficult for an adversary not knowing <em>K</em> to form <em>H(M,K)</em> given a specific <em>M</em>.</p>
</li>
<li>
<p><em>H(M,K)</em> is resistant to <strong><em>existential forgery</em></strong> if it is difficult for an adversary lacking <em>K</em> to find any previously unknown valid combination of <em>M</em> and <em>H(M,K)</em>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that MACs do not provide exactly the same features as digital signatures. For example, they cannot be a solid basis for nonrepudiation because the secret key is known to more than one party.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A standard MAC that uses <em>cryptographic hash functions</em> in a particular way is called the <em>keyed-hash message authentication code</em> (<strong>HMAC</strong>) <a href="#FIPS198">[FIPS198]</a><a href="#RFC2104">[RFC2104]</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The HMAC "algorithm" uses a generic cryptographic hash algorithm, say <em>H(M)</em>.</p>
</li>
<li>
<p>To form a <em>t</em>-byte HMAC on message <em>M</em> with key <em>K</em> using <em>H</em> (called <em>HMAC-H</em>), we use the following definition:</p>
<div class="listingblock text-center">
<div class="content">
<pre><em>HMAC-H (K, M)t = Λt (H((K ⊕ opad)||H((K ⊕ ipad)||M)))</em></pre>
</div>
</div>
<div class="paragraph">
<p>In this definition, <code>opad</code> (outer pad) is an array containing the value <code>0x5C</code> repeated <code>|K|</code> times, and <code>ipad</code> (inner pad) is an array containing the value <code>0x36</code> repeated <code>|K|</code> times. <code>⊕</code> is the vector XOR operator, and <code>||</code> is the concatenation operator.</p>
</div>
<div class="paragraph">
<p>Normally the HMAC output is intended to be a certain number <code>t</code> of bytes in length, so the operator <code>Λt(M)</code> takes the left-most <code>t</code> bytes of <code>M</code>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>More recently, other forms of MACs have been standardized, called the <strong><em>cipher-based MAC</em></strong> (<strong>CMAC</strong>) <a href="#FIPS800-38B">[FIPS800-38B]</a> and <strong>GMAC</strong> <a href="#NIST800-38D">[NIST800-38D]</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Instead of using a cryptographic hash function such as HMAC, these use a block cipher such as AES or 3DES.</p>
</li>
<li>
<p>CMAC is envisioned for use in environments where it is more convenient or efficient to use a block cipher in place of a hash function.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cryptographic-suites-and-cipher-suites">2.10. Cryptographic Suites and Cipher Suites</h3>
<div class="paragraph">
<p>The combination of the mathematical or cryptographic techniques used in a particular system, especially the Internet protocols, defines not only an enciphering (encryption) algorithm but may also include a particular MAC algorithm, PRF (<em>pseudorandom function family</em>), key agreement algorithm, signature algorithm, and associated key lengths and parameters, are called a <strong>cryptographic suite</strong> or sometimes a <strong>cipher suite</strong>, although the first term is more accurate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl ciphers <span class="nt">-v</span> <span class="nt">-s</span> <span class="nt">-tls1_3</span>
<span class="go">TLS_AES_256_GCM_SHA384         TLSv1.3 Kx=any      Au=any   Enc=AESGCM(256)            Mac=AEAD
TLS_CHACHA20_POLY1305_SHA256   TLSv1.3 Kx=any      Au=any   Enc=CHACHA20/POLY1305(256) Mac=AEAD
TLS_AES_128_GCM_SHA256         TLSv1.3 Kx=any      Au=any   Enc=AESGCM(128)            Mac=AEAD</span></code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>From Wikipedia, the free encyclopedia</p>
</div>
<div class="paragraph">
<p>A <strong><em>cipher suite</em></strong> is a set of algorithms that help secure a network connection. Suites typically use Transport Layer Security (TLS) or its now-deprecated predecessor Secure Socket Layer (SSL). The set of algorithms that cipher suites usually contain include: a key exchange algorithm, a bulk encryption algorithm, and a message authentication code (MAC) algorithm. <a href="#CSWIKIPEDIA">[CSWIKIPEDIA]</a></p>
</div>
<div class="paragraph">
<p>The <em>key exchange algorithm</em> is used to exchange a key between two devices. This key is used to encrypt and decrypt the messages being sent between two machines. The <em>bulk encryption algorithm</em> is used to encrypt the data being sent. The <em>MAC algorithm</em> provides data integrity checks to ensure that the data sent does not change in transit. In addition, cipher suites can include <em>signatures and an authentication algorithm</em> to help authenticate the server and or client.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Algorithms supported in TLS 1.0–1.2 cipher suites</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key exchange/agreement</th>
<th class="tableblock halign-left valign-top">Authentication</th>
<th class="tableblock halign-left valign-top">Block/stream ciphers</th>
<th class="tableblock halign-left valign-top">Message authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RC4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash-based MD5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diffie–Hellman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triple DES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHA hash function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECDH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECDSA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AES</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SRP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDEA</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSK</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DES</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Camellia</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ChaCha20</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For more information about algorithms supported in TLS 1.0–1.2, see also: <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Applications_and_adoption">Transport Layer Security § Applications and adoption</a></p>
</li>
<li>
<p>In TLS 1.3, many legacy algorithms that were supported in early versions of TLS have been dropped in an effort to make the protocol more secure.</p>
</li>
</ol>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. TLS Cipher Suites: <a href="https://www.iana.org/assignments/tls-parameters/tls-parameters.xml" class="bare">https://www.iana.org/assignments/tls-parameters/tls-parameters.xml</a></caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">DTLS-OK</th>
<th class="tableblock halign-left valign-top">Recommended</th>
<th class="tableblock halign-left valign-top">Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x13,0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS_AES_128_GCM_SHA256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC8446]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xD0,0x05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS_ECDHE_PSK_WITH_AES_128_CCM_SHA256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC8442]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xD0,0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS_ECDHE_PSK_WITH_AES_128_GCM_SHA256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC8442]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xC0,0x2F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC5289]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xC0,0x2B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC5289]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Usually, an <em>encryption algorithm</em> is specified by its name and description, how many bits are used for its keys (often a multiple of 128 bits), along with its operating <em>mode</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://learn.microsoft.com/en-us/windows/win32/secauthn/images/tls-cipher-suite.png" alt="Diagram that shows a single string for a Cipher Suite." width="55%" height="55%">
</div>
<div class="title">Figure 8. <a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/cipher-suites-in-schannel" class="bare">https://learn.microsoft.com/en-us/windows/win32/secauthn/cipher-suites-in-schannel</a></div>
</div>
<div class="ulist">
<ul>
<li>
<p>Encryption algorithms that have been standardized for use with Internet protocols include AES, 3DES, NULL <a href="#RFC2410">[RFC2410]</a>, and CAMELLIA <a href="#RFC3713">[RFC3713]</a>.</p>
<div class="paragraph">
<p>The NULL encryption algorithm does not modify the input and is used in certain circumstances where confidentiality is not required.</p>
</div>
</li>
<li>
<p>The <em>operating</em> <strong><em>mode</em></strong> of an encryption algorithm, especially a block cipher, describes how to use the encryption function for a single block repeatedly (e.g., in a cascade) to encrypt or decrypt an entire message with a single key.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>When performing encryption using CBC (<strong><em>cipher block chaining</em></strong>) mode, a cleartext block to be encrypted is first XORed with the previous ciphertext block (the first block is XORed with a random <strong><em>initialization vector</em></strong> or <strong>IV</strong>).</p>
</li>
<li>
<p>Encrypting in CTR (<strong><em>counter</em></strong>) mode involves first creating a value combining a nonce (or IV) and a counter that increments with each successive block to be encrypted.</p>
<div class="paragraph">
<p>The combination is then encrypted, the output is XORed with a cleartext block to produce a ciphertext block, and the process repeats for successive blocks.</p>
</div>
<div class="paragraph">
<p>In effect, this approach uses a block cipher to produce a <strong>keystream</strong>, a sequence of (random-appearing) bits that are combined (e.g., XORed) with cleartext bits to produce a ciphertext. Doing so essentially converts a block cipher into a stream cipher because no explicit padding of the input is required.</p>
</div>
</li>
<li>
<p>CBC requires a serial process for encryption and a partly serial process for decryption, whereas counter mode algorithms allow more efficient fully parallel encryption and decryption implementations. Consequently, counter mode is gaining popularity.</p>
</li>
<li>
<p>In addition, variants of CTR mode (e.g., counter mode with CBC-MAC (CCM), Galois Counter Mode, or GCM) can be used for authenticated encryption <a href="#RFC4309">[RFC4309]</a>, and possibly to authenticate (but not encrypt) additional data (called <em>authenticated encryption with associated data</em> or <strong>AEAD</strong>) <a href="#RFC5116">[RFC5116]</a>.</p>
</li>
<li>
<p>When an encryption algorithm is specified as part of a cryptographic suite, its name usually includes the mode, and the key length is often implied.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>For example, ENCR_AES_CTR refers to AES-128 used in CTR mode.</p>
</div>
</blockquote>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a PRF (<em>pseudorandom function family</em>) is included in the definition of a cryptographic suite, it is usually based on a cryptographic hash algorithm family such as SHA-2 <a href="#RFC6234">[RFC6234]</a> or a cryptographic MAC such as CMAC <a href="#RFC4434">[RFC4434]</a><a href="#RFC4615">[RFC4615]</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>For example, the algorithm AES-CMAC-PRF-128 refers to a PRF constructed using a CMAC based on AES-128. It is also written as PRF_AES128_CMAC. The algorithm PRF_HMAC_SHA1 refers to a PRF based on HMAC-SHA1.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong><em>Key agreement</em></strong> parameters, when included with an Internet cryptographic suite definition, refer to DH group definitions, as no other key agreement protocol is in widespread use. When DH key agreement is used in generating keys for a particular encryption algorithm, care must be taken to ensure that the keys produced are of sufficient length (strength) to avoid compromising the security of the encryption algorithm.</p>
</div>
<div class="paragraph">
<p>A <em>signature algorithm</em> is sometimes included in the definition of a cryptographic suite. It may be used for signing a variety of values including data, MACs, and DH values. The most common is to use <strong>RSA</strong> to sign a hashed value for some block of data, although the <em>digital signature standard</em> (written as DSS or DSA to indicate the digital signature algorithm) <a href="#FIPS186-3">[FIPS186-3]</a> is also used in some circumstances. With the advent of ECC, signatures based on elliptic curves (e.g., ECDSA <a href="#X9.62-2005">[X9.62-2005]</a>) are also now supported in many systems.</p>
</div>
<div class="paragraph">
<p>The concept of a cryptographic suite evolved in the context of Internet security protocols because of a need for modularity and decoupled evolution.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As computational power has improved, older cryptographic algorithms and smaller key lengths have fallen victim to various forms of brute-force attacks.</p>
</li>
<li>
<p>In some cases, more sophisticated attacks have revealed flaws that necessitate the replacement of the underlying mathematical and cryptographic methods, but the basic protocol machinery is otherwise sound.</p>
</li>
<li>
<p>As a result, the choice of a cryptographic suite can now be made separately from the communication protocol details and depends on factors such as convenience, performance, and security.</p>
</li>
<li>
<p>Protocols tend to make use of the components of a cryptographic suite in a standard way, so an appropriate cryptographic suite can be “snapped in” when deemed appropriate.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="certificates-certificate-authorities-cas-and-pkis">3. Certificates, Certificate Authorities (CAs), and PKIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Key management</strong>, how keys are <em>created</em>, <em>exchanged</em>, and <em>revoked</em>, remains one of the greatest challenges in deploying cryptographic systems on a widespread basis across multiple administrative domains.</p>
</div>
<div class="paragraph">
<p>One of the challenges with public key cryptosystems is to determine the correct public key for a principal or identity.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/passive-active-attacks.jpg" alt="Passive and active attacks" width="50%" height="50%">
</div>
<div class="title">Figure 9. The principals, Alice and Bob, attempt to communicate securely, but Eve may eavesdrop and Mallory may modify messages in transit.</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In our running example, if Alice were to send her public key to Bob, Mallory could modify it in transit to be her own public key, and Bob (called the <em>relying party</em> here) might unknowingly be using Mallory’s key, thinking it is Alice’s. This would allow Mallory to effectively masquerade as Alice.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>To address this problem, a <strong>public key certificate</strong> is used to bind an identity to a particular public key using a digital signature.</p>
</div>
<div class="paragraph">
<p>At first glance, this presents a certain “chicken-egg” problem: How can a public key become signed if the digital signature itself requires a reliable public key?</p>
</div>
<div class="paragraph">
<p>One model, called a <strong>web of trust</strong>, involves having a certificate (identity/key binding) <em>endorsed</em> by a collection of existing users (called <strong>endorsers</strong>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An endorser signs a certificate and distributes the signed certificate.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The more endorsers for a certificate over time, the more reliable it is likely to be.</p>
</div>
<div class="paragraph">
<p>An entity checking a certificate might require some number of endorsers or possibly some particular endorsers to trust the certificate.</p>
</div>
</div>
</div>
</li>
<li>
<p>The web of trust model is decentralized and “grassroots” in nature, with no central authority. This has mixed consequences.</p>
<div class="paragraph">
<p>Having no central authority suggests that the scheme will not collapse because of a single point of failure, but it also means that a new entrant may experience some delay in getting its key endorsed to a degree sufficient to be trusted by a significant number of users.</p>
</div>
</li>
<li>
<p>The web of trust model was first described as part of the <strong>Pretty Good Privacy</strong> (<em>PGP</em>) encryption system for electronic mail <a href="#NAZ00">[NAZ00]</a>, which has evolved to support a standard encoding format called <strong>OpenPGP</strong>, defined by <a href="#RFC4880">[RFC4880]</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A more formal approach, which has the added benefit of being provably secure under certain theoretical assumptions in exchange for more dependence on a centralized authority, involves the use of a <strong>public key infrastructure</strong> (<strong>PKI</strong>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A PKI is a service that operates with a collection of <strong><em>certificate authorities</em></strong> (<strong>CAs</strong>) responsible for creating, revoking, distributing, and updating key pairs and certificates.</p>
</li>
<li>
<p>A CA is an entity and service set up to manage and attest to the bindings between identities and their corresponding public keys. There are several hundred commercial CAs.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A CA usually employs a <em>hierarchical</em> signing scheme. This means that a public key may be signed using a parent key which is in turn signed by a grand-parent key, and so on. Ultimately a CA has one or more <strong><em>root certificates</em></strong> upon which many subordinate certificates depend for trust.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://letsencrypt.org/images/isrg-hierarchy.png" alt="ISRG Certificate Hierarchy Diagram, as of December 2020" width="60%" height="60%">
</div>
<div class="title">Figure 10. <a href="https://letsencrypt.org/certificates/">Let&#8217;s Encrypt&#8217;s Hierarchy as of August 2021</a></div>
</div>
</blockquote>
</div>
</li>
<li>
<p>An entity that is authoritative for certificates and keys (e.g., a CA) is called a <strong><em>trust anchor</em></strong>, although this term is also used to describe the certificates or other cryptographic material associated with such entities <a href="#RFC6024">[RFC6024]</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="public-key-certificates-certificate-authorities-and-x-509">3.1. Public Key Certificates, Certificate Authorities, and X.509</h3>
<div class="paragraph">
<p>While several types of certificates have been used in the past, the one of most interest to us is based on an Internet profile of the ITU-T X.509 standard <a href="#RFC5280">[RFC5280]</a>.</p>
</div>
<div class="paragraph">
<p>In addition, any particular certificate may be stored and exchanged in a number of file or encoding formats. The most common ones include DER, PEM (a Base64 encoded version of DER), PKCS#7 (P7B), PKCS#12 (PFX), and PKCS#1 <a href="#RFC3447">[RFC3447]</a>.</p>
</div>
<div class="paragraph">
<p>Today, Internet PKI-related standards tend to use the <em>cryptographic message syntax</em> <a href="#RFC5652">[RFC5652]</a>, which is based on PKCS#7 version 1.5.</p>
</div>
<div class="paragraph">
<p>Certificates are primarily used in identifying four types of entities on the Internet: individuals, servers, software publishers, and CAs. Certificate classes are primarily a convenience for grouping and naming types of certificates and for defining different security policies associated with them.</p>
</div>
<div class="paragraph">
<p>In practice, systems requiring public key operations have root certificates for popular CAs installed at configuration time (e.g., Microsoft Internet Explorer, Mozilla’s Firefox, and Google’s Chrome are all capable of accessing a preconfigured database of root certificates), to solve the chicken-egg PKI bootstrapping problem.</p>
</div>
<div class="paragraph">
<p>The <code>openssl</code> command, available for most common platforms including Linux and Windows, allows us to see the certificates for a Web site:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl version <span class="nt">-d</span>
<span class="go">OPENSSLDIR: "/usr/lib/ssl"
</span><span class="gp">$</span><span class="w"> </span>openssl s_client <span class="nt">-CApath</span> /usr/lib/ssl/certs/ <span class="nt">-connect</span> www.digicert.com:443 <span class="o">&gt;</span> digicert.out 2&gt;1
<span class="go">^C (to interrupt)</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The first command determines where the local system stores its preconfigured CA certificates. This is usually a directory that varies by system.</p>
</li>
<li>
<p>The next makes a connection to the HTTPS port (443) on the <code>www.digicert.com</code> server and redirect the output to the <code>digicert.out</code> file.</p>
</li>
<li>
<p>The <code>openssl</code> command takes care to print the entity identified by each of the certificates, and at what depth they are in the certificate hierarchy relative to the root (depth 0 is the server’s certificate, so the depth numbers are counted bottom to top).</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">head </span>digicert.out
<span class="go">CONNECTED(00000003)
---
Certificate chain
 0 s:jurisdictionC = US, jurisdictionST = Utah, businessCategory = Private Organization, serialNumber = 5299537-0142, C = US, ST = Utah, L = Lehi, O = "DigiCert, Inc.", CN = www.digicert.com
   i:C = US, O = DigiCert Inc, CN = DigiCert EV RSA CA G2
</span><span class="gp">   a:PKEY: rsaEncryption, 2048 (bit);</span><span class="w"> </span>sigalg: RSA-SHA256
<span class="gp">   v:NotBefore: Jun 26 00:00:00 2023 GMT;</span><span class="w"> </span>NotAfter: Jun 25 23:59:59 2024 GMT
<span class="go"> 1 s:C = US, O = DigiCert Inc, CN = DigiCert EV RSA CA G2
   i:C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert Global Root G2
</span><span class="gp">   a:PKEY: rsaEncryption, 2048 (bit);</span><span class="w"> </span>sigalg: RSA-SHA256</code></pre>
</div>
</div>
</li>
<li>
<p>It also checks the certificates against the stored CA certificates to see if they verify properly.</p>
<div class="paragraph">
<p>In this case, they do, as indicated by “verify return” having value <code>0</code> (ok).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">grep</span> <span class="s1">'return code'</span> digicert.out
<span class="go">Verify return code: 0 (ok)</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get the certificate into a more usable form, we can extract the certificate data, convert it, and place the result into a PEM-encoded certificate file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-in</span> digicert.out <span class="nt">-out</span> digicert.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the certificate in PEM format, we can now use a variety of <code>openssl</code> functions to manipulate and inspect it. At the highest level, the certificate includes some <em>data</em> to be signed (called the <em>To Be Signed (TBS) certificate</em>) followed by a <em>signature algorithm identifier</em> and <em>signature value</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-in</span> digicert.pem <span class="nt">-text</span>
<span class="go">Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            09:fc:b7:40:3f:fd:79:b6:8f:e2:4f:74:80:5f:5d:00
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: C = US, O = DigiCert Inc, CN = DigiCert EV RSA CA G2
        Validity
            Not Before: Jun 26 00:00:00 2023 GMT
            Not After : Jun 25 23:59:59 2024 GMT
        Subject: jurisdictionC = US, jurisdictionST = Utah, businessCategory = Private Organization, serialNumber = 5299537-0142, C = US, ST = Utah, L = Lehi, O = "DigiCert, Inc.", CN = www.digicert.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:98:df:33:59:c1:3b:a7:38:8c:5d:9e:2f:e3:cf:
</span><span class="c">                    ...
</span><span class="go">                    c0:ca:25:49:9d:45:d0:67:7e:d9:78:c9:0e:34:95:
                    88:39
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Authority Key Identifier:
                6A:4E:50:BF:98:68:9D:5B:7B:20:75:D4:59:01:79:48:66:92:32:06
            X509v3 Subject Key Identifier:
                D4:38:B0:9D:E2:63:52:91:C7:82:03:F0:1F:00:CE:EE:A0:FA:B7:93
            X509v3 Subject Alternative Name:
                DNS:www.digicert.com, DNS:digicert.com, DNS:admin.digicert.com, DNS:api.digicert.com, DNS:content.digicert.com, DNS:order.digicert.com, DNS:login.digicert.com, DNS:ws.digicert.com
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 CRL Distribution Points:
                Full Name:
                  URI:http://crl3.digicert.com/DigiCertEVRSACAG2.crl
                Full Name:
                  URI:http://crl4.digicert.com/DigiCertEVRSACAG2.crl
            X509v3 Certificate Policies:
                Policy: 2.16.840.1.114412.2.1
                Policy: 2.23.140.1.1
                  CPS: http://www.digicert.com/CPS
            Authority Information Access:
                OCSP - URI:http://ocsp.digicert.com
                CA Issuers - URI:http://cacerts.digicert.com/DigiCertEVRSACAG2.crt
            X509v3 Basic Constraints:
                CA:FALSE
            CT Precertificate SCTs:
                Signed Certificate Timestamp:
                    Version   : v1 (0x0)
                    Log ID    : 76:FF:88:3F:0A:B6:FB:95:51:C2:61:CC:F5:87:BA:34:
                                B4:A4:CD:BB:29:DC:68:42:0A:9F:E6:67:4C:5A:3A:74
                    Timestamp : Jun 26 17:26:00.704 2023 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:46:02:21:00:89:EB:FD:DB:D0:80:4F:31:30:73:D8:
</span><span class="c">                                ...
</span><span class="go">                                27:74:33:78:C4:AC:AF:18
                Signed Certificate Timestamp:
                    Version   : v1 (0x0)
                    Log ID    : 48:B0:E3:6B:DA:A6:47:34:0F:E5:6A:02:FA:9D:30:EB:
                                1C:52:01:CB:56:DD:2C:81:D9:BB:BF:AB:39:D8:84:73
                    Timestamp : Jun 26 17:26:00.754 2023 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:44:02:20:79:AB:36:3F:F9:22:B1:E1:2D:F4:57:16:
</span><span class="c">                                ...
</span><span class="go">                                55:46:5E:B2:83:16
                Signed Certificate Timestamp:
                    Version   : v1 (0x0)
                    Log ID    : 3B:53:77:75:3E:2D:B9:80:4E:8B:30:5B:06:FE:40:3B:
                                67:D8:4F:C3:F4:C7:BD:00:0D:2D:72:6F:E1:FA:D4:17
                    Timestamp : Jun 26 17:26:00.748 2023 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:44:02:20:3A:F4:92:55:82:0E:1D:06:A6:21:90:C3:
</span><span class="c">                                ...
</span><span class="go">                                CB:3A:14:83:07:27
    Signature Algorithm: sha256WithRSAEncryption
    Signature Value:
        5d:f7:f6:45:62:22:7e:93:dc:9e:5a:62:2b:3c:8a:f1:06:9b:
</span><span class="c">        ...
</span><span class="go">        e6:4d:4e:9f
-----BEGIN CERTIFICATE-----
MIIHbDCCBlSgAwIBAgIQCfy3QD/9ebaP4k90gF9dADANBgkqhkiG9w0BAQsFADBE
</span><span class="c">...
</span><span class="go">qL35PG7dfEKrx6fD8xlYnWOYSnqNet6EZBCFe+ZNTp8=
-----END CERTIFICATE-----</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The decoded version of the certificate followed by an ASCII (PEM) representation of the certificate (between the <code>BEGIN CERTIFICATE</code> and <code>END CERTIFICATE</code> indicators) shows a <em>data</em> portion and a <em>signature</em> portion.</p>
</div>
<div class="paragraph">
<p>Within the data portion is some metadata including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <em>Version</em> field, indicating the particular X.509 certificate type (<code>3</code>, the most recent, is encoded using hex value <code>0x02</code>),</p>
</li>
<li>
<p>a <em>Serial Number</em> of the particular certificate, a number assigned by the CA unique to each certificate,</p>
</li>
<li>
<p>and a <em>Validity</em> field that gives the time during which the certificate should be treated as legitimate, starting with the <em>Not Before</em> subfield and ending with the <em>Not After</em> subfield.</p>
</li>
<li>
<p>The certificate metadata also indicates which <em>signature algorithm</em> is used to sign the data portion.</p>
<div class="paragraph">
<p>In this case (i.e. <code>sha256WithRSAEncryption</code>), it is signed by computing a hash using SHA-2 and signing the result using RSA. The signature itself appears at the end of the certificate.</p>
</div>
</li>
<li>
<p>The <em>Issuer</em> field indicates the <em>distinguished name</em> (jargon from the ITU-T X.500 standard) of the entity that issued the certificate and may have these special subfields (based on X.501): <em>C</em> (country), <em>L</em> (locale or city), <em>O</em> (organization), <em>OU</em> (organizational unit), <em>ST</em> (state or province), <em>CN</em> (common name).</p>
</li>
<li>
<p>The <em>Subject</em> field identifies the entity this certificate is about, and the owner of the public key contained in the subsequent <em>Subject Public Key Info</em> field.</p>
<div class="paragraph">
<p>In this example, the <em>Subject</em> field is a somewhat complex structure like the <em>Issuer</em> field and contains multiple <em>object IDs</em> (<em>OIDs</em>) <a href="#ITUOID">[ITUOID]</a>. Most are decoded with names (e.g., <em>O</em>, <em>C</em>, <em>ST</em>, <em>L</em>, <em>CN</em>), but some are not because the particular version of <code>openssl</code> that printed the output did not understand them.</p>
</div>
<div class="paragraph">
<p>Note that the <em>CN</em> subfield tends to be an important one when identifying subjects and issuers for certificates used on the Internet.</p>
</div>
<div class="paragraph">
<p>For this certificate, it gives the correct matching name for the server (along with any names included in the <em>Subject Alternative Name</em> (<em>SAN</em>) extension). Nonmatching names or URLs (e.g., <code><a href="https://digicert.com" class="bare">https://digicert.com</a></code> instead of <code><a href="https://www.digicert.com" class="bare">https://www.digicert.com</a></code>) referring to the same server, when accessed, is also ok.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that <em>CN</em> is not really the field for holding a DNS name; SANs are intended for this purpose.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a certificate needs to be validated, a recursive process works up the certificate hierarchy to a root CA certificate by matching the issuer distinguished name in one certificate with the subject name in another.</p>
</div>
<div class="paragraph">
<p>In this case, the certificate was issued by <code>DigiCert EV RSA CA G2</code> (the issuer’s <em>CN</em> subfield). Assuming all certificates are current in their validity periods and are being used in appropriate ways, some parent certificate (immediate parent, grandparent, etc., but usually a root CA certificate) to the <em>Subject</em> field of the certificate we are evaluating must be trusted for validation to be successful.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>The <em>Subject Public Key Info</em> field gives the algorithm and public key belonging to the entity specified in the <em>Subject</em> field.</p>
<div class="paragraph">
<p>In this case, the public key is an RSA public key with a 2048-bit modulus and public exponent of 65537. The subject is in possession of the matching RSA private key (modulus plus private exponent) that is paired to the public key. If the private key is compromised, or if the public key needs to be changed for other reasons, the public and private keys must be regenerated and a new certificate issued. The old certificate is then revoked.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Version 3 X.509 certificates may include zero or more <em>extensions</em>.</p>
<div class="paragraph">
<p>Extensions are either critical or noncritical, and some are required by the Internet profile in [RFC5280]. If critical, an extension must be processed and found acceptable by the relying party’s (CPS jargon) policy. Noncritical extensions are processed if supported but do not otherwise cause errors.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>The <em>Basic Constraints</em> extension, a critical extension, indicates whether the certificate is a CA certificate.</p>
<div class="paragraph">
<p>In this case it is not, so it cannot be used for signing other certificates. A certificate indicating that it is a CA certificate may be used in a certificate validation chain at a location other than a leaf. This is common for root CA certificates or for other certificate-signing certificates (“intermediate” certificates, such as the <code>DigiCert EV RSA CA G2</code> certificate referenced in this example).</p>
</div>
</li>
<li>
<p>The <em>Subject Key Identifier</em> extension identifies the public key in the certificate.</p>
<div class="paragraph">
<p>It allows different keys owned by the same subject to be differentiated.</p>
</div>
</li>
<li>
<p>The <em>Key Usage</em> extension, a critical extension, determines the valid usage for the key.</p>
<div class="paragraph">
<p>Possible usages include <em>digital signature</em>, <em>nonrepudiation</em> (content commitment), <em>key encipherment</em>, <em>data encipherment</em>, <em>key agreement</em>, <em>certificate signing</em>, <em>CRL signing</em>, <em>encipher only</em>, and <em>decipher only</em>.</p>
</div>
<div class="paragraph">
<p>Because server certificates of this kind are primarily used for identifying the two endpoints of a connection and encrypting a session key, the possible usages may be somewhat limited, as in this case.</p>
</div>
</li>
<li>
<p>The <em>Extended Key Usage</em> extension, which may be critical or noncritical, may provide further restrictions on the key use.</p>
<div class="paragraph">
<p>Possible values of this extension when used in the Internet profile include the following: <em>TLS client and server authentication</em>, <em>signing of downloadable code</em>, <em>e-mail protection</em> (nonrepudiation and key agreement or encipherment), various <em>IPsec operating modes</em>, and <em>timestamping</em>.</p>
</div>
</li>
<li>
<p>The <em>SAN</em> extension allows a single certificate to be used for multiple purposes (e.g., for multiple Web sites with distinct DNS names).</p>
<div class="paragraph">
<p>This alleviates the need to have a separate certificate for each Web site, which can significantly reduce cost and administrative burden.</p>
</div>
<div class="paragraph">
<p>In this case, the certificate can be used for either of the DNS names <code>www.digicert.com</code> or <code>content.digicert.com</code> (and also <code>digicert.com</code>), and so on.</p>
</div>
</li>
<li>
<p>The <em>CRL Distribution Points</em> (CDP) extension gives a list of URLs for finding the CA’s certificate revocation list (CRL), a list of revoked certificates used to determine if a certificate in a validation chain has been revoked.</p>
</li>
<li>
<p>The <em>Certificate Policies</em> (CP) extension includes certificate policies applicable to the certificate <a href="#RFC5280">[RFC5280]</a>.</p>
<div class="paragraph">
<p>In this example, the CP extension contains three qulifiers, that is, two policies, and a CPS qualifier. The <em>Policy</em> value of <code>2.16.840.1.114412.2.1</code>, a DigiCert Object Identifier (OID), and the <em>Policy</em> value of <code>2.23.140.1.1</code>, a CABF OID, both indicate that the certificate complies with an EV policy. The <em>CPS</em> qualifier gives a pointer to the URI where the particular applicable CPS for the policy may be found.</p>
</div>
</li>
<li>
<p>The <em>Authority Key Identifier</em> identifies the public key corresponding to the private key used to sign the certificate. It is useful when an issuer has multiple private keys used for generating signatures.</p>
</li>
<li>
<p>The <em>Authority Information Access</em> (AIA) extension indicates where information may be retrieved from the CA.</p>
<div class="paragraph">
<p>In this case, it indicates a URI used to determine if the certificate has been revoked using an online query protocol. It also indicates the list of CA issuers, which includes a URL containing the CA certificate responsible for signing the example server certificate.</p>
</div>
</li>
<li>
<p>Following the extensions, the certificate contains the signature portion. It contains the identification of the signature algorithm (SHA-2 with RSA here), which must match the <em>Signature Algorithm</em> field we encountered earlier.</p>
<div class="paragraph">
<p>In this case, the signature itself is a 256-byte value, corresponding to the 2048-bit modulus used for this use of RSA.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="validating-and-revoking-certificates">3.2. Validating and Revoking Certificates</h3>
<div class="paragraph">
<p>Within the IETF, <a href="#RFC5280">[RFC5280]</a> defines the use of X.509 version 3 certificates with X.509 version 2 CRLs for the Internet that a certificate may have to be revoked and possibly replaced with a freshly issued certificate.</p>
</div>
<div class="paragraph">
<p>To validate a certificate, a <em>validation</em> or <em>certification path</em> must be established that includes a set of validated certificates, usually up to some trust anchor (e.g., root certificate) that is already known to the relying party. One of the key steps involves determining if one or more of the certificates in a chain have been revoked. If so, the path validation fails.</p>
</div>
<div class="paragraph">
<p>In the Internet, there are two primary ways to ensure that entities that wish to use a certificate become aware if it has been revoked: CRLs and the <em>Online Certificate Status Protocol</em> (OCSP) [RFC2560].</p>
</div>
<div class="paragraph">
<p>When the <em>CRL Distribution Point</em> extension includes an HTTP or FTP URI scheme, as it does in the preceding example, the complete URL gives the name of a file encoded in DER format containing an X.509 CRL. In our example, we can retrieve the CRL corresponding to the certificate using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>wget <span class="nt">-q</span> http://crl3.digicert.com/DigiCertEVRSACAG2.crl</code></pre>
</div>
</div>
<div class="paragraph">
<p>and print it out as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl crl <span class="nt">-inform</span> DER <span class="nt">-in</span> DigiCertEVRSACAG2.crl <span class="nt">-text</span>
<span class="go">Certificate Revocation List (CRL):
        Version 2 (0x1)
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: C = US, O = DigiCert Inc, CN = DigiCert EV RSA CA G2
        Last Update: Jul 31 19:48:27 2023 GMT
        Next Update: Aug  7 19:48:27 2023 GMT
        CRL extensions:
            X509v3 Authority Key Identifier:
                6A:4E:50:BF:98:68:9D:5B:7B:20:75:D4:59:01:79:48:66:92:32:06
            X509v3 CRL Number:
                1121
Revoked Certificates:
    Serial Number: 06AA5017961021B47CA95CE01C312405
        Revocation Date: Jul  8 17:31:01 2022 GMT
    Serial Number: 02FDC9206F81D00E3311F7B6D920B1A2
        Revocation Date: Jul 13 15:19:23 2022 GMT
</span><span class="c">    ...
</span><span class="go">    Serial Number: 0C2C2310AFDFF58F2E4A6454FA7B7801
        Revocation Date: Jul 31 17:32:07 2023 GMT
    Signature Algorithm: sha256WithRSAEncryption
    Signature Value:
        1f:ee:29:c7:fa:46:03:85:4a:cc:e0:c4:0b:9d:cd:cf:ea:4c:
</span><span class="c">        ...
</span><span class="go">        27:ca:42:1b
-----BEGIN X509 CRL-----
MIMCHE8wgwIbNgIBATANBgkqhkiG9w0BAQsFADBEMQswCQYDVQQGEwJVUzEVMBMG
</span><span class="c">...
</span><span class="go">3gwZtF3ABgkVW2jJCbM5+tDZzf/jSapQ3fOoPMNqCEknykIb
-----END X509 CRL-----</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we can see the format of an X.509 v2 CRL.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The format is very similar to that of a certificate, and the entire message is signed by a CA as certificates are.</p>
<div class="paragraph">
<p>This is useful because CRLs can be distributed like certificates: using otherwise untrusted communication channels and servers.</p>
</div>
</li>
<li>
<p>In comparison with a certificate, the validity period is replaced by a list of the previous and next CRL updates.</p>
</li>
<li>
<p>There is no subject and no public key but instead a list of serial numbers for revoked certificates plus the time and reason for revocation.</p>
</li>
<li>
<p>There may also be CRL extensions that are unique to CRLs.</p>
<div class="paragraph">
<p>In this example, the <em>Authority Key Identifier</em> extension gives a number identifying the key used by the CA in signing the CRL. The <em>CRL Number</em> extension gives the sequence number of the CRL. Other values are given in <a href="#RFC5280">[RFC5280]</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>OCSP (<em>Online Certificate Status Protocol</em>), the other primary method for determining if a certificate has been revoked, is an application-level request/response protocol usually operated over HTTP (i.e., using the HTTP protocol with TCP/IP on TCP port 80).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An OCSP request includes information identifying a particular certificate, plus some optional extensions. A response indicates whether the certificate is not revoked, unknown, or revoked. An error may be returned if the request cannot be parsed or otherwise acted upon.</p>
</li>
<li>
<p>The key used for signing the OCSP response need not necessarily match the key used to sign the original certificate. This is possible if the issuer included a <em>Key Usage</em> extension indicating an alternate OCSP provider.</p>
</li>
<li>
<p>To see an OCSP request/response exchange, we can execute the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># CONNECTED COMMANDS: Q   End the current SSL connection and exit.</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Q"</span> | <span class="se">\</span>
<span class="gp">&gt;</span><span class="w"> </span>openssl s_client <span class="nt">-connect</span> www.digicert.com:443 2&gt;1 | openssl x509 <span class="nt">-out</span> DigiCert.pem
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Q"</span> | <span class="se">\</span>
<span class="gp">&gt;</span><span class="w"> </span>openssl s_client <span class="nt">-connect</span> www.digicert.com:443 2&gt;1 | openssl x509 <span class="nt">-noout</span> <span class="nt">-subject</span> <span class="nt">-issuer</span> <span class="nt">-ext</span> authorityInfoAccess
<span class="go">subject=jurisdictionC = US, jurisdictionST = Utah, businessCategory = Private Organization, serialNumber = 5299537-0142, C = US, ST = Utah, L = Lehi, O = "DigiCert, Inc.", CN = www.digicert.com
issuer=C = US, O = DigiCert Inc, CN = DigiCert EV RSA CA G2
Authority Information Access:
    OCSP - URI:http://ocsp.digicert.com
    CA Issuers - URI:http://cacerts.digicert.com/DigiCertEVRSACAG2.crt
</span><span class="gp">$</span><span class="w"> </span>wget <span class="nt">-q</span> http://cacerts.digicert.com/DigiCertEVRSACAG2.crt
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nv">CA</span><span class="o">=</span>DigiCertEVRSACAG2.crt
<span class="gp">$</span><span class="w"> </span><span class="nv">CERT</span><span class="o">=</span>DigiCert.pem
<span class="gp">$</span><span class="w"> </span><span class="nv">OSCPURL</span><span class="o">=</span>http://ocsp.digicert.com
<span class="gp">$</span><span class="w"> </span>openssl ocsp <span class="nt">-issuer</span> <span class="nv">$CA</span> <span class="nt">-cert</span> <span class="nv">$CERT</span> <span class="nt">-url</span> <span class="nv">$OSCPURL</span> <span class="nt">-VAfile</span> <span class="nv">$CA</span> <span class="nt">-no_nonce</span> <span class="nt">-text</span>
<span class="go">OCSP Request Data:
    Version: 1 (0x0)
    Requestor List:
        Certificate ID:
          Hash Algorithm: sha1
          Issuer Name Hash: D613075FB6DEA11BDF0182D397E1D37C6E925509
          Issuer Key Hash: 6A4E50BF98689D5B7B2075D45901794866923206
          Serial Number: 09FCB7403FFD79B68FE24F74805F5D00
OCSP Response Data:
    OCSP Response Status: successful (0x0)
    Response Type: Basic OCSP Response
    Version: 1 (0x0)
    Responder Id: 6A4E50BF98689D5B7B2075D45901794866923206
    Produced At: Aug  1 20:19:18 2023 GMT
    Responses:
    Certificate ID:
      Hash Algorithm: sha1
      Issuer Name Hash: D613075FB6DEA11BDF0182D397E1D37C6E925509
      Issuer Key Hash: 6A4E50BF98689D5B7B2075D45901794866923206
      Serial Number: 09FCB7403FFD79B68FE24F74805F5D00
    Cert Status: good
    This Update: Aug  1 20:03:02 2023 GMT
    Next Update: Aug  8 19:03:02 2023 GMT

    Signature Algorithm: sha256WithRSAEncryption
    Signature Value:
        49:59:d8:0f:6c:e4:12:41:ab:0e:7a:4a:ad:94:7c:20:04:5e:
</span><span class="c">        ...
</span><span class="go">        bf:cf:a4:ad:95:2b:4b:16:f8:8c:61:79:63:48:42:57:d3:d2:
        21:6a:d3:fe
Response verify OK
DigiCert.pem: good
	This Update: Aug  1 20:03:02 2023 GMT
	Next Update: Aug  8 19:03:02 2023 GMT</span></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>The request included the identification of a hash algorithm (SHA-1), a hash of the issuer name, a number identifying the issuer’s key (the same as the <em>Authority Key Identifier</em> extension in the certificate), plus the certificate’s serial number.</p>
</li>
<li>
<p>The responder, identified by the responder ID, identifies itself and signs the response. The response includes the hashes and numbers from the request, as well as the certificate status of “good” (i.e., not revoked).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OCSP-based revocation is not an effective technique to mitigate against the compromise of an HTTPS server&#8217;s private key. <a href="#OCSPWIKIPEDIA">[OCSPWIKIPEDIA]</a>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="attribute-certificates">3.3. Attribute Certificates</h3>
<div class="paragraph">
<p>In addition to public key certificates (PKCs) used to bind names to public keys, X.509 defines another type of certificate called an <strong>attribute certificate</strong> (AC).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ACs are similar in structure to PKCs but lack a public key.</p>
</li>
<li>
<p>They are used to indicate other information, including authorization information that may have a lifetime different from (e.g., shorter than) a corresponding PKC <a href="#RFC5755">[RFC5755]</a>.</p>
</li>
<li>
<p>ACs contain other structures similar to PKCs, including extensions and AC policies.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tcpip-security-protocols-and-layering">4. TCP/IP Security Protocols and Layering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Protocols involving cryptography can (and do) exist at a number of different layers in the protocol stack.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security services at the link layer protect information only as it flows across a single communication hop,</p>
</li>
<li>
<p>security at the network layer protects information flowing between hosts,</p>
</li>
<li>
<p>security at the transport layer protects process-to-process communication, and</p>
</li>
<li>
<p>security at the application layer protects information manipulated by applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to protect the data manipulated by applications independently of the communication layers (e.g., files can be encrypted and sent as e-mail attachments).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/security-protocols.png" alt="Security protocols exist at essentially every OSI stack layer" width="75%" height="75%">
</div>
<div class="title">Figure 11. Security protocols exist at essentially every OSI stack layer, plus some “in-between” layers.</div>
</div>
<div class="paragraph">
<p>TLS and IPsec are the most prevalent, as TLS is used with all secure Web communications (HTTPS) and IPsec is used with most network-layer security, including VPNs.</p>
</div>
<div class="sect2">
<h3 id="network-access-control-802-1x-802-1ae-eap-and-pana">4.1. Network Access Control: 802.1X, 802.1AE, EAP, and PANA</h3>
<div class="paragraph">
<p><strong>Network Access Control</strong> (<strong>NAC</strong>) refers to methods used to authorize or deny network communications to particular systems or users.</p>
</div>
<div class="paragraph">
<p>Defined by the IEEE, the 802.1X <strong>Port-Based Network Access Control</strong> (<strong>PNAC</strong>) standard is commonly used with TCP/IP networks to support LAN security in enterprises, for both wired and wireless networks.</p>
</div>
<div class="paragraph">
<p>Used in conjunction with the IETF standard <strong>Extensible Authentication Protocol</strong> (<strong>EAP</strong>) [RFC3748], 802.1X is sometimes called <strong>EAP over LAN</strong> (<strong>EAPoL</strong>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/eap-802.11i-802.1x.png" alt="EAP, supported by 802.11i and 802.1X" width="75%" height="75%">
</div>
<div class="title">Figure 12. EAP, supported by 802.11i and 802.1X, allows for a <em>peer</em> (<em>supplicant</em>) to be authenticated by an <em>authenticator</em> that is separate from an <em>(authentication, authorization, and accounting) AAA server</em>. The authenticator can operate in “pass-through” mode in which it does little more than forward EAP packets. It can also participate more directly in the EAP protocol. The pass-through mode allows authenticators to avoid having to implement a large number of authentication methods. The most common approach is to make a VLAN mapping adjustment so that the authenticated peer is assigned to the protected VLAN or to another VLAN that provides connectivity to the protected VLAN using a router (layer 3).</div>
</div>
<div class="paragraph">
<p>In 802.1X, the protocol between the supplicant and the authenticator is divided into a lower and upper sublayer. The lower layer is called the <em>port access control protocol</em> (PACP). The higher layer is ordinarily some variant of EAP. For use with 802.1AR (X.509 certificates for secure device identities), the variant is called EAP-TLS [RFC5216]. PACP uses EAPoL frames for communication, even if EAP authentication is not used (e.g., when MKA is used). EAPoL frames use an <em>Ethertype</em> field value of <code>0x888E</code>.</p>
</div>
<div class="paragraph">
<p>Moving to IETF standards, EAP is not a single protocol but rather a framework for achieving authentication using a combination of other protocols, such as TLS and IKEv2.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/eap-header.png" alt="EAP Frame Header" width="45%" height="45%">
</div>
<div class="title">Figure 13. The EAP header includes a <code>Code</code> field for demultiplexing packet types (Request, Response, Success, Failure, Initiate, Finish). The <code>Identifier</code> helps match requests to responses. For request and response messages, the first data byte is a <code>Type</code> field. The <code>Length</code> field gives the number of bytes in the EAP message, including the <code>Code</code>, <code>Identifier</code>, and <code>Length</code> fields.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/baseline-eap-message-flow.png" alt="EAP message authentication flow" width="45%" height="45%">
</div>
<div class="title">Figure 14. The baseline EAP messages carry authentication material between the peer and the authenticator. In many deployments, the authenticator is a relatively simple device that acts in a “pass-through” mode. In such cases, most of the protocol processing takes place on the peer and AAA server. IETF standard AAA-specific protocols such as RADIUS or Diameter may be used to encapsulate EAP messages carried between the AAA server and authenticator.</div>
</div>
<div class="paragraph">
<p>EAP is a layered architecture that supports its own multiplexing and demultiplexing. Conceptually, it consists of four layers: the <em>lower layer</em> (for which there are multiple protocols), <em>EAP layer</em>, <em>EAP peer/authenticator layer</em>, and <em>EAP methods layer</em> (for which there are many methods).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/eap-protocol-stack.png" alt="EAP Stack" width="75%" height="75%">
</div>
<div class="title">Figure 15. The EAP stack and implementation model. In the pass-through mode, the peer and AAA server are responsible for implementing the EAP authentication methods. The authenticator need only implement EAP message processing, the authenticator processing, and enough of an AAA protocol (e.g., RADIUS, Diameter) to exchange information with the AAA server.</div>
</div>
</div>
<div class="sect2">
<h3 id="layer-3-ip-security-ipsec">4.2. Layer 3 IP Security (IPsec)</h3>
<div class="paragraph">
<p><strong>IPsec</strong> is an architecture and collection of standards that provide data source authentication, integrity, confidentiality, and access control at the network layer for IPv4 and IPv6 [RFC4301], including Mobile IPv6 [RFC4877]. It also provides a way to exchange cryptographic keys between two communicating parties, a recommended set of cryptographic suites, and a method for signaling the use of compression.</p>
</div>
<div class="paragraph">
<p>Each communicating party may be an individual host or a <em>security gateway</em> (<strong>SG</strong>) that provides a boundary between a protected and an unprotected portion of a network.</p>
</div>
<div class="paragraph">
<p>Thus, IPsec can be used in applications such as remote access to a corporate LAN (forming a <strong>VPN</strong>), to interconnect different portions of an enterprise securely across the open Internet, or to secure the communications of hosts or routers acting as hosts when exchanging routing information.</p>
</div>
<div class="paragraph">
<p>A host implementation of IPsec may be integrated within the IP stack itself or may act as a driver sitting “below” the rest of the network stack (called the “Bump in the Stack” or <strong>BITS</strong> implementation).</p>
</div>
<div class="paragraph">
<p>Alternatively, it may reside inside an inline SG, which is sometimes called the “Bump in the Wire” or <strong>BITW</strong> implementation approach. For BITW implementations, both host and SG functionality is generally required, as the device typically needs to be managed remotely.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/ipsec-deployment.png" alt="IPsec deployments" width="75%" height="75%">
</div>
<div class="title">Figure 16. IPsec is applicable to securing host-to-host communications, host-to-gateway communications, and gateway-to-gateway communications. It also supports multicast distribution and mobility.</div>
</div>
<div class="paragraph">
<p>The operation of IPsec can be divided into the <strong><em>establishment phase</em></strong>,</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>where key material is exchanged and a <em>security association</em> (SA) is built,</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>followed by the <strong><em>data exchange phase</em></strong>,</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>where different types of encapsulation schemes, called the <em>Authentication Header</em> (AH) and <em>Encapsulating Security Payload</em> (ESP), may be used in different modes such as <em>tunnel mode</em> or <em>transport mode</em> to protect the flow of IP datagrams.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Each of these IPsec components uses a cryptographic suite, and IPsec is designed to support a wide range of suites.</p>
</div>
<div class="paragraph">
<p>A complete IPsec implementation includes the SA establishment protocol, AH (optionally), ESP, and a collection of appropriate cryptographic suites, configuration information, and setup tools [RFC6071].</p>
</div>
<div class="paragraph">
<p>IPsec operates only selectively on certain packets based on policies set by administrators, contained in a <em>security policy database</em> (SPD), logically resident with each IPsec implementation.</p>
</div>
<div class="paragraph">
<p>IPsec also requires two additional databases called the <em>security association database</em> (SAD) and <em>peer authorization database</em> (PAD), which are consulted when determining how packets are to be handled.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/ipsec-packet-processing.png" alt="IPsec packet processing" width="75%" height="75%">
</div>
<div class="title">Figure 17. In a security gateway, IPsec packet processing takes place at layer 3 in a logical entity separating a protected and an unprotected network. The security policy database dictates the disposition of packets: bypass, discard, or protect. Protection generally involves applying or validating integrity protection or encryption. An administrator configures the SPD to achieve desired security goals.</div>
</div>
<div class="sect3">
<h4 id="internet-key-exchange-ikev2-protocol">4.2.1. Internet Key Exchange (IKEv2) Protocol</h4>
<div class="paragraph">
<p>The first step in using IPsec is to establish an SA. An SA is a simplex (one-direction) authenticated association established between two communicating parties, or between a sender and multiple receivers if IPsec is supporting multicast. Most frequently, communication is bidirectional between two parties, so a pair of SAs is required to use IPsec effectively.</p>
</div>
<div class="paragraph">
<p>A special protocol called the <strong>Internet Key Exchange</strong> (<strong>IKE</strong>) is used to accomplish this task automatically. The current version of the protocol is called IKEv2 [RFC5996]. We will refer to it simply as IKE.</p>
</div>
<div class="paragraph">
<p>To establish an SA, IKE begins with a simple request/response message pair that includes a request to establish the following parameters: an <em>encryption algorithm</em>, an <em>integrity protection algorithm</em>, a <em>Diffie-Hellman group</em>, and a <em>PRF</em> (pseudorandom function family) that gives a random-appearing output given any input bit string. In IKE, a PRF is used for generation of session keys. IKE first establishes an SA for itself (called an IKE_SA) and can subsequently establish SAs for either AH or ESP (called CHILD_SAs). IKE is also capable of negotiating the use of <em>IP Payload Compression</em> (IPComp) [RFC3173] with each CHILD_SA, because applying compression at other layers after performing encryption is ineffective.</p>
</div>
<div class="paragraph">
<p>IKE operates using pairs of messages called <strong><em>exchanges</em></strong> that are sent between an <strong><em>initiator</em></strong> and a <strong><em>responder</em></strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first two exchanges, called IKE_SA_INIT and IKE_AUTH, establish an IKE_SA and a single CHILD_SA.</p>
</li>
<li>
<p>Subsequently, CREATE_CHILD_SA exchanges, used to establish additional CHILD_SAs, and INFORMATIONAL exchanges, used to initiate changes in or gather status information about an SA, may occur.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most cases, a single IKE_SA_INIT and IKE_AUTH exchange (a total of four messages) is sufficient. Messages used in an exchange contain <em>payloads</em> identified by type numbers that identify the type of information carried in each payload. Multiple payloads per message are common, and some long messages may require IP fragmentation.</p>
</div>
<div class="paragraph">
<p>IKE messages are sent encapsulated in UDP using port number 500 or 4500. However, because IKE traffic may pass through a NAT where the port number is rewritten, an IKE receiver should be prepared to receive traffic originating from any port. Port 4500 is reserved for UDP-encapsulated ESP and IKE [RFC3948]. IKE messages appearing on port 4500 are required to have their initial 4 data bytes set to 0 (the “non-ESP marker”) to differentiate them from other (i.e., ESP or WESP) messages.</p>
</div>
<div class="paragraph">
<p>IKE initiators perform timer-based retransmissions when IKE messages appear to have been lost. Responders perform retransmissions only when triggered by an incoming request. An exponentially increasing retransmission timer is used for retransmissions, but the total number of retransmissions is left unspecified. Both initiators and responders keep track of their last transmitted messages and corresponding sequence numbers. Sequence numbers are used to match requests with responses, and to identify message retransmissions. This makes IKE a window-based protocol with a maximum window size given by a responder that is initialized when an SA is first set up but can be increased later. The maximum window size limits the total number of outstanding requests.</p>
</div>
<div class="sect4">
<h5 id="ikev2-message-formats">4.2.1.1. IKEv2 Message Formats</h5>
<div class="paragraph">
<p>IKE messages contain a header followed by zero or more <em>IKE payloads</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/ikev2-header.png" alt="IKEv2 header" width="75%" height="75%">
</div>
<div class="title">Figure 18. The IKE v2 header. All IKE messages contain a header followed by zero or more payloads. IKE uses 64-bit <em>Security Parameter Index</em> (SPI) values. The <em>Exchange Type</em> gives the purpose of the exchange and the payloads that may be expected in the message. The <em>Flags</em> field indicates whether the message was sent from an initiator or a responder. The <em>Message ID</em> associates requests with responses and is used for detecting replay attacks.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In the headers of IKE messages, the <em>Security Parameter Index</em> (SPI) is a 64-bit number that identifies a particular IKE_SA (other IPsec protocols use a 32-bit SPI value).</p>
<div class="paragraph">
<p>Both the initiator and the responder have an SA for their peer, so each provides the SPI it is using, and this pair of values, combined with the IP addresses of the endpoints, can be used to form an effective connection identifier.</p>
</div>
</li>
<li>
<p>The <em>Majoe Version</em> and <em>Minor Version</em> fields are set to 2 and 0, respectively, for this version of IKE.</p>
<div class="paragraph">
<p>The major version number is changed when interoperability cannot be maintained between versions.</p>
</div>
</li>
<li>
<p>The <em>Exchange Type</em> field gives the type of exchange of which the message is part: IKE_SA_INIT (34), IKE_AUTH (35), CREATE_CHILD_SA (36), INFORMATIONAL (37), and IKE_SESSION_RESUME (38; see [RFC5723]).</p>
<div class="paragraph">
<p>Other values are reserved; the range 240–255 is reserved for private use.</p>
</div>
</li>
<li>
<p>Three bit fields are defined for the <em>Flags</em> field (bits are labeled right to left, starting from 0): <em>I</em> (<em>Initiator</em>, bit 3), <em>V</em> (<em>Version</em>, bit 4), and <em>R</em> (<em>Response</em>, bit 5).</p>
<div class="paragraph">
<p>The <em>I</em> bit field is set by the original initiator and cleared by the recipient for return messages.</p>
</div>
<div class="paragraph">
<p>The <em>V</em> bit field indicates that the sender supports a higher major version number of the protocol than is currently being used.</p>
</div>
<div class="paragraph">
<p>The <em>R</em> bit field indicates that the message is a response to a previous message using the same message ID.</p>
</div>
</li>
<li>
<p>The <em>Message ID</em> field in IKE acts somewhat like the <em>Sequence Number</em> field in TCP, except the message ID starts with 0 for the initiator and 1 for the responder.</p>
<div class="paragraph">
<p>The field is incremented by 1 for each subsequent transmission, and responses use the same message ID as the requests. The <em>I</em> and <em>R</em> bit fields differentiate requests from responses.</p>
</div>
<div class="paragraph">
<p>Message IDs are remembered when sent or received. Doing so allows each end to perform <em>replay detection</em>. Old message IDs are not processed. Wrapping of the Message ID field (possible, but not likely with 4 billion IKE messages) is handled by reinitiating the IKE_SA_INIT exchange.</p>
</div>
</li>
<li>
<p>The other fields (<em>Next Payload</em> and <em>Length</em>) help describe what the IKE message contains.</p>
<div class="paragraph">
<p>Each message contains zero or more payloads, and each payload has its own particular structure. The <em>Length</em> field gives the size (in bytes) of the header plus all payloads in the message. The <em>Next Payload</em> field gives the type of the following payload. At present, 16 nontrivial types are defined (value 0 indicates no next payload).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. IKEv2 payload types. A value of 0 indicates no next payload. The ranges 1–32 and 49–255 are reserved; the range 128–255 is reserved for private use. Each IKE payload begins with an <em>IKE generic payload header</em>.</caption>
<colgroup>
<col style="width: 5%;">
<col style="width: 10%;">
<col style="width: 35%;">
<col style="width: 5%;">
<col style="width: 10%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Notation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Notation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">33</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security association</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notify</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key exchange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">42</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identification (initiator)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vendor ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identification (responder)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">44</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Traffic selector (initiator)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">37</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CERT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Traffic selector (responder)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">38</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CERTREQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate request (indicates trust anchors)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">46</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SK { }</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encrypted and authenticated (contains other payloads)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">39</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ni, Nr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonces (initiator, responder)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extensible authentication (EAP)</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/ikev2-generic-palyload-header.png" alt="IKEv2 generic payload header" width="70%" height="70%">
</div>
<div class="title">Figure 19. A “generic” IKEv2 payload header. Each payload begins with a header of this form.</div>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>The generic payload header is fixed at 32 bits, and the <em>Next Payload</em> and <em>Payload Length</em> fields provide for a “chain” of variable-size payloads (up to 65,535 bytes each, including the 4-byte payload header) to be present in a single IKE message. Each payload type has its own set of special headers.</p>
</li>
<li>
<p>The <em>C</em> (critical) bit field indicates that the current payload (not the one identified by the <em>Next Payload</em> field) is deemed “critical” for a successful IKE exchange.</p>
<div class="paragraph">
<p>Receivers of critical payloads that do not understand the type code (provided in the previous payload’s <em>Next Payload</em> field or in the IKE header’s <em>Next Payload</em> field) must abort the IKE exchange.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="the-ike_sa_init-exchange">4.2.1.2. The IKE_SA_INIT Exchange</h5>
<div class="paragraph">
<p>The first of two exchanges, IKE_SA_INIT and IKE_AUTH, constituting the “initial exchanges” of IKE, formerly known as Phase 1 in earlier versions of IKE. Other exchanges (CREATE_CHILD_SA and INFORMATIONAL) may be initiated by either party only after the initial exchanges have completed, and they are always secured (encrypted and integrity-protected) based on the parameters established using the first two exchanges.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/IKE_SA_INIT_and_IKE_AUTH_exchanges.png" alt="IKE_SA_INIT and IKE_AUTH exchange" width="40%" height="40%">
</div>
<div class="title">Figure 20. The IKE_SA_INIT and IKE_AUTH exchange involves payloads used to establish the first two security associations (IKE_SA and one CHILD_SA). Certificates and certificate request payloads (with trust anchors) may also be included, as may Notification and Configuration payloads (not shown).</div>
</div>
<div class="paragraph">
<p>As shown, IKE_SA_INIT negotiates the choice of cryptographic suite, exchanges nonces, and performs a DH key agreement. It may also include additional information, depending on the particular implementation and deployment scenario.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It begins when the initiator sends an IKE message containing its set of supported cryptographic suites, DH information, and nonce using three payloads (SA, KE, and Ni).</p>
</li>
<li>
<p>Upon receiving the first message, the responder becomes aware that an IKE transaction is requested by the initiator, the initiator’s supported cryptographic suites, and configuration parameters.</p>
<div class="paragraph">
<p>The responder selects an acceptable cryptographic suite and expresses this in the SAr1 payload. It also provides its portion of the DH key agreement parameters in KEr, its nonce in Nr, and an optional request for the initiator’s certificate in the CERTREQ payload.</p>
</div>
<div class="paragraph">
<p>CERTREQ payloads include an indication of CAs the responder finds acceptable for validating certificates that may be used in subsequent exchanges (i.e., it indicates the responder’s trust anchors).</p>
</div>
<div class="paragraph">
<p>A message containing the responder’s IKE header and all of these payloads is then sent in response to the initiator, completing the IKE_SA_INIT exchange.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="security-association-sa-payloads-and-proposals">4.2.1.3. Security Association (SA) Payloads and Proposals</h5>
<div class="paragraph">
<p>SA payloads contain an SPI value and a set of proposals (often one).</p>
</div>
<div class="paragraph">
<p>Proposals are built using proposal structures that are somewhat complex. Each proposal structure is numbered and contains an IPsec protocol ID. A protocol ID indicates one of the following IPsec protocols: IKE, AH, or ESP.</p>
</div>
<div class="paragraph">
<p>Multiple proposal structures using the same proposal number are considered to be part of the same proposal (an “AND” of the specified protocols). Proposal structures with different proposal numbers are considered different proposals (an “OR” of the specified protocols).</p>
</div>
<div class="paragraph">
<p>Each proposal/protocol structure contains one or more transform structures that describe algorithms to be used with the specified protocols.</p>
</div>
<div class="paragraph">
<p>Typically, AH has a single transform (integrity check algorithm), ESP has two (integrity check and encryption algorithms), and IKE has four (DH group number, PRF, integrity check, and encryption algorithms).</p>
</div>
</div>
<div class="sect4">
<h5 id="key-exchange-ke-and-nonce-ni-nr-payloads">4.2.1.4. Key Exchange (KE) and Nonce (Ni, Nr) Payloads</h5>
<div class="paragraph">
<p>In addition to SA payloads, IKE_SA_INIT messages include a KE (Key Exchange) and Nonce payload (written as Ni, Nr, or sometimes No).</p>
</div>
<div class="paragraph">
<p>The KE payload contains the DH group number and key exchange data representing the public numbers used in forming an ephemeral Diffie-Hellman key (initial shared secret). The DH group number gives the group in which the public value was computed. The Nonce payload contains a recently generated nonce between 16 and 256 bytes in length. It is used in generating key material to ensure freshness and protect against replay attacks.</p>
</div>
<div class="paragraph">
<p>Once the DH exchange completes, each side can compute its <strong>SKEYSEED</strong> value, which is used for all subsequent key generation associated with the IKE_SA (unless a key-generating EAP method is used for this purpose), a total of seven secret values: SK_d, SK_ai, SK_ar, SK_ei, SK_er, SK_pi, and SK_pr.</p>
</div>
<div class="paragraph">
<p>The SK_d key is used for deriving keys for CHILD_SAs. The SK_a and SK_e keys are for authentication and encryption, respectively. The SK_p keys are used in generating AUTH payloads during the IKE_AUTH exchange.</p>
</div>
</div>
<div class="sect4">
<h5 id="notification-n-and-configuration-cp-payloads">4.2.1.5. Notification (N) and Configuration (CP) Payloads</h5>
<div class="paragraph">
<p>The N payload is a Notification or Notify payload. It can be used for conveying error messages and indications of various processing capabilities with most of the IKE exchange types. It contains a variable-length SPI field and a 16-bit field to indicate the notification type. Values below 8192 are used for standard errors, and values above 16383 are used for status indicators.</p>
</div>
<div class="paragraph">
<p>For example, when requesting the creation of a transport mode SA instead of the default tunnel mode, a Notify payload containing the USE_ TRANSPORT_MODE value (16391) is used. If IP compression [RFC3173] is supported, this fact can be indicated by the IPCOMP_SUPPORTED value (16387). Notify payloads may contain a variable-length data portion whose content depends on the notification type.</p>
</div>
<div class="paragraph">
<p>A CP or Configuration payload also contains additional information like a Notify payload but is used primarily for initial system configuration. For example, obtaining information that might ordinarily be conveyed using DHCP can be carried over IKE using a CP.</p>
</div>
</div>
<div class="sect4">
<h5 id="algorithm-selection-and-application">4.2.1.6. Algorithm Selection and Application</h5>
<div class="paragraph">
<p>IKE divides the set of transforms forming a cryptographic suite into four types: <em>encryption (type 1, used with IKE and ESP)</em>, <em>PRF (type 2, used with IKE)</em>, <em>integrity protection (type 3, used with IKE and AH and optional in ESP)</em>, and <em>DH group (type 4, used with IKE and optional in AH and ESP)</em>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Mandatory-to-implement algorithms for use with IKEv2, grouped by type number. [RFC4307]</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Number</th>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Original Defining RFC/Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IKE Transform</p>
<p class="tableblock">Type 1 (encryption)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENCR_3DES</p>
<p class="tableblock">ENCR_NULL</p>
<p class="tableblock">ENCR_AES_CBC</p>
<p class="tableblock">ENCR_AES_CTR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p>
<p class="tableblock">11</p>
<p class="tableblock">12</p>
<p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p>
<p class="tableblock">Optional</p>
<p class="tableblock">Recommended</p>
<p class="tableblock">Recommended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC2451]</p>
<p class="tableblock">[RFC2410]</p>
<p class="tableblock">[RFC3602]</p>
<p class="tableblock">[RFC3686]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IKE Transform</p>
<p class="tableblock">Type 2 (for PRFs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRF_HMAC_MD5</p>
<p class="tableblock">PRF_HMAC_SHA1</p>
<p class="tableblock">PRF_AES128_CBC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p>
<p class="tableblock">2</p>
<p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p>
<p class="tableblock">Required</p>
<p class="tableblock">Recommended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC2104]</p>
<p class="tableblock">[RFC2104]</p>
<p class="tableblock">[RFC4434]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IKE Transform</p>
<p class="tableblock">Type 3 (integrity)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTH_HMAC_MD5_96</p>
<p class="tableblock">AUTH_HMAC_SHA1_96</p>
<p class="tableblock">AUTH_AES_XCBC_96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p>
<p class="tableblock">2</p>
<p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p>
<p class="tableblock">Required</p>
<p class="tableblock">Recommended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC2403]</p>
<p class="tableblock">[RFC2404]</p>
<p class="tableblock">[RFC3566]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IKE Transform</p>
<p class="tableblock">Type 4 (DH groups)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024 MODP (Group 2)</p>
<p class="tableblock">2048 MODP (Group 14)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p>
<p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p>
<p class="tableblock">Recommended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[RFC2409]</p>
<p class="tableblock">[RFC3526]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="the-ike_auth-exchange">4.2.1.7. The IKE_AUTH Exchange</h5>
<div class="paragraph">
<p>As mentioned earlier, the SKEYSEED value is used to derive encryption and authentication keys that are in turn used to secure payloads during the IKE_AUTH exchange. These keys are called SK_e and SK_a, respectively. The notation SK{P1, P2, &#8230;&#8203;, PN} indicates that payloads P1, &#8230;&#8203;, PN are encrypted and integrityprotected using these keys.</p>
</div>
<div class="paragraph">
<p>The primary purpose of the IKE_AUTH exchange is to provide identity validation for each peer. It also exchanges sufficient information to establish the first CHILD_SA.</p>
</div>
<div class="paragraph">
<p>To begin the IKE_AUTH exchange, the initiator sends the payload SK{IDi, AUTH, SAi2, TSi, TSr}. Given the proper decryption key, it provides the initiator’s identity, authentication information validating the initiator’s identity, another SA payload for the first CHILD_SA called SAi2, and a pair of traffic selectors (payloads TSi and TSr). The initiator may also include its certificate in a CERT payload, a certificate request in a CERTREQ payload that identifies its trust anchors, and identification of the responder in the IDr payload. Sending the responder’s identity is useful in the case where the responder has multiple identities associated with the same IP address and needs to ensure that the proper SA is set up. Several different identity types are supported for ID payloads, including IP address, FQDN, e-mail address, and distinguished name (to be used with X.509 certificates).</p>
</div>
<div class="paragraph">
<p>The final message of the exchange includes the responder’s identity (IDr), authentication material to prove the responder’s identity (AUTH), the other SA constituting the CHILD_SA (SAr2), and a set of traffic selectors (TSi and TSr), which may be subsets of the original TSi and TSr values. All payloads in the IKE_AUTH exchange are encrypted and integrity-protected. A certificate payload (CERT) containing one or more certificates may also be sent at this point. If so, any public key required to validate the AUTH payload appears first in the certificate list. The specific contents vary depending on the cryptographic suite selected. During the exchanges, both sides must check all applicable signatures in order to be safe from compromise, including MITM attacks.</p>
</div>
</div>
<div class="sect4">
<h5 id="traffic-selectors-and-ts-payloads">4.2.1.8. Traffic Selectors and TS Payloads</h5>
<div class="paragraph">
<p>Traffic selectors indicate the fields and corresponding values of an IP datagram that cause it to be "selected" for IPsec processing. They are used in combination with an IPsec SPD to determine whether the containing datagram should be protected using IPsec.</p>
</div>
<div class="paragraph">
<p>The contents of a TS payload may include IPv4 or IPv6 address ranges, port number ranges, and an IPv4 protocol ID or IPv6 header value. Ranges are sometimes denoted with wildcard notation.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>For example, the notation <code>192.0.2.*</code> or <code>192.0.2.0/24</code> would represent the range <code>192.0.2.0–192.0.2.255</code>.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Traffic selectors can be used to help implement policies such as which cryptographic suite is required to establish an SA to a particular host or port range. Most of these details are handled in the management interface to the SPD.</p>
</div>
<div class="paragraph">
<p>During an IKE_AUTH exchange, each party specifies a TSi and TSr payload containing TS values. When one range is smaller than another, the smaller range is selected for use in a process called “narrowing.”</p>
</div>
</div>
<div class="sect4">
<h5 id="eap-and-ike">4.2.1.9. EAP and IKE</h5>
<div class="paragraph">
<p>Although IKE includes its own authentication methods (see Section 2.15 of [RFC5996]), it can also make use of EAP (see Sections 2.16 and 3.16 of [RFC5996]). With EAP, a wide array of authentication methods can be used beyond the relatively limited set of pre-shared keys or public key certificates otherwise required by IKE.</p>
</div>
</div>
<div class="sect4">
<h5 id="better-than-nothing-security-btns">4.2.1.10. Better-than-Nothing Security (BTNS)</h5>
<div class="paragraph">
<p>A relatively recent development with IKE and IPsec is called <em>better-than-nothing security</em> (<strong>BTNS</strong>, pronounced “buttons”). BTNS aims to address some of the usability and ease of deployment issues with IPsec, especially the need to establish a PKI or other deployed authentication system [RFC5387] to use certificates.</p>
</div>
<div class="paragraph">
<p>Technically, BTNS is essentially unauthenticated IPsec [RFC5386], and it can be supported when IKE is used to establish an SA. With BTNS, public keys are used, but their containing certificates are not checked against a chain or root certificate. Consequently, an SA can ensure that the same entity is communicating over time but cannot ensure that any particular, validated entity established the SA. This form of authentication is called <em>continuity of association</em> and is weaker than the <em>data origin authentication</em> present in ordinary IPsec.</p>
</div>
<div class="paragraph">
<p><em>BTNS makes no other substantive changes to IPsec; the formats of IKE, AH, and ESP messages remain the same.</em></p>
</div>
</div>
<div class="sect4">
<h5 id="the-create_child_sa-exchange">4.2.1.11. The CREATE_CHILD_SA Exchange</h5>
<div class="paragraph">
<p>The CREATE_CHILD_SA exchange is used to create CHILD_SAs for ESP or AH, or to rekey existing SAs (either IKE_SAs or CHILD_SAs) once the initial exchanges have completed.</p>
</div>
<div class="paragraph">
<p>It uses a single exchange of packets and may be initiated by either side of the IKE_SA established during the initial exchanges. There are two variants, depending on whether a CHILD_SA or IKE_SA is being modified.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/CREATE_CHILD_SA-exchange.png" alt="CREATE_CHILD_SA exchange" width="40%" height="40%">
</div>
<div class="title">Figure 21. The CREATE_CHILD_SA exchange can be used to create or rekey a CHILD_SA, or to rekey an IKE_SA. A Notification payload is used when modifying a CHILD_SA to indicate the SPI of the SA to modify.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The first exchange depicts a CREATE_CHILD_SA used to create a new CHILD_SA or rekey an existing one.</p>
<div class="paragraph">
<p>Rekeying is indicated by the presence of an N(REKEY_SA) Notification payload sent by the initiator. To complete the rekey operation, a new SA is first created, and the old one is subsequently deleted. The new SA and traffic selector (TS) information allows most of the connection parameters to be altered.</p>
</div>
<div class="paragraph">
<p>If desired, new DH values can also be exchanged at this point using KE payloads. This provides better <em>forward secrecy</em> for the new SA.</p>
</div>
</li>
<li>
<p>Rekeying an IKE_SA uses a similar exchange, except the KE payloads are required and the TS payloads are not used, as shown in the second part.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="the-informational-exchange">4.2.1.12. The INFORMATIONAL Exchange</h5>
<div class="paragraph">
<p>The INFORMATIONAL exchange is used for conveying status and error information, usually using Notify (N) payloads. It is also used for deleting SAs using a Delete (D) payload and therefore constitutes one portion of the SA rekeying procedure.</p>
</div>
<div class="paragraph">
<p>An INFORMATIONAL exchange can take place only after successful completion of the initial exchanges. It includes an optional set of notifications, Delete (D) payloads that specify SAs to delete by SPI value, and Configuration (CP) payloads.</p>
</div>
<div class="paragraph">
<p>Some response is always required for any message received from an initiator, even if it is an empty IKE message (i.e., contains only a header). Otherwise, the initiator would retransmit its message unnecessarily.</p>
</div>
<div class="paragraph">
<p>In unusual cases, INFORMATIONAL messages may be sent outside the context of an INFORMATIONAL exchange, usually to signal the receipt of an IPsec message containing an unrecognized SPI value or unsupported IKE major version number.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/INFORMATIONAL-exchange.png" alt="INFORMATIONAL exchange" width="50%" height="50%">
</div>
<div class="title">Figure 22. The INFORMATIONAL exchange is used to convey status information and delete SAs. It makes use of Notification (N), Delete (D), and Configuration (CP) payloads.</div>
</div>
</div>
<div class="sect4">
<h5 id="mobile-ike-mobike">4.2.1.13. Mobile IKE (MOBIKE)</h5>
<div class="paragraph">
<p>Once the IKE_SA has been established, it is ordinarily used until no longer required. However, when IPsec operates in an environment where IP addresses may change because of mobility or interface failure, a variant of IKE has been specified in [RFC4555] called MOBIKE. MOBIKE augments the basic IKEv2 protocol to include additional “address change” options available in INFORMATIONAL exchanges. MOBIKE specifies what to do when the changed addresses are known. It does not address the discovery problem of how to determine these addresses.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="authentication-header-ah">4.2.2. Authentication Header (AH)</h4>
<div class="paragraph">
<p>Defined in [RFC4302], the IP <strong>Authentication Header</strong> (<strong>AH</strong>), one of the three major components of IPsec, is an optional portion of the IPsec protocol suite that provides a method for achieving origin authentication and integrity (but not confidentiality) of IP datagrams. By providing only integrity and not confidentiality (and not working with NAT), AH is the (far) less popular of the two primary IPsec data-securing protocols.</p>
</div>
<div class="paragraph">
<p>In transport mode, AH uses a header placed between the layer 3 (IPv4, IPv6 base, or IPv6 extension) header and the following protocol header (e.g., UDP, TCP, ICMP). With IPv6, AH may appear immediately before a <em>Destination Options</em> extension header, if present.</p>
</div>
<div class="paragraph">
<p>In tunnel mode, the “inner” IP header carries the original IP datagram, containing the ultimate IP source and destination information, and a newly created “outer” IP header contains information describing the IPsec peers. In this mode, AH protects the entire inner IP datagram.</p>
</div>
<div class="paragraph">
<p>Generally speaking, transport mode is used between end hosts that are directly connected, and tunnel mode is used between SGs or between a single host and an SG (e.g., for supporting a VPN).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/ipsec-ah-header-transport-mode.png" alt="IPsec Authentication Header (transport mode)" width="45%" height="45%">
</div>
<div class="title">Figure 23. The IPsec Authentication Header is used to provide authentication and integrity protection for IPv4 and IPv6 datagrams. In transport mode (depicted here with TCP), a conventional IP datagram is modified to include the AH.</div>
</div>
<div class="paragraph">
<p>In the figure, the IPv4 encapsulation uses a special IPv4 protocol number (51). For IPv6, the AH is placed between the destination and other options. In either case, the resulting datagram has a mutable portion of its header and an immutable portion of its header.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>mutable</em> portion is changed as the datagram moves through the network. Modifications include changing the IPv4 TTL or IPv6 Hop Limit field, IPv6 Flow Label field, DS Field, and ECN bits.</p>
</li>
<li>
<p>The <em>immutable</em> portion, containing the source and destination IP addresses, is not changed by the network and is integrity-protected using fields in the AH. This prevents transport mode AH datagrams from being rewritten by NATs, a potential problem for many deployments.</p>
</li>
<li>
<p>Transport mode cannot be used with fragments (IPv4 or IPv6).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/ipsec-ah-header-tunnel-mode.png" alt="IPsec Authentication Header (tunnel mode)" width="70%" height="70%">
</div>
<div class="title">Figure 24. The IPsec tunnel mode AH encapsulations provide authentication and integrity protection for IPv4 and IPv6 datagrams. In tunnel mode (depicted here carrying TCP), a conventional IP datagram is encapsulated inside a new “outside” IP datagram that carries the original datagram.</div>
</div>
<div class="paragraph">
<p>In tunnel mode, the entire original IP datagram is untouched, encapsulated and protected with the AH. The “inner” header is unmodified, and the “outer” header is created using the source and destination IP addresses associated with an SG or host.</p>
</div>
<div class="paragraph">
<p>In such cases, AH protects all of the original datagram, plus some portions of the new header (which prevents it being modified by a NAT).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/ipsec-ah-header.png" alt="IPsec Authentication Header" width="70%" height="70%">
</div>
<div class="title">Figure 25. The IPsec AH is used to provide authentication and integrity protection for IPv4 and IPv6 datagrams in either transport or tunnel mode. The SPI value indicates which SA the AH belongs to. The Sequence Number field is used for countering replay attacks. The ICV provides a form of MAC over the immutable portions of the payload.</div>
</div>
<div class="paragraph">
<p>Both modes of AH use the same AH, and identifies the datagram length and associated SA and includes integrity check information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>Payload Length</em> specifies the length of the AH in 32-bit-word units minus 2.</p>
</li>
<li>
<p>The <em>Security Parameters Index</em> (SPI) field contains a 32-bit identifier of an SA at the receiver that contains SA-derived information relating to the association.  For multicast SAs, the SPI value is handled in a special way.</p>
</li>
<li>
<p>The <em>Sequence Number</em> is a 32-bit field that increments by 1 for each packet sent on the SA.</p>
<div class="paragraph">
<p>This field is used for replay protection if enabled by the receiver (but it is always included by the sender, even if not checked by the receiver).</p>
</div>
<div class="paragraph">
<p>An <em>extended sequence number</em> (ESN) operating mode is also defined and recommended and is negotiated during the IKE_SA_INIT exchange. If enabled, the sequence number is calculated using 64 bits, but only the lower-order 32 bits are included in the <em>Sequence Number</em> field.</p>
</div>
</li>
<li>
<p>The length of the <em>Integrity Check Value</em> (ICV) field is variable and depends on the cryptographic suite used. This field is always an integral multiple of 32 bits in length.</p>
<div class="paragraph">
<p>The algorithm used for integrity protection is specified in the corresponding SA as a type 3 transform and can be established manually or by using some automatic method such as IKE.</p>
</div>
<div class="paragraph">
<p>The optional, recommended, and mandatory algorithms for AH (and ESP, later) are provided in [RFC4835] and include HMACMD5-96 (optional), AES-XCBC-MAC-96 (recommended), and HMAC-SHA1-96 (mandatory).</p>
</div>
<div class="paragraph">
<p>The integrity check is computed over the following portions of the datagram: header fields before the AH that are either immutable in transit or predictable in value when arriving at the destination AH SA endpoint, the AH, everything after the AH, high-order bits of the ESN (if employed, even though they are not sent), plus any padding.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="encapsulating-security-payload-esp">4.2.3. Encapsulating Security Payload (ESP)</h4>
<div class="paragraph">
<p>The ESP protocol of IPsec, defined in [RFC4303] (where it is called ESP (v3) even though ESP provides no formal version numbers), provides a selectable combination of confidentiality, integrity, origin authentication, and anti-replay protection for IP datagrams.</p>
</div>
<div class="paragraph">
<p>It can employ a NULL encryption method [RFC2410], which is mandatory to support, if only integrity is to be used. Conversely, encryption can be used for confidentiality without integrity protection, although this combination is effective only against passive attacks and is highly discouraged.</p>
</div>
<div class="paragraph">
<p>In the context of ESP, integrity includes data origin authentication. Given its flexibility and feature set, ESP is (far) more popular than AH.</p>
</div>
<div class="sect4">
<h5 id="transport-and-tunnel-modes">4.2.3.1. Transport and Tunnel Modes</h5>
<div class="paragraph">
<p>Like AH, ESP has transport and tunnel modes. In tunnel mode, an “outer” IP packet includes an “inner” IP packet that may be entirely encrypted. This provides for a limited form of <em>traffic flow confidentiality</em> (TFC) because the “inner”datagram’s size and contents can be hidden using encryption.</p>
</div>
<div class="paragraph">
<p>ESP may be used in combination with AH, if desired, and supports both IPv4 and IPv6. Using ESP in “integrity-only” mode may be preferable to AH in some cases for performance reasons (ESP may be more amenable to pipelining) and is a required configuration option for IPsec implementations.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/IPsec-ESP-transport-mode.png" alt="IPsec ESP transport mode" width="75%" height="75%">
</div>
<div class="title">Figure 26. The IPsec ESP is used to provide confidentiality (encryption), authentication, and integrity protection for IPv4 and IPv6 datagrams. In transport mode (depicted here with TCP), a conventional IP datagram is modified to include the ESP head er. ESP in transport mode allows the transport payload to be encrypted, authenticated, and integrity-protected.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/IPsec-ESP-tunnel-mode.png" alt="IPsec ESP tunnel mode" width="75%" height="75%">
</div>
<div class="title">Figure 27. In tunnel mode (depicted here with TCP), ESP encapsulates a conventional IP datagram inside a new “outside” IP datagram that carries the original datagram. ESP allows the outer datagram to be modified (e.g., for NAT traversal) while the inner datagram remains intact. ESP is more popular than AH for most applications.</div>
</div>
<div class="paragraph">
<p>The transport mode structure is similar to AH transport mode, except ESP trailer structures are used in support of ESP’s encryption and integrity protection methods. As with AH, ESP transport mode cannot be used with fragments. The tunnel mode encapsulations for ESP, similar to those for AH.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/ESP-messate-structure.png" alt="IPsec ESP message structure" width="75%" height="75%">
</div>
<div class="title">Figure 28. The ESP message structure includes the encrypted payload in the middle. The <em>SPI</em> and <em>Sequence Number</em> constitute the ESP header, and the combination of the <em>Pad</em>, <em>Pad Length</em>, and <em>Next Header</em> fields constitutes the ESP trailer. An optional ESP ICV trailer is also used when integrity protection is employed.</div>
</div>
<div class="paragraph">
<p>ESP does not use a strict header in the same way AH does. Instead, there is an overall ESP structure that includes a header and trailer portion. There is an optional (second) trailer structure if ESP is used with an integrity protection mechanism that requires space for additional check bits (labeled ESP ICV).</p>
</div>
<div class="paragraph">
<p>ESP-encapsulated IP datagrams use the value 50 in the <em>Protocol</em> (IPv4) or <em>Next Header</em> (IPv6) header fields.</p>
</div>
<div class="paragraph">
<p>The ESP payload structure, includes the <em>SPI</em> and <em>sequence numbers</em>, used in the same way as with AH. The primary difference is in the payload area. This area may be confidentiality-protected (encrypted) and can include a variable-length pad portion required by some encryption algorithms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The payload is required to end on a 32-bit boundary (64 for IPv6) and have the last two 8-bit fields identify the <em>Pad Length</em> and <em>Next Header (Protocol)</em> field values. The <em>Pad</em>, <em>Pad Length</em>, and <em>Next Header</em> fields constitute the ESP trailer.</p>
</li>
<li>
<p>Certain cryptographic algorithms may employ an IV. If present, the IV appears at the beginning of the payload area (not shown).</p>
</li>
<li>
<p>Additional padding for TFC purposes (called <em>TFC padding</em>) is permitted to appear within the payload area in front of the ESP trailer.</p>
<div class="paragraph">
<p>It is used to disguise the length of the datagram to help resist traffic analysis attacks, although this features does not appear to be widely used.</p>
</div>
</li>
<li>
<p>The <em>Next Header</em> field contains values chosen from the same space used in the IPv4 Protocol field or IPv6 <em>Next Header</em> field (e.g., 4 for IPv4, 41 for IPv6).</p>
<div class="paragraph">
<p>It may contain the value 59, indicating “no next header,” when carrying a dummy packet that is to be discarded. Dummy packets are another method sometimes used for resisting traffic analysis attacks.</p>
</div>
</li>
<li>
<p>The ESP ICV is a variable-length trailer used if integrity support is enabled and required by the integrity-checking algorithm.</p>
<div class="paragraph">
<p>It is computed over the ESP header, payload, and ESP trailer. Implicit values (e.g., high-order ESN bits) are also included.</p>
</div>
<div class="paragraph">
<p>The length of the ICV is known as a consequence of selecting the particular integrity-checking method. It is therefore established at the time the corresponding SA is set up and not changed as long as the SA exists.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Anti-replay is supported provided integrity protection is enabled.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is accomplished using a sequence number derived from a running counter. The counter is initialized to 0 when an SA is first set up and incremented before being copied into each datagram sent on the SA.</p>
</li>
<li>
<p>When anti-replay is enabled (the normal default), the sender checks to see that the counter has not wrapped and creates a new SA if wrapping is about to occur.</p>
</li>
<li>
<p>The receiver implementing anti-replay keeps a valid window of sequence numbers (similar in some ways to the TCP receiver’s window).</p>
<div class="paragraph">
<p>Datagrams containing out-of-window sequence numbers are dropped.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For systems that implement auditing, ESP processing can result in one or more <em>auditable events</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>These events include the following: no valid SA exists for a session, the datagram given to ESP for processing is a fragment, the anti-replay counter is about to wrap, a received packet was out of the valid anti-replay window, the
integrity check failed.</p>
</li>
<li>
<p>Auditable events are recorded in a logging system. These events include metadata such as the SPI value, current date and time, source and destination IP addresses, sequence number, and IPv6 flow ID (if present).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="esp-null-wrapped-esp-wesp-and-traffic-visibility">4.2.3.2. ESP-NULL, Wrapped ESP (WESP), and Traffic Visibility</h5>
<div class="paragraph">
<p>ESP ordinarily provides privacy using encryption, but it can also operate in an integrity-only mode using the NULL encryption algorithm.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Integrity-only mode (also called ESP-NULL) may be desirable in some circumstances, especially in enterprise environments where sophisticated packet inspection takes place within the network and confidentiality may be addressed in other ways.</p>
<div class="paragraph">
<p>For example, some network infrastructure devices inspect packets for unwanted content (e.g., malware signatures) and are capable of providing alerts or shutting down network access when policy is violated. Such devices are essentially disabled if ESP is used with encryption in an end-to-end fashion (i.e., the way it was designed). Said another way, unless they have <em>traffic visibility</em>, they cannot do their jobs.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a packet inspection device is faced with ESP traffic, it needs to make a decision about whether the traffic is encrypted (i.e., whether NULL encryption is being used or not).</p>
</div>
<div class="paragraph">
<p>Given that the negotiation of an IPsec cryptographic suite is handled outside ESP (e.g., manually or using a protocol such as IKE), there are two current methods for doing so.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first is simply to use a set of nonstandard heuristics to make a guess [RFC5879]. Use of these has the benefit of not requiring any modification to ESP for supporting traffic visibility.</p>
</li>
<li>
<p>The other method is to add a special description to ESP to indicate whether encryption is used.</p>
<div class="paragraph">
<p>Wrapped ESP (WESP) [RFC5840], a standards-track RFC, defines a header that is placed ahead of the ESP packet structure. WESP uses a different protocol number (141) from ESP and can be negotiated with IKE using the USE_WESP_MODE (value 16415) Notify payload.</p>
</div>
<div class="paragraph">
<p>The variable-length WESP header includes fields to indicate the location of payload information, along with a Flags field (maintained by the IANA [IWESP]) containing a bit indicating whether ESP-NULL is being used.</p>
</div>
<div class="paragraph">
<p>Although WESP makes the job of determining whether ESP-NULL is being used or not easier for network infrastructure, its utility also depends on end hosts using the WESP header appropriately.</p>
</div>
<div class="paragraph">
<p>Given that WESP is relatively new, this is not yet the case today. On the other hand, the WESP format is extensible, so once implemented it could be adapted for other purposes in the future.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multicast">4.2.4. Multicast</h4>
<div class="paragraph">
<p>IPsec optionally supports multicast operations [RFC5374], although this capability is not often used. The most basic form involves using manual key configuration, but there are also multicast group key establishment methods called group key management (GKM) protocols managed by group controller/key servers (GCKSs).</p>
</div>
</div>
<div class="sect3">
<h4 id="l2tpipsec">4.2.5. L2TP/IPsec</h4>
<div class="paragraph">
<p>The Layer 2 Tunneling Protocol (L2TP) supports tunneling of layer 2 traffic such as PPP through IP and non-IP networks.</p>
</div>
<div class="paragraph">
<p>It relies on authentication methods that provide some authentication during connection initiation, but no subsequent per-packet authentication, integrity protection, or confidentiality.</p>
</div>
<div class="paragraph">
<p>To address this concern, L2TP can be combined with IPsec [RFC3193]. The combination, called <strong>L2TP/IPsec</strong>, provides a recommended method to establish remote layer 2 VPN access to enterprise (or home) networks.</p>
</div>
<div class="paragraph">
<p>L2TP can be secured with IPsec using either a direct L2TP-over-IP encapsulation (protocol number 115) or a UDP/IP encapsulation that eases NAT traversal.</p>
</div>
<div class="paragraph">
<p>L2TP/IPsec uses IKE by default, although other keying methods are possible.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It uses an ESP SA in either transport mode (support required) or tunnel mode (support optional). The SA is used to secure the L2TP traffic, which is then responsible for establishing the layer 2 tunnel.</p>
</li>
<li>
<p>Because it is really a combination of two protocols, both of which involve authentication, L2TP/IPsec often requires two distinct authentication procedures: one for the machine (using IPsec with pre-shared keys or certificates) and another for the user (e.g., using a name and password or access token).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L2TP/IPsec is supported on most modern platforms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On Windows, creating a new connection with the “Connect to a workplace” option can be used to enable L2TP and L2TP/IPsec.</p>
</li>
<li>
<p>Some smartphones (e.g., Android, iPhone) support L2TP in their networking configuration setup screens.</p>
</li>
<li>
<p>Mac OS X includes an L2TP/IPsec network adapter type that can be added using the system preferences.</p>
</li>
<li>
<p>On Linux, it may be necessary to configure both IPsec and L2TP for them to work together.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If L2TP is not required on such systems, direct IPsec may be preferable.</p>
</div>
</div>
<div class="sect3">
<h4 id="ipsec-nat-traversal">4.2.6. IPsec NAT Traversal</h4>
<div class="paragraph">
<p>Using NATs with IPsec can present something of a challenge, primarily because IP addresses have traditionally been used in identifying communication endpoints and are assumed to not change. These assumptions were not entirely avoided (or obviated) when IPsec was first designed, so NAT has posed a problem. This is one factor contributing to the relatively slow deployment of IPsec. However, today IPsec supports both changing addresses (with MOBIKE) and NAT traversal.</p>
</div>
</div>
<div class="sect3">
<h4 id="ipsec-implementations">4.2.7. IPsec implementations</h4>
<div class="paragraph">
<p>There are several open-source and proprietary IPsec implementations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows 7 supports IKEv2 and MOBIKE in Microsoft’s Agile VPN subsystem.</p>
</li>
<li>
<p>Linux includes kernel-level IPsec support in kernel version 2.6 and later, and the OpenSwan and StrongSwan packages can be used to implement complete VPN solutions.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transport-layer-security-tls-and-dtls">4.3. Transport Layer Security (TLS and DTLS)</h3>
<div class="paragraph">
<p>The most widely used protocol for security just above the transport layer is called <strong>Transport Layer Security</strong> (<strong>TLS</strong>), which is used for securing Web communications and other popular protocols, including POP and IMAP (called <em>POP3S</em> and <em>IMAPS</em>, respectively, when protected with TLS).</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>TLS is implemented within or underneath applications that ride on top of the lower layers, whereas protocols such as EAP and IPsec usually require capabilities within the operating systems and protocol implementations of hosts and embedded devices.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>There are several versions of TLS and its predecessor, the <strong>Secure Sockets Layer</strong> (<strong>SSL</strong>) [RFC6101].TLS version 1.2 [RFC5246], which operates over a stream-oriented protocol (usually TCP), is the most recent at the time of writing.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Transport Layer Security | From Wikipedia, the free encyclopedia</em></p>
</div>
<div class="paragraph">
<p>TLS is a proposed Internet Engineering Task Force (IETF) standard, first defined in 1999, and the current version is TLS 1.3, defined in August 2018. TLS builds on the now-deprecated SSL (Secure Sockets Layer) specifications (1994, 1995, 1996) developed by Netscape Communications for adding the HTTPS protocol to their Navigator web browser.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>TLS 1.2 can support backward compatibility with most older versions of TLS and SSL (e.g., TLS 1.0, 1.1, and SSL 3.0). However, SSL 2.0 is weaker, and while interoperability with it is possible, it is now prohibited [RFC6176].</p>
</div>
<div class="paragraph">
<p>The <strong>Datagram Transport Layer Security</strong> (<strong>DTLS</strong>) [RFC4347], a datagram-oriented variant, is slowly gaining popularity for some applications such as VPN implementations that do not use IPsec.</p>
</div>
<div class="sect3">
<h4 id="tls-1-2">4.3.1. TLS 1.2</h4>
<div class="paragraph">
<p>The security goals of TLS are not unlike those for IPsec, but TLS operates at a higher layer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Confidentiality and data integrity are provided based on a variety of cryptographic suites that use certificates that can be provided by a PKI.</p>
</li>
<li>
<p>TLS can also establish secure connections between two anonymous parties (without using certificates), but this application is vulnerable to a MITM attack (not surprising, given that each end is not even strongly identified).</p>
</li>
<li>
<p>The TLS protocol has two layers of its own, called the <strong>record layer</strong> and the <strong>upper layer</strong>.</p>
<div class="paragraph">
<p>The Record protocol implements the record (lower) layer and is assumed to be layered on a reliable underlying protocol (e.g., TCP).</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/TLS-protocol-stack.png" alt="TLS protocol stack" width="55%" height="55%">
</div>
<div class="title">Figure 29. The TLS protocol “stack” has a lower record layer and three of its own upper-layer protocols called handshaking protocols. A fourth upper-layer protocol is the application protocol using TLS. The record layer provides fragmentation, compression, integrity protection, and encryption. The handshaking protocols perform many of the same tasks for TLS that IKE does for IPsec.</div>
</div>
<div class="paragraph">
<p>TLS is a client/server protocol, designed to support security for a connection between two applications.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Record protocol</strong> provides <em>fragmentation</em>, <em>compression</em>, <em>integrity protection</em>, and <em>encryption</em> for data objects exchanged between clients and servers,</p>
</li>
<li>
<p>and the <strong>handshake protocols</strong> establish identities, perform authentication, indicate alerts, and provide unique key material for the Record protocol to use on each connection.</p>
<div class="paragraph">
<p>The handshaking protocols comprise four specific protocols: the <strong>Handshake protocol</strong>, the <strong>Alert protocol</strong>, the <strong>Change Cipher Spec protocol</strong>, and the <strong>application data protocol</strong>.</p>
</div>
<div class="paragraph">
<p>Like IPsec, TLS is extensible and can accommodate existing or future cryptographic suites, which TLS calls <strong>cipher suites</strong> (<strong>CS</strong>).</p>
</div>
</li>
<li>
<p>Modern variants of TLS are based on SSL 3.0, originally developed by Netscape.</p>
<div class="paragraph">
<p>TLS and SSL do not directly interoperate, but there are negotiation mechanisms that allow clients and servers to dynamically discover which protocol to use when a connection is first established.</p>
</div>
</li>
<li>
<p>TLS depends on five cryptographic operations: <em>digital signing</em>, <em>stream cipher</em> <em>encryption</em>, <em>block cipher encryption</em>, <em>AEAD</em>, and <em>public key encryption</em>.</p>
<div class="paragraph">
<p>For integrity protection, the TLS record layer uses HMAC. For key generation, TLS 1.2 uses a PRF based on HMAC with SHA-256.</p>
</div>
<div class="paragraph">
<p>TLS also integrates an optional compression algorithm that is negotiated when a connection is first established.</p>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="tls-record-protocol">4.3.1.1. TLS Record Protocol</h5>
<div class="paragraph">
<p>The Record protocol uses an extensible set of record content type values to identify which message type (i.e., which of the higher-layer protocols) is being multiplexed.</p>
</div>
<div class="paragraph">
<p>At any given point in time, the Record protocol has an active <strong><em>current connection state</em></strong> and another set of state parameters called the <strong><em>pending connection state</em></strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each connection state is further divided into a <strong><em>read state</em></strong> and a <strong><em>write state</em></strong>.</p>
</li>
<li>
<p>Each of these states specifies a <em>compression algorithm</em>, <em>encryption algorithm</em>, and <em>MAC algorithm</em> to be used for communication, along with any necessary <em>keys</em> and <em>parameters</em>.</p>
</li>
<li>
<p>When a key is changed, the pending state is first set up using the Handshake protocol, and then a synchronization operation (usually accomplished using the Cipher Change protocol) sets the current state equal to the pending state. When first initialized, all states are set up with NULL encryption, no compression, and no MAC processing.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/TLS-Record-protocol-flow.png" alt="TLS Record protocols processing flow" width="55%" height="55%">
</div>
<div class="title">Figure 30. The TLS record layer starts with a TLSPlaintext record, which is compressed by a lossless compression algorithm to form a TLSCompressed record. The TLSCompressed record is encrypted (and has a MAC applied) to form a TLSCiphertext record, which is sent for transmission. Conventional stream and block ciphers require a MAC, and block ciphers may include padding. When using AEAD ciphers, a nonce is included with the encrypted and integrity-protected content, but no separate MAC is used.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The Record protocol’s processing flow divides (fragments) higher-layer information blocks into records called <strong>TLSPlaintext</strong> records, which can be at most 2<sup>14</sup> bytes in length (but are usually much less).</p>
<div class="paragraph">
<p>The choice of record size resides within TLS; higher-layer message boundaries are not preserved.</p>
</div>
</li>
<li>
<p>Once formed, TLSPlaintext records are compressed using a compression algorithm [RFC3749] identified in the current connection state.</p>
<div class="paragraph">
<p>There is always one compression protocol active, although it may be (and usually is) the NULL compression protocol (which, not surprisingly, provides no compression
gain). The compression algorithm converts a TLSPlaintext record into a <strong>TLSCompressed</strong> structure.</p>
</div>
<div class="paragraph">
<p>Compression algorithms are required to be lossless and may not produce an output that is larger than the input by more than 1KB.</p>
</div>
</li>
<li>
<p>To protect the payload from disclosure and modification, encryption and integrity protection algorithms convert a TLSCompressed structure into a <strong>TLSCiphertext</strong> structure, which is then sent on the underlying transport connection.</p>
<div class="paragraph">
<p>When producing a TLSCiphertext structure, a sequence number is first computed (but not placed in the message), then a MAC is computed if necessary, and finally symmetric encryption is performed.</p>
</div>
<div class="paragraph">
<p>Prior to encryption, the message may be padded (up to 255 bytes) to meet any block length requirements imposed by the encryption algorithm (e.g., for block ciphers).</p>
</div>
<div class="paragraph">
<p>A MAC is not required for AEAD algorithms that provide both integrity and encryption (e.g., CCM, GCM), but a nonce is used in such cases.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keys for the Record protocol are derived from a <strong><em>master secret</em></strong> provided by some method outside the Record protocol, most often by the Handshake protocol.</p>
</div>
<div class="paragraph text-center">
<p><em>M<sub>c</sub> | M<sub>s</sub> | D<sub>c</sub> | Ds | IV<sub>c</sub> | IV<sub>s</sub> = PRF(master_secret, "key expansion", server_random + client_random)</em></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>M<sub>c</sub></em> denotes the MAC write key for the client, <em>M<sub>s</sub></em> denotes the MAC write key for the server, <em>D<sub>c</sub></em> denotes the client’s data write key, <em>D<sub>s</sub></em> denotes the server’s data write key, <em>IV<sub>c</sub></em> denotes the client’s IV, and <em>IV<sub>s</sub></em> denotes the server’s IV.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect4">
<h5 id="tls-handshaking-protocols">4.3.1.2. TLS Handshaking Protocols</h5>
<div class="paragraph">
<p>There are three subprotocols to TLS, which perform tasks roughly equivalent to those performed by IKE in IPsec. More specifically, these other protocols are identified by numbers used for multiplexing and demultiplexing by the record layer and are called the <em>Handshake protocol (22)</em>, <em>Alert protocol (21)</em>, and <em>Cipher Change protocol (20)</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>Cipher Change protocol</em> is very simple. It consists of one message containing a single byte that has the value 1. The purpose of the message is to indicate to the peer a desire to change from the current to the pending state. Receiving such a message moves the read pending state to the current state and causes an indication to the record layer to transition to the pending write state as soon as possible. This message is used by both client and server.</p>
</li>
<li>
<p>The Alert protocol is used to deliver status information from one end of a TLS connection to another. This can include terminating conditions (either fatal errors or controlled shutdowns) or nonfatal error conditions. As of the publication of [RFC5246], 24 alert messages were defined in standards. More than half of them are always fatal (e.g., bad MACs, missing or unknown messages, algorithm failures).</p>
</li>
<li>
<p>The <em>Handshake protocol</em> sets up the relevant connection operating parameters. It allows the TLS endpoints to achieve six major objectives: agree on algorithms and exchange random values used in forming symmetric encryption keys, establish algorithm operating parameters, exchange certificates and perform mutual authentication, generate a session-specific secret, provide security parameters to the record layer, and verify that all of these operations have executed properly.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/TLS-connection-init-exchange.png" alt="TLS connection initiation exchange" width="25%" height="25%">
</div>
<div class="title">Figure 31. The normal TLS connection initiation exchange consists of several messages that may be pipelined. Required messages have solid arrows and are shown in boldface type. An abbreviated exchange takes place if a previously existing connection can be restarted. This avoids endpoint authentication, which can be costly for systems with limited processing capabilities.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>ClientHello message</em> is usually the first message sent from client to server, that contains a <em>session ID</em>, proposals for the <em>cryptographic suite</em> number (CS), and a set of acceptable <em>compression algorithms</em>, also contains the <em>TLS version</em> number and a <em>random number</em> called <code>ClientHello.random</code>.</p>
</li>
<li>
<p>Upon receiving the <em>ClientHello message</em>, the server checks to see if the <em>session ID</em> is present in its cache, and may agree to continue a previously existing connection (called a “resume”) by performing an <em>abbreviated handshake</em>.</p>
<div class="paragraph">
<p>The <em>abbreviated handshake</em> is key to TLS performance and avoids having to repeatedly verify the authenticity of each endpoint, but it does require synchronization with respect to the cipher specification.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>ServerHello message</em> completes the first part of the exchange by carrying the server’s random number (<code>ServerHello.random</code>) to the client.</p>
</li>
<li>
<p>The <em>ServerHello message</em> also contains a <em>session ID</em> value.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>If the <em>session ID</em> value is the same as that provided by the client, it indicates the server’s willingness to resume.</p>
</li>
<li>
<p>If not, it has the value <code>0</code> and a full handshake is required.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>If a full (non-abbreviated) handshake is executed, the exchange of <em>Hello messages</em> results in each end becoming aware of the <em>cipher suites</em>, <em>compression algorithms</em>, and <em>random values</em> of its peer.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>The server selects among the cryptographic suites specified by the client and may be required to provide its certificate chain in a <em>Certificate message</em> if it is to be authenticated (which is the typical case for secure Web traffic or HTTPS).</p>
</li>
<li>
<p>The server may also send a <em>ServerKeyExchange message</em> if its certificate is not valid for signing, it has no certificate, or a temporary or ephemeral key is to be used to generate session keys.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>ServerKeyExchange message</em> is used only in cases where the Certificate (server) message does not contain enough information to establish a premaster secret.</p>
</div>
<div class="paragraph">
<p>Such cases include anonymous or ephemeral DH key agreement (i.e., cipher suites starting with TLS_DHE_anon, TLS_DHE_DSS, TLS_ DHE_RSA).</p>
</div>
<div class="paragraph">
<p>The <em>ServerKeyExchange message</em> is not used for other suites, including those starting with TLS_RSA, TLS_DH_DSS, or TLS_DH_RSA.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>At this point, the server may require <em>client authentication</em>. If so, it generates a <em>CertificateRequest message</em>.</p>
</li>
<li>
<p>Once this message is sent, the server completes the second portion of the exchange by sending the mandatory <em>ServerHelloDone message</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Upon receiving this (possibly pipelined) message from the server, the client may be required to prove its identity (i.e., knowledge of an appropriate private key corresponding to a certificate).</p>
<div class="ulist">
<ul>
<li>
<p>If so, it first sends its certificate using a <em>Certificate message</em> in the same format used by the server.</p>
</li>
<li>
<p>It then sends the mandatory <em>ClientKeyExchange message</em>.</p>
<div class="paragraph">
<p>The contents of this message depend on the cryptographic suite used, but it generally contains either an RSA-encrypted key or Diffie-Hellman parameters that may be used to create a type of seed for creating new keys (called the <em>premaster secret</em>).</p>
</div>
</li>
<li>
<p>Finally, it sends a <em>CertificateVerify message</em> to demonstrate that it possesses the private key corresponding to the previously provided certificate, if the server requested <em>client authentication</em>.</p>
<div class="paragraph">
<p>This message contains a signature on the hash of all of the handshake messages the client has received and sent up to this point.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The final portion of the exchange includes a <em>ChangeCipherSpec message</em>, which is an independent TLS protocol content type (i.e., technically not a Handshake protocol message).</p>
<div class="paragraph">
<p>However, the mandatory Handshake protocol <em>Finished messages</em> can be exchanged only after a successful exchange of <em>ChangeCipherSpec messages</em>.</p>
</div>
</li>
<li>
<p>The <em>Finished messages</em> are the first ones to be protected using the parameters exchanged up to this point, and contain “verify data,” which consists of the following value:</p>
<div class="listingblock text-center">
<div class="content">
<pre>verify_data = PRF(master_secret, finished_label, Hash(handshake_messages))</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>where <em>finished_label</em> has the value “client finished” for the client and “server finished” for the server.</p>
</li>
<li>
<p>The particular hash function <em>Hash</em> is associated with the selection of the PRF made during the initial Hello exchange.</p>
</li>
<li>
<p>The 48-byte <em>master_secret</em> value is computed as follows, where <code>+</code> is the concatenation operator</p>
<div class="listingblock text-center">
<div class="content">
<pre>master_secret = PRF(premaster secret, “master secret”, ClientHello.random + ServerHello.random)</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>Finished message</em> is important because it can be used to know with a high degree of certainty that the Handshake protocol has completed successfully and subsequent data exchange can take place.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tls-extensions">4.3.2. TLS Extensions</h4>
<div class="paragraph">
<p>To provide an extensible mechanism for TLS, like IKE using Notify and Configuration payloads to carry information, various extensions can be included with TLS 1.2 messages in a standard way.</p>
</div>
<div class="paragraph">
<p>The baseline specification for TLS 1.2 [RFC5246] includes a <em>signature algorithms</em> extension that a client uses to specify to a server what types of hash and signature algorithms it supports.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>MD5, SHA-1, SHA-224, SHA-256, SHA-384, SHA-512 for hashes and RSA, DSA, ECDSA for digital signatures.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect3">
<h4 id="renegotiation">4.3.3. Renegotiation</h4>
<div class="paragraph">
<p>TLS supports the ability to renegotiate cryptographic connection parameters while maintaining the same connection. This can be initiated by either the server or the client. If the server wishes to renegotiate the connection parameters, it generates a <em>HelloRequest message</em>, and the client responds with a new <em>ClientHello message</em>, which begins the renegotiation procedure. The client is also able to generate such a <em>ClientHello message</em> spontaneously, without prompting from the server.</p>
</div>
</div>
<div class="sect3">
<h4 id="example">4.3.4. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># Create a self-signed CA cetrifacate</span>
openssl req <span class="nt">-x509</span> <span class="se">\</span>
    <span class="nt">-subj</span> <span class="s2">"/CN=work.icu"</span> <span class="se">\</span>
    <span class="nt">-addext</span> <span class="s2">"subjectAltName=DNS:work.icu,DNS:*.work.icu"</span> <span class="se">\</span>
    <span class="nt">-addext</span> <span class="s2">"keyUsage=digitalSignature,cRLSign,keyCertSign"</span> <span class="se">\</span>
    <span class="nt">-addext</span> <span class="s2">"extendedKeyUsage=serverAuth,clientAuth"</span> <span class="se">\</span>
    <span class="nt">-days</span> 365 <span class="se">\</span>
    <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:2048 <span class="se">\</span>
    <span class="nt">-keyout</span> work.icu.key <span class="se">\</span>
    <span class="nt">-out</span> work.icu.crt <span class="se">\</span>
    <span class="o">&gt;</span> /dev/null 2&gt;&amp;1

<span class="c"># Create a sever/client certificate and sign it by CA</span>
openssl req <span class="nt">-subj</span> <span class="s2">"/CN=996.icu"</span> <span class="se">\</span>
    <span class="nt">-addext</span> <span class="s2">"subjectAltName=DNS:996.icu,DNS:*.996.icu"</span> <span class="se">\</span>
    <span class="nt">-addext</span> <span class="s2">"basicConstraints=CA:false"</span> <span class="se">\</span>
    <span class="nt">-addext</span> <span class="s2">"keyUsage=digitalSignature,keyEncipherment"</span> <span class="se">\</span>
    <span class="nt">-addext</span> <span class="s2">"extendedKeyUsage=serverAuth,clientAuth"</span> <span class="se">\</span>
    <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:2048 <span class="se">\</span>
    <span class="nt">-x509</span> <span class="se">\</span>
    <span class="nt">-CA</span> work.icu.crt <span class="nt">-CAkey</span> work.icu.key <span class="se">\</span>
    <span class="nt">-copy_extensions</span> copy <span class="se">\</span>
    <span class="nt">-keyout</span> 996.icu.key <span class="se">\</span>
    <span class="nt">-out</span> 996.icu.crt <span class="se">\</span>
    <span class="o">&gt;</span> /dev/null 2&gt;&amp;1

<span class="c"># Install the root CA ceretificate into local trust store</span>
<span class="nb">sudo cp </span>work.icu.crt /usr/local/share/ca-certificates/extra/
<span class="nb">sudo </span>update-ca-certificates</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Create a server for 996.icu</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">cat</span> /etc/nginx/sites-enabled/996.icu
<span class="go">server {
</span><span class="gp">	listen 80;</span><span class="w">
</span><span class="gp">	listen [::]:80;</span><span class="w">
</span><span class="go">
</span><span class="gp">    server_name  *.996.icu;</span><span class="w">
</span><span class="go">
</span><span class="gp">    return 308 https://$</span>host:443<span class="nv">$request_uri</span><span class="p">;</span>
<span class="go">}

server {
</span><span class="gp">	listen 443 ssl;</span><span class="w">
</span><span class="gp">	listen [::]:443 ssl;</span><span class="w">
</span><span class="go">
</span><span class="gp">    server_name  *.996.icu;</span><span class="w">
</span><span class="go">
</span><span class="gp">    ssl_certificate     996.icu.crt;</span><span class="w">
</span><span class="gp">    ssl_certificate_key 996.icu.key;</span><span class="w">
</span><span class="go">
</span><span class="gp">	root /var/www/html;</span><span class="w">
</span><span class="go">
</span><span class="gp">	#</span><span class="w"> </span>Add index.php to the list <span class="k">if </span>you are using PHP
<span class="gp">	index index.html index.htm index.nginx-debian.html;</span><span class="w">
</span><span class="go">
</span><span class="gp">	server_name _;</span><span class="w">
</span><span class="go">
	location / {
</span><span class="gp">		try_files $</span>uri <span class="nv">$uri</span>/ <span class="o">=</span>404<span class="p">;</span>
<span class="go">	}
}

</span><span class="gp">$</span><span class="w"> </span><span class="c"># Test and reload Nginx</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>nginx <span class="nt">-t</span>
<span class="go">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
</span><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>nginx <span class="nt">-s</span> reload
<span class="gp">2023/08/09 17:44:53 [notice] 142427#</span>142427: signal process started
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Test the configuration</span>
<span class="gp">$</span><span class="w"> </span>curl <span class="nt">-iIL</span> localhost <span class="nt">-H</span> <span class="s1">'Host: 996.icu'</span>
<span class="go">HTTP/1.1 308 Permanent Redirect
Server: nginx/1.22.1
Date: Wed, 09 Aug 2023 09:46:48 GMT
Content-Type: text/html
Content-Length: 171
Connection: keep-alive
Location: https://996.icu:443/

HTTP/1.1 200 OK
Server: nginx/1.22.1
Date: Wed, 09 Aug 2023 09:46:48 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Fri, 25 Oct 2019 06:07:47 GMT
Connection: keep-alive
ETag: "5db29133-264"
Accept-Ranges: bytes</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># Use `tcpdump` to capture HTTPS traffic on local lookback interface</span>
<span class="nb">sudo </span>tcpdump <span class="nt">-i</span> lo port 443 <span class="nt">-w</span> 996.v1.2.icu.pcap</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-v</span> <span class="nt">--tlsv1</span>.2 <span class="nt">--tls-max</span> 1.2 <span class="nt">-iI</span> https://996.icu <span class="nt">--resolve</span> 996.icu:443:127.0.0.1
<span class="go">* Added 996.icu:443:127.0.0.1 to DNS cache</span>
<span class="go">* Hostname 996.icu was found in DNS cache</span>
<span class="go">*   Trying 127.0.0.1:443...</span>
<span class="gp">* Connected to 996.icu (127.0.0.1) port 443 (#</span>0<span class="o">)</span>
<span class="go">* ALPN: offers h2,http/1.1</span>
<span class="go">* TLSv1.2 (OUT), TLS handshake, Client hello (1):</span>
<span class="go">*  CAfile: /etc/ssl/certs/ca-certificates.crt</span>
<span class="go">*  CApath: /etc/ssl/certs</span>
<span class="go">* TLSv1.2 (IN), TLS handshake, Server hello (2):</span>
<span class="go">* TLSv1.2 (IN), TLS handshake, Certificate (11):</span>
<span class="go">* TLSv1.2 (IN), TLS handshake, Server key exchange (12):</span>
<span class="go">* TLSv1.2 (IN), TLS handshake, Server finished (14):</span>
<span class="go">* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):</span>
<span class="go">* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):</span>
<span class="go">* TLSv1.2 (OUT), TLS handshake, Finished (20):</span>
<span class="go">* TLSv1.2 (IN), TLS handshake, Finished (20):</span>
<span class="hll"><span class="go">* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384</span>
</span><span class="go">* ALPN: server accepted http/1.1</span>
<span class="go">* Server certificate:</span>
<span class="go">*  subject: CN=996.icu</span>
<span class="go">*  start date: Aug  9 09:06:00 2023 GMT</span>
<span class="go">*  expire date: Aug  8 09:06:00 2024 GMT</span>
<span class="go">*  subjectAltName: host "996.icu" matched cert's "996.icu"</span>
<span class="go">*  issuer: CN=996.icu</span>
<span class="go">*  SSL certificate verify ok.</span>
<span class="go">* using HTTP/1.1</span>
<span class="gp">&gt;</span><span class="w"> </span>HEAD / HTTP/1.1
<span class="gp">&gt;</span><span class="w"> </span>Host: 996.icu
<span class="gp">&gt;</span><span class="w"> </span>User-Agent: curl/7.88.1
<span class="gp">&gt;</span><span class="w"> </span>Accept: <span class="k">*</span>/<span class="k">*</span>
<span class="gp">&gt;</span>
<span class="go">&lt; HTTP/1.1 200 OK</span>
<span class="go">HTTP/1.1 200 OK</span>
<span class="go">&lt; Server: nginx/1.22.1</span>
<span class="go">Server: nginx/1.22.1</span>
<span class="go">&lt; Date: Wed, 09 Aug 2023 10:51:30 GMT</span>
<span class="go">Date: Wed, 09 Aug 2023 10:51:30 GMT</span>
<span class="go">&lt; Content-Type: text/html</span>
<span class="go">Content-Type: text/html</span>
<span class="go">&lt; Content-Length: 612</span>
<span class="go">Content-Length: 612</span>
<span class="go">&lt; Last-Modified: Fri, 25 Oct 2019 06:07:47 GMT</span>
<span class="go">Last-Modified: Fri, 25 Oct 2019 06:07:47 GMT</span>
<span class="go">&lt; Connection: keep-alive</span>
<span class="go">Connection: keep-alive</span>
<span class="go">&lt; ETag: "5db29133-264"</span>
<span class="go">ETag: "5db29133-264"</span>
<span class="go">&lt; Accept-Ranges: bytes</span>
<span class="go">Accept-Ranges: bytes</span>

<span class="go">&lt;</span>
<span class="gp">* Connection #</span>0 to host 996.icu left intact</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/wirshark-tlsv1.2-client-hello.png" alt="A ClientHello message in TLS 1.2" width="100%" height="100%">
</div>
<div class="title">Figure 32. A ClientHello message in TLS 1.2 contains version information, supported cipher suites and compression algorithms, random data, and a number of extensions.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip/security/wirshark-tlsv1.2-server-hello.png" alt="A ServerHello message in TLS 1.2" width="100%" height="100%">
</div>
<div class="title">Figure 33. A ServerHello message in TLS 1.2 contains version information, supported cipher suites and compression algorithms, and a number of extensions. Here, the client supports EC Diffie-Hellman key agreement. It uses AES-256-GCM for encryption and SHA-384 for integrity protection.</div>
</div>
</div>
<div class="sect3">
<h4 id="tls-with-datagrams-dtls">4.3.5. TLS with Datagrams (DTLS)</h4>
<div class="paragraph">
<p>The TLS protocol assumes a stream-based underlying transport protocol for delivering its messages. A datagram version (DTLS) relaxes this assumption but aims to otherwise achieve the same security goals as TLS using essentially all the same message formats. It was originally motivated by protocols such as SIP that run on UDP but do not care to use IPsec [RFC5406]. DTLS has also been adapted for use with DCCP [RFC5238] and SCTP [RFC6083].</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dns-security-dnssec">5. DNS Security (DNSSEC)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security for DNS covers both data within the DNS (resource records or RRs) as well as security of transactions that synchronize or update contents of DNS servers. A major effort has been undertaken to deploy these security mechanisms are called the <strong>Domain Name System Security Extensions</strong> (<strong>DNSSEC</strong>) and are discussed in a family of RFCs [RFC4033][RFC4034][RFC4035].</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="faqs">Appendix A: FAQs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="aes-aes-128-aes-192-and-aes-256">A.1. AES, AES-128, AES-192, and AES-256?</h3>
<div class="paragraph">
<p><strong>AES</strong> (Advanced Encryption Standard) is a symmetric block cipher used for encrypting and decrypting data. It operates on <em>fixed-size blocks of data (128 bits)</em> and uses a secret key for both encryption and decryption.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The only way to find out if a decryption will fail is by attempting to decrypt it using the key you have. If the key is incorrect or the ciphertext is corrupted, the decryption will produce garbled or meaningless output. In some cases, you can also get an error or an exception while trying to decrypt, depending on the padding scheme used and the library you&#8217;re using.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>AES is available in three different key lengths: AES-128, AES-192, and AES-256. The differences among AES, AES-128, and AES-256 are mainly related to the key length and the number of encryption rounds.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>AES-128:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Key length: 128 bits (16 bytes)</p>
</li>
<li>
<p>Number of rounds: 10</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>AES-128 uses a 128-bit key and performs 10 rounds of encryption and decryption. It is the fastest and requires the least amount of memory among the three AES key lengths, making it suitable for applications with limited resources or where performance is critical.</p>
</div>
</li>
<li>
<p>AES-192:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Key length: 192 bits (24 bytes)</p>
</li>
<li>
<p>Number of rounds: 12</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>AES-192 uses a 192-bit key and performs 12 rounds of encryption and decryption. It provides a higher security level compared to AES-128, but it is slower and requires more memory.</p>
</div>
</li>
<li>
<p>AES-256:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Key length: 256 bits (32 bytes)</p>
</li>
<li>
<p>Number of rounds: 14</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>AES-256 uses a 256-bit key and performs 14 rounds of encryption and decryption. It provides the highest security level among the three key lengths, making it suitable for applications requiring strong encryption. However, it is the slowest and requires the most memory.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In summary, the differences among AES, AES-128, and AES-256 are related to the key length and the number of encryption rounds.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AES-128 is the fastest and requires the least memory, while AES-256 provides the highest security level but is slower and requires more memory.</p>
</li>
<li>
<p>AES-192 offers a balance between performance and security.</p>
</li>
<li>
<p>The choice of which AES key length to use depends on the specific requirements of the application and the desired balance between security, performance, and memory usage.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>Initialization Vector</strong> (IV) length for all AES variants (AES-128, AES-192, and AES-256) is the same because the IV size depends on the block size of the cipher, not the key size.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AES, the block size is 128 bits. Therefore, the IV length for AES-128, AES-192, and AES-256 is 128 bits or 16 bytes.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that the IV should be unique and random for each encryption operation to maintain the security of the encrypted data. Although the IV can be public, ensure that the encryption key remains secret and secure.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="aes-and-aes-gcm">A.2. AES and AES-GCM</h3>
<div class="paragraph">
<p>AES (Advanced Encryption Standard) and AES-GCM (Advanced Encryption Standard with Galois/Counter Mode) are related concepts in cryptography, but they serve different purposes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>AES (Advanced Encryption Standard): AES is a symmetric key encryption algorithm that operates on blocks of fixed size (128 bits) with key sizes of 128, 192, or 256 bits. It is widely used for encrypting and decrypting data to ensure confidentiality. AES itself is a block cipher and does not specify how the blocks should be processed. To process multiple blocks, a block cipher mode of operation is used, such as ECB (Electronic Code Book), CBC (Cipher Block Chaining), CTR (Counter), or GCM (Galois/Counter Mode).</p>
</li>
<li>
<p>AES-GCM (Advanced Encryption Standard with Galois/Counter Mode): AES-GCM is a specific mode of operation for the AES block cipher. It combines the AES block cipher with the Galois/Counter Mode (GCM) to provide both encryption and authentication. AES-GCM is an authenticated encryption with associated data (AEAD) scheme, which means it not only ensures the confidentiality of the encrypted data but also provides integrity checks and authentication. This is achieved by generating an authentication tag during the encryption process, which is verified during decryption to ensure that the data has not been tampered with.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In summary, AES is the underlying block cipher used for encryption and decryption, while AES-GCM is a specific mode of operation that combines AES with the GCM mode to provide both encryption and authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <em>AES-GCM is recommended for modern applications</em> as it provides both data confidentiality and integrity, ensuring that the encrypted data is not tampered with.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="whats-the-salt-and-iv-in-aes">A.3. What&#8217;s the SALT and IV in AES?</h3>
<div class="paragraph">
<p>In AES (Advanced Encryption Standard), "salt" and "IV" (Initialization Vector) serve different purposes and are used in different contexts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Salt: A salt is a random value that is combined with a password or secret key during the key derivation process. The purpose of using a salt is to prevent attacks that use precomputed tables (such as <em>rainbow tables</em>) to find the original password or key.</p>
<div class="paragraph">
<p>By adding a unique, random salt to the input, the output of the key derivation function becomes unique for each salt value, making precomputed attacks infeasible.</p>
</div>
<div class="paragraph">
<p>In the context of AES, salts are typically used when generating a key from a password using a <em>key derivation function</em> like PBKDF2, bcrypt, or scrypt.</p>
</div>
</li>
<li>
<p>IV (Initialization Vector): An IV is a random value used as the starting point for certain block cipher modes of operation, such as CBC (Cipher Block Chaining) or GCM (Galois/Counter Mode). The purpose of using an IV is to ensure that the same plaintext encrypted with the same key results in different ciphertexts each time. This adds an extra layer of security and prevents attackers from recognizing patterns in the encrypted data.</p>
<div class="paragraph">
<p>The IV should be unique and random for each encryption operation with the same key.</p>
</div>
<div class="paragraph">
<p>In AES, the IV is used in conjunction with the chosen mode of operation (e.g., AES-CBC or AES-GCM) and is not part of the core AES algorithm itself.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In AES (Advanced Encryption Standard), the Initialization Vector (IV) size depends on the block size of the cipher and the mode of operation used, such as AES-CBC (Cipher Block Chaining) or AES-GCM (Galois/Counter Mode). For AES, the block size is always 128 bits, regardless of the key size (128, 192, or 256 bits).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AES-CBC (Cipher Block Chaining): In AES-CBC mode, the IV size must be equal to the block size of the cipher, which is 128 bits (16 bytes) for AES.</p>
<div class="paragraph">
<p>The IV is combined with the first block of plaintext using an XOR operation before encryption and should be unique and random for each encryption operation with the same key.</p>
</div>
</li>
<li>
<p>AES-GCM (Galois/Counter Mode): In AES-GCM mode, the recommended IV size is 96 bits (12 bytes).</p>
<div class="paragraph">
<p>Using a 96-bit IV is considered the most efficient and secure option for GCM mode because it avoids the need for additional processing to generate the internal counter block.</p>
</div>
<div class="paragraph">
<p>However, it is possible to use other IV sizes with AES-GCM, but this requires an additional step called GHASH to compute a new IV based on the original IV.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In summary, the salt is used during the key derivation process to add randomness and prevent precomputed attacks, while the IV is used during encryption with specific block cipher modes of operation to ensure the uniqueness of the resulting ciphertexts. The IV size for AES-CBC is 128 bits (16 bytes), and for AES-GCM, the recommended size is 96 bits (12 bytes). Both salt and IV contribute to the overall security of AES encryption.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using a unique and random IV for each encryption operation with the same key is essential for maintaining the security of the encryption scheme.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="openssl-cryptography-and-ssltls-toolkit">A.4. OpenSSL: Cryptography and SSL/TLS Toolkit</h3>
<div class="paragraph">
<p>The <a href="https://www.openssl.org/">OpenSSL Project</a> develops and maintains the OpenSSL software - a robust, commercial-grade, full-featured toolkit for general-purpose cryptography and secure communication. <a href="#OPENSSL">[OPENSSL]</a></p>
</div>
<div class="paragraph">
<p>A good starting point for understanding some of the key concepts in OpenSSL 3.0 is the libcrypto <a href="https://www.openssl.org/docs/man3.0/man7/crypto.html">manual page</a>. Information and notes about migrating existing applications to OpenSSL 3.0 are available in the <a href="https://www.openssl.org/docs/man3.0/man7/migration_guide.html">OpenSSL 3.0 Migration Guide</a>. The <a href="https://www.openssl.org/docs/faq.html">frequently-asked questions (FAQ)</a> page is available.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The OpenSSL crypto library ("libcrypto") implements a wide range of cryptographic algorithms used in various Internet standards. The services provided by this library are used by the OpenSSL implementations of TLS and CMS, and they have also been used to implement many other third party products and protocols.</p>
</div>
<div class="paragraph">
<p>The functionality includes symmetric encryption, public key cryptography, key agreement, certificate handling, cryptographic hash functions, cryptographic pseudo-random number generators, message authentication codes (MACs), key derivation functions (KDFs), and various utilities.</p>
</div>
</blockquote>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl version
<span class="go">OpenSSL 3.0.9 30 May 2023 (Library: OpenSSL 3.0.9 30 May 2023)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Hello, 世界"</span>  <span class="o">&gt;</span> plaintext.txt
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Encrypt a message using a passphrase, a randomly generated salt, and a key derived with PBKDF2:</span>
<span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-salt</span> <span class="nt">-in</span> plaintext.txt <span class="nt">-out</span> ciphertext.txt <span class="nt">-pass</span> pass:123456
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Decrypt the encrypted message with the encrypted key derived with PBKDF2 from the same passphrase</span>
<span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-d</span> <span class="nt">-in</span> ciphertext.txt <span class="nt">-out</span> message.txt <span class="nt">-pass</span> pass:123456
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>message.txt
<span class="go">Hello, 世界</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Generate a private and public key pair for Alice (RSA)</span>
<span class="gp">$</span><span class="w"> </span>openssl genpkey <span class="nt">-algorithm</span> RSA <span class="nt">-pkeyopt</span> rsa_keygen_bits:4096 <span class="nt">-out</span> alice.key <span class="nt">-quiet</span>
<span class="gp">$</span><span class="w"> </span>openssl rsa <span class="nt">-in</span> alice.key <span class="nt">-pubout</span> <span class="nt">-out</span> alice.pub
<span class="go">writing RSA key

</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>alice.pub
<span class="go">-----BEGIN PUBLIC KEY-----
MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAw+BE9N6B2sz4MaM0aOZe
</span><span class="c">...
</span><span class="go">DwCtw8HP1vA5BEsOcogjCV8CAwEAAQ==
-----END PUBLIC KEY-----

</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>alice.key
<span class="go">-----BEGIN PRIVATE KEY-----
MIIJQQIBADANBgkqhkiG9w0BAQEFAASCCSswggknAgEAAoICAQDD4ET03oHazPgx
</span><span class="c">...
</span><span class="go">Fb4D3jFp0r9UrlYIM1mtEI3wZbvg
-----END PRIVATE KEY-----</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Generate a private and public key pair for Bob (ECC)</span>
<span class="gp">$</span><span class="w"> </span>openssl genpkey <span class="nt">-algorithm</span> EC <span class="nt">-out</span> bob.key <span class="nt">-pkeyopt</span> ec_paramgen_curve:secp384r1 <span class="nt">-pkeyopt</span> ec_param_enc:named_curve
<span class="gp">$</span><span class="w"> </span>openssl pkey <span class="nt">-in</span> bob.key <span class="nt">-pubout</span> <span class="nt">-out</span> bob.pub
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>bob.key
<span class="go">-----BEGIN PRIVATE KEY-----
MIG2AgEAMBAGByqGSM49AgEGBSuBBAAiBIGeMIGbAgEBBDCnOkyORJs4ESXkkdIM
</span><span class="c">...
</span><span class="go">3c7TzHSDQLACE8hp4slbh6BeatQMyuzZlSY+ajIfPyiiHhsaD3a5qC0=
-----END PRIVATE KEY-----
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>bob.pub
<span class="go">-----BEGIN PUBLIC KEY-----
MHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEEFQE3OsITjygGFvfg0qjwK1SZJJXUOZM
</span><span class="c">...
</span><span class="go">XmrUDMrs2ZUmPmoyHz8ooh4bGg92uagt
-----END PUBLIC KEY-----

</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">alice.key  alice.pub  bob.key  bob.pub</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Encrypt a message using a public key.</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-encrypt</span> <span class="nt">-pubin</span> <span class="nt">-inkey</span> alice.pub <span class="nt">-in</span> message.txt <span class="nt">-out</span> ciper.txt
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Decrypt the encrypted data using a private key.</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-decrypt</span> <span class="nt">-inkey</span> alice.key <span class="nt">-in</span> ciper.txt
<span class="go">Hello, 世界</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Sign a message using a private key</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-sign</span> <span class="nt">-inkey</span> alice.key <span class="nt">-in</span> message.txt <span class="nt">-out</span> sig.txt
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Verify the signature (e.g. a DSA key)</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-verify</span> <span class="nt">-inkey</span> alice.pub <span class="nt">-pubin</span> <span class="nt">-sigfile</span> sig.txt <span class="nt">-in</span> message.txt
<span class="go">Signature Verified Successfully</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># The digest functions output the message digest of a supplied file or files in hexadecimal.</span>
<span class="gp">$</span><span class="w"> </span>openssl dgst <span class="nt">-sha256</span> <span class="nt">-hex</span> <span class="nt">-out</span> dgst.txt message.txt
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>dgst.txt
<span class="go">SHA2-256(message.txt)= a281e84c7f61393db702630c2a6807e871cd3b6896c9e56e22982d125696575c
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>message.txt | <span class="nb">sha256sum</span>
<span class="go">a281e84c7f61393db702630c2a6807e871cd3b6896c9e56e22982d125696575c  -

</span><span class="gp">$</span><span class="w"> </span><span class="c"># The digest functions also generate and verify digital signatures using message digests.</span>
<span class="gp">$</span><span class="w"> </span>openssl dgst <span class="nt">-sha256</span> <span class="nt">-sign</span> alice.key <span class="nt">-out</span> sig.txt.0 message.txt
<span class="gp">$</span><span class="w"> </span>openssl dgst <span class="nt">-sha256</span> <span class="nt">-verify</span> alice.pub <span class="nt">-signature</span> sig.txt.0 message.txt
<span class="go">Verified OK</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># When signing a file, dgst will automatically determine the algorithm (RSA, ECC, etc) to use for signing \</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># based on the private key's ASN.1 info.</span>
<span class="gp">$</span><span class="w"> </span>openssl asn1parse <span class="nt">-in</span> alice.pub
<span class="go">    0:d=0  hl=4 l= 546 cons: SEQUENCE</span>
<span class="hll"><span class="go">    4:d=1  hl=2 l=  13 cons: SEQUENCE</span>
</span><span class="go">    6:d=2  hl=2 l=   9 prim: OBJECT            :rsaEncryption</span>
<span class="go">   17:d=2  hl=2 l=   0 prim: NULL</span>
<span class="go">   19:d=1  hl=4 l= 527 prim: BIT STRING</span>

<span class="gp">$</span><span class="w"> </span>openssl asn1parse <span class="nt">-in</span> bob.pub
<span class="go">    0:d=0  hl=2 l= 118 cons: SEQUENCE</span>
<span class="go">    2:d=1  hl=2 l=  16 cons: SEQUENCE</span>
<span class="hll"><span class="go">    4:d=2  hl=2 l=   7 prim: OBJECT            :id-ecPublicKey</span>
</span><span class="go">   13:d=2  hl=2 l=   5 prim: OBJECT            :secp384r1</span>
<span class="go">   20:d=1  hl=2 l=  98 prim: BIT STRING</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Hello, 世界"</span> <span class="o">&gt;</span> message.txt
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-hex</span> 16 | <span class="nb">tee </span>key.txt
<span class="go">40921c47c8086ad7a10059c94b35eb3d
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Create a hex-encoded (two hex digits per byte) HMAC-SHA256 MAC of a file and write to stdout</span>
<span class="gp">$</span><span class="w"> </span>openssl mac <span class="nt">-digest</span> sha256 <span class="nt">-macopt</span> hexkey:<span class="si">$(</span><span class="nb">cat </span>key.txt<span class="si">)</span> <span class="nt">-in</span> message.txt HMAC
<span class="go">7508EA0525F0F40CDF263089D5B4826D23342AAAE97EA77DAB44A325DE83AAE1</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-generate-an-encrypted-key-for-aes-using-openssl">A.5. How to generate an encrypted key for AES using OpenSSL?</h3>
<div class="paragraph">
<p>The best way to generate an encrypted key for AES using OpenSSL involves creating a strong, random symmetric key and then securely storing it.</p>
</div>
<div class="paragraph">
<p>You can use the <code>openssl rand</code> command, which generates cryptographically secure random bytes. The key size depends on the AES variant you want to use: AES-128, AES-192, or AES-256. Here&#8217;s how to generate a key for each AES variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># 1. Generate a 128-bit key for AES-128:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-out</span> aes128_key.bin 16
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># 2. Generate a 192-bit key for AES-192:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-out</span> aes192_key.bin 24
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># 3. Generate a 256-bit key for AES-256:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-out</span> aes256_key.bin 32</code></pre>
</div>
</div>
<div class="paragraph">
<p>These commands will generate random binary files with the specified number of bytes (16 bytes for AES-128, 24 bytes for AES-192, and 32 bytes for AES-256). You can then use these keys with the <code>openssl enc</code> command or other AES encryption tools.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is essential to protect the confidentiality of the generated AES keys, as anyone with access to the key can decrypt the encrypted data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to encrypt the generated key using a passphrase, you can use the <code>openssl enc</code> command with a suitable encryption algorithm like AES-256-CBC. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-salt</span> <span class="nt">-in</span> aes_key.bin <span class="nt">-out</span> encrypted_aes_key.bin <span class="nt">-pass</span> pass:your_secure_passphrase</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This command encrypts the <code>aes_key.bin</code> file using AES-256-CBC with a provided passphrase, adding a random salt for key derivation, and saves the encrypted key in the file <code>encrypted_aes_key.bin</code>.</p>
</li>
<li>
<p>Make sure to replace "your_secure_passphrase" with a strong, unique passphrase.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To decrypt the encrypted key when needed, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-d</span> <span class="nt">-aes-256-cbc</span> <span class="nt">-in</span> encrypted_aes_key.bin <span class="nt">-out</span> decrypted_aes_key.bin <span class="nt">-pass</span> pass:your_secure_passphrase</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This command decrypts the <code>encrypted_aes_key.bin</code> file using the provided passphrase and saves the decrypted key in the file <code>decrypted_aes_key.bin</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remember to protect the key file and passphrase, as they are required to decrypt the data encrypted with the generated AES key. Store them securely and restrict access to only the users or systems that need them.</p>
</div>
<div class="paragraph">
<p>You can also derive an AES key from a human-readable passphrase using a KDF (Key Derivation Function), such as PBKDF2 (Password-Based Key Derivation Function 2), which takes a passphrase, salt, and iteration count to generate a secure encryption key.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how to use the <code>openssl enc</code> command to derive an AES key from a passphrase and use it for encryption with OpenSSL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># print out the key and IV used a randomly generated salt then immediately exit: don't do any encryption or decryption.</span>
<span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-192-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-salt</span> <span class="nt">-P</span> <span class="nt">-pass</span> pass:your_passphrase <span class="o">&gt;</span> salt_iv_and_key.txt
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>salt_iv_and_key.txt
<span class="go">salt=76D7E6752358F5B3
key=CBE904342A2BB0C2385B01187EF5115FCBB6027521416708
iv =BF5BCA68D74A0FE3592913420A8F24F3

</span><span class="gp">$</span><span class="w"> </span><span class="c"># encrypt a message using a passphrase, a randomly generated salt, and a key derived with PBKDF2:</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Hello, 世界"</span> | openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-salt</span> <span class="nt">-out</span> encrypted.bin <span class="nt">-p</span> <span class="nt">-pass</span> pass:your_passphrase
<span class="go">salt=361CA8EF534E1219
key=7ED20774DE6A4369103736C851506B0E216BD52EA21C2CE00299EE3C98568CA7
iv =455AA565070AEFBD51230D532C347627

</span><span class="gp">$</span><span class="w"> </span><span class="c"># to decrypt the encrypted message, use the following command:</span>
<span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-d</span> <span class="nt">-in</span> encrypted.bin <span class="nt">-p</span> <span class="nt">-pass</span> pass:your_passphrase
<span class="go">salt=361CA8EF534E1219
key=7ED20774DE6A4369103736C851506B0E216BD52EA21C2CE00299EE3C98568CA7
iv =455AA565070AEFBD51230D532C347627
Hello, 世界</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Make sure to replace "your_passphrase" with a strong, unique passphrase.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember to securely store the passphrase and salt, as they are required to decrypt the data encrypted with the derived AES key. Share them only with the users or systems that need them.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="how-to-encrypt-a-message-with-aes">A.6. How to encrypt a message with AES?</h3>
<div class="paragraph">
<p>To generate a key and encrypt a message using AES with OpenSSL, follow these steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># 1. Generate a random key:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-base64</span> 32 <span class="o">&gt;</span> key.txt
<span class="gp">$</span><span class="w"> </span><span class="c"># This will generate a random 256-bit key and save it to a file called "key.txt".</span>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># 2. Encrypt a message using the key:</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Hello, 世界"</span> <span class="o">&gt;</span> message.txt
<span class="gp">$</span><span class="w">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># This will encrypt the message using AES-256 in CBC mode with a random IV and the key from "key.txt".</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># The encrypted message will be saved to a file called "cipher.txt".</span>
<span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-salt</span> <span class="nt">-in</span> message.txt <span class="nt">-out</span> cipher.txt <span class="nt">-pass</span> file:key.txt
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># 3. Decrypt the message using the key:</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># This will decrypt the message from "cipher.txt" using the same key from "key.txt"</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># and save the decrypted message to a file called "decrypted.txt".</span>
<span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-d</span> <span class="nt">-in</span> cipher.txt <span class="nt">-pass</span> file:key.txt <span class="nt">-out</span> decrypted.txt</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note: Make sure to keep the key file secure and do not share it with anyone who should not have access to the encrypted message.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous example, when you run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-salt</span> <span class="nt">-in</span> message.txt <span class="nt">-out</span> cipher.txt <span class="nt">-pass</span> file:key.txt</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenSSL automatically generates a random <strong>IV</strong> and uses it for the encryption.</p>
<div class="paragraph">
<p>The IV is stored alongside the encrypted data in the output file (<code>cipher.txt</code>). When decrypting the data, OpenSSL will automatically extract the IV from the input file and use it for decryption.</p>
</div>
<div class="paragraph">
<p>If you want to specify a custom IV, you can do so using the <code>-iv</code> option, but this is generally not recommended as it can weaken the security of the encryption. It is best to let OpenSSL generate a random IV for each encryption operation.</p>
</div>
</li>
<li>
<p>OpenSSL automatically generates a salt and uses it by default when you encrypt data using a password.</p>
<div class="paragraph">
<p>The salt is stored in the output file along with the encrypted data, making it possible to derive the same key during decryption.</p>
</div>
<div class="paragraph">
<p>When decrypting the data, OpenSSL will automatically extract the salt from the input file and use it along with the password to derive the correct encryption key.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to note that while the salt can be stored and transmitted alongside the encrypted data, the password must be kept secret and secure to maintain the confidentiality of the encrypted data.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>By default, the output file contains the salt and the IV along with the ciphertext with the following format:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">Salted__[8-byte salt][IV + ciphertext]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The salt and IV is often transmitted alongside the encrypted data, and it is necessary for the decryption process.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To extract the IV from the ciphertext file, you can use the <code>dd</code> command.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before doing that, make sure you know the size of the salt and the IV for the specific encryption method you used.</p>
</li>
<li>
<p>For AES, the default salt size if 8 bytes, and the IV size is 16 bytes, and the recommended IV size for AES-GCM is 12 bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s how to extract the IV:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, remove the <code>Salted__</code> part and the 8-byte salt from the ciphertext file:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">dd </span><span class="k">if</span><span class="o">=</span>cipher.txt <span class="nv">of</span><span class="o">=</span>data_without_salt.bin <span class="nv">bs</span><span class="o">=</span>1 <span class="nv">skip</span><span class="o">=</span>16</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command reads from <code>cipher.txt</code>, skips the first 16 bytes (8 for <code>Salted__</code> and 8 for the salt), and writes the result to <code>data_without_salt.bin</code>.</p>
</div>
</li>
<li>
<p>Next, extract the IV (16 bytes for AES) from the output file:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">dd </span><span class="k">if</span><span class="o">=</span>data_without_salt.bin <span class="nv">of</span><span class="o">=</span>iv.bin <span class="nv">bs</span><span class="o">=</span>1 <span class="nv">count</span><span class="o">=</span>16</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command reads the first 16 bytes from <code>data_without_salt.bin</code> and writes them to a file called <code>iv.bin</code>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keep in mind that you should not share the IV with unauthorized parties, as it is essential for the decryption process.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="how-to-determine-if-aes-cannot-decrypt-a-ciphertext">A.7. How to determine if AES cannot decrypt a ciphertext?</h3>
<div class="paragraph">
<p>AES is a symmetric encryption algorithm, which means that it uses the same key for both encryption and decryption. If you have the correct key and the ciphertext is not corrupted, you should be able to decrypt the ciphertext without any issues.</p>
</div>
<div class="paragraph">
<p>However, you cannot determine if AES cannot decrypt a ciphertext only by looking at the ciphertext itself, without trying to decrypt it. The only way to find out if a decryption will fail is by attempting to decrypt it using the key you have. If the key is incorrect or the ciphertext is corrupted, the decryption will produce garbled or meaningless output. In some cases, you can also get an error or an exception while trying to decrypt, depending on the padding scheme used and the library you&#8217;re using.</p>
</div>
<div class="paragraph">
<p>However, AES-GCM can help determine whether AES can decrypt the ciphertext or not because it provides both encryption and authentication. If the key, IV (nonce), or ciphertext is incorrect or tampered with, the authentication tag verification will fail during decryption, and an exception will be thrown. In this case, you can conclude that the decryption failed.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a step-by-step process to encrypt and decrypt a message using AES-GCM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># 1. Generate a 256-bit key for AES-256:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-out</span> aes256_key.bin 32
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># 2. Generate a random 96-bit (12-byte) nonce (also called IV - Initialization Vector) for GCM:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-out</span> nonce.bin 12
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># 3. Encrypt a message using AES-256-GCM:</span>
<span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-gcm</span> <span class="nt">-in</span> plaintext.txt <span class="nt">-out</span> encrypted.bin <span class="se">\</span>
<span class="gp">   -K $</span><span class="o">(</span><span class="nb">cat </span>aes256_key.bin | xxd <span class="nt">-p</span><span class="o">)</span> <span class="se">\</span>
<span class="gp">   -iv $</span><span class="o">(</span><span class="nb">cat </span>nonce.bin | xxd <span class="nt">-p</span><span class="o">)</span> <span class="se">\</span>
<span class="go">   -aead</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will encrypt the file <code>plaintext.txt</code> and create an encrypted file <code>encrypted.bin</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>-K</code> and <code>-iv</code> options specify the key and nonce in hexadecimal format, respectively.</p>
</li>
<li>
<p>The <code>-aead</code> option indicates that an authentication tag will be generated and appended to the encrypted message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Decrypt the message and verify its integrity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-d</span> <span class="nt">-aes-256-gcm</span> <span class="nt">-in</span> encrypted.bin <span class="nt">-out</span> decrypted.txt <span class="se">\</span>
<span class="gp">    -K $</span><span class="o">(</span><span class="nb">cat </span>aes256_key.bin | xxd <span class="nt">-p</span><span class="o">)</span> <span class="se">\</span>
<span class="gp">    -iv $</span><span class="o">(</span><span class="nb">cat </span>nonce.bin | xxd <span class="nt">-p</span><span class="o">)</span> <span class="se">\</span>
<span class="go">    -aead</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will decrypt the file <code>encrypted.bin</code> and create a decrypted file <code>decrypted.txt</code>. If the message has been tampered with, OpenSSL will display an error message like bad decrypt or error reading input file.</p>
</div>
<div class="paragraph">
<p>Remember, you should securely share the AES key and nonce/IV with the recipient, but do not transmit them alongside the encrypted message. The nonce/IV should be unique for each encryption operation with the same key.</p>
</div>
<div class="paragraph">
<p>In real-world applications, you should handle these sensitive values securely, such as using secure key storage solutions and secure channels for key exchange.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-to-encrypte-a-message-with-aes-using-a-specific-salt-and-an-iv">A.8. How to encrypte a message with AES using a specific salt and an IV?</h3>
<div class="paragraph">
<p>For OpenSSL, the default salt size is 8 bytes (64 bits). This size provides a reasonable balance between security and efficiency. A larger salt size would increase the number of unique salts, making it more difficult for attackers to precompute tables for dictionary or rainbow table attacks. However, it would also require more storage space and processing time.</p>
</div>
<div class="paragraph">
<p>For AES, the block size is 128 bits, which is why the IV size is 16 bytes (128 bits). The IV must be the same size as the block size to ensure that the encryption process works correctly and securely.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To create a salt and an IV using OpenSSL, you can use the openssl rand command. Here&#8217;s how to create them:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># These commands generate random salt and IV values in hexadecimal format and save them to separate files.</span>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># For OpenSSL, the salt is 8 bytes (64 bits) long.</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># To generate a random salt and save it to a file called salt.txt, use the following command:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-hex</span> 8 <span class="o">&gt;</span> salt.txt
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># For AES, the IV is 16 bytes (128 bits) long.</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># To generate a random IV and save it to a file called iv.txt, use the following command:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-hex</span> 16 <span class="o">&gt;</span> iv.txt</code></pre>
</div>
</div>
</li>
<li>
<p>To encrypt a message with AES using a specific salt and IV in OpenSSL, you can use the following steps:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Derive the encryption key from the password and salt using a key derivation function, such as <code>PBKDF2</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># This command generates the key and IV using the password from `password.txt` and the salt from `salt.txt`.</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># The key and IV are stored in a file called `key_and_iv.txt`.</span>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Print out the key and IV used then immediately exit: don't do any encryption or decryption.</span>
<span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-pbkdf2</span> <span class="nt">-S</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">cat </span>salt.txt<span class="si">)</span><span class="s2">"</span> <span class="nt">-P</span> <span class="nt">-pass</span> file:password.txt <span class="o">&gt;</span> key_and_iv.txt
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>key_and_iv.txt
<span class="go">salt=967D5441CD75BA53
key=F29DCDB2D054B75CC380606B3FED28DF0FD84F3452EA6B0D759B412C22AF9D84
iv =0029B6227C554F1AC120CB414708F08C</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that this command will generate a new IV, but we&#8217;ll replace it with our specific IV in the next step.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Replace the generated IV in <code>key_and_iv.txt</code> with your specific IV:</p>
<div class="ulist">
<ul>
<li>
<p>Open <code>key_and_iv.txt</code> and locate the line that starts with "iv =". Replace the IV value with the contents of the <code>iv.txt</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">salt=8F585A18C70FBC06
key=7E60368294A3223978F440BDC4A424DF03D281699F1BF3C38D461559E4A595F4
iv =2b9233c61a92f9becc6af13b68747ad2</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Encrypt the message using AES, the key, and the specific IV:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># This command encrypts the message in `plaintext.txt`  \</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># using AES-256-CBC with the key and specific IV from `key_and_iv.txt`.</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># The encrypted data is stored in a file called `ciphertext.txt`.</span>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Hello, 世界"</span> | openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-out</span> ciphertext.txt <span class="se">\</span>
<span class="gp">     -K "$</span><span class="o">(</span><span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'(?&lt;=key=).+'</span> key_and_iv.txt<span class="o">)</span><span class="s2">" </span><span class="se">\</span><span class="s2">
</span><span class="gp">    -iv "$</span><span class="s2">(grep -oP '(?&lt;=iv =).+' key_and_iv.txt)"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Decrypt the message using AES, the key, and the specific IV:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl enc <span class="nt">-aes-256-cbc</span> <span class="nt">-d</span> <span class="nt">-in</span> ciphertext.txt <span class="se">\</span>
<span class="gp">     -K "$</span><span class="o">(</span><span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'(?&lt;=key=).+'</span> key_and_iv.txt<span class="o">)</span><span class="s2">" </span><span class="se">\</span><span class="s2">
</span><span class="gp">    -iv "$</span><span class="s2">(grep -oP '(?&lt;=iv =).+' key_and_iv.txt)"</span>
<span class="go">Hello, 世界</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ec-ecc-ecdh-and-ecdsa">A.9. EC, ECC, ECDH and ECDSA?</h3>
<div class="paragraph">
<p>EC, ECC, ECDH, and ECDSA are all related to elliptic curve cryptography, but they serve different purposes and functions. Here&#8217;s an explanation of each term:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>EC (Elliptic Curve): An elliptic curve is a mathematical construct used in cryptography for creating cryptosystems that are based on the algebraic structure of elliptic curves over finite fields. Elliptic curves provide the basis for elliptic curve cryptography (ECC).</p>
</li>
<li>
<p>ECC (Elliptic Curve Cryptography): ECC is a public-key cryptosystem that is based on the algebraic structure of elliptic curves over finite fields. It offers the same security level as other public-key cryptosystems like RSA, but with smaller key sizes, which makes it more efficient in terms of computation and memory usage. ECC can be used for encryption, decryption, digital signatures, and key exchange. ECDH and ECDSA are both cryptographic schemes based on ECC.</p>
</li>
<li>
<p>ECDH (Elliptic Curve Diffie-Hellman): ECDH is a key exchange protocol that is based on elliptic curve cryptography. It allows two parties, each having an elliptic curve public-private key pair, to establish a shared secret over an insecure channel. This shared secret can then be used to encrypt and decrypt messages between the two parties or to generate symmetric keys for symmetric encryption algorithms like AES. ECDH provides a secure way to establish a shared secret key without directly transmitting the key itself.</p>
</li>
<li>
<p>ECDSA (Elliptic Curve Digital Signature Algorithm): ECDSA is a digital signature algorithm that is based on elliptic curve cryptography. It is used for signing and verifying digital signatures to ensure the integrity and authenticity of data. In ECDSA, a private key is used to generate a digital signature, and a public key is used to verify the signature. ECDSA provides similar functionality to other digital signature algorithms like RSA, but with smaller key sizes and more efficient operations.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In summary, EC and ECC are related to the underlying mathematical concepts and the overall cryptography approach based on elliptic curves. ECDH and ECDSA are specific cryptographic schemes based on ECC, with ECDH being used for secure key exchange and ECDSA being used for digital signatures.</p>
</div>
</div>
<div class="sect2">
<h3 id="rsa-dh-and-ecdh">A.10. RSA, DH, and ECDH</h3>
<div class="paragraph">
<p>RSA, DH, and ECDH are cryptographic algorithms that serve different purposes and are based on different mathematical foundations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>RSA (Rivest-Shamir-Adleman): RSA is an asymmetric cryptographic algorithm used for encryption, decryption, and digital signatures. It is based on the mathematical properties of large prime numbers and modular exponentiation. In RSA, a key pair (private key and public key) is generated, and the security relies on the difficulty of factoring the product of two large prime numbers. RSA is widely used in various security protocols and systems, such as TLS, SSH, and PGP.</p>
</li>
<li>
<p>DH (Diffie-Hellman): DH is a key exchange algorithm that allows two parties to establish a shared secret over an insecure communication channel. It is based on the mathematical properties of modular exponentiation and the discrete logarithm problem. In DH, both parties generate their own private keys and public keys, exchange the public keys, and perform calculations to derive the shared secret. The security relies on the difficulty of solving the Discrete Logarithm Problem (DLP). DH does not provide encryption, decryption, or digital signature capabilities by itself but enables secure key agreement to establish symmetric keys for use in encryption or authentication.</p>
</li>
<li>
<p>ECDH (Elliptic Curve Diffie-Hellman): ECDH is a key exchange algorithm that is based on elliptic curve cryptography. It is the elliptic curve counterpart of the Diffie-Hellman algorithm. ECDH allows two parties to establish a shared secret using elliptic curve operations instead of modular exponentiation. Like DH, both parties generate their own private keys and public keys, exchange the public keys, and perform calculations to derive the shared secret. The security relies on the difficulty of solving the Elliptic Curve Discrete Logarithm Problem (ECDLP). ECDH provides the same key exchange functionality as DH but with smaller key sizes and better performance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In summary, RSA is an asymmetric cryptographic algorithm used for encryption, decryption, and digital signatures, while DH and ECDH are key exchange algorithms that allow parties to establish a shared secret securely. DH is based on modular exponentiation, while ECDH uses elliptic curve cryptography.</p>
</div>
</div>
<div class="sect2">
<h3 id="digital-signatures-and-public-key-encryptiondecryption">A.11. Digital signatures and public key encryption/decryption</h3>
<div class="paragraph">
<p>Digital signatures and public key encryption/decryption are both concepts that rely on public key cryptography (also known as asymmetric cryptography). They serve different purposes and have distinct properties:</p>
</div>
<div class="paragraph">
<p><strong>Digital Signatures</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Purpose: Digital signatures are used to verify the authenticity, integrity, and non-repudiation of a message or document. They confirm that the message has not been altered during transmission and that it comes from a specific sender.</p>
</li>
<li>
<p>Process: The sender generates a digital signature by applying a cryptographic hash function to the message and then <em>encrypting the hash using their private key</em>. The recipient verifies the signature by decrypting the hash using the sender&#8217;s public key, and then independently hashing the message and comparing the two hashes. If they match, the signature is considered valid.</p>
</li>
<li>
<p>Properties: Digital signatures provide message integrity, authentication, and non-repudiation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Public Key Encryption/Decryption</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Purpose: Public key encryption is used to ensure the confidentiality of a message or document. It ensures that only the intended recipient can read the message.</p>
</li>
<li>
<p>Process: The sender <em>encrypts the message using the recipient&#8217;s public key</em>. The encrypted message can only be decrypted by the recipient using their private key, ensuring that the message remains confidential.</p>
</li>
<li>
<p>Properties: Public key encryption provides message confidentiality.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In summary, digital signatures are used for verifying the authenticity and integrity of a message, while public key encryption is used for ensuring the confidentiality of a message. Both concepts rely on public key cryptography, where each user has a pair of keys: a public key for encryption or signature verification, and a private key for decryption or signature generation.</p>
</div>
</div>
<div class="sect2">
<h3 id="is-it-possible-to-encrypt-a-message-with-a-private-key-and-decrypt-it-with-the-corresponding-public-key-or-vice-versa">A.12. Is it possible to encrypt a message with a private key and decrypt it with the corresponding public key, or vice versa?</h3>
<div class="paragraph">
<p>In theory, it is possible to encrypt a message with a private key and decrypt it with the corresponding public key, or vice versa, depending on the specific public key cryptosystem being used. However, this approach is not recommended for ensuring confidentiality, as it has different security implications.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Encrypting a message with a private key and decrypting it with a public key is essentially the concept behind digital signatures.</p>
<div class="paragraph">
<p>When you sign a message with your private key, anyone with your public key can verify the signature, effectively decrypting the encrypted hash. This process is used to provide authentication and integrity, not confidentiality.</p>
</div>
</li>
<li>
<p>Encrypting a message with a public key and decrypting it with a private key is the standard method for ensuring confidentiality in public key cryptography.</p>
<div class="paragraph">
<p>This method ensures that only the intended recipient, who possesses the private key, can decrypt and read the message.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In summary, while it is technically possible to encrypt a message with a private key and decrypt it with a public key or vice versa, it is not the recommended approach for ensuring confidentiality. Instead, use the standard method of encrypting with a public key and decrypting with the corresponding private key for secure communication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Hello, 世界"</span> <span class="o">&gt;</span> message.txt
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>openssl genpkey <span class="nt">-algorithm</span> RSA <span class="nt">-out</span> private_key.pem <span class="nt">-pkeyopt</span> rsa_keygen_bits:2048 <span class="nt">-quiet</span>
<span class="gp">$</span><span class="w"> </span>openssl rsa <span class="nt">-in</span> private_key.pem <span class="nt">-pubout</span> <span class="nt">-out</span> public_key.pem
<span class="go">writing RSA key
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Encrypt a message using the public ke</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-encrypt</span> <span class="nt">-in</span> message.txt <span class="nt">-out</span> encrypted_message.bin <span class="nt">-pubin</span> <span class="nt">-inkey</span> public_key.pem
<span class="gp">$</span><span class="w"> </span><span class="c"># Decrypt the encrypted message using the private key</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-decrypt</span> <span class="nt">-in</span> encrypted_message.bin <span class="nt">-out</span> decrypted_message.txt <span class="nt">-inkey</span> private_key.pem
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>decrypted_message.txt
<span class="go">Hello, 世界
</span><span class="gp">$</span><span class="w"> </span>openssl dgst <span class="nt">-sha256</span> <span class="nt">-sign</span> private_key.pem <span class="nt">-out</span> signature.bin message.txt
<span class="gp">$</span><span class="w"> </span>openssl dgst <span class="nt">-sha256</span> <span class="nt">-verify</span> public_key.pem <span class="nt">-signature</span> signature.bin message.txt
<span class="go">Verified OK</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="it-seems-that-the-text-length-of-private-key-is-larger-than-public-key-in-pem">A.13. It seems that the text length of private key is larger than public key in PEM?</h3>
<div class="paragraph">
<p>Yes, that is correct. The text length of a private key in PEM format is generally larger than the public key. This is because the private key contains more information than the public key.</p>
</div>
<div class="paragraph">
<p>In the case of RSA, for example, the private key includes the following components: modulus (n), public exponent (e), private exponent (d), prime1 (p), prime2 (q), exponent1 (d mod (p-1)), exponent2 (d mod (q-1)), and coefficient (q^-1 mod p). The public key, on the other hand, contains only the modulus (n) and the public exponent (e).</p>
</div>
<div class="paragraph">
<p>Similarly, in the case of ECC, the private key includes the curve parameters and the private scalar, while the public key only includes the curve parameters and the public point.</p>
</div>
<div class="paragraph">
<p>When represented in PEM format, these additional components in the private key result in a larger text length compared to the public key. However, it&#8217;s important to note that the actual key lengths (e.g., 256-bit for ECC or 2048-bit for RSA) refer to the mathematical properties of the keys and not their text representations.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-does-openssl-determine-the-algorithm-rsa-or-ecc">A.14. How does OpenSSL determine the algorithm (RSA or ECC)?</h3>
<div class="paragraph">
<p>When you create a digital signature with <code>openssl dgst</code>, the command reads the private key file and extracts the relevant information, such as the algorithm used (RSA, ECC, etc.) from the ASN.1 encoded data. Based on this information, it selects the appropriate signing algorithm and creates the digital signature.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ASN.1 (Abstract Syntax Notation One) is a standardized notation used to describe the structure and encoding of data in telecommunications and computer networking. Private keys are often stored in the PEM (Privacy Enhanced Mail) format, which contains the ASN.1 encoded data in a base64 representation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When OpenSSL reads a key, it decodes the base64 data and parses the ASN.1 structure. This structure includes an identifier called "Object Identifier" (OID) that indicates the algorithm associated with the key. OpenSSL uses this OID to determine the correct algorithm.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For RSA keys, the OID is <code>1.2.840.113549.1.1.1</code>.</p>
</li>
<li>
<p>For EC (Elliptic Curve) keys, the OID is <code>1.2.840.10045.2.1</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s a high-level view of how OpenSSL determines the algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read the private key file.</p>
</li>
<li>
<p>Decode the base64 data and parse the ASN.1 structure.</p>
</li>
<li>
<p>Locate the OID in the ASN.1 structure.</p>
</li>
<li>
<p>Compare the OID with known algorithm OIDs.</p>
</li>
<li>
<p>Use the corresponding algorithm for signing or other operations.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This process allows OpenSSL to automatically determine the algorithm used for signing and verification based on the ASN.1 information in the private and public keys.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-to-use-openssl-to-show-the-asn-1-oid-in-a-key-file">A.15. How to use OpenSSL to show the ASN.1 OID in a key file?</h3>
<div class="paragraph">
<p>You can use the <code>openssl asn1parse</code> command to display the ASN.1 structure of a key file, which includes the OID (Object Identifier). Here&#8217;s an example for both RSA and ECC keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Generate a private and public key pair for Alice (RSA)</span>
<span class="gp">$</span><span class="w"> </span>openssl genpkey <span class="nt">-algorithm</span> RSA <span class="nt">-pkeyopt</span> rsa_keygen_bits:4096 <span class="nt">-out</span> alice.rsa.key <span class="nt">-quiet</span>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Generate a private and public key pair for Bob (EC)</span>
<span class="gp">$</span><span class="w"> </span>openssl genpkey <span class="nt">-algorithm</span> EC <span class="nt">-out</span> bob.ecc.key <span class="nt">-pkeyopt</span> ec_paramgen_curve:secp384r1 <span class="nt">-pkeyopt</span> ec_param_enc:named_curve</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl asn1parse <span class="nt">-in</span> alice.rsa.key
<span class="go">    0:d=0  hl=4 l=2370 cons: SEQUENCE
    4:d=1  hl=2 l=   1 prim: INTEGER           :00
    7:d=1  hl=2 l=  13 cons: SEQUENCE
    9:d=2  hl=2 l=   9 prim: OBJECT            :rsaEncryption
   20:d=2  hl=2 l=   0 prim: NULL
</span><span class="gp">   22:d=1  hl=4 l=2348 prim: OCTET STRING      [HEX DUMP]: &lt;...&gt;</span><span class="w">
</span><span class="go">
</span><span class="gp">$</span><span class="w"> </span>openssl asn1parse <span class="nt">-in</span> bob.ecc.key
<span class="go">    0:d=0  hl=3 l= 182 cons: SEQUENCE
    3:d=1  hl=2 l=   1 prim: INTEGER           :00
    6:d=1  hl=2 l=  16 cons: SEQUENCE
    8:d=2  hl=2 l=   7 prim: OBJECT            :id-ecPublicKey
   17:d=2  hl=2 l=   5 prim: OBJECT            :secp384r1
</span><span class="gp">   24:d=1  hl=3 l= 158 prim: OCTET STRING      [HEX DUMP]: &lt;...&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the output, you should see an entry with the OID <code>1.2.840.113549.1.1.1</code> corresponding to the RSA algorithm, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">9:d=2  hl=2 l=   9 prim: OBJECT            :rsaEncryption</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And, similarly, an entry with the OID <code>1.2.840.10045.2.1</code> corresponding to the ECC algorithm, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">8:d=2  hl=2 l=   7 prim: OBJECT            :id-ecPublicKey</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-derive-a-shared-key-using-key-exchange-algorithm">A.16. How to derive a shared key using key exchange algorithm?</h3>
<div class="paragraph">
<p>Here&#8217;s an example of how to use the <code>openssl pkeyutl</code> command to derive a shared key using the Elliptic Curve Diffie-Hellman (ECDH) key exchange.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl genpkey <span class="nt">-algorithm</span> EC <span class="nt">-pkeyopt</span> ec_paramgen_curve:P-256 <span class="nt">-out</span> alice.key
<span class="gp">$</span><span class="w"> </span>openssl pkey <span class="nt">-in</span> alice.key <span class="nt">-pubout</span> <span class="nt">-out</span> alice.pub
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>openssl genpkey <span class="nt">-algorithm</span> EC <span class="nt">-pkeyopt</span> ec_paramgen_curve:P-256 <span class="nt">-out</span> bob.key
<span class="gp">$</span><span class="w"> </span>openssl pkey <span class="nt">-in</span> bob.key <span class="nt">-pubout</span> <span class="nt">-out</span> bob.pub
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-derive</span> <span class="nt">-inkey</span> alice.key <span class="nt">-peerkey</span> bob.pub <span class="nt">-out</span> alice.secret.bin
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-derive</span> <span class="nt">-inkey</span> bob.key <span class="nt">-peerkey</span> alice.pub <span class="nt">-out</span> bob.secret.bin
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>cmp <span class="nt">-s</span> alice.secret.bin bob.secret.bin <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Shared secrets match"</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"Shared secrets don't match"</span>
<span class="go">Shared secrets match</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the derived shared secret is a binary file. In practice, you may want to use a <em>key derivation function</em> (KDF) to generate a symmetric key from the shared secret for use in encryption or authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Digital Signature Algorithm (DSA) is designed for digital signatures and not for key agreement or key exchange protocols like Diffie-Hellman or Elliptic Curve Diffie-Hellman, which are specifically designed for secure key agreement purposes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the shared key derived from a static key pair will always be the same.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To mitigate the risk of the shared key being compromised, you can use ephemeral (temporary) key pairs in the Diffie-Hellman (DH) or Elliptic Curve Diffie-Hellman (ECDH) key exchange process.</p>
</li>
<li>
<p>This approach is called Ephemeral Diffie-Hellman (DHE) or Ephemeral Elliptic Curve Diffie-Hellman (ECDHE).</p>
</li>
<li>
<p>In DHE or ECDHE, each party generates a new temporary key pair for each key exchange session, derives the shared secret, and then discards the temporary keys.</p>
</li>
<li>
<p>This approach provides <em>forward secrecy</em>, meaning that even if an attacker compromises a shared key for one session, they cannot use it to decrypt past or future sessions.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember to generate new ephemeral key pairs for each session and securely delete the temporary keys after use to maintain forward secrecy.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="can-i-derive-a-shared-key-using-two-different-cipher-algorithm-keys">A.17. Can I derive a shared key using two different cipher algorithm keys?</h3>
<div class="paragraph">
<p>No, you cannot use the <code>openssl pkeyutl</code> command to derive a shared key using two different cipher algorithm keys. Key derivation requires both parties to use keys generated with the same algorithm and compatible parameters.</p>
</div>
<div class="paragraph">
<p>For example, if you want to derive a shared key using the Elliptic Curve Diffie-Hellman (ECDH) key exchange, both parties must use ECC key pairs with the same elliptic curve. Similarly, for Diffie-Hellman (DH) key exchange, both parties must use key pairs with compatible parameters (prime modulus and generator).</p>
</div>
<div class="paragraph">
<p>Attempting to derive a shared key using keys from different algorithms, such as RSA and ECC, will result in an error because their underlying mathematical structures and key generation processes are fundamentally different and not compatible with each other.</p>
</div>
<div class="paragraph">
<p>If you want to derive a shared key, make sure both parties use compatible keys generated with the same algorithm and appropriate parameters.</p>
</div>
</div>
<div class="sect2">
<h3 id="can-i-derive-a-shared-key-with-rsa">A.18. Can I derive a shared key with RSA?</h3>
<div class="paragraph">
<p>No, you cannot use <code>openssl pkeyutl</code> to directly derive a shared key with RSA in the same way as you would with Diffie-Hellman (DH) or Elliptic Curve Diffie-Hellman (ECDH). This is because RSA is not designed as a key agreement or key exchange algorithm like DH or ECDH.</p>
</div>
<div class="paragraph">
<p>However, you can use RSA to encrypt and decrypt a shared secret, which can then be used as a shared key for symmetric encryption. Here&#8217;s an example of how to do this with OpenSSL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Generate an RSA key pair for the server</span>
<span class="gp">$</span><span class="w"> </span>openssl genpkey <span class="nt">-algorithm</span> RSA <span class="nt">-out</span> server.key.pem <span class="nt">-pkeyopt</span> rsa_keygen_bits:2048
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Extract the public key from the server's private key:</span>
<span class="gp">$</span><span class="w"> </span>openssl pkey <span class="nt">-in</span> server.key.pem <span class="nt">-pubout</span> <span class="nt">-out</span> server.pub.pem
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Generate a random pre-master secret (shared secret) on the client side:</span>
<span class="gp">$</span><span class="w"> </span>openssl rand <span class="nt">-out</span> pre_master_secret.bin 48
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Encrypt the pre-master secret using the server's RSA public key:</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-encrypt</span> <span class="nt">-in</span> pre_master_secret.bin <span class="nt">-pubin</span> <span class="nt">-inkey</span> server.pub.pem <span class="nt">-out</span> encrypted_pre_master_secret.bin
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Decrypt the encrypted pre-master secret using the server's RSA private key:</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-decrypt</span> <span class="nt">-in</span> encrypted_pre_master_secret.bin <span class="nt">-inkey</span> server.key.pem <span class="nt">-out</span> decrypted_pre_master_secret.bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, both the client and the server have the same pre-master secret (shared secret). You can use this shared secret to derive symmetric encryption keys using a key derivation function.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that this process does not provide <em>forward secrecy</em>, as mentioned in previous responses, and it is recommended to use modern key exchange algorithms like ECDHE or DHE for better security.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Although RSA key exchange is supported in TLS 1.0 - TLS 1.2, it has some drawbacks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It does not provide forward secrecy.</p>
<div class="paragraph">
<p>If an attacker manages to compromise the server&#8217;s RSA private key, they can decrypt past recorded TLS sessions that used the same key.</p>
</div>
</li>
<li>
<p>The server must have an RSA key pair, which might not be the case if the server uses an ECDSA certificate for digital signatures.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Due to these limitations, modern TLS configurations often prefer using ephemeral key exchange algorithms like DHE (Diffie-Hellman Ephemeral) or ECDHE (Elliptic Curve Diffie-Hellman Ephemeral), which provide forward secrecy and work independently of the server&#8217;s certificate type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In TLS 1.3, RSA key exchange has been removed, and only ephemeral key exchange algorithms like ECDHE and DHE are supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="how-to-compute-the-digest-and-sign-it-from-a-csr-separately">A.19. How to compute the digest and sign it from a CSR separately?</h3>
<div class="paragraph">
<p>The origin data of the digest in a CSR (Certificate Signing Request) is the DER-encoded data of the CertificationRequestInfo structure, which contains information about the subject, public key, and optional attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Create a Certificate Signing Request (CSR)</span>
<span class="gp">$</span><span class="w"> </span>openssl req <span class="nt">-subj</span> <span class="s2">"/CN=955.wlb"</span> <span class="se">\</span>
<span class="go">    -addext "subjectAltName=DNS:955.wlb,DNS:*.955.wlb" \
    -addext "basicConstraints=CA:false" \
    -addext "keyUsage=digitalSignature,keyEncipherment" \
    -addext "extendedKeyUsage=serverAuth,clientAuth" \
    -nodes -newkey rsa:2048 \
    -keyout 955.wlb.key \
    -out 955.wlb.csr \
</span><span class="gp">    2&gt;</span>/dev/null
<span class="gp">$</span><span class="w"> </span><span class="c"># Verify the self-signed signature of a request:</span>
<span class="gp">$</span><span class="w"> </span>openssl req <span class="nt">-verify</span> <span class="nt">-in</span> 955.wlb.csr <span class="nt">-noout</span>
<span class="go">Certificate request self-signature verify OK</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A certification request shall have ASN.1 type CertificationRequest: [RFC2986]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="asn1">CertificationRequest ::= SEQUENCE {
     certificationRequestInfo CertificationRequestInfo,
     signatureAlgorithm AlgorithmIdentifier{{ SignatureAlgorithms }},
     signature          BIT STRING
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Parse the CSR information in ASN1</span>
<span class="gp">$</span><span class="w"> </span>openssl asn1parse <span class="nt">-in</span> 955.wlb.csr <span class="nt">-i</span>
<span class="go">    0:d=0  hl=4 l= 702 cons: SEQUENCE
    4:d=1  hl=4 l= 422 cons:  SEQUENCE
</span><span class="c">    ...
</span><span class="go">   31:d=2  hl=4 l= 290 cons:   SEQUENCE
   35:d=3  hl=2 l=  13 cons:    SEQUENCE
   37:d=4  hl=2 l=   9 prim:     OBJECT            :rsaEncryption
</span><span class="c">    ...
</span><span class="go">  430:d=1  hl=2 l=  13 cons:  SEQUENCE
</span><span class="c">    ...
</span><span class="go">  445:d=1  hl=4 l= 257 prim:  BIT STRING

</span><span class="gp">$</span><span class="w"> </span><span class="c"># Extract the certificationRequestInfo</span>
<span class="gp">$</span><span class="w"> </span>openssl asn1parse <span class="nt">-in</span> 955.wlb.csr <span class="nt">-strparse</span> 4 <span class="nt">-out</span> 955.wlb.cri <span class="nt">-noout</span>
<span class="gp">$</span><span class="w"> </span><span class="c"># Extract the signature vaule (ignore the error, because it's the raw signature bytes instead of ASN.1 encoded.</span>
<span class="gp">$</span><span class="w"> </span>openssl asn1parse <span class="nt">-in</span> 955.wlb.csr <span class="nt">-strparse</span> 445 <span class="nt">-out</span> 955.wlb.sig.o <span class="o">&gt;</span> /dev/null 2&gt;&amp;1
<span class="gp">$</span><span class="w"> </span><span class="c"># Determine the signature algorithm</span>
<span class="gp">$</span><span class="w"> </span>openssl req <span class="nt">-in</span> 955.wlb.csr <span class="nt">-noout</span> <span class="nt">-text</span> | <span class="nb">grep</span> <span class="s1">'Signature Algorithm:'</span>
<span class="go">    Signature Algorithm: sha256WithRSAEncryption
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Sign the raw request information using the private key</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-sign</span> <span class="nt">-inkey</span> 955.wlb.key <span class="se">\</span>
<span class="go">    -digest sha256 -rawin \
    -in 955.wlb.cri \
    -out 955.wlb.sig.1
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Compare the signatures</span>
<span class="gp">$</span><span class="w"> </span>diff 955.wlb.sig.o 955.wlb.sig.1
<span class="gp">&lt;nothing is ok&gt;</span><span class="w">
</span><span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Extract the public key</span>
<span class="gp">$</span><span class="w"> </span>openssl pkey <span class="nt">-in</span> 955.wlb.key <span class="nt">-pubout</span> <span class="nt">-out</span> 955.wlb.pub
<span class="gp">$</span><span class="w"> </span><span class="c"># or</span>
<span class="gp">$</span><span class="w"> </span>openssl asn1parse <span class="nt">-in</span> 955.wlb.csr <span class="nt">-strparse</span> 31 <span class="nt">-out</span> /dev/stdout <span class="nt">-noout</span> <span class="se">\</span>
<span class="go">    | openssl pkey -pubin -inform DER -outform PEM -out 955.wlb.pub.1
</span><span class="gp">$</span><span class="w"> </span>diff 955.wlb.pub 955.wlb.pub.1
<span class="gp">&lt;nothing is ok&gt;</span><span class="w">
</span><span class="gp">$</span><span class="w"> </span><span class="c"># Verify the signature using the publick key</span>
<span class="gp">$</span><span class="w"> </span>openssl pkeyutl <span class="nt">-verify</span> <span class="nt">-pubin</span> <span class="nt">-inkey</span> 955.wlb.pub <span class="se">\</span>
<span class="go">    -rawin -digest sha256 -in 955.wlb.cri \
    -sigfile 955.wlb.sig.o
Signature Verified Successfully</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-create-issue-and-verify-a-certificate">A.20. How to create, issue and verify a certificate?</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Create a self-signed CA root certificate</span>
<span class="gp">$</span><span class="w"> </span>openssl req <span class="nt">-x509</span> <span class="se">\</span>
<span class="go">    -subj "/CN=996.icu" \
    -addext "subjectAltName=DNS:996.icu,DNS:*.996.icu" \
    -addext "keyUsage=digitalSignature,cRLSign,keyCertSign" \
    -addext "extendedKeyUsage=serverAuth,clientAuth" \
    -days 365 \
    -nodes -newkey rsa:2048 \
    -keyout 996.icu.key \
    -out 996.icu.crt \
</span><span class="gp">    &gt;</span><span class="w"> </span>/dev/null 2&gt;&amp;1
<span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-in</span> 996.icu.crt <span class="nt">-noout</span> <span class="nt">-ext</span> keyUsage,extendedKeyUsage,basicConstraints
<span class="go">X509v3 Basic Constraints: critical
    CA:TRUE
X509v3 Key Usage:
    Digital Signature, Certificate Sign, CRL Sign
X509v3 Extended Key Usage:
    TLS Web Server Authentication, TLS Web Client Authentication</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Create a Certificate Signing Request (CSR)</span>
<span class="gp">$</span><span class="w"> </span>openssl req <span class="nt">-subj</span> <span class="s2">"/CN=955.wlb"</span> <span class="se">\</span>
<span class="go">    -addext "subjectAltName=DNS:955.wlb,DNS:*.955.wlb" \
    -addext "basicConstraints=CA:false" \
    -addext "keyUsage=digitalSignature,keyEncipherment" \
    -addext "extendedKeyUsage=serverAuth,clientAuth" \
    -nodes -newkey rsa:2048 \
    -keyout 955.wlb.key \
    -out 955.wlb.csr \
</span><span class="gp">    2&gt;</span>/dev/null
<span class="gp">$</span><span class="w"> </span><span class="c"># Sign a certificate signing request with a root certificate</span>
<span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-req</span> <span class="se">\</span>
<span class="go">    -CA 996.icu.crt -CAkey 996.icu.key -CAcreateserial \
    -days 180 \
    -in 955.wlb.csr \
    -copy_extensions copy \
    -out 955.wlb.crt \
</span><span class="gp">    2&gt;</span>/dev/null
<span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-in</span> 955.wlb.crt <span class="nt">-noout</span> <span class="nt">-ext</span> keyUsage,extendedKeyUsage,basicConstraints
<span class="go">X509v3 Basic Constraints:
    CA:FALSE
X509v3 Key Usage:
    Digital Signature, Key Encipherment
X509v3 Extended Key Usage:
    TLS Web Server Authentication, TLS Web Client Authentication</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="c"># Verify a certificate using the root certificate</span>
<span class="gp">$</span><span class="w"> </span>openssl verify <span class="nt">-CAfile</span> 996.icu.crt 955.wlb.crt
<span class="go">955.wlb.crt: OK</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Remember that the <code>openssl verify</code> command checks the trust chain up to the provided root certificate, so ensure that the certificate you are trying to verify is indeed signed by the provided root certificate.</p>
</div>
<div class="paragraph">
<p>If there are intermediate certificates involved, you may need to include them in the command as well, using the <code>-untrusted</code> option.</p>
</div>
<div class="paragraph">
<p>$ openssl verify -CAfile 996.icu.crt 955.wlb.crt -untrusted</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fqas-ipsec">Appendix B: FQAs: IPsec</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ikev2-internet-key-exchange-version-2">B.1. IKEv2 (Internet Key Exchange version 2)</h3>
<div class="paragraph">
<p>IKEv2 (Internet Key Exchange version 2) is a protocol used for negotiating and authenticating IPsec (Internet Protocol Security) connections. It is used to establish secure communication between two devices before the actual data exchange takes place. IKEv2 is responsible for setting up the encryption keys, authentication keys, and other security parameters needed for the IPsec connection.</p>
</div>
<div class="paragraph">
<p>IKEv2 uses a series of messages to perform the negotiation and authentication process. The messages are exchanged between the two devices in a defined sequence. The first message is the IKE_SA_INIT message, which initiates the negotiation process. The second message is the IKE_AUTH message, which is used for authentication.</p>
</div>
<div class="paragraph">
<p>During the negotiation process, the two devices exchange information about their security capabilities and agree on a set of encryption algorithms, authentication methods, and other security parameters. Once the negotiation process is complete, the devices exchange the actual data packets using the agreed-upon encryption and authentication methods.</p>
</div>
<div class="paragraph">
<p>To terminate the session, either one of the devices can send an IKE_DELETE message to the other device. This message instructs the other device to delete the IPsec security association and end the connection.</p>
</div>
<div class="paragraph">
<p>The IKEv2 protocol uses a variety of packet types and formats to perform the negotiation and authentication process. Some of the most important packet types include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IKE_SA_INIT: This is the initial packet sent by the initiator to start the negotiation process.</p>
</li>
<li>
<p>IKE_AUTH: This packet is used for authentication and exchange of keying material.</p>
</li>
<li>
<p>CREATE_CHILD_SA: This packet is used to create a new child security association within an existing IKEv2 security association.</p>
</li>
<li>
<p>INFORMATIONAL: This packet is used to exchange information about the status of the connection, such as when terminating the session.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Overall, IKEv2 is a critical component of IPsec security. It is responsible for setting up the secure connection between two devices, establishing the encryption and authentication methods to be used, and maintaining the security association during the data exchange.</p>
</div>
</div>
<div class="sect2">
<h3 id="transport-mode-and-tunnel-mode-in-ipsec">B.2. Transport mode and tunnel mode in IPsec</h3>
<div class="paragraph">
<p>In IPsec, data exchange is encapsulated in IP datagrams to provide confidentiality, integrity, and authenticity of the data being transmitted. IPsec operates in two modes: transport mode and tunnel mode.</p>
</div>
<div class="paragraph">
<p>Transport mode is used when both the source and destination hosts are using IPsec. In this mode, only the payload (data) of the IP datagram is encrypted and authenticated, while the IP header remains untouched.</p>
</div>
<div class="paragraph">
<p>Tunnel mode is used when at least one of the hosts does not support IPsec. In this mode, the entire IP datagram, including the IP header and payload, is encapsulated within another IP datagram. The outer IP header is used for routing while the inner IP header is used to establish the security association and provides the necessary security services.</p>
</div>
<div class="paragraph">
<p>The packet format for IPsec depends on the mode being used. In transport mode, the original IP datagram remains unchanged, except for the addition of an Authentication Header (AH) or Encapsulating Security Payload (ESP) header. The AH header provides data integrity and authenticity, while the ESP header provides confidentiality, integrity, and authenticity.</p>
</div>
<div class="paragraph">
<p>The packet format for transport mode IPsec is as follows:</p>
</div>
<div class="listingblock text-center">
<div class="content">
<pre><em>Original IP Header | ESP/AH Header | Payload</em></pre>
</div>
</div>
<div class="paragraph">
<p>In tunnel mode, the original IP datagram is encapsulated within another IP datagram. The outer IP header is used for routing, while the inner IP header is used to establish the security association. The ESP or AH header is added after the new outer IP header and before the original IP header. The ESP or AH header provides the necessary security services.</p>
</div>
<div class="paragraph">
<p>The packet format for tunnel mode IPsec is as follows:</p>
</div>
<div class="listingblock text-center">
<div class="content">
<pre><em>New Outer IP Header | ESP/AH Header | Original IP Header | Payload</em></pre>
</div>
</div>
<div class="paragraph">
<p>Overall, IPsec provides secure communication over IP networks by encapsulating IP datagrams with additional headers that provide confidentiality, integrity, and authenticity. The choice of transport mode or tunnel mode depends on the specific requirements of the network and the devices being used.</p>
</div>
</div>
<div class="sect2">
<h3 id="tunnel-mode-in-ipsec-as-an-overlay-network">B.3. Tunnel mode in IPsec as an overlay network</h3>
<div class="paragraph">
<p>Tunnel mode in IPsec can be considered as an overlay network, as it creates a virtual secure tunnel between two security gateways (such as VPN gateways, firewalls, or routers) over an existing IP network, allowing the secure transmission of data between two networks or between a host and a network.</p>
</div>
<div class="paragraph">
<p>Tunnel mode can bypass some network firewalls and restrictions because it encapsulates the entire original IP packet (including the original IP header and payload) within a new IP packet. The new outer IP header is used for routing between the security gateways, and the inner IP header (along with the encrypted payload) is protected by IPsec. Since the original IP packet is hidden inside the encrypted payload, firewalls and other security devices may not be able to inspect the contents of the packet and apply filtering rules based on the original IP addresses or protocols.</p>
</div>
<div class="paragraph">
<p>This feature of tunnel mode is beneficial in scenarios where secure communication is needed across restrictive networks or when establishing VPN connections for remote access to corporate resources. However, it&#8217;s important to note that some firewalls and security devices can still detect and block IPsec tunnel mode traffic by inspecting the outer IP header, identifying the use of IPsec protocols, or employing deep packet inspection techniques.</p>
</div>
</div>
<div class="sect2">
<h3 id="ah-authentication-header-and-esp-encapsulating-security-payload-headers">B.4. AH (Authentication Header) and ESP (Encapsulating Security Payload) headers</h3>
<div class="paragraph">
<p>Not all IPsec packets in IP datagrams require both the AH (Authentication Header) and ESP (Encapsulating Security Payload) headers. Depending on the security requirements, one of these headers can be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If only data integrity and authentication are needed, the AH header can be used. In this case, the payload remains unencrypted, but its integrity and authenticity are ensured.</p>
</li>
<li>
<p>If confidentiality is also required, the ESP header should be used. With ESP, the payload is encrypted, ensuring confidentiality, and the ESP header provides data integrity and authentication.</p>
</li>
<li>
<p>In transport mode, the IPsec packet format will have the original IP header, followed by the AH/ESP header, and then the payload. The payload will be encrypted if ESP is used:</p>
</li>
</ul>
</div>
<div class="listingblock text-center">
<div class="content">
<pre><em>Original IP Header | AH/ESP Header | (Encrypted) Payload</em></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In tunnel mode, the IPsec packet format will have a new outer IP header, followed by the AH/ESP header, the original IP header, and the payload. The payload, along with the original IP header, will be encrypted if ESP is used:</p>
</li>
</ul>
</div>
<div class="listingblock text-center">
<div class="content">
<pre><em>New Outer IP Header | AH/ESP Header | (Encrypted) Original IP Header | (Encrypted) Payload</em></pre>
</div>
</div>
<div class="paragraph">
<p>In both cases, if confidentiality is required, the payload will be encrypted. The choice of using AH or ESP depends on the specific security requirements of the network and the devices being used.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-scenarios-where-using-ipsec-without-confidentiality-i-e-without-encryption">B.5. The scenarios where using IPsec without confidentiality (i.e., without encryption)</h3>
<div class="paragraph">
<p>There are scenarios where using IPsec without confidentiality (i.e., without encryption) can still be useful. In these cases, IPsec can provide data integrity and authentication, ensuring that the data has not been tampered with and that it comes from a trusted source. This can be achieved using the Authentication Header (AH) protocol.</p>
</div>
<div class="paragraph">
<p>Some scenarios where IPsec without confidentiality can be employed include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Network management and monitoring</strong>: In situations where data confidentiality is not crucial, but ensuring data integrity and authenticity is essential, IPsec with AH can be used. This is common in network management and monitoring systems, where administrators need to trust the information coming from devices without necessarily requiring the data to be encrypted.</p>
</li>
<li>
<p><strong>Environments with strict data privacy regulations</strong>: In certain industries or countries, data privacy regulations might restrict the use of encryption. In such cases, IPsec with AH can be used to provide data integrity and authentication while complying with the regulations.</p>
</li>
<li>
<p><strong>Performance-sensitive applications</strong>: Encrypting and decrypting data can add processing overhead and latency to network communications. In performance-sensitive applications where the data being transmitted is not sensitive, but data integrity and authentication are still required, IPsec with AH can be a suitable choice.</p>
</li>
<li>
<p><strong>Interoperability with legacy systems</strong>: Some older systems might not support encryption due to hardware limitations or outdated software. In these cases, IPsec with AH can provide a measure of security by ensuring data integrity and authentication.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is important to note that using IPsec without confidentiality does not protect the data from eavesdropping or unauthorized access. It only ensures that the data has not been tampered with and that it comes from a trusted source. In scenarios where data confidentiality is crucial, using IPsec with the Encapsulating Security Payload (ESP) protocol is recommended, as it provides encryption in addition to data integrity and authentication.</p>
</div>
</div>
<div class="sect2">
<h3 id="ipsec-internet-protocol-security-and-tls-transport-layer-security">B.6. IPsec (Internet Protocol Security) and TLS (Transport Layer Security)</h3>
<div class="paragraph">
<p>While both IPsec and TLS (Transport Layer Security) provide secure communication over networks, they operate at different layers of the networking stack and have some differences in their use cases, implementation, and features.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Layer of operation</strong>: IPsec operates at the network layer (Layer 3) of the OSI model, while TLS operates at the transport layer (Layer 4). This means IPsec secures the entire IP packet, whereas TLS secures the data within a specific transport layer protocol, such as TCP.</p>
</li>
<li>
<p><strong>Applicability</strong>: IPsec can secure any protocol that uses IP, whereas TLS is limited to securing TCP-based protocols, such as HTTP, SMTP, and IMAP.</p>
</li>
<li>
<p><strong>Connection setup</strong>: IPsec sets up a security association (SA) between two hosts or networks to ensure secure communication, while TLS establishes a secure connection between a client and server using a handshake process.</p>
</li>
<li>
<p><strong>Modes of operation</strong>: IPsec can operate in two modes, transport mode (securing end-to-end communication between hosts) and tunnel mode (securing communication between networks or between a host and a network). TLS does not have different modes of operation but secures communication between a client and a server.</p>
</li>
<li>
<p><strong>Implementation</strong>: IPsec is typically implemented within the operating system or as part of network hardware (routers, firewalls), while TLS is typically implemented within applications or as part of application-level libraries.</p>
</li>
<li>
<p><strong>Granularity of control</strong>: IPsec provides more fine-grained control over security policies and can be applied to a wide range of traffic types. TLS is more focused on securing specific application-level protocols.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In summary, while both IPsec and TLS provide secure communication, they operate at different layers and have some differences in use cases, implementation, and features. IPsec is more versatile in securing a wider range of network traffic, while TLS is mainly used for securing specific application-level protocols over TCP.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-to-identify-the-type-of-an-ip-datagram-that-contains-normal-ipsec-data-an-ikev2-message-or-something-else">B.7. How to identify the type of an IP datagram, that contains normal IPsec data, an IKEv2 message, or something else?</h3>
<div class="paragraph">
<p>To identify the type of an IP datagram, you can examine the "Protocol" field in the IP header. The <em>Protocol</em> field is an 8-bit field that indicates the type of payload carried by the IP datagram. Here&#8217;s how you can identify if the IP datagram contains normal IPsec data, an IKEv2 message, or something else:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Normal IPsec data: IPsec uses two main protocols for securing data: <em>Authentication Header (AH)</em> and <em>Encapsulating Security Payload (ESP)</em>. In the <em>Protocol</em> field of the IP header, the value <code>51</code> represents AH, and the value <code>50</code> represents ESP.</p>
</li>
<li>
<p>IKEv2 message: IKEv2 (Internet Key Exchange version 2) is used for negotiating and establishing Security Associations (SAs) for IPsec. IKEv2 uses the User Datagram Protocol (UDP) for communication. In the Protocol field of the IP header, the value <code>17</code> represents UDP. To further confirm that the UDP payload contains an IKEv2 message, you need to check the UDP source or destination port. The standard port for IKEv2 is 500 or 4500 (when using NAT-Traversal).</p>
</li>
<li>
<p>Something else: If the Protocol field in the IP header contains a value other than the ones mentioned above, it represents a different protocol. For example, the values <code>6</code> and <code>17</code> represent TCP and UDP, respectively.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To summarize, you can identify the type of an IP datagram by checking the Protocol field in the IP header. If the value is 50 (ESP) or 51 (AH), it is an IPsec data packet. If the value is 17 (UDP) and the source or destination port is 500 or 4500, it is likely an IKEv2 message. If the value is different from these, it is something else, such as a non-IPsec packet for another protocol.</p>
</div>
<div class="paragraph">
<p>While it is true that IKEv2 typically uses UDP ports <code>500</code> and <code>4500</code>, there can be other non-IKEv2 traffic on the same ports in rare cases.</p>
</div>
<div class="paragraph">
<p>To be more certain about the identification of an IKEv2 message within a UDP packet, you can inspect the payload of the UDP packet for the specific structure of an IKEv2 message. IKEv2 messages have a well-defined format, starting with an IKE header, followed by one or more IKE payloads.</p>
</div>
<div class="paragraph">
<p>An IKEv2 header has the following structure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initiator&#8217;s SPI (64 bits): Security Parameter Index (SPI) of the initiator.</p>
</li>
<li>
<p>Responder&#8217;s SPI (64 bits): Security Parameter Index (SPI) of the responder.</p>
</li>
<li>
<p>Next Payload (8 bits): Indicates the type of the first payload in the message.</p>
</li>
<li>
<p>Major Version (4 bits): Indicates the major version of the IKE protocol (for IKEv2, it is 2).</p>
</li>
<li>
<p>Minor Version (4 bits): Indicates the minor version of the IKE protocol (for IKEv2, it is 0).</p>
</li>
<li>
<p>Exchange Type (8 bits): Indicates the type of the IKE exchange (e.g., IKE_SA_INIT, IKE_AUTH, CREATE_CHILD_SA, etc.).</p>
</li>
<li>
<p>Flags (8 bits): Contains various flags, such as initiator/response flag and higher-order bits reserved for future use.</p>
</li>
<li>
<p>Message ID (32 bits): Used to identify and match request and response pairs.</p>
</li>
<li>
<p>Length (32 bits): Indicates the total length of the IKE message, including the header and all the payloads.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By examining the contents of the UDP payload and looking for the specific structure of an IKEv2 message, you can more accurately determine whether a UDP packet contains an IKEv2 message for IPsec.</p>
</div>
<div class="paragraph">
<p>In IPsec, the Internet Key Exchange (IKE) protocol is used to negotiate and establish security parameters between two parties. IKE typically uses UDP datagrams for its communication, with the standard ports being 500 and 4500 (when using NAT-Traversal).</p>
</div>
<div class="paragraph">
<p>During the IKE negotiation process, the two parties exchange IKE messages to establish a secure channel called the IKE Security Association (SA). Once the IKE SA is established, the parties negotiate IPsec Security Associations (SAs) for the actual data exchange. These IPsec SAs define the cryptographic algorithms, keys, and other security parameters to be used for data protection.</p>
</div>
<div class="paragraph">
<p>The data exchange in IPsec uses normal IP datagrams with either the Authentication Header (AH) or Encapsulating Security Payload (ESP) header, depending on the chosen mode of operation. AH provides data integrity and authentication, while ESP provides confidentiality, data integrity, and authentication.</p>
</div>
<div class="paragraph">
<p>In summary, IKE is responsible for negotiating and establishing security parameters using UDP datagrams, while the actual data exchange in IPsec uses normal IP datagrams with AH or ESP headers to provide the desired security services.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-are-ikev2-and-openvpn">B.8. What are IKEv2 and OpenVPN?</h3>
<div class="paragraph">
<p>IKEv2 and OpenVPN are two different VPN protocols used to establish a secure and encrypted connection between a user&#8217;s device and a remote server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IKEv2 (Internet Key Exchange version 2) is a protocol used to set up a secure connection between two devices. It is a widely used protocol that supports various encryption algorithms and authentication methods. IKEv2 is known for its high performance and ability to quickly reconnect when a connection is lost, which makes it suitable for mobile devices that frequently switch between Wi-Fi and cellular networks. It is also considered very secure and is natively supported by many operating systems, including Windows, macOS, and iOS.</p>
</li>
<li>
<p>OpenVPN is an open-source VPN protocol that is known for its flexibility, security, and stability. It uses a custom security protocol based on SSL/TLS (Secure Socket Layer/Transport Layer Security) for key exchange, authentication, and encryption. OpenVPN supports a wide range of encryption algorithms, authentication methods, and is highly configurable, making it suitable for various use cases and security requirements. It works well on various platforms, including Windows, macOS, Linux, Android, and iOS, but may require third-party software for setup on some devices.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both IKEv2 and OpenVPN are popular choices for VPN users due to their strong security features, compatibility with multiple platforms, and overall performance. However, the choice between the two may depend on specific needs, device compatibility, and user preference.</p>
</div>
</div>
<div class="sect2">
<h3 id="whatre-p2s-point-to-site-and-s2s-site-to-site">B.9. What&#8217;re P2S (Point-to-Site) and S2S (Site-to-Site)?</h3>
<div class="paragraph">
<p>P2S (Point-to-Site) and S2S (Site-to-Site) are two types of VPN (Virtual Private Network) connections used to create secure and encrypted communication channels.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>P2S (Point-to-Site) VPN: A P2S VPN connection is designed to establish a secure connection between a single client (user) and a remote network, such as a corporate network or data center. In this setup, the user&#8217;s device acts as the "point" and connects to the remote "site." P2S VPNs are typically used by remote workers or employees who need to access company resources securely from home or while traveling. P2S VPNs often use SSL/TLS or IPsec-based VPN protocols, such as OpenVPN or IKEv2, for secure communication.</p>
</li>
<li>
<p>S2S (Site-to-Site) VPN: An S2S VPN connection is used to establish a secure connection between two separate networks or "sites." These sites can be two different offices, data centers, or even cloud environments. The purpose of an S2S VPN is to allow devices on both networks to securely communicate with each other as if they were on the same local network. S2S VPNs typically use IPsec or other dedicated VPN protocols for secure communication and are often set up using dedicated VPN hardware or routers on both ends.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both P2S and S2S VPNs help to ensure secure and encrypted communication over the internet while providing access to remote resources. However, they cater to different use cases: P2S VPNs are meant for individual users, while S2S VPNs connect entire networks or sites.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extended-validation-certificate">Appendix C: Extended Validation Certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <strong>Extended Validation Certificate</strong> (<strong>EV</strong>) is a certificate conforming to X.509 that proves the legal entity of the owner and is signed by a certificate authority key that can issue EV certificates. EV certificates can be used in the same manner as any other X.509 certificates, including securing web communications with HTTPS and signing software and documents. Unlike <em>domain-validated certificates</em> and <em>organization-validation certificates</em>, EV certificates can be issued only by a subset of certificate authorities (CAs) and require verification of the requesting entity&#8217;s legal identity before certificate issuance. <a href="#EVCWIKIPEDIA">[EVCWIKIPEDIA]</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Removal of special UI indicators</p>
<div class="paragraph">
<p>In May 2018, Google announced plans to redesign user interfaces of Google Chrome to remove emphasis for EV certificates. Chrome 77, released in 2019, removed the EV certificate indication from omnibox, but EV certificate status can be viewed by clicking on lock icon and then checking for legal entity name listed as "issued to" under "certificate". Firefox 70 removed the distinction in the omnibox or URL bar (EV and DV certificates are displayed similarly with just a lock icon), but the details about certificate EV status are accessible in the more detailed view that opens after click on the lock icon.<a href="#EVCWIKIPEDIA">[EVCWIKIPEDIA]</a></p>
</div>
</li>
<li>
<p>Extended Validation certificate identification</p>
<div class="paragraph">
<p>EV certificates are standard X.509 digital certificates. The primary way to identify an EV certificate is by referencing the Certificate Policies extension field. Each issuer uses a different <em>object identifier</em> (OID) in this field to identify their EV certificates, and each OID is documented in the issuer&#8217;s Certification Practice Statement. As with root certificate authorities in general, browsers may not recognize all issuers. <a href="#EVCWIKIPEDIA">[EVCWIKIPEDIA]</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl s_client <span class="nt">-connect</span> www.globalsign.com:443 2&gt;1 | openssl x509 <span class="nt">-noout</span> <span class="nt">-ext</span> certificatePolicies
<span class="go">X509v3 Certificate Policies:
    Policy: 1.3.6.1.4.1.4146.1.1
      CPS: https://www.globalsign.com/repository/
    Policy: 2.23.140.1.1</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. CA/Browser Forum CP OID</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Certificate Policy (CP)</th>
<th class="tableblock halign-left valign-top">CA/Browser Forum CP OID <a href="#CABFOID">[CABFOID]</a></th>
<th class="tableblock halign-left valign-top">DigiCert CP (OID) [Legacy] <a href="#DIGICERTCPS">[DIGICERTCPS]</a></th>
<th class="tableblock halign-left valign-top">GlobalSign CP (OID) [Legacy] <a href="#GLOBALSIGNCP">[GLOBALSIGNCP]</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended Validation Certificate Policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.23.140.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.16.840.1.114412.2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.6.1.4.1.4146.1.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EV Code Signing Certificates Policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.23.140.1.3</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.6.1.4.1.4146.1.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain Validation Certificates Policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.23.140.1.2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.16.840.1.114412.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.6.1.4.1.4146.1.10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization Validation Certificates Policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.23.140.1.2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.16.840.1.114412.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.6.1.4.1.4146.1.20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Individual Validation Certificate Policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.23.140.1.2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.16.840.1.114412.1.1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>EV certificates represent an industry response to certain phishing attacks involving malicious Web sites that were issued certificates without rigorous identity proofing. Issuing of an EV certificate takes place only under an agreed-upon set of stringent criteria, and a user visiting a Web site using EV certificates and a modern browser typically sees a <em>green</em> title bar and CA information to indicate the enhanced level of rigor.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>One of the requirements for EV certificates placed upon each CA is to provide a <em>certification practice statement</em> (CPS), which outlines the practices used in issuing certificates. Considerations for authors of CPSs (and <em>certificate policies</em> or CPs that apply on a per-certificate basis) are given in <a href="#RFC5280">[RFC5280]</a>.</p>
</div>
<div class="paragraph">
<p>Note that although EV certificates may provide higher assurance (e.g., for some Web sites), most users do not pay careful attention to the cues provided by Web browsers that reveal this fact <a href="#BOPSW09">[BOPSW09]</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="TCPIPV1"></a>[1] Kevin Fall, W. Stevens <em>TCP/IP Illustrated: The Protocols, Volume 1</em>. 2nd edition, Addison-Wesley Professional, 2011</p>
</li>
<li>
<p><a id="BOPSW09"></a>[BOPSW09] R. Biddle et al., “Browser Interfaces and Extended Validation SSL Certificates: An Empirical Study,” Proc. ACM Cloud Security Workshop, Nov. 2009.</p>
</li>
<li>
<p><a id="CABF09"></a>[CABF09] CA/Browser Forum, “Guidelines for the Issuance and Management of Extended Validation Certificates (v1.4.6),” 2009, <a href="https://cabforum.org/wp-content/uploads/EV-SSL-Certificate-Guidelines-Version-1.4.6.pdf" class="bare">https://cabforum.org/wp-content/uploads/EV-SSL-Certificate-Guidelines-Version-1.4.6.pdf</a></p>
</li>
<li>
<p><a id="CABFOID"></a>[CABFOID] <a href="https://cabforum.org/object-registry/" class="bare">https://cabforum.org/object-registry/</a></p>
</li>
<li>
<p><a id="CSWIKIPEDIA"></a>[CSWIKIPEDIA] <a href="https://en.wikipedia.org/wiki/Cipher_suite" class="bare">https://en.wikipedia.org/wiki/Cipher_suite</a></p>
</li>
<li>
<p><a id="DIGICERTCPS"></a>[DIGICERTCPS] <a href="https://www.digicert.com/content/dam/digicert/pdfs/legal/DigiCert-CPS-V.5.6.pdf" class="bare">https://www.digicert.com/content/dam/digicert/pdfs/legal/DigiCert-CPS-V.5.6.pdf</a></p>
</li>
<li>
<p><a id="EVCWIKIPEDIA"></a>[EVCWIKIPEDIA] <em>Extended Validation Certificate - Wikipedia</em> [online]. <a href="https://en.wikipedia.org/wiki/Extended_Validation_Certificate" class="bare">https://en.wikipedia.org/wiki/Extended_Validation_Certificate</a></p>
</li>
<li>
<p><a id="FIPS186-3"></a>[FIPS186-3] National Institute for Standards and Technology, “Digital Signature Standard (DSS),” FIPS PUB 186-3, June 2009.</p>
</li>
<li>
<p><a id="FIPS198"></a>[FIPS198] National Institute for Standards and Technology, “The Keyed-Hash Message Authentication Code (HMAC),” FIPS PUB 198, Mar. 2002.</p>
</li>
<li>
<p><a id="FIPS800-38B"></a>[FIPS800-38B] National Institute for Standards and Technology, “Recommendation for Block Cipher Modes of Operation: The CMAC Mode for Authentication,”NIST Special Publication 800-38B, May 2005.</p>
</li>
<li>
<p><a id="GLOBALSIGNCP"></a>[GLOBALSIGNCP] <a href="https://www.globalsign.com/en/repository/GlobalSign_CP_v6.6_final.pdf" class="bare">https://www.globalsign.com/en/repository/GlobalSign_CP_v6.6_final.pdf</a></p>
</li>
<li>
<p><a id="ITUOID"></a>[ITUOID] <a href="http://www.itu.int/ITU-T/asn1" class="bare">http://www.itu.int/ITU-T/asn1</a></p>
</li>
<li>
<p><a id="NAZ00"></a>[NAZ00] Network Associates and P. Zimmermann, Introduction to Cryptography, Part of PGP 7.0 Documentation, available from <a href="http://www.pgpi.org/doc/guide/7.0/en" class="bare">http://www.pgpi.org/doc/guide/7.0/en</a></p>
</li>
<li>
<p><a id="NIST800-38D"></a>[NIST800-38D] National Institute for Standards and Technology, “Recommendation for Block Cipher Modes of Operation: Galois/Counter Mode (GCM) and GMAC,”NIST Special Publication 800-38D, Nov. 2005.</p>
</li>
<li>
<p><a id="OCSPWIKIPEDIA"></a>[OCSPWIKIPEDIA] <a href="https://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol" class="bare">https://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol</a></p>
</li>
<li>
<p><a id="OPENSSL"></a>[OPENSSL] <a href="https://www.openssl.org/" class="bare">https://www.openssl.org/</a></p>
</li>
<li>
<p><a id="RFC1321"></a>[RFC1321] R. Rivest, “The MD5 Message-Digest Algorithm,”Internet RFC 1321 (informational), Apr. 1992.</p>
</li>
<li>
<p><a id="RFC2104"></a>[RFC2104] H. Krawczyk, M. Bellare, and R. Canetti, “HMAC: Keyed-Hashing for Message Authentication,”Internet RFC 2104 (informational), Feb. 1997.</p>
</li>
<li>
<p><a id="RFC2410"></a>[RFC2410] R. Glenn and S. Kent, “The NULL Encryption Algorithm and Its Use with IPsec,” Internet RFC 2410, Nov. 1998.</p>
</li>
<li>
<p><a id="RFC2631"></a>[RFC2631] E. Rescorla, “Diffie-Hellman Key Agreement Method,” Internet RFC 2631, June 1999.</p>
</li>
<li>
<p><a id="RFC3447"></a>[RFC3447] J. Jonsson and B. Kaliski, “Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1,” Internet RFC 3447 (informational), Feb. 2003.</p>
</li>
<li>
<p><a id="RFC3713"></a>[RFC3713] M. Matsui, J. Nakajima, and S. Moriai, “A Description of the Camellia Encryption Algorithm,”Internet RFC 3713 (informational), Apr. 2004.</p>
</li>
<li>
<p><a id="RFC4086"></a>[RFC4086] D. Eastlake 3rd, J. Schiller, and S. Crocker, “Randomness Requirements for Security,”Internet RFC 4086/BCP 0106, June 2005.</p>
</li>
<li>
<p><a id="RFC4309"></a>[RFC4309] R. Housley, “Using Advanced Encryption Standard (AES) CCM Mode with IPsec Encapsulating Security Payload (ESP),” Internet RFC 4309, Dec. 2005.</p>
</li>
<li>
<p><a id="RFC4434"></a>[RFC4434] P. Hoffman, “The AES-XCBC-PRF-128 Algorithm for the Internet Key Exchange Protocol (IKE),” Internet RFC 4434, Feb. 2006.</p>
</li>
<li>
<p><a id="RFC4615"></a>[RFC4615] J. Song, R. Poovendran, J. Lee, and T. Iwata, “The Advanced Encryption Standard-Cipher-Based Message Authentication Code-Pseudo-Random Function-128 (AES-CMAC-PRF-128) Algorithm for the Internet Key Exchange Protocol (IKE),” Internet RFC 4615, Aug. 2006.</p>
</li>
<li>
<p><a id="RFC4880"></a>[RFC4880] J. Callas, L. Donnerhacke, H. Finney, D. Shaw, and R. Thayer, “Open-PGP Message Format,” Internet RFC 4880, Nov. 2007.</p>
</li>
<li>
<p><a id="RFC5116"></a>[RFC5116] D. McGrew, “An Interface and Algorithms for Authenticated Encryption,”Internet RFC 5116, Jan. 2008.</p>
</li>
<li>
<p><a id="RFC5280"></a>[RFC5280] D. Cooper, S. Santesson, S. Farrell, S. Boeyen, R. Housley, and W. Polk, “Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,” Internet RFC 5280, May 2008.</p>
</li>
<li>
<p><a id="RFC5652"></a>[RFC5652] R. Housley, “Cryptographic Message Syntax (CMS),”Internet RFC 5652/STD 0070, Sept. 2009.</p>
</li>
<li>
<p><a id="RFC5755"></a>[RFC5755] S. Farrell, R. Housley, and S. Turner, “An Internet Attribute Certificate Profile for Authorization,”Internet RFC 5755, Jan. 2010.</p>
</li>
<li>
<p><a id="RFC6024"></a>[RFC6024] R. Reddy and C. Wallace, “Trust Anchor Management Requirements,” Internet RFC 6024 (informational), Oct. 2010.</p>
</li>
<li>
<p><a id="RFC6234"></a>[RFC6234] D. Eastlake 3rd and T. Hansen, “US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF),”Internet RFC 6234 (informational), May 2011.</p>
</li>
<li>
<p><a id="SSLDVOVEV"></a>[SSLDVOVEV] <em>DV, OV, IV, and EV Certificates - SSL.com</em> [online]. <a href="https://www.ssl.com/article/dv-ov-and-ev-certificates/" class="bare">https://www.ssl.com/article/dv-ov-and-ev-certificates/</a></p>
</li>
<li>
<p><a id="SSLGREENBAR"></a>[SSLGREENBAR] <em>Why the green bar is gone for good | SSLs.com Blog</em> [online]. <a href="https://www.ssls.com/blog/why-the-green-bar-is-gone-for-good/" class="bare">https://www.ssls.com/blog/why-the-green-bar-is-gone-for-good/</a></p>
</li>
<li>
<p><a id="X9.62-2005"></a>[X9.62-2005] American National Standards Institute, “Public Key Cryptography for the Financial Services Industry: The Elliptic Curve Digital Signature Standard (ECDSA),” ANSI X9.62, 2005.</p>
</li>
<li>
<p><a id="RUBLONIKEOVPN"></a>[RUBLONIKEOVPN] <a href="https://rublon.com/blog/ikev2-openvpn-difference/" class="bare">https://rublon.com/blog/ikev2-openvpn-difference/</a></p>
</li>
</ul>
</div>
</div>
</div>
    
<style>
  .utterances {
      max-width: 100%;
  }
</style>
<script src="https://utteranc.es/client.js"
        repo="ousiax/utterances"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2023/02/10/entity-framework-core-in-net/">&laquo; Entity Framework in .NET</a>
      
    </li>
    <li>
      
      <a href="/2023/03/06/dhcp-options-in-vmware/">DHCP Options in VMware &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
