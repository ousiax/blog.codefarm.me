<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>What is PowerShell</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2023/07/06/what-is-powershell/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!--<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />-->

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?ousiax" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">What is PowerShell</h1>
    
    
    <p class="post-meta"><time datetime="2023-07-06T14:50:56+08:00" itemprop="datePublished">Jul 6, 2023</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>PowerShell is a cross-platform task automation solution made up of a <strong>command-line shell</strong>, a <strong>scripting language</strong>, and a <strong>configuration management framework</strong>. PowerShell runs on Windows, Linux, and macOS. <a href="#ps-overview">[1]</a></p>
</div>
<div class="paragraph">
<p>Commands for PowerShell are known as <strong>cmdlets</strong> (pronounced command-lets). In addition to cmdlets, PowerShell allows you to run any command available on your system. <a href="#ps-cmdlets">[2]</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cmdlets are native PowerShell commands, not stand-alone executables.</p>
</li>
<li>
<p>Cmdlets are collected into PowerShell <strong>modules</strong> that can be loaded on demand.</p>
</li>
<li>
<p>Cmdlets can be written in any compiled .NET language or in the PowerShell scripting language itself.</p>
</li>
<li>
<p>PowerShell uses a <em>Verb-Noun</em> name pair to name cmdlets.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PowerShell includes cmdlets that help you discover PowerShell. Using these three cmdlets, you can discover what commands available, what they do, and what types they operate on. <a href="#ps-discover">[3]</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Get-Verb</code>. Running this command returns a list of verbs that most commands adhere to. The response includes a description of what these verbs do. Since most commands follow this naming convention, it sets expectations on what a command does. This helps you select the appropriate command and what to name a command, should you be creating one.</p>
</li>
<li>
<p><code>Get-Command</code>. This command retrieves a list of all commands installed on your machine.</p>
</li>
<li>
<p><code>Get-Member</code>. It operates on object based output and is able to discover what object, properties and methods are available for a command.</p>
</li>
<li>
<p><code>Get-Help</code>. Invoking this command with the name of a command as an argument displays a help page describing various parts of a command.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using these commands, you can discover almost anything you need to know about PowerShell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Process</span><span class="w">
</span><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="o">*</span><span class="nt">-Process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">2</span><span class="w">
</span><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-Verb</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">2</span><span class="w">
</span><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-Noun</span><span class="w"> </span><span class="nx">Process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">2</span><span class="w">

</span><span class="n">Get-Process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">3</span><span class="w">
</span><span class="n">Get-Process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w"> </span><span class="nt">-MemberType</span><span class="w"> </span><span class="nx">Method</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">3</span><span class="w">
</span><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-ParameterType</span><span class="w"> </span><span class="nx">Process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">3</span><span class="w">

</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Full</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Detailed</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Examples</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Online</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Parameter</span><span class="w"> </span><span class="nx">Noun</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-ShowWindow</span></code></pre>
</div>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#getting-started-with-powershell">1. Getting Started with PowerShell</a>
<ul class="sectlevel2">
<li><a href="#what-version-of-powershell-am-i-running">1.1. What version of PowerShell am I running?</a></li>
<li><a href="#execution-policy">1.2. Execution Policy</a></li>
<li><a href="#the-help-system">1.3. The Help System</a>
<ul class="sectlevel3">
<li><a href="#get-help">1.3.1. Get-Help</a></li>
<li><a href="#get-command">1.3.2. Get-Command</a></li>
<li><a href="#get-member">1.3.3. Get-Member</a></li>
</ul>
</li>
<li><a href="#formatting-aliases-providers-comparison">1.4. Formatting, aliases, providers, comparison</a></li>
</ul>
</li>
<li><a href="#the-powershellget-module">2. The PowerShellGet module</a></li>
<li><a href="#scripting-language">3. Scripting language</a>
<ul class="sectlevel2">
<li><a href="#how-to-run-a-script">3.1. How to run a script</a></li>
<li><a href="#how-to-write-a-script">3.2. How to write a script</a></li>
<li><a href="#functions">3.3. Functions</a></li>
</ul>
</li>
<li><a href="#manage-microsoft-365-with-powershell">4. Manage Microsoft 365 with PowerShell</a>
<ul class="sectlevel2">
<li><a href="#azure-active-directory-powershell-for-graph">4.1. Azure Active Directory PowerShell for Graph</a></li>
<li><a href="#azure-active-directory-module-msonline-for-windows-powershell">4.2. Azure Active Directory Module (MSOnline) for Windows PowerShell</a></li>
<li><a href="#microsoft-graph-powershell-sdk">4.3. Microsoft Graph PowerShell SDK</a>
<ul class="sectlevel3">
<li><a href="#installation">4.3.1. Installation</a></li>
<li><a href="#use-powershell-sdk">4.3.2. Use PowerShell SDK</a></li>
<li><a href="#using-authentication-cmdlets">4.3.3. Using authentication cmdlets</a>
<ul class="sectlevel4">
<li><a href="#using-connect-mggraph">4.3.3.1. Using <code>Connect-MgGraph</code></a></li>
<li><a href="#using-get-mgenvironment-connecting-to-an-environment-or-cloud">4.3.3.2. Using Get-MgEnvironment: Connecting to an environment or cloud</a></li>
<li><a href="#connecting-to-an-environment-as-a-different-identity">4.3.3.3. Connecting to an environment as a different identity</a></li>
<li><a href="#using-disconnect-mggraph">4.3.3.4. Using Disconnect-MgGraph</a></li>
<li><a href="#using-get-mgcontext">4.3.3.5. Using Get-MgContext</a></li>
<li><a href="#using-invoke-mggraphrequest">4.3.3.6. Using Invoke-MgGraphRequest</a></li>
</ul>
</li>
<li><a href="#using-find-mggraphcommand-cmdlet">4.3.4. Using Find-MgGraphCommand cmdlet</a></li>
<li><a href="#using-find-mggraphpermission-cmdlet">4.3.5. Using Find-MgGraphPermission cmdlet</a></li>
<li><a href="#view-microsoft-365-licenses-and-services-with-powershell">4.3.6. View Microsoft 365 licenses and services with PowerShell</a></li>
<li><a href="#view-licensed-and-unlicensed-microsoft-365-users-with-powershell">4.3.7. View licensed and unlicensed Microsoft 365 users with PowerShell</a></li>
<li><a href="#assign-microsoft-365-licenses-to-user-accounts-with-powershell">4.3.8. Assign Microsoft 365 licenses to user accounts with PowerShell</a></li>
<li><a href="#view-microsoft-365-account-license-and-service-details-with-powershell">4.3.9. View Microsoft 365 account license and service details with PowerShell</a></li>
<li><a href="#remove-microsoft-365-licenses-from-user-accounts-with-powershell">4.3.10. Remove Microsoft 365 licenses from user accounts with PowerShell</a></li>
<li><a href="#disable-access-to-microsoft-365-services-with-powershell">4.3.11. Disable access to Microsoft 365 services with PowerShell</a></li>
</ul>
</li>
<li><a href="#exchange-online-powershell">4.4. Exchange Online PowerShell</a>
<ul class="sectlevel3">
<li><a href="#autodiscover-of-outlook-exchange-and-exchange-online-exo">4.4.1. AutoDiscover of Outlook, Exchange, and Exchange Online (EXO)</a></li>
<li><a href="#how-to-bypass-the-autodiscover-process-in-outlook">4.4.2. How to bypass the Autodiscover process in Outlook</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#azure-powershell">5. Azure PowerShell</a>
<ul class="sectlevel2">
<li><a href="#install-azure-powershell-on-windows">5.1. Install Azure PowerShell on Windows</a>
<ul class="sectlevel3">
<li><a href="#prerequisites">5.1.1. Prerequisites</a></li>
<li><a href="#installation-2">5.1.2. Installation</a></li>
<li><a href="#sign-in-with-azure-powershell">5.1.3. Sign in with Azure PowerShell</a>
<ul class="sectlevel4">
<li><a href="#sign-in-interactively">5.1.3.1. Sign in interactively</a></li>
<li><a href="#device-code-authentication">5.1.3.2. Device code authentication</a></li>
<li><a href="#sign-in-using-a-managed-identity">5.1.3.3. Sign in using a managed identity</a></li>
<li><a href="#sign-in-with-a-non-default-tenant-or-as-a-cloud-solution-provider-csp">5.1.3.4. Sign in with a non-default tenant or as a Cloud Solution Provider (CSP)</a></li>
<li><a href="#sign-in-to-another-cloud">5.1.3.5. Sign in to another Cloud</a></li>
</ul>
</li>
<li><a href="#credential-contexts">5.1.4. Credential contexts</a>
<ul class="sectlevel4">
<li><a href="#change-the-active-azure-context">5.1.4.1. Change the active Azure context</a></li>
<li><a href="#save-azure-contexts-across-powershell-sessions">5.1.4.2. Save Azure contexts across PowerShell sessions</a></li>
<li><a href="#remove-azure-contexts-and-stored-credentials">5.1.4.3. Remove Azure contexts and stored credentials</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#find-commands">5.2. Find commands</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-with-powershell">1. Getting Started with PowerShell</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All modern versions of Windows operating systems ship with PowerShell installed. If you&#8217;re running a version older than 5.1, you should install the latest version.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To upgrade to Windows PowerShell 5.1, see <a href="https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/install/installing-windows-powershell#upgrading-existing-windows-powershell">Upgrading existing Windows PowerShell</a></p>
</li>
<li>
<p>To install the latest version of PowerShell, see <a href="https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell">Installing PowerShell</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="what-version-of-powershell-am-i-running">1.1. What version of PowerShell am I running?</h3>
<div class="paragraph">
<p>There are a number of automatic variables in PowerShell that store state information. One of these variables is <code>$PSVersionTable</code>, which contains a hashtable that can be used to display the relevant PowerShell version information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span><span class="nv">$PSVersionTable</span>
<span class="go">
Name                           Value
----                           -----
PSVersion                      5.1.19041.3031
PSEdition                      Desktop
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
BuildVersion                   10.0.19041.3031
CLRVersion                     4.0.30319.42000
WSManStackVersion              3.0
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="execution-policy">1.2. Execution Policy</h3>
<div class="paragraph">
<p>Contrary to popular belief, the execution policy in PowerShell is not a security boundary. It&#8217;s designed to prevent a user from unknowingly running a script.</p>
</div>
<div class="paragraph">
<p>Regardless of the execution policy setting, any PowerShell command can be run interactively. The execution policy only affects commands running in a script.</p>
</div>
<div class="paragraph">
<p>The <code>Get-ExecutionPolicy</code> cmdlet is used to determine what the current execution policy setting is and the <code>Set-ExecutionPolicy</code> cmdlet is used to change the execution policy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-ExecutionPolicy
<span class="go">RemoteSigned
</span><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-ExecutionPolicy <span class="nt">-List</span>
<span class="go">
        Scope ExecutionPolicy
        ----- ---------------
MachinePolicy       Undefined
   UserPolicy       Undefined
      Process       Undefined
  CurrentUser    RemoteSigned
 LocalMachine       Undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s recommended to use the <strong>RemoteSigned</strong> policy, which requires downloaded scripts to be signed by a trusted publisher in order to be run.</p>
</div>
<div class="paragraph">
<p>PowerShell scripts can&#8217;t be run at all when the execution policy is set to <strong>Restricted</strong>. This is the default setting on all Windows client operating systems.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Set-ExecutionPolicy <span class="nt">-Scope</span> CurrentUser Restricted
<span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-Service <span class="nt">-Name</span> W32Time | Stop-Service <span class="nt">-PassThru</span>
<span class="go">
Status   Name               DisplayName
------   ----               -----------
Stopped  W32Time            Windows Time


</span><span class="gp">PS C:\&gt;</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'Get-Service -Name W32Time | Stop-Service -PassThru'</span> <span class="o">&gt;</span> Stop-TimeService.ps1
<span class="gp">PS C:\&gt;</span><span class="w"> </span>.<span class="se">\S</span>top-TimeService.ps1
<span class="go">.\Stop-TimeService.ps1 : File C:\Stop-TimeService.ps1 cannot be loaded because running scripts is disabled on this system. For more
information, see about_Execution_Policies at https:/go.microsoft.com/fwlink/?LinkID=135170.
At line:1 char:1
+ .\Stop-TimeService.ps1
+ ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess
</span><span class="gp">PS C:\&gt;</span><span class="w"> </span>Set-ExecutionPolicy <span class="nt">-Scope</span> CurrentUser RemoteSigned
<span class="gp">PS C:\&gt;</span><span class="w"> </span>.<span class="se">\S</span>top-TimeService.ps1
<span class="go">
Status   Name               DisplayName
------   ----               -----------
Stopped  W32Time            Windows Time</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-help-system">1.3. The Help System</h3>
<div class="paragraph">
<p>Compiled commands in PowerShell are called <strong>cmdlets</strong>. Cmdlet is pronounced "command-let" (not CMD-let). Cmdlets names have the form of singular "Verb-Noun" commands to make them easily discoverable.</p>
</div>
<div class="sect3">
<h4 id="get-help">1.3.1. Get-Help</h4>
<div class="paragraph">
<p><code>Get-Help</code> is a multipurpose command. <code>Get-Help</code> helps you learn how to use commands once you find them. <code>Get-Help</code> can also be used to help locate commands, but in a different and more indirect way when compared to <code>Get-Command</code>.</p>
</div>
<div class="paragraph">
<p>When <code>Get-Help</code> is used to locate commands, it first searches for wildcard matches of command names based on the provided input. If it doesn&#8217;t find a match, it searches through the help topics themselves, and if no match is found an error is returned. Contrary to popular belief, <code>Get-Help</code> can be used to find commands that don&#8217;t have help topics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Help</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Help</code> is a function that pipes <code>Get-Help</code> to a function named <code>more</code>, which is a wrapper for the <code>more.com</code> executable file in Windows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Help</span><span class="w"> </span><span class="nt">-Full</span><span class="w">
</span><span class="n">help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Help</span><span class="w"> </span><span class="nt">-Full</span><span class="w">
</span><span class="n">help</span><span class="w"> </span><span class="nx">Get-Help</span><span class="w"> </span><span class="nt">-Full</span><span class="w">

</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Full</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Detailed</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Examples</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Online</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-Parameter</span><span class="w"> </span><span class="nx">Noun</span><span class="w">
</span><span class="n">Get-Help</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-ShowWindow</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="get-command">1.3.2. Get-Command</h4>
<div class="paragraph">
<p><code>Get-Command</code> is designed to help you locate commands. Running <code>Get-Command</code> without any parameters returns a list of all the commands on your system.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="o">*</span><span class="nx">service</span><span class="o">*</span><span class="w"> </span><span class="nt">-CommandType</span><span class="w"> </span><span class="nx">Cmdlet</span><span class="p">,</span><span class="w"> </span><span class="nx">Function</span><span class="p">,</span><span class="w"> </span><span class="nx">Alias</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>Get-Command</code> with the <strong>Module</strong> parameter to determine what commands were added as part of the ActiveDirectory PowerShell module when the remote server administration tools were installed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-Module</span><span class="w"> </span><span class="nx">ActiveDirectory</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="get-member">1.3.3. Get-Member</h4>
<div class="paragraph">
<p><code>Get-Member</code> helps you discover what objects, properties, and methods are available for commands. Any command that produces object-based output can be piped to <code>Get-Member</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">w32time</span><span class="w">
</span><span class="n">Get-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">w32time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w">
</span><span class="nx">Get-Command</span><span class="w"> </span><span class="nt">-ParameterType</span><span class="w"> </span><span class="nx">ServiceController</span><span class="w">
</span><span class="n">Get-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">w32time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="o">*</span><span class="w">
</span><span class="n">Get-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">w32time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Status</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">DisplayName</span><span class="p">,</span><span class="w"> </span><span class="nx">ServiceType</span><span class="w">
</span><span class="n">Get-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">w32time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Status</span><span class="p">,</span><span class="w"> </span><span class="nx">DisplayName</span><span class="p">,</span><span class="w"> </span><span class="nx">Can</span><span class="o">*</span><span class="w">
</span><span class="n">Get-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">w32time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w"> </span><span class="nt">-MemberType</span><span class="w"> </span><span class="nx">Method</span><span class="w">
</span><span class="p">(</span><span class="n">Get-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">w32time</span><span class="p">)</span><span class="o">.</span><span class="nf">Stop</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="formatting-aliases-providers-comparison">1.4. Formatting, aliases, providers, comparison</h3>
<div class="paragraph">
<p>The most common <strong>format</strong> commands are <code>Format-Table</code> and <code>Format-List</code>. <code>Format-Wide</code> and <code>Format-Custom</code> can also be used, but are less common.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-Service <span class="nt">-Name</span> w32time | Select-Object <span class="nt">-Property</span> Status, DisplayName, Can<span class="k">*</span>
<span class="go">
Status              : Running
DisplayName         : Windows Time
CanPauseAndContinue : False
CanShutdown         : True
CanStop             : True

</span><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-Service <span class="nt">-Name</span> w32time | Select-Object <span class="nt">-Property</span> Status, DisplayName, Can<span class="k">*</span> | Format-Table
<span class="go">
 Status DisplayName  CanPauseAndContinue CanShutdown CanStop
 ------ -----------  ------------------- ----------- -------
Running Windows Time               False        True    True

</span><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-Service <span class="nt">-Name</span> w32time | Format-List
<span class="go">
Name                : w32time
DisplayName         : Windows Time
Status              : Running
DependentServices   : {}
ServicesDependedOn  : {}
CanPauseAndContinue : False
CanShutdown         : True
CanStop             : True
ServiceType         : Win32OwnProcess, Win32ShareProcess</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An <strong>alias</strong> in PowerShell is a shorter name for a command. PowerShell includes a set of built-in aliases and you can also define your own aliases.</p>
</div>
<div class="paragraph">
<p>The <code>Get-Alias</code> cmdlet is used to find aliases. If you already know the alias for a command, the <strong>Name</strong> parameter is used to determine what command the alias is associated with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-Alias <span class="nt">-Name</span> gcm
<span class="go">
CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
</span><span class="gp">Alias           gcm -&gt;</span><span class="w"> </span>Get-Command
<span class="go">
</span><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-Alias <span class="nt">-Name</span> gcm, gm
<span class="go">
CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
</span><span class="gp">Alias           gcm -&gt;</span><span class="w"> </span>Get-Command
<span class="gp">Alias           gm -&gt;</span><span class="w"> </span>Get-Member</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <strong>provider</strong> in PowerShell is an interface that allows file system like access to a datastore. There are a number of built-in providers in PowerShell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-PSProvider
<span class="go">
Name                 Capabilities                                                  Drives
----                 ------------                                                  ------
Registry             ShouldProcess, Transactions                                   {HKLM, HKCU}
Alias                ShouldProcess                                                 {Alias}
Environment          ShouldProcess                                                 {Env}
FileSystem           Filter, ShouldProcess, Credentials                            {C, D}
Function             ShouldProcess                                                 {Function}
Variable             ShouldProcess                                                 {Variable}
Certificate          ShouldProcess                                                 {Cert}
WSMan                Credentials                                                   {WSMan}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual drives that these providers use to expose their datastore can be determined with the <code>Get-PSDrive</code> cmdlet. The <code>Get-PSDrive</code> cmdlet not only displays drives exposed by providers, but it also displays Windows logical drives including drives mapped to network shares.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-PSDrive
<span class="go">
Name           Used (GB)     Free (GB) Provider      Root                                                                       CurrentLocation
----           ---------     --------- --------      ----                                                                       ---------------
Alias                                  Alias
C                 138.14        131.16 FileSystem    C:\
Cert                                   Certificate   \
D                 205.78          0.33 FileSystem    D:\
Env                                    Environment
Function                               Function
HKCU                                   Registry      HKEY_CURRENT_USER
HKLM                                   Registry      HKEY_LOCAL_MACHINE
Variable                               Variable
WSMan                                  WSMan</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Third-party modules such as the Active Directory PowerShell module and the SQLServer PowerShell module both add their own PowerShell provider and PSDrive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Import-Module SqlServer
<span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-PSProvider
<span class="go">
Name                 Capabilities                                                  Drives
----                 ------------                                                  ------
Registry             ShouldProcess                                                 {HKLM, HKCU}
Alias                ShouldProcess                                                 {Alias}
Environment          ShouldProcess                                                 {Env}
FileSystem           Filter, ShouldProcess, Credentials                            {C, D, Temp}
Function             ShouldProcess                                                 {Function}
Variable             ShouldProcess                                                 {Variable}
SqlServer            Credentials                                                   {SQLSERVER}
Certificate          ShouldProcess                                                 {Cert}
WSMan                Credentials                                                   {WSMan}

</span><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-PSDrive
<span class="go">
Name           Used (GB)     Free (GB) Provider      Root                                                                       CurrentLocation
----           ---------     --------- --------      ----                                                                       ---------------
Alias                                  Alias
C                 138.14        131.16 FileSystem    C:\
Cert                                   Certificate   \
D                 205.78          0.33 FileSystem    D:\
Env                                    Environment
Function                               Function
HKCU                                   Registry      HKEY_CURRENT_USER
HKLM                                   Registry      HKEY_LOCAL_MACHINE
SQLSERVER                              SqlServer     SQLSERVER:\
Temp              138.14        131.16 FileSystem    C:\Users\xuqiang3\AppData\Local\Te…
Variable                               Variable
WSMan                                  WSMan</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>PSDrives can be accessed just like a traditional file system.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-ChildItem <span class="nt">-Path</span> Cert:<span class="se">\L</span>ocalMachine<span class="se">\C</span>A
<span class="go">
   PSParentPath: Microsoft.PowerShell.Security\Certificate::LocalMachine\CA

Thumbprint                                Subject              EnhancedKeyUsageList
----------                                -------              --------------------
FEE449EE0E3965A5246F000E87FDE2A065FD89D4  CN=Root Agency
</span><span class="gp">D559A586669B08F46A30A133F8A9ED3D038E2EA8  OU=www.verisign.com… {Server Authentication, Client Authentication, $</span>null, <span class="nv">$null</span><span class="o">}</span>
<span class="go">D4FFDB19BA590FFFAA34DB5F4B568706A2978436  CN=Microsoft TPM Ro…
</span><span class="gp">5E94211AC5D477F157230E6E316AA923E521AF2C  CN=NCU-INTC-KEYID-B… {$</span>null, Attestation Identity Key Certificate<span class="o">}</span>
<span class="go">109F1CAED645BB78B3EA2B94C0697C740733031C  CN=Microsoft Window… {Code Signing, Windows Hardware Driver Verification}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>PowerShell contains a number of <strong>comparison</strong> operators that are used to compare values or find values that match certain patterns. Table 5-1 contains a list of comparison operators in PowerShell.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. All of the operators listed are case-insensitive. Place a <code>c</code> in front of the operator listed to make it case-sensitive. For example, <code>-ceq</code> is the case-sensitive version of the <code>-eq</code> comparison operator.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-eq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-ne</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-gt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-ge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-lt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-le</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than or equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match using the * wildcard character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-NotLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does not match using the * wildcard character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Match</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches the specified regular expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-NotMatch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does not match the specified regular expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Contains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if a collection contains a specified value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-NotContains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if a collection does not contain a specific value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if a specified value is in a collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-NotIn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if a specified value is not in a collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Replace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaces the specified value</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-powershellget-module">2. The PowerShellGet module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>PowerShellGet</strong> module contains cmdlets for discovering, installing, updating, and publishing PowerShell packages from the <a href="https://www.powershellgallery.com/">PowerShell Gallery</a>. These packages can contain artifacts such as Modules, DSC Resources, and Scripts.</p>
</div>
<div class="paragraph">
<p>Use the following command to see what version is installed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Get-Module PowerShellGet, PackageManagement
<span class="go">
ModuleType Version    Name                                ExportedCommands
---------- -------    ----                                ----------------
Binary     1.0.0.1    PackageManagement                   {Find-Package, Find-PackageProvider, Get-Package, Get-PackageProvider...}
Script     1.0.0.1    PowerShellGet                       {Find-Command, Find-DscResource, Find-Module, Find-RoleCapability...}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To install the latest versions of these modules run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nx">PowerShellGet</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-AllowClobber</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Windows PowerShell 5.1 comes with version 1.0.0.1 of the <strong>PowerShellGet</strong> and <strong>PackageManagement</strong> preinstalled. This version of <strong>PowerShellGet</strong> has a limited features and must be updated to work with the PowerShell Gallery. To be supported, you must update to the latest version.</p>
</div>
<div class="paragraph">
<p>Windows PowerShell 5.1 comes with <strong>PowerShellGet</strong> version 1.0.0.1, which doesn&#8217;t include the NuGet provider. The provider is required by <strong>PowerShellGet</strong> when working with the PowerShell Gallery.</p>
</div>
<div class="paragraph">
<p>There are two ways to install the NuGet provider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>Install-PackageProvider</code> to install NuGet before installing other modules</p>
<div class="paragraph">
<p>Run the following command to install the NuGet provider.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-PackageProvider</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">NuGet</span><span class="w"> </span><span class="nt">-Force</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After you have installed the provider you should be able to use any of the <strong>PowerShellGet</strong> cmdlets with the PowerShell Gallery.</p>
</div>
</li>
<li>
<p>Let <code>Install-Module</code> prompt you to install the NuGet provider</p>
<div class="paragraph">
<p>The following command attempts to install the updated PowerShellGet module without the NuGet provider.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nx">PowerShellGet</span><span class="w"> </span><span class="nt">-AllowClobber</span><span class="w"> </span><span class="nt">-Force</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you have installed the new version of <strong>PowerShellGet</strong>, you should open a new PowerShell session. PowerShell automatically loads the newest version of the module when you use a <strong>PowerShellGet</strong> cmdlet.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also recommended to register the PowerShell Gallery as a trusted repository. Use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Set-PSRepository</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">PSGallery</span><span class="w"> </span><span class="nt">-InstallationPolicy</span><span class="w"> </span><span class="nx">Trusted</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scripting-language">3. Scripting language</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a scripting language, PowerShell is commonly used for automating the management of systems. It&#8217;s also used to build, test, and deploy solutions, often in CI/CD environments. PowerShell is built on the .NET Common Language Runtime (CLR). All inputs and outputs are .NET objects. No need to parse text output to extract information from output. The PowerShell scripting language includes the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Extensible through <em>functions</em>, <em>classes</em>, <em>scripts</em>, and <em>modules</em></p>
</li>
<li>
<p>Extensible <em>formatting system</em> for easy output</p>
</li>
<li>
<p>Extensible <em>type system</em> for creating dynamic types</p>
</li>
<li>
<p>Built-in support for common data formats like CSV, JSON, and XML</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="how-to-run-a-script">3.1. How to run a script</h3>
<div class="paragraph">
<p>Before you can run a script on Windows, you need to change the default PowerShell execution policy. Execution policy does not apply to PowerShell running on non-Windows platforms.</p>
</div>
<div class="paragraph">
<p>The default execution policy, <strong>Restricted</strong>, prevents all scripts from running, including scripts that you write on the local computer. For more information, see about_Execution_Policies.</p>
</div>
<div class="paragraph">
<p>The execution policy is saved in the registry, so you need to change it only once on each computer.</p>
</div>
<div class="paragraph">
<p>To change the execution policy, use the following procedure.</p>
</div>
<div class="paragraph">
<p>At the command prompt, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Set-ExecutionPolicy</span><span class="w"> </span><span class="nx">AllSigned</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Set-ExecutionPolicy</span><span class="w"> </span><span class="nx">RemoteSigned</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The change is effective immediately.</p>
</div>
<div class="paragraph">
<p>To run a script, type the full name and the full path to the script file.</p>
</div>
<div class="paragraph">
<p>For example, to run the Get-ServiceLog.ps1 script in the <code>C:\Scripts</code> directory, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">C:\Scripts\Get-ServiceLog.ps1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a script in the current directory, type the path to the current directory, or use a dot to represent the current directory, followed by a path backslash (<code>.\</code>).</p>
</div>
<div class="paragraph">
<p>For example, to run the ServicesLog.ps1 script in the local directory, type:
PowerShell</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="o">.</span><span class="n">\Get-ServiceLog.ps1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the script has parameters, type the parameters and parameter values after the script filename.</p>
</div>
<div class="paragraph">
<p>For example, the following command uses the ServiceName parameter of the <strong>Get-ServiceLog</strong> script to request a log of <strong>WinRM</strong> service activity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="o">.</span><span class="n">\Get-ServiceLog.ps1</span><span class="w"> </span><span class="nt">-ServiceName</span><span class="w"> </span><span class="nx">WinRM</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a security feature, PowerShell does not run scripts when you double-click the script icon in File Explorer or when you type the script name without a full path, even when the script is in the current directory.</p>
</div>
<div class="paragraph">
<p>Beginning in PowerShell 3.0, you can run scripts from File Explorer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To use the "Run with PowerShell" feature: Run File Explorer, right-click the script filename and then select "Run with PowerShell".</p>
</li>
<li>
<p>The "Run with PowerShell" feature is designed to run scripts that do not have required parameters and do not return output to the command prompt.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="how-to-write-a-script">3.2. How to write a script</h3>
<div class="paragraph">
<p>A script can contain any valid PowerShell commands, including single commands, commands that use the pipeline, functions, and control structures such as If statements and For loops.</p>
</div>
<div class="paragraph">
<p>To write a script, open a new file in a text editor, type the commands, and save them in a file with a valid filename with the <code>.ps1</code> file extension.</p>
</div>
<div class="paragraph">
<p>To define parameters in a script, use a <code>Param</code> statement. The <code>Param</code> statement must be the first statement in a script, except for comments and any <code>#Require</code> statements.</p>
</div>
<div class="paragraph">
<p>Script parameters work like function parameters. The parameter values are available to all of the commands in the script. All of the features of function parameters, including the Parameter attribute and its named arguments, are also valid in scripts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="c"># Test-Remote.ps1</span><span class="w">
</span><span class="kr">param</span><span class="w"> </span><span class="p">(</span><span class="nv">$ComputerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="kr">throw</span><span class="w"> </span><span class="s2">"ComputerName parameter is required."</span><span class="p">))</span><span class="w">

</span><span class="kr">function</span><span class="w"> </span><span class="nf">CanPing</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nv">$error</span><span class="o">.</span><span class="nf">clear</span><span class="p">()</span><span class="w">
   </span><span class="nv">$tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test-connection</span><span class="w"> </span><span class="nv">$computername</span><span class="w"> </span><span class="nt">-erroraction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">

   </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="bp">$?</span><span class="p">)</span><span class="w">
       </span><span class="p">{</span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Ping failed: </span><span class="nv">$ComputerName</span><span class="s2">."</span><span class="p">;</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="bp">$false</span><span class="p">}</span><span class="w">
   </span><span class="kr">else</span><span class="w">
       </span><span class="p">{</span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Ping succeeded: </span><span class="nv">$ComputerName</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="bp">$true</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">function</span><span class="w"> </span><span class="nf">CanRemote</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new-pssession</span><span class="w"> </span><span class="nv">$computername</span><span class="w"> </span><span class="nt">-erroraction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">

    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$s</span><span class="w"> </span><span class="o">-is</span><span class="w"> </span><span class="p">[</span><span class="n">System.Management.Automation.Runspaces.PSSession</span><span class="p">])</span><span class="w">
        </span><span class="p">{</span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Remote test succeeded: </span><span class="nv">$ComputerName</span><span class="s2">."</span><span class="p">}</span><span class="w">
    </span><span class="kr">else</span><span class="w">
        </span><span class="p">{</span><span class="n">write-host</span><span class="w"> </span><span class="s2">"Remote test failed: </span><span class="nv">$ComputerName</span><span class="s2">."</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">CanPing</span><span class="w"> </span><span class="nv">$computername</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">CanRemote</span><span class="w"> </span><span class="nv">$computername</span><span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions">3.3. Functions</h3>
<div class="paragraph">
<p>A function is a list of PowerShell statements that has a name that you assign. When you run a function, you type the function name. The statements in the list run as if you had typed them at the command prompt.</p>
</div>
<div class="paragraph">
<p>Functions can be as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="kr">function</span><span class="w"> </span><span class="nf">Get-PowerShellProcess</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Get-Process</span><span class="w"> </span><span class="nx">PowerShell</span><span class="w"> </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like cmdlets, functions can have parameters. The parameters can be named, positional, switch, or dynamic parameters. Function parameters can be read from the command line or from the pipeline.</p>
</div>
<div class="paragraph">
<p>Functions can return values that can be displayed, assigned to variables, or passed to other functions or cmdlets. You can also specify a return value using the <code>return</code> keyword. The <code>return</code> keyword doesn&#8217;t affect or suppress other output returned from your function. However, the <code>return</code> keyword exits the function at that line.</p>
</div>
<div class="paragraph">
<p>The function&#8217;s statement list can contain different types of statement lists with the keywords <code>begin</code>, <code>process</code>, <code>end</code>, and <code>clean</code>. These statement lists handle input from the pipeline differently.</p>
</div>
<div class="paragraph">
<p>The <code>filter</code> keyword is used to create a type of function that runs on each object in the pipeline. A filter resembles a function with all its statements in a process block.</p>
</div>
<div class="paragraph">
<p>The following are the syntax for a function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">function [&lt;scope:&gt;]&lt;name&gt; [([type]$parameter1[,[type]$parameter2])]
{
  begin {&lt;statement list&gt;}
  process {&lt;statement list&gt;}
  end {&lt;statement list&gt;}
  clean {&lt;statement list&gt;}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">function [&lt;scope:&gt;]&lt;name&gt;
{
  param([type]$parameter1 [,[type]$parameter2])
  dynamicparam {&lt;statement list&gt;}
  begin {&lt;statement list&gt;}
  process {&lt;statement list&gt;}
  end {&lt;statement list&gt;}
  clean {&lt;statement list&gt;}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function includes the following items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>function</code> keyword</p>
</li>
<li>
<p>A scope (optional)</p>
</li>
<li>
<p>A name that you select</p>
</li>
<li>
<p>Any number of named parameters (optional)</p>
</li>
<li>
<p>One or more PowerShell commands enclosed in braces {}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Functions don&#8217;t have to be complicated to be useful. The simplest functions have the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">function &lt;function-name&gt; {statements}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following function starts PowerShell with the <strong>Run as Administrator</strong> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="kr">function</span><span class="w"> </span><span class="nf">Start-PSAdmin</span><span class="w"> </span><span class="p">{</span><span class="n">Start-Process</span><span class="w"> </span><span class="nx">PowerShell</span><span class="w"> </span><span class="nt">-Verb</span><span class="w"> </span><span class="nx">RunAs</span><span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manage-microsoft-365-with-powershell">4. Manage Microsoft 365 with PowerShell</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PowerShell for Microsoft 365 enables you to manage your Microsoft 365 settings from the command line. To connect to PowerShell, just install the required software and then connect to your Microsoft 365 organization. <a href="#m365-powershell">[4]</a></p>
</div>
<div class="paragraph">
<p>There are two versions of the PowerShell module that you can use to connect to Microsoft 365 and administer user accounts, groups, and licenses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/powershell/azure/active-directory/overview?view=azureadps-2.0">Azure Active Directory PowerShell for Graph</a>, whose cmdlets include <em>AzureAD</em> in their name</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/powershell/azure/active-directory/overview?view=azureadps-1.0">Microsoft Azure Active Directory Module</a> for Windows PowerShell, whose cmdlets include <em>Msol</em> in their name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Currently, the Azure Active Directory PowerShell for Graph module doesn&#8217;t completely replace the functionality of the Microsoft Azure Active Directory Module for Windows PowerShell module for user, group, and license administration. In some cases, you need to use both versions. You can safely install both versions on the same computer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Azure Active Directory Module is being replaced by the <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/overview?view=graph-powershell-1.0">Microsoft Graph PowerShell SDK</a>. You can use the Microsoft Graph PowerShell SDK to access all Microsoft Graph APIs.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="azure-active-directory-powershell-for-graph">4.1. Azure Active Directory PowerShell for Graph</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Azure AD Powershell is planned for deprecation on <strong>March 30, 2024</strong>. For more details on the deprecation plans, see the deprecation update. We encourage you to continue migrating to <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/overview?view=graph-powershell-1.0">Microsoft Graph PowerShell</a>, which is the recommended module for interacting with Azure AD. In addition, Microsoft Graph PowerShell allows you access to all Microsoft Graph APIs and is available on PowerShell 7. For answers to frequent migration queries, see the <a href="https://learn.microsoft.com/en-us/powershell/azure/active-directory/migration-faq?view=azureadps-2.0">Migration FAQ</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the Azure Active Directory PowerShell module version for Graph for Azure AD administrative tasks such as user management, domain management and for configuring single sign-on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Azure AD PowerShell module is not compatible with PowerShell 7. It is only supported in PowerShell 5.1.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To install the General Availability version of the module, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nx">AzureAD</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To connect to Azure Active Directory (Azure AD) for your Microsoft 365 subscription with an account name and password or with multi-factor authentication, run one of these commands from a Windows PowerShell command prompt. <a href="#4">[4]</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Office 365 cloud</th>
<th class="tableblock halign-left valign-top">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Office 365 Worldwide (+GCC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect-AzureAD</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Office 365 operated by 21 Vianet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect-AzureAD -AzureEnvironmentName AzureChinaCloud</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Office 365 Germany</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect-AzureAD -AzureEnvironmentName AzureGermanyCloud</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Office 365 U.S. Government DoD and Office 365 U.S. Government GCC High</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect-AzureAD -AzureEnvironmentName AzureUSGovernment</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="azure-active-directory-module-msonline-for-windows-powershell">4.2. Azure Active Directory Module (MSOnline) for Windows PowerShell</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
MSOnline is planned for deprecation on <strong>March 30, 2024</strong>. For more details on the deprecation plans, see the deprecation update. We encourage you to continue migrating to <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/overview?view=graph-powershell-1.0">Microsoft Graph PowerShell</a>, which is the recommended module for interacting with Azure AD. In addition, Microsoft Graph PowerShell allows you access to all Microsoft Graph APIs and is available on PowerShell 7. For answers to frequent migration queries, see the <a href="https://learn.microsoft.com/en-us/powershell/azure/active-directory/migration-faq?view=azureadps-2.0">Migration FAQ</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Follow these steps to install and import the Microsoft Azure Active Directory Module for Windows PowerShell:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open an elevated Windows PowerShell command prompt (run Windows PowerShell as an administrator).</p>
</li>
<li>
<p>Run the <strong>Install-Module MSOnline</strong> command.</p>
</li>
<li>
<p>If you&#8217;re prompted to install the NuGet provider, type <strong>Y</strong> and press Enter.</p>
</li>
<li>
<p>If you&#8217;re prompted to install the module from PSGallery, type <strong>Y</strong> and press Enter.</p>
</li>
<li>
<p>Run the <strong>Import-Module MSOnline</strong> command to import the module.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To connect to Azure AD for your Microsoft 365 subscription with an account name and password or with multi-factor authentication, run one of these commands from a Windows PowerShell command prompt. (It doesn&#8217;t have to be elevated.)</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 37.5%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Office 365 cloud</th>
<th class="tableblock halign-left valign-top">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Office 365 Worldwide (+GCC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect-MsolService</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Office 365 operated by 21 Vianet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect-MsolService -AzureEnvironmentName AzureChinaCloud</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Office 365 Germany</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect-MsolService -AzureEnvironmentName AzureGermanyCloud</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Office 365 U.S. Government DoD and Office 365 U.S. Government GCC High</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect-MsolService -AzureEnvironmentName AzureUSGovernment</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="microsoft-graph-powershell-sdk">4.3. Microsoft Graph PowerShell SDK</h3>
<div class="paragraph">
<p>The Microsoft Graph PowerShell SDK acts as an API wrapper for the Microsoft Graph APIs, exposing the entire API set for use in PowerShell. It contains a set of cmdlets that helps you manage identities at scale from automating tasks to managing users in bulk using Azure Active Directory (Azure AD). It will help administer every Azure AD feature that has an API in Microsoft Graph. <a href="#mgraph-powershell">[5]</a></p>
</div>
<div class="paragraph">
<p>The Microsoft Graph PowerShell SDK provides the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Access to all Microsoft Graph APIs</strong>: Microsoft Graph PowerShell is based on Microsoft Graph API. In addition to Azure AD, the Microsoft Graph API includes APIs from other Microsoft services like SharePoint, Exchange, and Outlook, all accessed through a single endpoint with a single access token.</p>
</li>
<li>
<p><strong>Supports PowerShell 7</strong>: Microsoft Graph PowerShell works with PowerShell 7 and later. It&#8217;s also compatible with Windows PowerShell 5.1.</p>
</li>
<li>
<p><strong>Cross-platform support</strong>: Microsoft Graph PowerShell works on all platforms including Windows, macOS, and Linux.</p>
</li>
<li>
<p><strong>Supports modern authentication</strong>: Microsoft Graph PowerShell supports the Microsoft Authentication Library (MSAL) which offers more security. For example, you can use passwordless sign-in experiences.</p>
</li>
<li>
<p><strong>Supports external identities</strong>: Users from other Azure AD tenants can authenticate to services in your tenant with Microsoft Graph PowerShell.</p>
</li>
<li>
<p><strong>Uses least privilege</strong>: Microsoft Graph PowerShell permissions are not pre-authorized and users must perform one-time request for app permissions depending on their needs.</p>
</li>
<li>
<p><strong>Advanced queries</strong>: Microsoft Graph PowerShell supports rich, advanced queries via eventual consistency. For example, you can get a near-instant count of all users using advanced queries.</p>
</li>
<li>
<p><strong>Open source</strong>: Feature teams and the community can create great PowerShell experiences and share them with everyone.</p>
</li>
<li>
<p><strong>Receives regular updates</strong>: Microsoft Graph PowerShell commands are updated regularly to support the latest Graph API updates.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="installation">4.3.1. Installation</h4>
<div class="paragraph">
<p>The Microsoft Graph PowerShell SDK comes in 2 modules, <strong>Microsoft.Graph</strong> and <strong>Microsoft.Graph.Beta</strong>, that you will install separately. These modules call the Microsoft Graph v1.0 and Microsoft Graph beta endpoints, respectively. You can install the 2 modules on the same PowerShell version.</p>
</div>
<div class="paragraph">
<p>Using the <strong>Install-Module</strong> cmdlet is the preferred installation method for the Microsoft Graph PowerShell modules.</p>
</div>
<div class="paragraph">
<p>To install the v1 module of the SDK in PowerShell Core or Windows PowerShell, run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">CurrentUser</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, you can change the scope of the installation using the <code>-Scope</code> parameter. This requires admin permissions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">AllUsers</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To install the beta module, run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph.Beta</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the installation is completed, you can verify the installed version with the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-InstalledModule</span><span class="w"> </span><span class="nx">Microsoft.Graph</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the installed sub-modules and their versions, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-InstalledModule</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The version in the output should match the latest version published on the PowerShell Gallery. Now you&#8217;re ready to use the SDK.</p>
</div>
</div>
<div class="sect3">
<h4 id="use-powershell-sdk">4.3.2. Use PowerShell SDK</h4>
<div class="paragraph">
<p>The PowerShell SDK supports two types of authentication: <em>delegated access</em>, and <em>app-only access</em>.</p>
</div>
<div class="paragraph">
<p>Each API in the Microsoft Graph is protected by one or more permission scopes. The user logging in must consent to one of the required scopes for the APIs you plan to use.</p>
</div>
<div class="paragraph">
<p>The <code>Find-MgGraphCommand</code> cmdlet can be used to discover the required permissions for another cmdlet. For example, to see all permissions that can be used to call <code>Get-MgUser</code>, run;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Find-MgGraphCommand</span><span class="w"> </span><span class="nt">-command</span><span class="w"> </span><span class="nx">Get-MgUser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">Permissions</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>Find-MgGraphCommand <span class="nt">-Command</span> Get-MgUser
<span class="go">

   APIVersion: v1.0

Command    Module Method URI              OutputType          Permissions
-------    ------ ------ ---              ----------          -----------
Get-MgUser Users  GET    /users           IMicrosoftGraphUser {DeviceManagementApps.Read.All, DeviceManagementApps.ReadWrite.All, DeviceMana...
Get-MgUser Users  GET    /users/{user-id} IMicrosoftGraphUser {DeviceManagementApps.Read.All, DeviceManagementApps.ReadWrite.All, DeviceMana...


</span><span class="gp">PS C:\&gt;</span><span class="w"> </span>Find-MgGraphCommand <span class="nt">-Command</span> Get-MgUser | Select <span class="nt">-First</span> 1 <span class="nt">-ExpandProperty</span> Permissions
<span class="go">
Name                                         IsAdmin Description                                                       FullDescription
----                                         ------- -----------                                                       ---------------
DeviceManagementApps.Read.All                True    Read Microsoft Intune apps                                        Allows the app to rea...
DeviceManagementApps.ReadWrite.All           True    Read and write Microsoft Intune apps                              Allows the app to rea...
DeviceManagementConfiguration.Read.All       True    Read Microsoft Intune Device Configuration and Policies           Allows the app to rea...
DeviceManagementConfiguration.ReadWrite.All  True    Read and write Microsoft Intune Device Configuration and Policies Allows the app to rea...
DeviceManagementManagedDevices.Read.All      True    Read devices Microsoft Intune devices                             Allows the app to rea...
DeviceManagementManagedDevices.ReadWrite.All True    Read and write Microsoft Intune devices                           Allows the app to rea...
DeviceManagementServiceConfig.Read.All       True    Read Microsoft Intune configuration                               Allows the app to rea...
DeviceManagementServiceConfig.ReadWrite.All  True    Read and write Microsoft Intune configuration                     Allows the app to rea...
Directory.Read.All                           True    Read directory data                                               Allows the app to rea...
Directory.ReadWrite.All                      True    Read and write directory data                                     Allows the app to rea...
User.Read.All                                True    Read all users' full profiles                                     Allows the app to rea...
User.ReadBasic.All                           False   Read all users' basic profiles                                    Allows the app to rea...
User.ReadWrite.All                           True    Read and write all users' full profiles                           Allows the app to rea...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>Connect-MgGraph</code> command to sign in with the required scopes. You&#8217;ll need to sign in with an admin account to consent to the required scopes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="s2">"User.Read.All"</span><span class="p">,</span><span class="s2">"Group.ReadWrite.All"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The command prompts you to go to a web page to sign in with your credentials. Once you&#8217;ve done that, the command indicates success with a <code>Welcome To Microsoft Graph!</code> message. You only need to sign in once per session.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add additional permissions by repeating the <code>Connect-MgGraph</code> command with the new permission scopes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the Disconnect-MgGraph command to sign out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Disconnect-MgGraph</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-authentication-cmdlets">4.3.3. Using authentication cmdlets</h4>
<div class="paragraph">
<p>Microsoft Graph PowerShell supports two types of authentication: <strong>delegated</strong> and <strong>app-only</strong> access. There are a number of cmdlets that can be used to manage the different parameters required during authentication, for example, environment, application ID, and certificate. <a href="#mgraph-ps-auth-cmdlets">[6]</a></p>
</div>
<div class="sect4">
<h5 id="using-connect-mggraph">4.3.3.1. Using <code>Connect-MgGraph</code></h5>
<div class="paragraph">
<p>You must invoke <code>Connect-MgGraph</code> before any commands that access Microsoft Graph. This cmdlet gets the access token using the Microsoft Authentication Library.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Delegated access</strong></p>
<div class="paragraph">
<p>There are three ways to allow delegated access using <code>Connect-MgGraph</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using interactive authentication, where you provide the scopes that you require during your session:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="s2">"User.Read.All"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Group.ReadWrite.All"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Using device code flow:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="s2">"User.Read.All"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Group.ReadWrite.All"</span><span class="w"> </span><span class="nt">-UseDeviceAuthentication</span></code></pre>
</div>
</div>
</li>
<li>
<p>Using your own access token:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-AccessToken</span><span class="w"> </span><span class="nv">$AccessToken</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>App-only access</strong></p>
<div class="ulist">
<ul>
<li>
<p>Using client credential with a certificate</p>
<div class="paragraph">
<p>To use app-only access, the certificate is loaded from either <code>Cert:\CurrentUser\My\</code> or <code>Cert:\LocalMachine\My\</code> when <code>-CertificateThumbprint</code> or <code>-CertificateName</code> is specified. Make sure that the certificate you&#8217;re using is present in either certificate store before calling <code>Connect-MgGraph</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using Certificate Thumbprint:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-ClientId</span><span class="w"> </span><span class="s2">"YOUR_APP_ID"</span><span class="w"> </span><span class="nt">-TenantId</span><span class="w"> </span><span class="s2">"YOUR_TENANT_ID"</span><span class="w"> </span><span class="nt">-CertificateThumbprint</span><span class="w"> </span><span class="s2">"YOUR_CERT_THUMBPRINT"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Using Certificate name:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-ClientId</span><span class="w"> </span><span class="s2">"YOUR_APP_ID"</span><span class="w"> </span><span class="nt">-TenantId</span><span class="w"> </span><span class="s2">"YOUR_TENANT_ID"</span><span class="w"> </span><span class="nt">-CertificateName</span><span class="w"> </span><span class="s2">"YOUR_CERT_SUBJECT"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Using a certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$Cert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nx">Cert:\LocalMachine\My\</span><span class="nv">$CertThumbprint</span><span class="w">
</span><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-ClientId</span><span class="w"> </span><span class="s2">"YOUR_APP_ID"</span><span class="w"> </span><span class="nt">-TenantId</span><span class="w"> </span><span class="s2">"YOUR_TENANT_ID"</span><span class="w"> </span><span class="nt">-Certificate</span><span class="w"> </span><span class="nv">$Cert</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use a certificate stored in your machine&#8217;s certificate store or another location when connecting to Microsoft Graph, specify the certificate&#8217;s location.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Using client secret credentials</p>
<div class="paragraph">
<p>If you need interactions in the background, without a user to sign in, this type of grant will help you. Support for client secret credentials was added by adding <code>-ClientSecretCredential</code> parameter to <code>Connect-MgGraph</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$ClientSecretCredential</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Credential</span><span class="w"> </span><span class="nt">-Username</span><span class="w"> </span><span class="s2">"Client_Id"</span><span class="w">
</span><span class="c"># Enter client_secret in the password prompt.</span><span class="w">
</span><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-TenantId</span><span class="w"> </span><span class="s2">"Tenant_Id"</span><span class="w"> </span><span class="nt">-ClientSecretCredential</span><span class="w"> </span><span class="nv">$ClientSecretCredential</span></code></pre>
</div>
</div>
</li>
<li>
<p>Using managed identity</p>
<div class="paragraph">
<p>A common challenge when writing automation scripts is the management of secrets, credentials, certificates, and keys used to secure communication between services. Eliminate the need to manage credentials by allowing the module to obtain access tokens for Azure resources that are protected by Azure AD. The identity is managed by the Azure platform and does not require you to provision or rotate any secrets.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System-assigned managed identity:</p>
<div class="paragraph">
<p>Uses an automatically managed identity on a service instance. The identity is tied to the lifecycle of a service instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Identity</span></code></pre>
</div>
</div>
</li>
<li>
<p>User-assigned managed identity:</p>
<div class="paragraph">
<p>Uses a user created managed identity as a standalone Azure resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Identity</span><span class="w"> </span><span class="nt">-ClientId</span><span class="w"> </span><span class="s2">"User_Assigned_Managed_identity_Client_Id"</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="using-get-mgenvironment-connecting-to-an-environment-or-cloud">4.3.3.2. Using Get-MgEnvironment: Connecting to an environment or cloud</h5>
<div class="paragraph">
<p>When you use <code>Connect-MgGraph</code>, you can choose to target other environments. By default, <code>Connect-MgGraph</code> targets the global public cloud.</p>
</div>
<div class="paragraph">
<p>To get a list of all clouds that you can choose from, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgEnvironment</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">Name     AzureADEndpoint                   GraphEndpoint                           Type
----     ---------------                   -------------                           ----
China    https://login.chinacloudapi.cn    https://microsoftgraph.chinacloudapi.cn Built-in
Global   https://login.microsoftonline.com https://graph.microsoft.com             Built-in
USGov    https://login.microsoftonline.us  https://graph.microsoft.us              Built-in
USGovDoD https://login.microsoftonline.us  https://dod-graph.microsoft.us          Built-in
Germany  https://login.microsoftonline.de  https://graph.microsoft.de              Built-in</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To explicitly target other clouds, for example, US Government and Azure China, use the <code>-Environment</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Environment</span><span class="w"> </span><span class="nx">USGov</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Globally registered apps don&#8217;t replicate to Azure China. You&#8217;ll need to register your own applications in Azure China and use them when connecting to Microsoft Graph.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="connecting-to-an-environment-as-a-different-identity">4.3.3.3. Connecting to an environment as a different identity</h5>
<div class="paragraph">
<p>To connect as a different identity other than CurrentUser, specify the <code>-ContextScope</code> parameter with the value <strong>Process</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-ContextScope</span><span class="w"> </span><span class="nx">Process</span><span class="w"> </span><span class="nt">-ForceRefresh</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-disconnect-mggraph">4.3.3.4. Using Disconnect-MgGraph</h5>
<div class="paragraph">
<p>Once you&#8217;re signed in, you&#8217;ll remain signed in until you invoke <code>Disconnect-MgGraph</code>. Microsoft Graph PowerShell automatically refreshes the access token for you and sign-in persists across PowerShell sessions because Microsoft Graph PowerShell securely caches the token.</p>
</div>
<div class="paragraph">
<p>Use <code>Disconnect-MgGraph</code> to sign out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Disconnect-MgGraph</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-get-mgcontext">4.3.3.5. Using Get-MgContext</h5>
<div class="paragraph">
<p><code>Get-MgContext</code> is used to retrieve the details about your current session, which include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ClientID</p>
</li>
<li>
<p>TenantID</p>
</li>
<li>
<p>Certificate Thumbprint</p>
</li>
<li>
<p>Scopes consented to</p>
</li>
<li>
<p>AuthType: Delegated or app-only</p>
</li>
<li>
<p>AuthProviderType</p>
</li>
<li>
<p>CertificateName</p>
</li>
<li>
<p>Account</p>
</li>
<li>
<p>AppName</p>
</li>
<li>
<p>ContextScope</p>
</li>
<li>
<p>Certificate</p>
</li>
<li>
<p>PSHostVersion</p>
</li>
<li>
<p>ClientTimeOut.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To retrieve the session details, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgContext</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve all the scopes that you&#8217;ve consented to, expand the Scopes property using the -ExpandProperty parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgContext</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">Scopes</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-invoke-mggraphrequest">4.3.3.6. Using Invoke-MgGraphRequest</h5>
<div class="paragraph">
<p><code>Invoke-MgGraphRequest</code> issues REST API requests to the Graph API. It works for any Graph API if you know the REST URI, method and optional body parameter. This command is especially useful for accessing APIs for which there isn&#8217;t an equivalent cmdlet yet.</p>
</div>
<div class="paragraph">
<p>To retrieve the details of the signed-in user, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Invoke-MgGraphRequest</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">GET</span><span class="w"> </span><span class="nx">https://graph.microsoft.com/v1.0/me</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-find-mggraphcommand-cmdlet">4.3.4. Using Find-MgGraphCommand cmdlet</h4>
<div class="paragraph">
<p>Find-MgGraphCommand aims to make it easier for you to discover which API path a command calls, by providing a URI or a command name.</p>
</div>
<div class="paragraph">
<p>The Find-MgGraphCommand allows to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass a Microsoft Graph URL (relative and absolute) and get an equivalent Microsoft Graph PowerShell command.</p>
</li>
<li>
<p>Pass a command and get the URL it calls.</p>
</li>
<li>
<p>Pass a command or URI wildcard (.*) to find all commands that match it.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="syntax">Find-MgGraphCommand -Uri &lt;String[]&gt; [-Method &lt;String&gt;] [-ApiVersion &lt;String&gt;] [&lt;CommonParameters&gt;]
Find-MgGraphCommand -Uri .*searchstring.* [-ApiVersion &lt;String&gt;] [&lt;CommonParameters&gt;] [-Method &lt;String&gt;]

Find-MgGraphCommand -Command &lt;String[]&gt; [-ApiVersion &lt;String&gt;] [&lt;CommonParameters&gt;]
Find-MgGraphCommand -Command .*searchstring.* [-ApiVersion &lt;String&gt;] [&lt;CommonParameters&gt;]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="c"># Use a URI to get all related cmdlets</span><span class="w">
</span><span class="n">Find-MgGraphCommand</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="s1">'/users/{id}'</span><span class="w">

</span><span class="c"># Search for commands using URI wildcard</span><span class="w">
</span><span class="n">Find-MgGraphCommand</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="s2">".*users.*"</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="s1">'Get'</span><span class="w"> </span><span class="nt">-ApiVersion</span><span class="w"> </span><span class="s1">'v1.0'</span><span class="w">

</span><span class="c"># Pass a command and get the URI it calls</span><span class="w">
</span><span class="n">Find-MgGraphCommand</span><span class="w"> </span><span class="nt">-Command</span><span class="w"> </span><span class="s1">'Get-MgUser'</span><span class="w">

</span><span class="c"># Pass a command and get the permissions required</span><span class="w">
</span><span class="n">Find-MgGraphCommand</span><span class="w"> </span><span class="nt">-command</span><span class="w"> </span><span class="nx">Get-MgUser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">Permissions</span><span class="w">

</span><span class="c"># Search for commands using a command wildcard</span><span class="w">
</span><span class="n">Find-MgGraphCommand</span><span class="w"> </span><span class="nt">-Command</span><span class="w"> </span><span class="o">.*</span><span class="nx">UserToDo.</span><span class="o">*</span><span class="w"> </span><span class="nt">-APIVersion</span><span class="w"> </span><span class="s1">'v1.0'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-find-mggraphpermission-cmdlet">4.3.5. Using Find-MgGraphPermission cmdlet</h4>
<div class="paragraph">
<p>The Microsoft Graph PowerShell SDK application requires users to have domain knowledge of both the semantics and syntax of Microsoft Graph API permissions used to authorize access to the API. This cmdlet helps to answer the following questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How do I find the values to supply to the permission-related parameters of commands like <code>New-MgApplication</code> and other application and consent related commands?</p>
</li>
<li>
<p>What permissions are applicable to a certain domain, for example, application, directory? To use Microsoft Graph PowerShell SDK to access Microsoft Graph, users must sign in to an Azure AD application using the <code>Connect-MgGraph</code> command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="c"># Find permissions related to a given domain</span><span class="w">
</span><span class="n">Find-MgGraphPermission</span><span class="w"> </span><span class="nx">application</span><span class="w">

</span><span class="c"># Find the identifier for a specific permission</span><span class="w">
</span><span class="n">Find-MgGraphPermission</span><span class="w"> </span><span class="nx">application.Read</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-List</span><span class="w">

</span><span class="c"># Pass a command and get the permissions required</span><span class="w">
</span><span class="n">Find-MgGraphCommand</span><span class="w"> </span><span class="nx">New-MgApplication</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">Permissions</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="view-microsoft-365-licenses-and-services-with-powershell">4.3.6. View Microsoft 365 licenses and services with PowerShell</h4>
<div class="paragraph">
<p>Every Microsoft 365 subscription consists of the following elements: <a href="#mgraph-ps-view-licenses">[7]</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Licensing plans</strong> These are also known as license plans or Microsoft 365 plans. Licensing plans define the Microsoft 365 services that are available to users. Your Microsoft 365 subscription may contain multiple licensing plans. An example licensing plan would be Microsoft 365 E3.</p>
</li>
<li>
<p><strong>Services</strong> These are also known as service plans. Services are the Microsoft 365 products, features, and capabilities that are available in each licensing plan, for example, Exchange Online and Microsoft 365 Apps for enterprise (previously named Office 365 ProPlus). Users can have multiple licenses assigned to them from different licensing plans that grant access to different services.</p>
</li>
<li>
<p><strong>Licenses</strong> Each licensing plan contains the number of licenses that you purchased. You assign licenses to users so they can use the Microsoft 365 services that are defined by the licensing plan. Every user account requires at least one license from one licensing plan so they can log on to Microsoft 365 and use the services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Reading subscription license plans requires the <code>Organization.Read.All</code> permission scope or one of the other permissions listed in the <a href="https://learn.microsoft.com/en-us/graph/api/subscribedsku-list">'List subscribedSkus' Graph API reference page</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-Graph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nx">Organization.Read.All</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To view summary information about your current licensing plans and the available licenses for each plan, run this command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Sku</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="nx">ConsumedUnits</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">PrepaidUnits</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-List</span></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The results contain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SkuPartNumber</strong>: Shows the available licensing plans for your organization. For example, <code>ENTERPRISEPACK</code> is the license plan name for Office 365 Enterprise E3.</p>
</li>
<li>
<p><strong>Enabled</strong>: Number of licenses that you&#8217;ve purchased for a specific licensing plan.</p>
</li>
<li>
<p><strong>ConsumedUnits</strong>: Number of licenses that you&#8217;ve assigned to users from a specific licensing plan.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>To view details about the Microsoft 365 services that are available in all of your license plans, first display a list of your license plans.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgSubscribedSku</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, store the license plans information in a variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$licenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, display the services in a specific license plan.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$licenses</span><span class="p">[</span><span class="err">&lt;</span><span class="n">index</span><span class="err">&gt;</span><span class="p">]</span><span class="o">.</span><span class="nf">ServicePlans</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;index&gt;</code> is an integer that specifies the row number of the license plan from the display of the <code>Get-MgSubscribedSku | Select SkuPartNumber</code> command, minus 1.</p>
</div>
<div class="paragraph">
<p>For example, if the display of the <code>Get-MgSubscribedSku | Select SkuPartNumber</code> command is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">SkuPartNumber
-------------
WIN10_VDA_E5
EMSPREMIUM
ENTERPRISEPREMIUM
FLOW_FREE
-------------</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the command to display the services for the <code>ENTERPRISEPREMIUM</code> license plan is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$licenses</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="nf">ServicePlans</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ENTERPRISEPREMIUM</code> is the third row. Therefore, the index value is (3 - 1), or 2.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For a complete list of license plans (also known as product names), their included service plans, and their corresponding friendly names, see <a href="https://learn.microsoft.com/en-us/azure/active-directory/users-groups-roles/licensing-service-plan-reference">Product names and service plan identifiers for licensing</a>.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="view-licensed-and-unlicensed-microsoft-365-users-with-powershell">4.3.7. View licensed and unlicensed Microsoft 365 users with PowerShell</h4>
<div class="paragraph">
<p>User accounts in your Microsoft 365 organization may have some, all, or none of the available licenses assigned to them from the licensing plans that are available in your organization. <a href="#mgraph-view-licensed-and-unlicensed-users">[8]</a></p>
</div>
<div class="paragraph">
<p>Reading user properties including license details requires the <strong>User.Read.All</strong> permission scope or one of the other permissions listed in the <a href="https://learn.microsoft.com/en-us/graph/api/user-get">'Get a user' Graph API reference page</a>.</p>
</div>
<div class="paragraph">
<p>The <strong>Organization.Read.All</strong> permission scope is required to read the licenses available in the tenant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-Graph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nx">User.Read.All</span><span class="p">,</span><span class="w"> </span><span class="nx">Organization.Read.All</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To view the license details of a specific user account, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"&lt;user sign-in name (UPN)&gt;"</span></code></pre>
</div>
</div>
</li>
<li>
<p>To view the list of all user accounts in your organization that have NOT been assigned any of your licensing plans (unlicensed users), run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s1">'assignedLicenses/$count eq 0'</span><span class="w"> </span><span class="nt">-ConsistencyLevel</span><span class="w"> </span><span class="nx">eventual</span><span class="w"> </span><span class="nt">-CountVariable</span><span class="w"> </span><span class="nx">unlicensedUserCount</span><span class="w"> </span><span class="nt">-All</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Found </span><span class="nv">$unlicensedUserCount</span><span class="s2"> unlicensed users."</span></code></pre>
</div>
</div>
</li>
<li>
<p>To view the list of all member user accounts (excluding guests) in your organization that have NOT been assigned any of your licensing plans (unlicensed users), run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s2">"assignedLicenses/</span><span class="se">`$</span><span class="s2">count eq 0 and userType eq 'Member'"</span><span class="w"> </span><span class="nt">-ConsistencyLevel</span><span class="w"> </span><span class="nx">eventual</span><span class="w"> </span><span class="nt">-CountVariable</span><span class="w"> </span><span class="nx">unlicensedUserCount</span><span class="w"> </span><span class="nt">-All</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Found </span><span class="nv">$unlicensedUserCount</span><span class="s2"> unlicensed users (excluding guests)."</span></code></pre>
</div>
</div>
</li>
<li>
<p>To view the list of all user accounts in your organization that have been assigned any of your licensing plans (licensed users), run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s1">'assignedLicenses/$count ne 0'</span><span class="w"> </span><span class="nt">-ConsistencyLevel</span><span class="w"> </span><span class="nx">eventual</span><span class="w"> </span><span class="nt">-CountVariable</span><span class="w"> </span><span class="nx">licensedUserCount</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="nt">-Select</span><span class="w"> </span><span class="nx">UserPrincipalName</span><span class="p">,</span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">AssignedLicenses</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-Table</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">UserPrincipalName</span><span class="p">,</span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">AssignedLicenses</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Found </span><span class="nv">$licensedUserCount</span><span class="s2"> licensed users."</span></code></pre>
</div>
</div>
</li>
<li>
<p>To view the list of all user accounts in your organization that have an E5 license assigned, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">

</span><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s2">"assignedLicenses/any(x:x/skuId eq </span><span class="si">$(</span><span class="nv">$e5sku</span><span class="o">.</span><span class="nf">SkuId</span><span class="si">)</span><span class="s2"> )"</span><span class="w"> </span><span class="nt">-ConsistencyLevel</span><span class="w"> </span><span class="nx">eventual</span><span class="w"> </span><span class="nt">-CountVariable</span><span class="w"> </span><span class="nx">e5licensedUserCount</span><span class="w"> </span><span class="nt">-All</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Found </span><span class="nv">$e5licensedUserCount</span><span class="s2"> E5 licensed users."</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="assign-microsoft-365-licenses-to-user-accounts-with-powershell">4.3.8. Assign Microsoft 365 licenses to user accounts with PowerShell</h4>
<div class="paragraph">
<p>Users can&#8217;t use any Microsoft 365 services until their account has been assigned a license from a licensing plan. You can use PowerShell to quickly assign licenses to unlicensed accounts. <a href="#mgraph-assign-licenses-to-user-accounts">[9]</a></p>
</div>
<div class="paragraph">
<p>User accounts must first be assigned a location. Specifying a location is a required part of creating a new user account in the <a href="https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/add-users?view=o365-worldwide">Microsoft 365 admin center</a>.</p>
</div>
<div class="paragraph">
<p>Accounts synchronized from your on-premises Active Directory Domain Services do not by default have a location specified. You can configure a location for these accounts from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Microsoft 365 admin center</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/microsoft-365/enterprise/configure-user-account-properties-with-microsoft-365-powershell?view=o365-worldwide">PowerShell</a></p>
</li>
<li>
<p>The Azure portal</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assigning and removing licenses for a user requires the <strong>User.ReadWrite.All</strong> permission scope or one of the other permissions listed in the <a href="https://learn.microsoft.com/en-us/graph/api/user-assignlicense">'Assign license' Microsoft Graph API reference page</a>.</p>
</div>
<div class="paragraph">
<p>The <strong>Organization.Read.All</strong> permission scope is required to read the licenses available in the tenant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nx">User.ReadWrite.All</span><span class="p">,</span><span class="w"> </span><span class="nx">Organization.Read.All</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>Get-MgSubscribedSku</code> command to view the available licensing plans and the number of available licenses in each plan in your organization. The number of available licenses in each plan is <strong>ActiveUnits</strong> - <strong>WarningUnits</strong> - <strong>ConsumedUnits</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To find the unlicensed accounts in your organization, run this command.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s1">'assignedLicenses/$count eq 0'</span><span class="w"> </span><span class="nt">-ConsistencyLevel</span><span class="w"> </span><span class="nx">eventual</span><span class="w"> </span><span class="nt">-CountVariable</span><span class="w"> </span><span class="nx">unlicensedUserCount</span><span class="w"> </span><span class="nt">-All</span></code></pre>
</div>
</div>
</li>
<li>
<p>To find the unlicensed synchronized users in your organization, run this command.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s1">'assignedLicenses/$count eq 0 and OnPremisesSyncEnabled eq true'</span><span class="w"> </span><span class="nt">-ConsistencyLevel</span><span class="w"> </span><span class="nx">eventual</span><span class="w"> </span><span class="nt">-CountVariable</span><span class="w"> </span><span class="nx">unlicensedUserCount</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="nt">-Select</span><span class="w"> </span><span class="nx">UserPrincipalName</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can only assign licenses to user accounts that have the <strong>UsageLocation</strong> property set to a valid ISO 3166-1 alpha-2 country code. For example, US for the United States, and FR for France. Some Microsoft 365 services aren&#8217;t available in certain countries.</p>
</div>
</li>
<li>
<p>To find accounts that don&#8217;t have a <strong>UsageLocation</strong> value, run this command.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Select</span><span class="w"> </span><span class="nx">Id</span><span class="p">,</span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">Mail</span><span class="p">,</span><span class="nx">UserPrincipalName</span><span class="p">,</span><span class="nx">UsageLocation</span><span class="p">,</span><span class="nx">UserType</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">UsageLocation</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="bp">$null</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">UserType</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'Member'</span><span class="w"> </span><span class="p">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>To set the UsageLocation value on an account, run this command.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$userUPN</span><span class="o">=</span><span class="s2">"&lt;user sign-in name (UPN)&gt;"</span><span class="w">
</span><span class="nv">$userLoc</span><span class="o">=</span><span class="s2">"&lt;ISO 3166-1 alpha-2 country code&gt;"</span><span class="w">

</span><span class="n">Update-MgUser</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nv">$userUPN</span><span class="w"> </span><span class="nt">-UsageLocation</span><span class="w"> </span><span class="nv">$userLoc</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Update-MgUser</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belindan@litwareinc.com"</span><span class="w"> </span><span class="nt">-UsageLocation</span><span class="w"> </span><span class="nx">US</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use the <code>Get-MgUser</code> cmdlet without using the <strong>-All</strong> parameter, only the first 100 accounts are returned.</p>
</div>
</li>
<li>
<p>To assign a license to a user, use the following command in PowerShell.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nv">$userUPN</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="p">@{</span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;SkuId&gt;"</span><span class="p">}</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example assigns a license from the <strong>SPE_E5</strong> (Microsoft 365 E5) licensing plan to the unlicensed user <strong>belindan@litwareinc.com</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">
</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belindan@litwareinc.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="p">@{</span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="p">}</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example assigns <strong>SPE_E5</strong> (Microsoft 365 E5) and <strong>EMSPREMIUM</strong> (ENTERPRISE MOBILITY + SECURITY E5) to the user <strong>belindan@litwareinc.com</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">
</span><span class="nv">$e5EmsSku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'EMSPREMIUM'</span><span class="w">
</span><span class="nv">$addLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="p">@{</span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="p">},</span><span class="w">
    </span><span class="p">@{</span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5EmsSku</span><span class="err">.</span><span class="nx">SkuId</span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belinda@litwareinc.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="nv">$addLicenses</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example assigns <strong>SPE_E5</strong> (Microsoft 365 E5) with the <strong>MICROSOFTBOOKINGS</strong> (Microsoft Bookings) and <strong>LOCKBOX_ENTERPRISE</strong> (Customer Lockbox) services turned off:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">
</span><span class="nv">$disabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Where</span><span class="w"> </span><span class="nx">ServicePlanName</span><span class="w"> </span><span class="nt">-in</span><span class="w"> </span><span class="p">(</span><span class="s2">"LOCKBOX_ENTERPRISE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MICROSOFTBOOKINGS"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="nv">$addLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="p">@{</span><span class="w">
        </span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="w">
        </span><span class="nx">DisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$disabledPlans</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belinda@litwareinc.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="nv">$addLicenses</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example updates a user with <strong>SPE_E5</strong> (Microsoft 365 E5) and turns off the Sway and Forms service plans while leaving the user&#8217;s existing disabled plans in their current state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$userLicense</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belinda@litwareinc.com"</span><span class="w">
</span><span class="nv">$userDisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$userLicense</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Where</span><span class="w"> </span><span class="nx">ProvisioningStatus</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">
</span><span class="nv">$newDisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Where</span><span class="w"> </span><span class="nx">ServicePlanName</span><span class="w"> </span><span class="nt">-in</span><span class="w"> </span><span class="p">(</span><span class="s2">"SWAY"</span><span class="p">,</span><span class="w"> </span><span class="s2">"FORMS_PLAN_E5"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="nv">$disabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$userDisabledPlans</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$newDisabledPlans</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-Unique</span><span class="w">

</span><span class="nv">$addLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="p">@{</span><span class="w">
        </span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="w">
        </span><span class="nx">DisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$disabledPlans</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belinda@litwareinc.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="nv">$addLicenses</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example updates a user with <strong>SPE_E5</strong> (Microsoft 365 E5) and turns off the Sway and Forms service plans while leaving the user&#8217;s existing disabled plans in all other subscriptions in their current state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$userLicense</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nx">belinda</span><span class="err">@</span><span class="nx">litwareinc.com</span><span class="w">

</span><span class="nv">$userDisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$userLicense</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="nx">ProvisioningStatus</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">

</span><span class="nv">$newDisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">ServicePlanName</span><span class="w"> </span><span class="nt">-in</span><span class="w"> </span><span class="p">(</span><span class="s2">"SWAY"</span><span class="p">,</span><span class="w"> </span><span class="s2">"FORMS_PLAN_E5"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="nv">$disabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$userDisabledPlans</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$newDisabledPlans</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-Unique</span><span class="w">

</span><span class="nv">$result</span><span class="o">=</span><span class="p">@()</span><span class="w">
</span><span class="nv">$allPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$disabledPlan</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$disabledPlans</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$allPlan</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$allPlans</span><span class="p">)</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="p">(</span><span class="nv">$disabledPlan</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$allPlan</span><span class="p">)</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nv">$property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{</span><span class="w">
                </span><span class="nx">Disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$disabledPlan</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
     </span><span class="p">}</span><span class="w">
     </span><span class="nv">$result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">psobject</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nv">$property</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$finalDisabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">Disabled</span><span class="w">

</span><span class="nv">$addLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="p">@{</span><span class="w">
        </span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="w">
        </span><span class="nx">DisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$finalDisabled</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nx">belinda</span><span class="err">@</span><span class="nx">litwareinc.com</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="nv">$addLicenses</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
</li>
<li>
<p>Assign licenses to a user by copying the license assignment from another user</p>
<div class="paragraph">
<p>This example assigns <strong>jamesp@litwareinc.com</strong> with the same licensing plan that has been applied to <strong>belindan@litwareinc.com</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$mgUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belindan@litwareinc.com"</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">AssignedLicenses</span><span class="w">
</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"jamesp@litwareinc.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="nv">$mgUser</span><span class="o">.</span><span class="nf">AssignedLicenses</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
</li>
<li>
<p>Move a user to a different subscription (license plan)</p>
<div class="ulist">
<ul>
<li>
<p>This example upgrades a user from the <strong>SPE_E3</strong> (Microsoft 365 E3) licensing plan to the <strong>SPE_E5</strong> (Microsoft 365 E5) licensing plan:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$e3Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E3'</span><span class="w">
</span><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">

</span><span class="c"># Unassign E3</span><span class="w">
</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belindan@litwareinc.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="p">@{}</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@(</span><span class="nv">$e3Sku</span><span class="err">.SkuId</span><span class="p">)</span><span class="w">
</span><span class="c"># Assign E5</span><span class="w">
</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belindan@litwareinc.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="p">@{</span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="p">}</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify the change in subscription for the user account with this command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belindan@litwareinc.com"</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>This example upgrades all users from <strong>TEAMS_EXPLORATORY</strong> (Microsoft Teams Exploratory) to <strong>STANDARDPACK</strong> (Office 365 E1):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nx">Organization.Read.All</span><span class="p">,</span><span class="nx">User.ReadWrite.All</span><span class="w">
</span><span class="nv">$teamsExploratorySku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'TEAMS_EXPLORATORY'</span><span class="w">
</span><span class="nv">$e1Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'STANDARDPACK'</span><span class="w">

</span><span class="nv">$disabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e1Sku</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">ServicePlanName</span><span class="w"> </span><span class="nt">-in</span><span class="w"> </span><span class="p">(</span><span class="s2">"EXCHANGE_S_STANDARD"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">
</span><span class="nv">$addLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="p">@{</span><span class="w">
        </span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e1Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="w">
        </span><span class="nx">DisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$disabledPlans</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="nv">$removeLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="nv">$teamsExploratorySku</span><span class="err">.SkuId</span><span class="p">)</span><span class="w">

</span><span class="nv">$filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"assignedLicenses/any(u:u/skuId eq </span><span class="si">$(</span><span class="nv">$teamsExploratorySku</span><span class="o">.</span><span class="nf">SkuId</span><span class="si">)</span><span class="s2">)"</span><span class="w">
</span><span class="nv">$teamsExploratoryUserIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">UserPrincipalName</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="nv">$filter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">UserPrincipalName</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="nv">$teamsExploratoryUserIds</span><span class="o">.</span><span class="nf">Count</span><span class="w">
</span><span class="nx">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$userId</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$teamsExploratoryUserIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nv">$userId</span><span class="o">.</span><span class="nf">UserPrincipalName</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="nv">$addLicenses</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="nv">$removeLicenses</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="view-microsoft-365-account-license-and-service-details-with-powershell">4.3.9. View Microsoft 365 account license and service details with PowerShell</h4>
<div class="paragraph">
<p>In Microsoft 365, licenses from licensing plans (also called SKUs or Microsoft 365 plans) give users access to the Microsoft 365 services that are defined for those plans. However, a user might not have access to all the services that are available in a license that&#8217;s currently assigned to them. You can use PowerShell for Microsoft 365 to view the status of services on user accounts. <a href="#mgraph-view-account-license-and-service-details">[10]</a></p>
</div>
<div class="paragraph">
<p>Reading user properties including license details requires the <strong>User.Read.All</strong> permission scope or one of the other permissions listed in the <a href="https://learn.microsoft.com/en-us/graph/api/user-get">'Get a user' Graph API reference page</a>.</p>
</div>
<div class="paragraph">
<p>The <strong>Organization.Read.All</strong> permission scope is required to read the licenses available in the tenant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-Graph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nx">User.ReadWrite.All</span><span class="p">,</span><span class="w"> </span><span class="nx">Organization.Read.All</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, list the license plans for your tenant with this command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgSubscribedSku</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use these commands to list the services that are available in each licensing plan.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$allSKUs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="p">,</span><span class="w"> </span><span class="nx">ServicePlans</span><span class="w">
</span><span class="nv">$allSKUs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Service Plan:"</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">SkuPartNumber</span><span class="w">
    </span><span class="bp">$_</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use these commands to list the licenses that are assigned to a user account.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"&lt;user sign-in name (UPN)&gt;"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belindan@litwareinc.com"</span></code></pre>
</div>
</div>
</li>
<li>
<p>To view all the Microsoft 365 services that a user has access to, use the following syntax:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="p">(</span><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">user</span><span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="nx">UPN</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">ServicePlans</span><span class="p">)[</span><span class="err">&lt;</span><span class="n">LicenseIndexNumber</span><span class="err">&gt;</span><span class="p">]</span><span class="o">.</span><span class="nf">ServicePlans</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows the services to which the user <strong>BelindaN@litwareinc.com</strong> has access. This shows the services that are associated with all licenses that are assigned to her account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="p">(</span><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nx">belindan</span><span class="err">@</span><span class="nx">litwareinc.com</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">ServicePlans</span><span class="p">)</span><span class="o">.</span><span class="nf">ServicePlans</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows the services that user <strong>BelindaN@litwareinc.com</strong> has access to from the first license that&#8217;s assigned to her account (the index number is 0).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="p">(</span><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nx">belindan</span><span class="err">@</span><span class="nx">litwareinc.com</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">ServicePlans</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nf">ServicePlans</span></code></pre>
</div>
</div>
</li>
<li>
<p>To view all the services for a user who has been assigned <em>multiple licenses</em>, use the following syntax:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$userUPN</span><span class="o">=</span><span class="s2">"&lt;user account UPN&gt;"</span><span class="w">
</span><span class="nv">$allLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nv">$userUPN</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="p">,</span><span class="w"> </span><span class="nx">ServicePlans</span><span class="w">
</span><span class="nv">$allLicenses</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"License:"</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">SkuPartNumber</span><span class="w">
    </span><span class="bp">$_</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="remove-microsoft-365-licenses-from-user-accounts-with-powershell">4.3.10. Remove Microsoft 365 licenses from user accounts with PowerShell</h4>
<div class="paragraph">
<p>Assigning and removing licenses for a user requires the User.ReadWrite.All permission scope or one of the other permissions listed in the <a href="https://learn.microsoft.com/en-us/graph/api/user-assignlicense">'Assign license' Graph API reference page</a>. <a href="#mgraph-remove-licenses-from-user-accounts">[11]</a></p>
</div>
<div class="paragraph">
<p>The <strong>Organization.Read.All</strong> permission scope is required to read the licenses available in the tenant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-Graph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nx">User.ReadWrite.All</span><span class="p">,</span><span class="w"> </span><span class="nx">Organization.Read.All</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To remove licenses from an existing user account, use the following syntax:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"&lt;Account&gt;"</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@(</span><span class="s2">"&lt;AccountSkuId1&gt;"</span><span class="p">)</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="p">@{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example removes the <strong>SPE_E5</strong> (Microsoft 365 E5) licensing plan from the user <strong>BelindaN@litwareinc.com</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">
</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belindan@litwareinc.com"</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@(</span><span class="nv">$e5Sku</span><span class="err">.SkuId</span><span class="p">)</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="p">@{}</span></code></pre>
</div>
</div>
</li>
<li>
<p>To remove all licenses from a group of existing licensed users, use the following syntax:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$licensedUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgUser</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s1">'assignedLicenses/$count ne 0'</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-ConsistencyLevel</span><span class="w"> </span><span class="nx">eventual</span><span class="w"> </span><span class="nt">-CountVariable</span><span class="w"> </span><span class="nx">licensedUserCount</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-Select</span><span class="w"> </span><span class="nx">UserPrincipalName</span><span class="p">,</span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">AssignedLicenses</span><span class="w">

</span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$user</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$licensedUsers</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nv">$licencesToRemove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$user</span><span class="o">.</span><span class="nf">AssignedLicenses</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">SkuId</span><span class="w">
    </span><span class="nv">$user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nv">$user</span><span class="o">.</span><span class="nf">UserPrincipalName</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="nv">$licencesToRemove</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="p">@{}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way to free up a license is by deleting the user account.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="disable-access-to-microsoft-365-services-with-powershell">4.3.11. Disable access to Microsoft 365 services with PowerShell</h4>
<div class="paragraph">
<p>When a Microsoft 365 account is assigned a license from a licensing plan, Microsoft 365 services are made available to the user from that license. However, you can control the Microsoft 365 services that the user can access. For example, even though the license allows access to the SharePoint Online service, you can disable access to it. You can use PowerShell to disable access to any number of services for a specific licensing plan for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An individual account.</p>
</li>
<li>
<p>A group of accounts.</p>
</li>
<li>
<p>All accounts in your organization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assigning and removing licenses for a user requires the User.ReadWrite.All permission scope or one of the other permissions listed in the <a href="https://learn.microsoft.com/en-us/graph/api/user-assignlicense">'Assign license' Graph API reference page</a>.</p>
</div>
<div class="paragraph">
<p>The <strong>Organization.Read.All</strong> permission scope is required to read the licenses available in the tenant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-Graph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nx">User.ReadWrite.All</span><span class="p">,</span><span class="w"> </span><span class="nx">Organization.Read.All</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, use this command to view your available licensing plans, also known as SkuPartNumber:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nx">SkuId</span><span class="p">,</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="p">,</span><span class="w"> </span><span class="nx">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort</span><span class="w"> </span><span class="nx">SkuPartNumber</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Disable specific Microsoft 365 services for specific users for a specific licensing plan</p>
<div class="paragraph">
<p>First list the licensing plans available in your tenant using the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nx">SkuPartNumber</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, use the SkuPartNumber from the command above, list the service plans available for a given license plan (Sku).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlans</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example assigns <strong>SPE_E5</strong> (Microsoft 365 E5) with the <strong>MICROSOFTBOOKINGS</strong> (Microsoft Bookings) and <strong>LOCKBOX_ENTERPRISE</strong> (Customer Lockbox) services turned off:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">
</span><span class="nv">$disabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Where</span><span class="w"> </span><span class="nx">ServicePlanName</span><span class="w"> </span><span class="nt">-in</span><span class="w"> </span><span class="p">(</span><span class="s2">"LOCKBOX_ENTERPRISE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MICROSOFTBOOKINGS"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="nv">$addLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="p">@{</span><span class="w">
        </span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="w">
        </span><span class="nx">DisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$disabledPlans</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belinda@litwareinc.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="nv">$addLicenses</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>DisabledPlans</strong> property of the <strong>AddLicenses</strong> parameter in <code>Set-MgUserLicense</code> will overwrite the user&#8217;s existing <strong>DisabledPlans</strong> value. To preserve the state of existing service plans, the user&#8217;s current state of service plans must be merged with the new plans that are going to be disabled.</p>
</div>
<div class="paragraph">
<p>Failing to include the existing <strong>DisabledPlans</strong> will result in the user&#8217;s previously disabled plan being enabled.</p>
</div>
<div class="paragraph">
<p>The following example updates a user with <strong>SPE_E5</strong> (Microsoft 365 E5) and turns off the <strong>Sway</strong> and <strong>Forms</strong> service plans while leaving the user&#8217;s existing disabled plans in their current state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="c">## Get the services that have already been disabled for the user.</span><span class="w">
</span><span class="nv">$userLicense</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgUserLicenseDetail</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belinda@fdoau.onmicrosoft.com"</span><span class="w">
</span><span class="nv">$userDisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$userLicense</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Where</span><span class="w"> </span><span class="nx">ProvisioningStatus</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="c">## Get the new service plans that are going to be disabled</span><span class="w">
</span><span class="nv">$e5Sku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgSubscribedSku</span><span class="w"> </span><span class="nt">-All</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where</span><span class="w"> </span><span class="nx">SkuPartNumber</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'SPE_E5'</span><span class="w">
</span><span class="nv">$newDisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="o">.</span><span class="nf">ServicePlans</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Where</span><span class="w"> </span><span class="nx">ServicePlanName</span><span class="w"> </span><span class="nt">-in</span><span class="w"> </span><span class="p">(</span><span class="s2">"SWAY"</span><span class="p">,</span><span class="w"> </span><span class="s2">"FORMS_PLAN_E5"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="se">`</span><span class="w">
    </span><span class="n">Select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">ServicePlanId</span><span class="w">

</span><span class="c">## Merge the new plans that are to be disabled with the user's current state of disabled plans</span><span class="w">
</span><span class="nv">$disabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$userDisabledPlans</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$newDisabledPlans</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="nt">-Unique</span><span class="w">

</span><span class="nv">$addLicenses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="p">@{</span><span class="w">
        </span><span class="nx">SkuId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$e5Sku</span><span class="err">.</span><span class="nx">SkuId</span><span class="w">
        </span><span class="nx">DisabledPlans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$disabledPlans</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="c">## Update user's license</span><span class="w">
</span><span class="n">Set-MgUserLicense</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"belinda@litwareinc.onmicrosoft.com"</span><span class="w"> </span><span class="nt">-AddLicenses</span><span class="w"> </span><span class="nv">$addLicenses</span><span class="w"> </span><span class="nt">-RemoveLicenses</span><span class="w"> </span><span class="p">@()</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exchange-online-powershell">4.4. Exchange Online PowerShell</h3>
<div class="paragraph">
<p>Exchange Online PowerShell is the administrative interface that enables you to manage your Microsoft Exchange Online organization from the command line. For example, you can use Exchange Online PowerShell to configure mail flow rules (also known as transport rules) and connectors. <a href="#exo-powershell">[9]</a></p>
</div>
<div class="paragraph">
<p>The Exchange Online PowerShell module uses modern authentication and works with multi-factor authentication (MFA) for connecting to all Exchange-related PowerShell environments in Microsoft 365: Exchange Online PowerShell, Security &amp; Compliance PowerShell, and standalone Exchange Online Protection (EOP) PowerShell.</p>
</div>
<div class="paragraph">
<p>To install the latest public version of the module, run one of the the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In an elevated PowerShell window (all users):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">ExchangeOnlineManagement</span></code></pre>
</div>
</div>
</li>
<li>
<p>Only for the current user account:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">ExchangeOnlineManagement</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">CurrentUser</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you&#8217;ve installed the module, open a PowerShell window and load the module by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Import-Module</span><span class="w"> </span><span class="nx">ExchangeOnlineManagement</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the module is already installed, you can typically skip this step and run <code>Connect-ExchangeOnline</code> without manually loading the module first.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <code>Connect-ExchangeOnline</code> command to sign in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-ExchangeOnline</span><span class="w"> </span><span class="nt">-UserPrincipalName</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">UPN</span><span class="err">&gt;</span><span class="w"> </span><span class="p">[</span><span class="nt">-UseRPSSession</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-ExchangeEnvironmentName</span><span class="w"> </span><span class="err">&lt;</span><span class="n">Value</span><span class="err">&gt;</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-ShowBanner</span><span class="p">:</span><span class="bp">$false</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-DelegatedOrganization</span><span class="w"> </span><span class="err">&lt;</span><span class="n">String</span><span class="err">&gt;</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-PSSessionOption</span><span class="w"> </span><span class="nv">$ProxyOptions</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to disconnect the session when you&#8217;re finished. If you close the PowerShell window without disconnecting the session, you could use up all the sessions available to you, and you need to wait for the sessions to expire. To disconnect the session, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Disconnect-ExchangeOnline</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To silently disconnect without a confirmation prompt, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Disconnect-ExchangeOnline</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="bp">$false</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="autodiscover-of-outlook-exchange-and-exchange-online-exo">4.4.1. AutoDiscover of Outlook, Exchange, and Exchange Online (EXO)</h4>
<div class="paragraph">
<p>Autodiscover is a feature that simplifies the configuration process for email clients like Outlook by automatically discovering the required settings for connecting to Exchange mailboxes, whether they are hosted on-premises (Exchange Server) or in the cloud (Exchange Online).</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a summary of Autodiscover for Outlook, Exchange, and Exchange Online (EXO):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Outlook</strong>: When configuring an email account in Outlook, it uses the Autodiscover process to find the appropriate settings for the user&#8217;s mailbox. Outlook first attempts to connect to Exchange Online by querying the default Office 365 Autodiscover endpoint. If it fails to find an Exchange Online mailbox, Outlook will try to discover settings for an on-premises Exchange mailbox using various methods, such as querying custom Autodiscover URLs or performing an SCP (Service Connection Point) lookup in Active Directory.</p>
</li>
<li>
<p><strong>Exchange (On-premises)</strong>: For on-premises Exchange environments, the Autodiscover service is hosted on the Exchange server. You need to configure Autodiscover DNS records (such as an "A" or "CNAME" record for <code>autodiscover.yourdomain.com</code>) that point to your Exchange server&#8217;s IP address or hostname. This will enable Outlook to discover the on-premises mailbox settings automatically when it fails to find an Exchange Online mailbox.</p>
</li>
<li>
<p><strong>Exchange Online (EXO)</strong>: In Office 365, the Autodiscover service is automatically configured for Exchange Online. Outlook can discover Exchange Online mailboxes using the default Office 365 Autodiscover endpoint. However, it&#8217;s a good practice to configure the recommended DNS records for your domain, including the Autodiscover CNAME record that points to <code>autodiscover.outlook.com</code>. This ensures optimal performance, compatibility, and helps avoid potential issues in the future.</p>
<div class="paragraph">
<p>If you haven&#8217;t configured an Autodiscover DNS record for your domain, but Outlook still connects to Exchange Online (EXO) automatically, it&#8217;s likely due to Outlook&#8217;s built-in capability to find the Exchange Online mailbox using the default Office 365 Autodiscover service.</p>
</div>
<div class="paragraph">
<p>Outlook has a pre-defined list of endpoints it checks during the Autodiscover process. If Outlook is unable to find a custom Autodiscover DNS record for your domain, it will try the default Office 365 Autodiscover endpoint at <code><a href="https://autodiscover-s.outlook.com/autodiscover/autodiscover.xml" class="bare">https://autodiscover-s.outlook.com/autodiscover/autodiscover.xml</a></code>.</p>
</div>
<div class="paragraph">
<p>Since Exchange Online is part of Office 365, its Autodiscover information is already available at this default endpoint. When Outlook queries this URL, it will receive the necessary configuration settings to connect to the Exchange Online mailbox automatically.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>By properly configuring Autodiscover for both on-premises Exchange and Exchange Online environments, you can ensure a seamless user experience and simplify the process of connecting to mailboxes using Outlook and other email clients.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the order of the Autodiscover process in Outlook:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Outlook first checks for an Office 365 mailbox (Exchange Online) by querying the Office 365 Autodiscover service at &#8220;<a href="https://autodiscover-s.outlook.com/autodiscover/autodiscover.xml&#8221" class="bare">https://autodiscover-s.outlook.com/autodiscover/autodiscover.xml&#8221</a>;.</p>
</li>
<li>
<p>the mailbox is not found in Office 365, Outlook will then try to discover the mailbox settings from the on-premises Exchange server using the following methods:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Querying the &#8220;<a href="https://autodiscover.yourdomain.com/autodiscover/autodiscover.xml&#8221" class="bare">https://autodiscover.yourdomain.com/autodiscover/autodiscover.xml&#8221</a>; URL, where "yourdomain.com" is the user&#8217;s email domain.</p>
</li>
<li>
<p>Performing an SCP (Service Connection Point) lookup in Active Directory (only applicable for domain-joined computers in the same AD forest as the Exchange server).</p>
</li>
<li>
<p>Querying the &#8220;<a href="https://yourdomain.com/autodiscover/autodiscover.xml&#8221" class="bare">https://yourdomain.com/autodiscover/autodiscover.xml&#8221</a>; URL.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p>If the on-premises Exchange server is discovered and the mailbox settings are retrieved, Outlook will connect to the on-premises Exchange server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is important to ensure that your organization&#8217;s Autodiscover DNS records and configuration are set up correctly for both Exchange Online and on-premises Exchange server. This will allow Outlook to discover the correct mailbox settings and ensure a seamless user experience.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-bypass-the-autodiscover-process-in-outlook">4.4.2. How to bypass the Autodiscover process in Outlook</h4>
<div class="paragraph">
<p>Disabling Autodiscover in Office 365 (Microsoft 365) Exchange Online is not recommended, as it is an essential service for automatically configuring email clients and maintaining connections with Exchange Online mailboxes. However, if you want to prevent Outlook from automatically connecting to Exchange Online, you can use a registry modification on the client-side to bypass the Autodiscover process.</p>
</div>
<div class="paragraph">
<p>Please note that modifying the registry can cause issues if not done correctly, so proceed with caution and create a backup of your registry before making any changes.</p>
</div>
<div class="paragraph">
<p>To bypass the Autodiscover process in Outlook:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Press <code>Win + R</code> to open the Run dialog box, type regedit, and press Enter.</p>
</li>
<li>
<p>Navigate to the following registry key, depending on your version of Outlook:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Outlook 2016, 2019, or Outlook for Office 365:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Outlook\AutoDiscover</code></pre>
</div>
</div>
</li>
<li>
<p>Outlook 2013:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">HKEY_CURRENT_USER\Software\Microsoft\Office\15.0\Outlook\AutoDiscover</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>If the <code>AutoDiscover</code> key does not exist, you can create it by right-clicking on the <code>Outlook</code> key, selecting "New" &gt; "Key," and naming it "AutoDiscover."</p>
</div>
</li>
<li>
<p>Right-click on the <code>AutoDiscover</code> key, choose "New" &gt; "DWORD (32-bit) Value," and name it "ExcludeExplicitO365Endpoint."</p>
</li>
<li>
<p>Double-click the "ExcludeExplicitO365Endpoint" value, set the "Value data" to 1, and click "OK."</p>
</li>
<li>
<p>Close the Registry Editor and restart Outlook.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This registry modification tells Outlook to bypass the Office 365 Autodiscover process, allowing you to manually configure your email clients to connect to other Exchange servers, such as on-premises deployments.</p>
</div>
<div class="paragraph">
<p>Please keep in mind that this method disables the Autodiscover process for Office 365 on the client-side and may lead to issues with email client configuration and connectivity. Use this approach only if you understand the risks and potential consequences.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a PowerShell script and a batch script that will automatically detect the operating system version, Outlook version, and add or update the necessary registry key to bypass the Office 365 Autodiscover process.</p>
</div>
<div class="listingblock">
<div class="title">PowerShell Script (AutodiscoverBypass.ps1):</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="c"># Detect the Outlook version</span><span class="w">
</span><span class="nv">$OutlookVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"HKLM:\Software\Microsoft\Office\ClickToRun\Configuration"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"ClientVersionToReport"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="p">)</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'[^\d\.]'</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$OutlookVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$OutlookVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"HKLM:\Software\Microsoft\Office\16.0\Common\InstallRoot"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"Path"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$OutlookVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$OutlookVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"HKLM:\Software\Microsoft\Office\15.0\Common\InstallRoot"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"Path"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># Set the registry key based on the Outlook version</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$OutlookVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$AutoDiscoverPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"HKCU:\Software\Microsoft\Office\</span><span class="si">$(</span><span class="nv">$OutlookVersion</span><span class="o">.</span><span class="nf">Split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span><span class="s2">[0]).0\Outlook\AutoDiscover"</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$AutoDiscoverPath</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$AutoDiscoverPath</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="n">Set-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$AutoDiscoverPath</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"ExcludeExplicitO365Endpoint"</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-Type</span><span class="w"> </span><span class="nx">DWord</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the PowerShell script:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save the script as <code>AutodiscoverBypass.ps1</code>.</p>
</li>
<li>
<p>Open PowerShell as Administrator.</p>
</li>
<li>
<p>Execute the script: <code>.\AutodiscoverBypass.ps1</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Batch Script (AutodiscoverBypass.bat):</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bat">@echo <span class="na">off</span>
<span class="nb">setlocal</span> <span class="na">enabledelayedexpansion</span>

<span class="c">rem Detect the Outlook version</span>
<span class="k">for</span> <span class="na">/f </span><span class="s2">"tokens=2*"</span> <span class="vm">%%a</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'reg query "HKLM\SOFTWARE\Microsoft\Office\ClickToRun\Configuration" /v "ClientVersionToReport" 2</span><span class="se">^&gt;</span><span class="s1">nul'</span><span class="o">)</span> <span class="k">do</span> <span class="kd">set</span> <span class="kd">OutlookVersion</span><span class="o">=</span><span class="vm">%%b</span>
<span class="k">if</span> <span class="ow">not</span> <span class="ow">defined</span> <span class="kd">OutlookVersion</span> <span class="k">for</span> <span class="na">/f </span><span class="s2">"tokens=2*"</span> <span class="vm">%%a</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'reg query "HKLM\SOFTWARE\Microsoft\Office\16.0\Common\InstallRoot" /v "Path" 2</span><span class="se">^&gt;</span><span class="s1">nul'</span><span class="o">)</span> <span class="k">do</span> <span class="kd">set</span> <span class="kd">OutlookVersion</span><span class="o">=</span><span class="m">16</span>
<span class="k">if</span> <span class="ow">not</span> <span class="ow">defined</span> <span class="kd">OutlookVersion</span> <span class="k">for</span> <span class="na">/f </span><span class="s2">"tokens=2*"</span> <span class="vm">%%a</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'reg query "HKLM\SOFTWARE\Microsoft\Office\15.0\Common\InstallRoot" /v "Path" 2</span><span class="se">^&gt;</span><span class="s1">nul'</span><span class="o">)</span> <span class="k">do</span> <span class="kd">set</span> <span class="kd">OutlookVersion</span><span class="o">=</span><span class="m">15</span>

<span class="c">rem Set the registry key based on the Outlook version</span>
<span class="k">if</span> <span class="ow">defined</span> <span class="kd">OutlookVersion</span> <span class="o">(</span>
    <span class="kd">set</span> <span class="kd">MajorVersion</span><span class="o">=</span><span class="err">!</span><span class="kd">OutlookVersion</span>:<span class="o">~</span><span class="m">0</span><span class="o">,</span><span class="m">2</span><span class="err">!</span>
    <span class="nb">reg</span> <span class="kd">add</span> <span class="s2">"HKCU\Software\Microsoft\Office\</span><span class="nv">!MajorVersion!</span><span class="s2">.0\Outlook\AutoDiscover"</span> <span class="na">/v </span><span class="s2">"ExcludeExplicitO365Endpoint"</span> <span class="na">/t </span><span class="kd">REG_DWORD</span> <span class="na">/d </span><span class="m">1</span> <span class="na">/f
</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the batch script:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save the script as <code>AutodiscoverBypass.bat</code>.</p>
</li>
<li>
<p>Right-click the file and select "Run as Administrator".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both scripts will detect the operating system and Outlook version, and then add or update the <code>ExcludeExplicitO365Endpoint</code> registry key accordingly.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="azure-powershell">5. Azure PowerShell</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Azure PowerShell is a set of cmdlets for managing Azure resources directly from PowerShell. Azure PowerShell is designed to make it easy to learn and get started with, but provides powerful features for automation. <a href="#azps">[10]</a></p>
</div>
<div class="paragraph">
<p>The Az PowerShell module is the replacement of AzureRM and is the recommended version to use for interacting with Azure.</p>
</div>
<div class="sect2">
<h3 id="install-azure-powershell-on-windows">5.1. Install Azure PowerShell on Windows</h3>
<div class="paragraph">
<p>The Azure PowerShell Az module is a rollup module. Installing the Az PowerShell module downloads the generally available modules and makes their cmdlets available for use. <a href="#azps-install-win">[11]</a></p>
</div>
<div class="paragraph">
<p>The recommended installation method and PowerShell version for the Az PowerShell module:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install from the PowerShell Gallery</p>
</li>
<li>
<p>Use with PowerShell version 7 or higher</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="prerequisites">5.1.1. Prerequisites</h4>
<div class="ulist">
<ul>
<li>
<p>Run the following command from PowerShell to determine your PowerShell version:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="bp">$PSVersionTable</span><span class="o">.</span><span class="nf">PSVersion</span></code></pre>
</div>
</div>
</li>
<li>
<p>Determine if you have the AzureRM PowerShell module installed:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-Module</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">AzureRM</span><span class="w"> </span><span class="nt">-ListAvailable</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you have the AzureRM PowerShell module installed, see <a href="https://learn.microsoft.com/en-us/powershell/azure/troubleshooting?view=azps-10.1.0#az-and-azurerm-coexistence">Az and AzureRM coexistence</a> before proceeding.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Windows PowerShell</div>
<div class="ulist">
<ul>
<li>
<p>Update to <a href="https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/install/installing-windows-powershell#upgrading-existing-windows-powershell">Windows PowerShell 5.1</a></p>
</li>
<li>
<p>Install .NET Framework 4.7.2 or later</p>
</li>
<li>
<p>Update PowerShellGet</p>
<div class="paragraph">
<p>Launch Windows PowerShell 5.1 elevated as an administrator and run the following command to update PowerShellGet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">PowerShellGet</span><span class="w"> </span><span class="nt">-Force</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the PowerShell execution policy to remote signed or less restrictive</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Check the PowerShell execution policy:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-ExecutionPolicy</span><span class="w"> </span><span class="nt">-List</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the PowerShell execution policy to remote signed:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Set-ExecutionPolicy</span><span class="w"> </span><span class="nt">-ExecutionPolicy</span><span class="w"> </span><span class="nx">RemoteSigned</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">CurrentUser</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="installation-2">5.1.2. Installation</h4>
<div class="ulist">
<ul>
<li>
<p>Use the <code>Install-Module</code> cmdlet to install the Az PowerShell module:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Install-Module</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Az</span><span class="w"> </span><span class="nt">-Repository</span><span class="w"> </span><span class="nx">PSGallery</span><span class="w"> </span><span class="nt">-Force</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use <strong>Update-Module</strong> to update to the latest version of the Az PowerShell module:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Update-Module</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Az</span><span class="w"> </span><span class="nt">-Force</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Updating the Az PowerShell module using <code>Update-Module</code> doesn&#8217;t remove old versions of the Az PowerShell module from your system.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sign-in-with-azure-powershell">5.1.3. Sign in with Azure PowerShell</h4>
<div class="paragraph">
<p>Azure PowerShell supports several authentication methods. <a href="#azps-authz">[12]</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The easiest way to get started is with <strong>Azure Cloud Shell</strong>, which automatically logs you in.</p>
</li>
<li>
<p>With a local install, you can sign in interactively through your browser.</p>
</li>
<li>
<p>When writing scripts for automation, the recommended approach is to use a <strong>service principal</strong> with the necessary permissions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you restrict sign-in permissions as much as possible for your use case, you help keep your Azure resources secure.</p>
</div>
<div class="paragraph">
<p>Initially, you&#8217;re signed into the first subscription Azure returns if you have access to more than one subscription. Commands are run against this subscription by default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To change your active subscription for a session, use the <code>Set-AzContext</code> cmdlet.</p>
</li>
<li>
<p>To change your active subscription and have it persist between sessions on the same system, use the <code>Select-AzContext</code> cmdlet.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sign-in-interactively">5.1.3.1. Sign in interactively</h5>
<div class="ulist">
<ul>
<li>
<p>To sign in interactively, use the <code>Connect-AzAccount</code> cmdlet.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-AzAccount</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This cmdlet presents an interactive browser based login prompt by default.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="device-code-authentication">5.1.3.2. Device code authentication</h5>
<div class="ulist">
<ul>
<li>
<p>You can specify the <code>UseDeviceAuthentication</code> parameter to use device code authentication instead of a browser control.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-AzAccount</span><span class="w"> </span><span class="nt">-UseDeviceAuthentication</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sign-in-using-a-managed-identity">5.1.3.3. Sign in using a managed identity</h5>
<div class="paragraph">
<p>Managed identities are a feature of Azure Active Directory. Managed identities are service principals assigned to resources that run in Azure. You can use a managed identity service principal for sign-in, and an app-only access token to access other resources. Managed identities are only available on resources running in an Azure cloud.</p>
</div>
<div class="paragraph">
<p>This example connects using a system-assigned managed identity of the host environment. For example, if executed on a VirtualMachine with an assigned Managed Service Identity, this allows the code to sign in using that assigned identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-AzAccount</span><span class="w"> </span><span class="nt">-Identity</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sign-in-with-a-non-default-tenant-or-as-a-cloud-solution-provider-csp">5.1.3.4. Sign in with a non-default tenant or as a Cloud Solution Provider (CSP)</h5>
<div class="paragraph">
<p>If your account is associated with more than one tenant, sign-in requires the <code>Tenant</code> parameter to be specified when connecting. This parameter works with any sign-in method. When logging in, this parameter value can either be the Azure object ID of the tenant (Tenant ID) or the fully qualified domain name of the tenant.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re a <a href="https://azure.microsoft.com/offers/ms-azr-0145p/">Cloud Solution Provider (CSP)</a>, the value for the Tenant parameter must be a tenant ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-AzAccount</span><span class="w"> </span><span class="nt">-Tenant</span><span class="w"> </span><span class="s1">'00000000-0000-0000-0000-000000000000'</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sign-in-to-another-cloud">5.1.3.5. Sign in to another Cloud</h5>
<div class="paragraph">
<p>Azure cloud services offer environments compliant with regional data-handling laws. For accounts in a regional cloud, set the environment when you sign in with the <code>Environment</code> parameter. This parameter works with any sign-in method. For example, if your account is in Azure China 21Vianet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-AzAccount</span><span class="w"> </span><span class="nt">-Environment</span><span class="w"> </span><span class="nx">AzureChinaCloud</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command returns a list of available environments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-AzEnvironment</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">Name</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="credential-contexts">5.1.4. Credential contexts</h4>
<div class="paragraph">
<p>Azure PowerShell uses <em>Azure PowerShell context objects</em> (Azure contexts) to hold subscription and authentication information. If you have more than one subscription, Azure contexts let you select the subscription to run Azure PowerShell cmdlets on. Azure contexts are also used to store sign-in information across multiple PowerShell sessions and run background tasks.</p>
</div>
<div class="paragraph">
<p>Azure contexts are PowerShell objects representing your active subscription to run commands against, and the authentication information needed to connect to an Azure cloud. With Azure contexts, Azure PowerShell doesn&#8217;t need to reauthenticate your account each time you switch subscriptions. An Azure context consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>account</em> that was used to sign in to Azure with <code>Connect-AzAccount</code>. Azure contexts treat users, application IDs, and service principals the same from an account perspective.</p>
</li>
<li>
<p>The active <em>subscription</em>, a service agreement with Microsoft to create and run Azure resources, which are associated with a <em>tenant</em>. Tenants are often referred to as organizations in documentation or when working with Active Directory.</p>
</li>
<li>
<p>A reference to a <em>token cache</em>, a stored authentication token for accessing an Azure cloud. Where this token is stored and how long it persists for is determined by the <a href="https://learn.microsoft.com/en-us/powershell/azure/context-persistence?view=azps-10.1.0#save-azure-contexts-across-powershell-sessions">context autosave settings</a>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Get Azure contexts</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="c"># List the available contexts</span><span class="w">
</span><span class="n">Get-AzContext</span><span class="w"> </span><span class="nt">-ListAvailable</span><span class="w">

</span><span class="c"># Or get a context by name</span><span class="w">
</span><span class="n">Get-AzContext</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s1">'mycontext'</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="change-the-active-azure-context">5.1.4.1. Change the active Azure context</h5>
<div class="paragraph">
<p>Both <code>Set-AzContext</code> and <code>Select-AzContext</code> can be used to change the active Azure context.</p>
</div>
<div class="paragraph">
<p><code>Set-AzContext</code> creates a new Azure context for a subscription if one doesn&#8217;t exist, and then switches the active context to that one.</p>
</div>
<div class="paragraph">
<p><code>Select-AzContext</code> is meant to be used only with existing Azure contexts and works similarly to using <code>Set-AzContext -Context</code>, but is designed for use with piping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Set-AzContext</span><span class="w"> </span><span class="nt">-Context</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="n">Get-AzContext</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s1">'mycontext'</span><span class="p">)</span><span class="w"> </span><span class="c"># Set a context with an inline Azure context object</span><span class="w">
</span><span class="n">Get-AzContext</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s1">'mycontext'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-AzContext</span><span class="w"> </span><span class="c"># Set a context with a piped Azure context object</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like many other account and context management commands in Azure PowerShell, <code>Set-AzContext</code> and <code>Select-AzContext</code> support the <strong>Scope</strong> parameter so that you can control how long the context is active. <strong>Scope</strong> lets you change a single session&#8217;s active context without changing your default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-AzContext</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s1">'mycontext'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-AzContext</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Process</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid switching contexts for a whole PowerShell session, Azure PowerShell commands with an <strong>AzContext</strong> parameter can be run against a given context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="nv">$context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-AzContext</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"mycontext"</span><span class="w">
</span><span class="n">New-AzVM</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">ExampleVM</span><span class="w"> </span><span class="nt">-AzContext</span><span class="w"> </span><span class="nv">$context</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to change subscriptions associated with your current Azure session, you use the <code>Set-AzContext</code> cmdlet to change the current context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Set-AzContext</span><span class="w"> </span><span class="nt">-Subscription</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">subscription</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">id</span><span class="err">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>Get-AzSubscription</code> cmdlet to retrieve a list of your Azure subscriptions.</p>
</div>
</div>
<div class="sect4">
<h5 id="save-azure-contexts-across-powershell-sessions">5.1.4.2. Save Azure contexts across PowerShell sessions</h5>
<div class="paragraph">
<p>By default, Azure contexts are saved for use between PowerShell sessions. You change this behavior in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sign in using -Scope Process with Connect-AzAccount.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Connect-AzAccount</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Process</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Azure context returned as part of this sign in is valid for the current session only and won&#8217;t be saved automatically, regardless of the Azure PowerShell context autosave setting.</p>
</div>
</li>
<li>
<p>Disable context autosave in Azure PowerShell with the <code>Disable-AzContextAutosave</code> cmdlet. Disabling context autosave doesn&#8217;t clear any stored tokens.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To remove stored information, use the <code>Clear-AzContext</code> cmdlet.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Explicitly enable Azure context autosave can be enabled with the <code>Enable-AzContextAutosave</code> cmdlet. With autosave enabled, a user&#8217;s contexts are stored locally for later PowerShell sessions.</p>
</li>
<li>
<p>Manually save contexts with <code>Save-AzContext</code> to be used in future PowerShell sessions, where they can be loaded with <code>Import-AzContext</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Save-AzContext</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nx">current-context.json</span><span class="w"> </span><span class="c"># Save the current context</span><span class="w">
</span><span class="n">Save-AzContext</span><span class="w"> </span><span class="nt">-Profile</span><span class="w"> </span><span class="nv">$profileObject</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nx">other-context.json</span><span class="w"> </span><span class="c"># Save a context object</span><span class="w">
</span><span class="n">Import-AzContext</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nx">other-context.json</span><span class="w"> </span><span class="c"># Load the context from a file and set it to the current context</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="remove-azure-contexts-and-stored-credentials">5.1.4.3. Remove Azure contexts and stored credentials</h5>
<div class="paragraph">
<p>To clear Azure contexts and credentials:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sign out of an account with <code>Disconnect-AzAccount</code>. You can sign out of any account either by account or context:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Disconnect-AzAccount</span><span class="w"> </span><span class="c"># Disconnect active account</span><span class="w">
</span><span class="n">Disconnect-AzAccount</span><span class="w"> </span><span class="nt">-Username</span><span class="w"> </span><span class="s1">'user@contoso.com'</span><span class="w"> </span><span class="c"># Disconnect by account name</span><span class="w">

</span><span class="n">Disconnect-AzAccount</span><span class="w"> </span><span class="nt">-ContextName</span><span class="w"> </span><span class="s1">'subscription2'</span><span class="w"> </span><span class="c"># Disconnect by context name</span><span class="w">
</span><span class="n">Disconnect-AzAccount</span><span class="w"> </span><span class="nt">-AzureContext</span><span class="w"> </span><span class="nv">$contextObject</span><span class="w"> </span><span class="c"># Disconnect using context object information</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Disconnecting always removes stored authentication tokens and clears saved contexts associated with the disconnected user or context.</p>
</div>
</li>
<li>
<p>Use <code>Clear-AzContext</code>. This cmdlet always removes stored contexts, authentication tokens, and signs you out.</p>
</li>
<li>
<p>Remove a context with <code>Remove-AzContext</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Remove-AzContext</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s1">'mycontext'</span><span class="w"> </span><span class="c"># Remove by name</span><span class="w">
</span><span class="n">Get-AzContext</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s1">'mycontext'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Remove-AzContext</span><span class="w"> </span><span class="c"># Remove by piping Azure context object</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you remove the active context, you&#8217;ll be disconnected from Azure and need to reauthenticate with <code>Connect-AzAccount</code>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="find-commands">5.2. Find commands</h3>
<div class="paragraph">
<p>Azure PowerShell cmdlets follow a standard naming convention for PowerShell, <code>Verb-Noun</code>. The verb describes the action (examples include <code>New</code>, <code>Get</code>, <code>Set</code>, <code>Remove</code>) and the noun describes the resource type (examples include <code>AzVM</code>, <code>AzKeyVaultCertificate</code>, <code>AzFirewall</code>, <code>AzVirtualNetworkGateway</code>). Nouns in Azure PowerShell always start with the prefix <code>Az</code>.</p>
</div>
<div class="paragraph">
<p>Knowing the nouns, verbs, and the Azure PowerShell modules available helps you find commands with the <code>Get-Command</code> cmdlet. For example, to find all VM-related commands that use the <code>Get</code> verb:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-Verb</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="nt">-Noun</span><span class="w"> </span><span class="nx">AzVM</span><span class="o">*</span><span class="w"> </span><span class="nt">-Module</span><span class="w"> </span><span class="nx">Az.Compute</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="ps-overview"></a>[1] <a href="https://learn.microsoft.com/en-us/powershell/scripting/overview?view=powershell-7.3" class="bare">https://learn.microsoft.com/en-us/powershell/scripting/overview?view=powershell-7.3</a></p>
</li>
<li>
<p><a id="ps-cmdlets"></a>[2] <a href="https://learn.microsoft.com/en-us/powershell/scripting/powershell-commands?view=powershell-7.3" class="bare">https://learn.microsoft.com/en-us/powershell/scripting/powershell-commands?view=powershell-7.3</a></p>
</li>
<li>
<p><a id="ps-discover"></a>[3] <a href="https://learn.microsoft.com/en-us/powershell/scripting/discover-powershell?view=powershell-7.3" class="bare">https://learn.microsoft.com/en-us/powershell/scripting/discover-powershell?view=powershell-7.3</a></p>
</li>
<li>
<p><a id="m365-powershell"></a>[4] <a href="https://learn.microsoft.com/en-us/microsoft-365/enterprise/connect-to-microsoft-365-powershell?view=o365-worldwide" class="bare">https://learn.microsoft.com/en-us/microsoft-365/enterprise/connect-to-microsoft-365-powershell?view=o365-worldwide</a></p>
</li>
<li>
<p><a id="mgraph-powershell"></a>[5] <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/overview?view=graph-powershell-1.0" class="bare">https://learn.microsoft.com/en-us/powershell/microsoftgraph/overview?view=graph-powershell-1.0</a></p>
</li>
<li>
<p><a id="mgraph-ps-auth-cmdlets"></a>[6] <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/authentication-commands?view=graph-powershell-1.0" class="bare">https://learn.microsoft.com/en-us/powershell/microsoftgraph/authentication-commands?view=graph-powershell-1.0</a></p>
</li>
<li>
<p><a id="mgraph-ps-view-licenses"></a>[7] <a href="https://learn.microsoft.com/en-us/microsoft-365/enterprise/view-licenses-and-services-with-microsoft-365-powershell?view=o365-worldwide" class="bare">https://learn.microsoft.com/en-us/microsoft-365/enterprise/view-licenses-and-services-with-microsoft-365-powershell?view=o365-worldwide</a></p>
</li>
<li>
<p><a id="mgraph-view-licensed-and-unlicensed-users"></a>[8] <a href="https://learn.microsoft.com/en-us/microsoft-365/enterprise/view-licensed-and-unlicensed-users-with-microsoft-365-powershell?view=o365-worldwide" class="bare">https://learn.microsoft.com/en-us/microsoft-365/enterprise/view-licensed-and-unlicensed-users-with-microsoft-365-powershell?view=o365-worldwide</a></p>
</li>
<li>
<p><a id="mgraph-assign-licenses-to-user-accounts"></a>[9] <a href="https://learn.microsoft.com/en-us/microsoft-365/enterprise/assign-licenses-to-user-accounts-with-microsoft-365-powershell?view=o365-worldwide" class="bare">https://learn.microsoft.com/en-us/microsoft-365/enterprise/assign-licenses-to-user-accounts-with-microsoft-365-powershell?view=o365-worldwide</a></p>
</li>
<li>
<p><a id="mgraph-view-account-license-and-service-details"></a>[10] <a href="https://learn.microsoft.com/en-us/microsoft-365/enterprise/view-account-license-and-service-details-with-microsoft-365-powershell?view=o365-worldwide" class="bare">https://learn.microsoft.com/en-us/microsoft-365/enterprise/view-account-license-and-service-details-with-microsoft-365-powershell?view=o365-worldwide</a></p>
</li>
<li>
<p><a id="mgraph-remove-licenses-from-user-accounts"></a>[11] <a href="https://learn.microsoft.com/en-us/microsoft-365/enterprise/remove-licenses-from-user-accounts-with-microsoft-365-powershell?view=o365-worldwide" class="bare">https://learn.microsoft.com/en-us/microsoft-365/enterprise/remove-licenses-from-user-accounts-with-microsoft-365-powershell?view=o365-worldwide</a></p>
</li>
<li>
<p><a id="exo-powershell"></a>[9] <a href="https://learn.microsoft.com/en-us/powershell/exchange/exchange-online-powershell?view=exchange-ps" class="bare">https://learn.microsoft.com/en-us/powershell/exchange/exchange-online-powershell?view=exchange-ps</a></p>
</li>
<li>
<p><a id="azps"></a>[10] <a href="https://learn.microsoft.com/en-us/powershell/azure/what-is-azure-powershell?view=azps-10.1.0" class="bare">https://learn.microsoft.com/en-us/powershell/azure/what-is-azure-powershell?view=azps-10.1.0</a></p>
</li>
<li>
<p><a id="azps-install-win"></a>[11] <a href="https://learn.microsoft.com/en-us/powershell/azure/install-azps-windows?view=azps-10.1.0&amp;tabs=windowspowershell&amp;pivots=windows-psgallery" class="bare">https://learn.microsoft.com/en-us/powershell/azure/install-azps-windows?view=azps-10.1.0&amp;tabs=windowspowershell&amp;pivots=windows-psgallery</a></p>
</li>
<li>
<p><a id="azps-authz"></a>[12] <a href="https://learn.microsoft.com/en-us/powershell/azure/authenticate-azureps?view=azps-10.1.0" class="bare">https://learn.microsoft.com/en-us/powershell/azure/authenticate-azureps?view=azps-10.1.0</a></p>
</li>
</ul>
</div>
</div>
</div>
    
<style>
  .utterances {
      max-width: 100%;
  }
</style>
<script src="https://utteranc.es/client.js"
        repo="ousiax/utterances"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2023/06/30/character-encoding-ascii-unicode/">&laquo; Character encoding, ASCII, Unicode</a>
      
    </li>
    <li>
      
      <a href="/2023/07/11/what-is-opentelemetry/">What is OpenTelemetry &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
